(function(){$.ajax({url:"//munchkin.marketo.net/munchkin.js",dataType:"script",cache:true,success:function(){Munchkin.init("369-GED-718",{cookieAnon:true})}});(function(){var c="LkYToQZAwO4I1NRbbQFqQEEzy4KK44sI";var d=window.analytics=window.analytics||[];if(d.initialize){return}if(d.invoked){if(window.console&&console.error){console.error("Segment snippet included twice.")}return}d.invoked=true;d.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","page","once","off","on"];d.factory=function(g){return function(){var h=Array.prototype.slice.call(arguments);h.unshift(g);d.push(h);return d}};for(var f=0;f<d.methods.length;f++){var e=d.methods[f];d[e]=d.factory(e)}d.load=function(h){var g=document.createElement("script");g.type="text/javascript";g.async=true;g.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+h+"/analytics.min.js";var j=document.getElementsByTagName("script")[0];j.parentNode.insertBefore(g,j)};d.SNIPPET_VERSION="3.1.0";d.load(c);d.page()})();(function(){var c=function(){var h="YYYY-MM-DDTHH:mm:ssZ";var g=false,j=null,f=null,k=null,e=null,d=false;this.setIsAdmin=function(l){g=l};this.getIsAdmin=function(){return g};this.setAccount=function(l){j=l};this.getAccount=function(){return j};this.setUser=function(l){f=l};this.getUser=function(){return f};this.setAccountMetaData=function(l){k=l};this.getAccountMetaData=function(){return k};this.setAccountUserMetaData=function(l){e=l};this.getAccountUserMetaData=function(){return e};this.setDebug=function(l){d=l};this.getDebug=function(){return d};this.editorLoad=function(){j=GliffyApp.authController.get("account");f=GliffyApp.authController.get("user");g=GliffyApp.authController.get("propIsAccountAdmin");if(j!==null){e=GliffyApp.authController.get("account").get("accountUserMetadata");k=GliffyApp.authController.get("account").get("accountMetadata")}if($.cookie("account-created")==="true"){$.removeCookie("account-created",{path:"/"});this.segmentTracking(true,false)}this.enableDebugModeIfNotProduction()};this.ajaxLoadAccount=function(){var l=$.ajax({url:"/go/api/fullaccountdata",async:false});l.success(function(m){if(m){j=m.account;f=j.user;g=(j.userRole==="ADMIN");e=j.accountUserMetadata;k=j.accountMetadata}})};this.segmentTracking=function(p,l){var o=moment(f.createdDate+"-6","XZ");var n=moment.unix(j.createdDateMilli);var q={Account_Id_Online:j.id,email:f.email,Creator_Email_Online:f.email,User_Create_Date_Online:o.format(h),Creator_User_Id_Online:f.uid,Account_Create_Date_Online:n.format(h),Account_Status_Online:j.status,Max_Users_Online:(j.get_max_users==="function")?j.get_max_users():j.maxUsers,Number_Of_Users_Online:j.userCount,Account_Product_Type_Online:j.productType,Account_Product_Id:j.productId,Billing_Period_Online:j.billingPeriod,Billing_Price_Online:(j.billingPrice/100)};if(d===true){q.Debug_Online=true}if(j.daysLeftUntilTrialExpiration>=0){var m=new Date();m=m.setDate(m.getDate()+j.daysLeftUntilTrialExpiration);var r=moment(m);q.Trial_Expiration_Date_Online=r.format(h)}if(typeof k!=="undefined"&&k!==null){if(k.organizationSizeMin>0){q.Organization_Size_Min_Online=k.organizationSizeMin;q.Organization_Size_Max_Online=k.organizationSizeMax}if(e.organizationName&&e.organizationName.length>0){q.Organization_Name_Online=e.organizationName;q.company=e.organizationName}if(e.phone!==""){q.phone=e.phone}if(e.title!==""){q.title=e.title;q.Creator_Title_Online=e.title}}if(typeof e.name!=="undefined"&&e.name!==null&&e.name.trim().length>0){q.name=e.name;q.Creator_Name_Online=e.name}else{q.name=f.username;q.Creator_Name_Online=f.username}if(p){analytics.identify(j.id,q,{Salesforce:true})}if(l){analytics.group(j.id,q,{Salesforce:true})}return q};this.enableDebugModeIfNotProduction=function(){if(!window.GLIFFY.ENV.isProduction){d=true}if(typeof analytics.debug==="function"){if(d===true){analytics.debug()}else{analytics.debug(false)}}};this.logout=function(){analytics.reset()}};window.segmentUtils=new c();$("body").on("editorAndTemplatesReady",$.proxy(window.segmentUtils.editorLoad,window.segmentUtils))}());var b=new Array("Afghanistan","Albania","Algeria","American Samoa","Angola","Anguilla","Antarctica","Antigua and Barbuda","Argentina","Armenia","Aruba","Ashmore and Cartier Island","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burma","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Cayman Islands","Central African Republic","Chad","Chile","China","Christmas Island","Clipperton Island","Cocos (Keeling) Islands","Colombia","Comoros","Congo, Democratic Republic of the","Congo, Republic of the","Cook Islands","Costa Rica","Cote d'Ivoire","Croatia","Cuba","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Europa Island","Falkland Islands (Islas Malvinas)","Faroe Islands","Fiji","Finland","France","French Guiana","French Polynesia","French Southern and Antarctic Lands","Gabon","Gambia, The","Gaza Strip","Georgia","Germany","Ghana","Gibraltar","Glorioso Islands","Greece","Greenland","Grenada","Guadeloupe","Guam","Guatemala","Guernsey","Guinea","Guinea-Bissau","Guyana","Haiti","Heard Island and McDonald Islands","Holy See (Vatican City)","Honduras","Hong Kong","Howland Island","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Ireland, Northern","Israel","Italy","Jamaica","Jan Mayen","Japan","Jarvis Island","Jersey","Johnston Atoll","Jordan","Juan de Nova Island","Kazakhstan","Kenya","Kiribati","Korea, North","Korea, South","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macau","Macedonia, Former Yugoslav Republic of","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Man, Isle of","Marshall Islands","Martinique","Mauritania","Mauritius","Mayotte","Mexico","Micronesia, Federated States of","Midway Islands","Moldova","Monaco","Mongolia","Montserrat","Morocco","Mozambique","Namibia","Nauru","Nepal","Netherlands","Netherlands Antilles","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","Niue","Norfolk Island","Northern Mariana Islands","Norway","Oman","Pakistan","Palau","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Pitcaim Islands","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russia","Rwanda","Saint Helena","Saint Kitts and Nevis","Saint Lucia","Saint Pierre and Miquelon","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Scotland","Senegal","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Georgia and South Sandwich Islands","Spain","Spratly Islands","Sri Lanka","Sudan","Suriname","Svalbard","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Tobago","Toga","Tokelau","Tonga","Trinidad","Tunisia","Turkey","Turkmenistan","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","Uruguay","USA","Uzbekistan","Vanuatu","Venezuela","Vietnam","Virgin Islands","Wales","Wallis and Futuna","West Bank","Western Sahara","Yemen","Yugoslavia","Zambia","Zimbabwe");var a=new Array();a[0]="";a[1]="Badakhshan|Badghis|Baghlan|Balkh|Bamian|Farah|Faryab|Ghazni|Ghowr|Helmand|Herat|Jowzjan|Kabol|Kandahar|Kapisa|Konar|Kondoz|Laghman|Lowgar|Nangarhar|Nimruz|Oruzgan|Paktia|Paktika|Parvan|Samangan|Sar-e Pol|Takhar|Vardak|Zabol";a[2]="Berat|Bulqize|Delvine|Devoll (Bilisht)|Diber (Peshkopi)|Durres|Elbasan|Fier|Gjirokaster|Gramsh|Has (Krume)|Kavaje|Kolonje (Erseke)|Korce|Kruje|Kucove|Kukes|Kurbin|Lezhe|Librazhd|Lushnje|Malesi e Madhe (Koplik)|Mallakaster (Ballsh)|Mat (Burrel)|Mirdite (Rreshen)|Peqin|Permet|Pogradec|Puke|Sarande|Shkoder|Skrapar (Corovode)|Tepelene|Tirane (Tirana)|Tirane (Tirana)|Tropoje (Bajram Curri)|Vlore";a[3]="Adrar|Ain Defla|Ain Temouchent|Alger|Annaba|Batna|Bechar|Bejaia|Biskra|Blida|Bordj Bou Arreridj|Bouira|Boumerdes|Chlef|Constantine|Djelfa|El Bayadh|El Oued|El Tarf|Ghardaia|Guelma|Illizi|Jijel|Khenchela|Laghouat|M'Sila|Mascara|Medea|Mila|Mostaganem|Naama|Oran|Ouargla|Oum el Bouaghi|Relizane|Saida|Setif|Sidi Bel Abbes|Skikda|Souk Ahras|Tamanghasset|Tebessa|Tiaret|Tindouf|Tipaza|Tissemsilt|Tizi Ouzou|Tlemcen";a[4]="Eastern|Manu'a|Rose Island|Swains Island|Western";a[5]="Andorra la Vella|Bengo|Benguela|Bie|Cabinda|Canillo|Cuando Cubango|Cuanza Norte|Cuanza Sul|Cunene|Encamp|Escaldes-Engordany|Huambo|Huila|La Massana|Luanda|Lunda Norte|Lunda Sul|Malanje|Moxico|Namibe|Ordino|Sant Julia de Loria|Uige|Zaire";a[6]="Anguilla";a[7]="Antarctica";a[8]="Barbuda|Redonda|Saint George|Saint John|Saint Mary|Saint Paul|Saint Peter|Saint Philip";a[9]="Antartica e Islas del Atlantico Sur|Buenos Aires|Buenos Aires Capital Federal|Catamarca|Chaco|Chubut|Cordoba|Corrientes|Entre Rios|Formosa|Jujuy|La Pampa|La Rioja|Mendoza|Misiones|Neuquen|Rio Negro|Salta|San Juan|San Luis|Santa Cruz|Santa Fe|Santiago del Estero|Tierra del Fuego|Tucuman";a[10]="Aragatsotn|Ararat|Armavir|Geghark'unik'|Kotayk'|Lorri|Shirak|Syunik'|Tavush|Vayots' Dzor|Yerevan";a[11]="Aruba";a[12]="Ashmore and Cartier Island";a[13]="Australian Capital Territory|New South Wales|Northern Territory|Queensland|South Australia|Tasmania|Victoria|Western Australia";a[14]="Burgenland|Kaernten|Niederoesterreich|Oberoesterreich|Salzburg|Steiermark|Tirol|Vorarlberg|Wien";a[15]="Abseron Rayonu|Agcabadi Rayonu|Agdam Rayonu|Agdas Rayonu|Agstafa Rayonu|Agsu Rayonu|Ali Bayramli Sahari|Astara Rayonu|Baki Sahari|Balakan Rayonu|Barda Rayonu|Beylaqan Rayonu|Bilasuvar Rayonu|Cabrayil Rayonu|Calilabad Rayonu|Daskasan Rayonu|Davaci Rayonu|Fuzuli Rayonu|Gadabay Rayonu|Ganca Sahari|Goranboy Rayonu|Goycay Rayonu|Haciqabul Rayonu|Imisli Rayonu|Ismayilli Rayonu|Kalbacar Rayonu|Kurdamir Rayonu|Lacin Rayonu|Lankaran Rayonu|Lankaran Sahari|Lerik Rayonu|Masalli Rayonu|Mingacevir Sahari|Naftalan Sahari|Naxcivan Muxtar Respublikasi|Neftcala Rayonu|Oguz Rayonu|Qabala Rayonu|Qax Rayonu|Qazax Rayonu|Qobustan Rayonu|Quba Rayonu|Qubadli Rayonu|Qusar Rayonu|Saatli Rayonu|Sabirabad Rayonu|Saki Rayonu|Saki Sahari|Salyan Rayonu|Samaxi Rayonu|Samkir Rayonu|Samux Rayonu|Siyazan Rayonu|Sumqayit Sahari|Susa Rayonu|Susa Sahari|Tartar Rayonu|Tovuz Rayonu|Ucar Rayonu|Xacmaz Rayonu|Xankandi Sahari|Xanlar Rayonu|Xizi Rayonu|Xocali Rayonu|Xocavand Rayonu|Yardimli Rayonu|Yevlax Rayonu|Yevlax Sahari|Zangilan Rayonu|Zaqatala Rayonu|Zardab Rayonu";a[16]="Acklins and Crooked Islands|Bimini|Cat Island|Exuma|Freeport|Fresh Creek|Governor's Harbour|Green Turtle Cay|Harbour Island|High Rock|Inagua|Kemps Bay|Long Island|Marsh Harbour|Mayaguana|New Providence|Nicholls Town and Berry Islands|Ragged Island|Rock Sound|San Salvador and Rum Cay|Sandy Point";a[17]="Al Hadd|Al Manamah|Al Mintaqah al Gharbiyah|Al Mintaqah al Wusta|Al Mintaqah ash Shamaliyah|Al Muharraq|Ar Rifa' wa al Mintaqah al Janubiyah|Jidd Hafs|Juzur Hawar|Madinat 'Isa|Madinat Hamad|Sitrah";a[18]="Barguna|Barisal|Bhola|Jhalokati|Patuakhali|Pirojpur|Bandarban|Brahmanbaria|Chandpur|Chittagong|Comilla|Cox's Bazar|Feni|Khagrachari|Lakshmipur|Noakhali|Rangamati|Dhaka|Faridpur|Gazipur|Gopalganj|Jamalpur|Kishoreganj|Madaripur|Manikganj|Munshiganj|Mymensingh|Narayanganj|Narsingdi|Netrokona|Rajbari|Shariatpur|Sherpur|Tangail|Bagerhat|Chuadanga|Jessore|Jhenaidah|Khulna|Kushtia|Magura|Meherpur|Narail|Satkhira|Bogra|Dinajpur|Gaibandha|Jaipurhat|Kurigram|Lalmonirhat|Naogaon|Natore|Nawabganj|Nilphamari|Pabna|Panchagarh|Rajshahi|Rangpur|Sirajganj|Thakurgaon|Habiganj|Maulvi bazar|Sunamganj|Sylhet";a[19]="Bridgetown|Christ Church|Saint Andrew|Saint George|Saint James|Saint John|Saint Joseph|Saint Lucy|Saint Michael|Saint Peter|Saint Philip|Saint Thomas";a[20]="Brestskaya (Brest)|Homyel'skaya (Homyel')|Horad Minsk|Hrodzyenskaya (Hrodna)|Mahilyowskaya (Mahilyow)|Minskaya|Vitsyebskaya (Vitsyebsk)";a[21]="Antwerpen|Brabant Wallon|Brussels Capitol Region|Hainaut|Liege|Limburg|Luxembourg|Namur|Oost-Vlaanderen|Vlaams Brabant|West-Vlaanderen";a[22]="Belize|Cayo|Corozal|Orange Walk|Stann Creek|Toledo";a[23]="Alibori|Atakora|Atlantique|Borgou|Collines|Couffo|Donga|Littoral|Mono|Oueme|Plateau|Zou";a[24]="Devonshire|Hamilton|Hamilton|Paget|Pembroke|Saint George|Saint Georges|Sandys|Smiths|Southampton|Warwick";a[25]="Bumthang|Chhukha|Chirang|Daga|Geylegphug|Ha|Lhuntshi|Mongar|Paro|Pemagatsel|Punakha|Samchi|Samdrup Jongkhar|Shemgang|Tashigang|Thimphu|Tongsa|Wangdi Phodrang";a[26]="Beni|Chuquisaca|Cochabamba|La Paz|Oruro|Pando|Potosi|Santa Cruz|Tarija";a[27]="Federation of Bosnia and Herzegovina|Republika Srpska";a[28]="Central|Chobe|Francistown|Gaborone|Ghanzi|Kgalagadi|Kgatleng|Kweneng|Lobatse|Ngamiland|North-East|Selebi-Pikwe|South-East|Southern";a[29]="Acre|Alagoas|Amapa|Amazonas|Bahia|Ceara|Distrito Federal|Espirito Santo|Goias|Maranhao|Mato Grosso|Mato Grosso do Sul|Minas Gerais|Para|Paraiba|Parana|Pernambuco|Piaui|Rio de Janeiro|Rio Grande do Norte|Rio Grande do Sul|Rondonia|Roraima|Santa Catarina|Sao Paulo|Sergipe|Tocantins";a[30]="Anegada|Jost Van Dyke|Tortola|Virgin Gorda";a[31]="Belait|Brunei and Muara|Temburong|Tutong";a[32]="Blagoevgrad|Burgas|Dobrich|Gabrovo|Khaskovo|Kurdzhali|Kyustendil|Lovech|Montana|Pazardzhik|Pernik|Pleven|Plovdiv|Razgrad|Ruse|Shumen|Silistra|Sliven|Smolyan|Sofiya|Sofiya-Grad|Stara Zagora|Turgovishte|Varna|Veliko Turnovo|Vidin|Vratsa|Yambol";a[33]="Bale|Bam|Banwa|Bazega|Bougouriba|Boulgou|Boulkiemde|Comoe|Ganzourgou|Gnagna|Gourma|Houet|Ioba|Kadiogo|Kenedougou|Komandjari|Kompienga|Kossi|Koupelogo|Kouritenga|Kourweogo|Leraba|Loroum|Mouhoun|Nahouri|Namentenga|Naumbiel|Nayala|Oubritenga|Oudalan|Passore|Poni|Samentenga|Sanguie|Seno|Sissili|Soum|Sourou|Tapoa|Tuy|Yagha|Yatenga|Ziro|Zondomo|Zoundweogo";a[34]="Ayeyarwady|Bago|Chin State|Kachin State|Kayah State|Kayin State|Magway|Mandalay|Mon State|Rakhine State|Sagaing|Shan State|Tanintharyi|Yangon";a[35]="Bubanza|Bujumbura|Bururi|Cankuzo|Cibitoke|Gitega|Karuzi|Kayanza|Kirundo|Makamba|Muramvya|Muyinga|Mwaro|Ngozi|Rutana|Ruyigi";a[36]="Banteay Mean Cheay|Batdambang|Kampong Cham|Kampong Chhnang|Kampong Spoe|Kampong Thum|Kampot|Kandal|Kaoh Kong|Keb|Kracheh|Mondol Kiri|Otdar Mean Cheay|Pailin|Phnum Penh|Pouthisat|Preah Seihanu (Sihanoukville)|Preah Vihear|Prey Veng|Rotanah Kiri|Siem Reab|Stoeng Treng|Svay Rieng|Takev";a[37]="Adamaoua|Centre|Est|Extreme-Nord|Littoral|Nord|Nord-Ouest|Ouest|Sud|Sud-Ouest";a[38]="Alberta|British Columbia|Manitoba|New Brunswick|Newfoundland|Northwest Territories|Nova Scotia|Nunavut|Ontario|Prince Edward Island|Quebec|Saskatchewan|Yukon Territory";a[39]="Boa Vista|Brava|Maio|Mosteiros|Paul|Porto Novo|Praia|Ribeira Grande|Sal|Santa Catarina|Santa Cruz|Sao Domingos|Sao Filipe|Sao Nicolau|Sao Vicente|Tarrafal";a[40]="Creek|Eastern|Midland|South Town|Spot Bay|Stake Bay|West End|Western";a[41]="Bamingui-Bangoran|Bangui|Basse-Kotto|Gribingui|Haut-Mbomou|Haute-Kotto|Haute-Sangha|Kemo-Gribingui|Lobaye|Mbomou|Nana-Mambere|Ombella-Mpoko|Ouaka|Ouham|Ouham-Pende|Sangha|Vakaga";a[42]="Batha|Biltine|Borkou-Ennedi-Tibesti|Chari-Baguirmi|Guera|Kanem|Lac|Logone Occidental|Logone Oriental|Mayo-Kebbi|Moyen-Chari|Ouaddai|Salamat|Tandjile";a[43]="Aisen del General Carlos Ibanez del Campo|Antofagasta|Araucania|Atacama|Bio-Bio|Coquimbo|Libertador General Bernardo O'Higgins|Los Lagos|Magallanes y de la Antartica Chilena|Maule|Region Metropolitana (Santiago)|Tarapaca|Valparaiso";a[44]="Anhui|Beijing|Chongqing|Fujian|Gansu|Guangdong|Guangxi|Guizhou|Hainan|Hebei|Heilongjiang|Henan|Hubei|Hunan|Jiangsu|Jiangxi|Jilin|Liaoning|Nei Mongol|Ningxia|Qinghai|Shaanxi|Shandong|Shanghai|Shanxi|Sichuan|Tianjin|Xinjiang|Xizang (Tibet)|Yunnan|Zhejiang";a[45]="Christmas Island";a[46]="Clipperton Island";a[47]="Direction Island|Home Island|Horsburgh Island|North Keeling Island|South Island|West Island";a[48]="Amazonas|Antioquia|Arauca|Atlantico|Bolivar|Boyaca|Caldas|Caqueta|Casanare|Cauca|Cesar|Choco|Cordoba|Cundinamarca|Distrito Capital de Santa Fe de Bogota|Guainia|Guaviare|Huila|La Guajira|Magdalena|Meta|Narino|Norte de Santander|Putumayo|Quindio|Risaralda|San Andres y Providencia|Santander|Sucre|Tolima|Valle del Cauca|Vaupes|Vichada";a[49]="Anjouan (Nzwani)|Domoni|Fomboni|Grande Comore (Njazidja)|Moheli (Mwali)|Moroni|Moutsamoudou";a[50]="Bandundu|Bas-Congo|Equateur|Kasai-Occidental|Kasai-Oriental|Katanga|Kinshasa|Maniema|Nord-Kivu|Orientale|Sud-Kivu";a[51]="Bouenza|Brazzaville|Cuvette|Kouilou|Lekoumou|Likouala|Niari|Plateaux|Pool|Sangha";a[52]="Aitutaki|Atiu|Avarua|Mangaia|Manihiki|Manuae|Mauke|Mitiaro|Nassau Island|Palmerston|Penrhyn|Pukapuka|Rakahanga|Rarotonga|Suwarrow|Takutea";a[53]="Alajuela|Cartago|Guanacaste|Heredia|Limon|Puntarenas|San Jose";a[54]="Abengourou|Abidjan|Aboisso|Adiake'|Adzope|Agboville|Agnibilekrou|Ale'pe'|Bangolo|Beoumi|Biankouma|Bocanda|Bondoukou|Bongouanou|Bouafle|Bouake|Bouna|Boundiali|Dabakala|Dabon|Daloa|Danane|Daoukro|Dimbokro|Divo|Duekoue|Ferkessedougou|Gagnoa|Grand Bassam|Grand-Lahou|Guiglo|Issia|Jacqueville|Katiola|Korhogo|Lakota|Man|Mankono|Mbahiakro|Odienne|Oume|Sakassou|San-Pedro|Sassandra|Seguela|Sinfra|Soubre|Tabou|Tanda|Tiassale|Tiebissou|Tingrela|Touba|Toulepleu|Toumodi|Vavoua|Yamoussoukro|Zuenoula";a[55]="Bjelovarsko-Bilogorska Zupanija|Brodsko-Posavska Zupanija|Dubrovacko-Neretvanska Zupanija|Istarska Zupanija|Karlovacka Zupanija|Koprivnicko-Krizevacka Zupanija|Krapinsko-Zagorska Zupanija|Licko-Senjska Zupanija|Medimurska Zupanija|Osjecko-Baranjska Zupanija|Pozesko-Slavonska Zupanija|Primorsko-Goranska Zupanija|Sibensko-Kninska Zupanija|Sisacko-Moslavacka Zupanija|Splitsko-Dalmatinska Zupanija|Varazdinska Zupanija|Viroviticko-Podravska Zupanija|Vukovarsko-Srijemska Zupanija|Zadarska Zupanija|Zagreb|Zagrebacka Zupanija";a[56]="Camaguey|Ciego de Avila|Cienfuegos|Ciudad de La Habana|Granma|Guantanamo|Holguin|Isla de la Juventud|La Habana|Las Tunas|Matanzas|Pinar del Rio|Sancti Spiritus|Santiago de Cuba|Villa Clara";a[57]="Famagusta|Kyrenia|Larnaca|Limassol|Nicosia|Paphos";a[58]="Brnensky|Budejovicky|Jihlavsky|Karlovarsky|Kralovehradecky|Liberecky|Olomoucky|Ostravsky|Pardubicky|Plzensky|Praha|Stredocesky|Ustecky|Zlinsky";a[59]="Arhus|Bornholm|Fredericksberg|Frederiksborg|Fyn|Kobenhavn|Kobenhavns|Nordjylland|Ribe|Ringkobing|Roskilde|Sonderjylland|Storstrom|Vejle|Vestsjalland|Viborg";a[60]="'Ali Sabih|Dikhil|Djibouti|Obock|Tadjoura";a[61]="Saint Andrew|Saint David|Saint George|Saint John|Saint Joseph|Saint Luke|Saint Mark|Saint Patrick|Saint Paul|Saint Peter";a[62]="Azua|Baoruco|Barahona|Dajabon|Distrito Nacional|Duarte|El Seibo|Elias Pina|Espaillat|Hato Mayor|Independencia|La Altagracia|La Romana|La Vega|Maria Trinidad Sanchez|Monsenor Nouel|Monte Cristi|Monte Plata|Pedernales|Peravia|Puerto Plata|Salcedo|Samana|San Cristobal|San Juan|San Pedro de Macoris|Sanchez Ramirez|Santiago|Santiago Rodriguez|Valverde";a[63]="Azuay|Bolivar|Canar|Carchi|Chimborazo|Cotopaxi|El Oro|Esmeraldas|Galapagos|Guayas|Imbabura|Loja|Los Rios|Manabi|Morona-Santiago|Napo|Orellana|Pastaza|Pichincha|Sucumbios|Tungurahua|Zamora-Chinchipe";a[64]="Ad Daqahliyah|Al Bahr al Ahmar|Al Buhayrah|Al Fayyum|Al Gharbiyah|Al Iskandariyah|Al Isma'iliyah|Al Jizah|Al Minufiyah|Al Minya|Al Qahirah|Al Qalyubiyah|Al Wadi al Jadid|As Suways|Ash Sharqiyah|Aswan|Asyut|Bani Suwayf|Bur Sa'id|Dumyat|Janub Sina'|Kafr ash Shaykh|Matruh|Qina|Shamal Sina'|Suhaj";a[65]="Ahuachapan|Cabanas|Chalatenango|Cuscatlan|La Libertad|La Paz|La Union|Morazan|San Miguel|San Salvador|San Vicente|Santa Ana|Sonsonate|Usulutan";a[66]="Annobon|Bioko Norte|Bioko Sur|Centro Sur|Kie-Ntem|Litoral|Wele-Nzas";a[67]="Akale Guzay|Barka|Denkel|Hamasen|Sahil|Semhar|Senhit|Seraye";a[68]="Harjumaa (Tallinn)|Hiiumaa (Kardla)|Ida-Virumaa (Johvi)|Jarvamaa (Paide)|Jogevamaa (Jogeva)|Laane-Virumaa (Rakvere)|Laanemaa (Haapsalu)|Parnumaa (Parnu)|Polvamaa (Polva)|Raplamaa (Rapla)|Saaremaa (Kuessaare)|Tartumaa (Tartu)|Valgamaa (Valga)|Viljandimaa (Viljandi)|Vorumaa (Voru)";a[69]="Adis Abeba (Addis Ababa)|Afar|Amara|Dire Dawa|Gambela Hizboch|Hareri Hizb|Oromiya|Sumale|Tigray|YeDebub Biheroch Bihereseboch na Hizboch";a[70]="Europa Island";a[71]="Falkland Islands (Islas Malvinas)";a[72]="Bordoy|Eysturoy|Mykines|Sandoy|Skuvoy|Streymoy|Suduroy|Tvoroyri|Vagar";a[73]="Central|Eastern|Northern|Rotuma|Western";a[74]="Aland|Etela-Suomen Laani|Ita-Suomen Laani|Lansi-Suomen Laani|Lappi|Oulun Laani";a[75]="Alsace|Aquitaine|Auvergne|Basse-Normandie|Bourgogne|Bretagne|Centre|Champagne-Ardenne|Corse|Franche-Comte|Haute-Normandie|Ile-de-France|Languedoc-Roussillon|Limousin|Lorraine|Midi-Pyrenees|Nord-Pas-de-Calais|Pays de la Loire|Picardie|Poitou-Charentes|Provence-Alpes-Cote d'Azur|Rhone-Alpes";a[76]="French Guiana";a[77]="Archipel des Marquises|Archipel des Tuamotu|Archipel des Tubuai|Iles du Vent|Iles Sous-le-Vent";a[78]="Adelie Land|Ile Crozet|Iles Kerguelen|Iles Saint-Paul et Amsterdam";a[79]="Estuaire|Haut-Ogooue|Moyen-Ogooue|Ngounie|Nyanga|Ogooue-Ivindo|Ogooue-Lolo|Ogooue-Maritime|Woleu-Ntem";a[80]="Banjul|Central River|Lower River|North Bank|Upper River|Western";a[81]="Gaza Strip";a[82]="Abashis|Abkhazia or Ap'khazet'is Avtonomiuri Respublika (Sokhumi)|Adigenis|Ajaria or Acharis Avtonomiuri Respublika (Bat'umi)|Akhalgoris|Akhalk'alak'is|Akhalts'ikhis|Akhmetis|Ambrolauris|Aspindzis|Baghdat'is|Bolnisis|Borjomis|Ch'khorotsqus|Ch'okhatauris|Chiat'ura|Dedop'listsqaros|Dmanisis|Dushet'is|Gardabanis|Gori|Goris|Gurjaanis|Javis|K'arelis|K'ut'aisi|Kaspis|Kharagaulis|Khashuris|Khobis|Khonis|Lagodekhis|Lanch'khut'is|Lentekhis|Marneulis|Martvilis|Mestiis|Mts'khet'is|Ninotsmindis|Onis|Ozurget'is|P'ot'i|Qazbegis|Qvarlis|Rust'avi|Sach'kheris|Sagarejos|Samtrediis|Senakis|Sighnaghis|T'bilisi|T'elavis|T'erjolis|T'et'ritsqaros|T'ianet'is|Tqibuli|Ts'ageris|Tsalenjikhis|Tsalkis|Tsqaltubo|Vanis|Zestap'onis|Zugdidi|Zugdidis";a[83]="Baden-Wuerttemberg|Bayern|Berlin|Brandenburg|Bremen|Hamburg|Hessen|Mecklenburg-Vorpommern|Niedersachsen|Nordrhein-Westfalen|Rheinland-Pfalz|Saarland|Sachsen|Sachsen-Anhalt|Schleswig-Holstein|Thueringen";a[84]="Ashanti|Brong-Ahafo|Central|Eastern|Greater Accra|Northern|Upper East|Upper West|Volta|Western";a[85]="Gibraltar";a[86]="Ile du Lys|Ile Glorieuse";a[87]="Aitolia kai Akarnania|Akhaia|Argolis|Arkadhia|Arta|Attiki|Ayion Oros (Mt. Athos)|Dhodhekanisos|Drama|Evritania|Evros|Evvoia|Florina|Fokis|Fthiotis|Grevena|Ilia|Imathia|Ioannina|Irakleion|Kardhitsa|Kastoria|Kavala|Kefallinia|Kerkyra|Khalkidhiki|Khania|Khios|Kikladhes|Kilkis|Korinthia|Kozani|Lakonia|Larisa|Lasithi|Lesvos|Levkas|Magnisia|Messinia|Pella|Pieria|Preveza|Rethimni|Rodhopi|Samos|Serrai|Thesprotia|Thessaloniki|Trikala|Voiotia|Xanthi|Zakinthos";a[88]="Avannaa (Nordgronland)|Kitaa (Vestgronland)|Tunu (Ostgronland)";a[89]="Carriacou and Petit Martinique|Saint Andrew|Saint David|Saint George|Saint John|Saint Mark|Saint Patrick";a[90]="Basse-Terre|Grande-Terre|Iles de la Petite Terre|Iles des Saintes|Marie-Galante";a[91]="Guam";a[92]="Alta Verapaz|Baja Verapaz|Chimaltenango|Chiquimula|El Progreso|Escuintla|Guatemala|Huehuetenango|Izabal|Jalapa|Jutiapa|Peten|Quetzaltenango|Quiche|Retalhuleu|Sacatepequez|San Marcos|Santa Rosa|Solola|Suchitepequez|Totonicapan|Zacapa";a[93]="Castel|Forest|St. Andrew|St. Martin|St. Peter Port|St. Pierre du Bois|St. Sampson|St. Saviour|Torteval|Vale";a[94]="Beyla|Boffa|Boke|Conakry|Coyah|Dabola|Dalaba|Dinguiraye|Dubreka|Faranah|Forecariah|Fria|Gaoual|Gueckedou|Kankan|Kerouane|Kindia|Kissidougou|Koubia|Koundara|Kouroussa|Labe|Lelouma|Lola|Macenta|Mali|Mamou|Mandiana|Nzerekore|Pita|Siguiri|Telimele|Tougue|Yomou";a[95]="Bafata|Biombo|Bissau|Bolama-Bijagos|Cacheu|Gabu|Oio|Quinara|Tombali";a[96]="Barima-Waini|Cuyuni-Mazaruni|Demerara-Mahaica|East Berbice-Corentyne|Essequibo Islands-West Demerara|Mahaica-Berbice|Pomeroon-Supenaam|Potaro-Siparuni|Upper Demerara-Berbice|Upper Takutu-Upper Essequibo";a[97]="Artibonite|Centre|Grand'Anse|Nord|Nord-Est|Nord-Ouest|Ouest|Sud|Sud-Est";a[98]="Heard Island and McDonald Islands";a[99]="Holy See (Vatican City)";a[100]="Atlantida|Choluteca|Colon|Comayagua|Copan|Cortes|El Paraiso|Francisco Morazan|Gracias a Dios|Intibuca|Islas de la Bahia|La Paz|Lempira|Ocotepeque|Olancho|Santa Barbara|Valle|Yoro";a[101]="Hong Kong";a[102]="Howland Island";a[103]="Bacs-Kiskun|Baranya|Bekes|Bekescsaba|Borsod-Abauj-Zemplen|Budapest|Csongrad|Debrecen|Dunaujvaros|Eger|Fejer|Gyor|Gyor-Moson-Sopron|Hajdu-Bihar|Heves|Hodmezovasarhely|Jasz-Nagykun-Szolnok|Kaposvar|Kecskemet|Komarom-Esztergom|Miskolc|Nagykanizsa|Nograd|Nyiregyhaza|Pecs|Pest|Somogy|Sopron|Szabolcs-Szatmar-Bereg|Szeged|Szekesfehervar|Szolnok|Szombathely|Tatabanya|Tolna|Vas|Veszprem|Veszprem|Zala|Zalaegerszeg";a[104]="Akranes|Akureyri|Arnessysla|Austur-Bardhastrandarsysla|Austur-Hunavatnssysla|Austur-Skaftafellssysla|Borgarfjardharsysla|Dalasysla|Eyjafjardharsysla|Gullbringusysla|Hafnarfjordhur|Husavik|Isafjordhur|Keflavik|Kjosarsysla|Kopavogur|Myrasysla|Neskaupstadhur|Nordhur-Isafjardharsysla|Nordhur-Mulasys-la|Nordhur-Thingeyjarsysla|Olafsfjordhur|Rangarvallasysla|Reykjavik|Saudharkrokur|Seydhisfjordhur|Siglufjordhur|Skagafjardharsysla|Snaefellsnes-og Hnappadalssysla|Strandasysla|Sudhur-Mulasysla|Sudhur-Thingeyjarsysla|Vesttmannaeyjar|Vestur-Bardhastrandarsysla|Vestur-Hunavatnssysla|Vestur-Isafjardharsysla|Vestur-Skaftafellssysla";a[105]="Andaman and Nicobar Islands|Andhra Pradesh|Arunachal Pradesh|Assam|Bihar|Chandigarh|Chhattisgarh|Dadra and Nagar Haveli|Daman and Diu|Delhi|Goa|Gujarat|Haryana|Himachal Pradesh|Jammu and Kashmir|Jharkhand|Karnataka|Kerala|Lakshadweep|Madhya Pradesh|Maharashtra|Manipur|Meghalaya|Mizoram|Nagaland|Orissa|Pondicherry|Punjab|Rajasthan|Sikkim|Tamil Nadu|Tripura|Uttar Pradesh|Uttaranchal|West Bengal";a[106]="Aceh|Bali|Banten|Bengkulu|East Timor|Gorontalo|Irian Jaya|Jakarta Raya|Jambi|Jawa Barat|Jawa Tengah|Jawa Timur|Kalimantan Barat|Kalimantan Selatan|Kalimantan Tengah|Kalimantan Timur|Kepulauan Bangka Belitung|Lampung|Maluku|Maluku Utara|Nusa Tenggara Barat|Nusa Tenggara Timur|Riau|Sulawesi Selatan|Sulawesi Tengah|Sulawesi Tenggara|Sulawesi Utara|Sumatera Barat|Sumatera Selatan|Sumatera Utara|Yogyakarta";a[107]="Ardabil|Azarbayjan-e Gharbi|Azarbayjan-e Sharqi|Bushehr|Chahar Mahall va Bakhtiari|Esfahan|Fars|Gilan|Golestan|Hamadan|Hormozgan|Ilam|Kerman|Kermanshah|Khorasan|Khuzestan|Kohgiluyeh va Buyer Ahmad|Kordestan|Lorestan|Markazi|Mazandaran|Qazvin|Qom|Semnan|Sistan va Baluchestan|Tehran|Yazd|Zanjan";a[108]="Al Anbar|Al Basrah|Al Muthanna|Al Qadisiyah|An Najaf|Arbil|As Sulaymaniyah|At Ta'mim|Babil|Baghdad|Dahuk|Dhi Qar|Diyala|Karbala'|Maysan|Ninawa|Salah ad Din|Wasit";a[109]="Carlow|Cavan|Clare|Cork|Donegal|Dublin|Galway|Kerry|Kildare|Kilkenny|Laois|Leitrim|Limerick|Longford|Louth|Mayo|Meath|Monaghan|Offaly|Roscommon|Sligo|Tipperary|Waterford|Westmeath|Wexford|Wicklow";a[110]="Antrim|Ards|Armagh|Ballymena|Ballymoney|Banbridge|Belfast|Carrickfergus|Castlereagh|Coleraine|Cookstown|Craigavon|Derry|Down|Dungannon|Fermanagh|Larne|Limavady|Lisburn|Magherafelt|Moyle|Newry and Mourne|Newtownabbey|North Down|Omagh|Strabane";a[111]="Central|Haifa|Jerusalem|Northern|Southern|Tel Aviv";a[112]="Abruzzo|Basilicata|Calabria|Campania|Emilia-Romagna|Friuli-Venezia Giulia|Lazio|Liguria|Lombardia|Marche|Molise|Piemonte|Puglia|Sardegna|Sicilia|Toscana|Trentino-Alto Adige|Umbria|Valle d'Aosta|Veneto";a[113]="Clarendon|Hanover|Kingston|Manchester|Portland|Saint Andrew|Saint Ann|Saint Catherine|Saint Elizabeth|Saint James|Saint Mary|Saint Thomas|Trelawny|Westmoreland";a[114]="Jan Mayen";a[115]="Aichi|Akita|Aomori|Chiba|Ehime|Fukui|Fukuoka|Fukushima|Gifu|Gumma|Hiroshima|Hokkaido|Hyogo|Ibaraki|Ishikawa|Iwate|Kagawa|Kagoshima|Kanagawa|Kochi|Kumamoto|Kyoto|Mie|Miyagi|Miyazaki|Nagano|Nagasaki|Nara|Niigata|Oita|Okayama|Okinawa|Osaka|Saga|Saitama|Shiga|Shimane|Shizuoka|Tochigi|Tokushima|Tokyo|Tottori|Toyama|Wakayama|Yamagata|Yamaguchi|Yamanashi";a[116]="Jarvis Island";a[117]="Jersey";a[118]="Johnston Atoll";a[119]="'Amman|Ajlun|Al 'Aqabah|Al Balqa'|Al Karak|Al Mafraq|At Tafilah|Az Zarqa'|Irbid|Jarash|Ma'an|Madaba";a[120]="Juan de Nova Island";a[121]="Almaty|Aqmola|Aqtobe|Astana|Atyrau|Batys Qazaqstan|Bayqongyr|Mangghystau|Ongtustik Qazaqstan|Pavlodar|Qaraghandy|Qostanay|Qyzylorda|Shyghys Qazaqstan|Soltustik Qazaqstan|Zhambyl";a[122]="Central|Coast|Eastern|Nairobi Area|North Eastern|Nyanza|Rift Valley|Western";a[123]="Abaiang|Abemama|Aranuka|Arorae|Banaba|Banaba|Beru|Butaritari|Central Gilberts|Gilbert Islands|Kanton|Kiritimati|Kuria|Line Islands|Line Islands|Maiana|Makin|Marakei|Nikunau|Nonouti|Northern Gilberts|Onotoa|Phoenix Islands|Southern Gilberts|Tabiteuea|Tabuaeran|Tamana|Tarawa|Tarawa|Teraina";a[124]="Chagang-do (Chagang Province)|Hamgyong-bukto (North Hamgyong Province)|Hamgyong-namdo (South Hamgyong Province)|Hwanghae-bukto (North Hwanghae Province)|Hwanghae-namdo (South Hwanghae Province)|Kaesong-si (Kaesong City)|Kangwon-do (Kangwon Province)|Namp'o-si (Namp'o City)|P'yongan-bukto (North P'yongan Province)|P'yongan-namdo (South P'yongan Province)|P'yongyang-si (P'yongyang City)|Yanggang-do (Yanggang Province)";a[125]="Ch'ungch'ong-bukto|Ch'ungch'ong-namdo|Cheju-do|Cholla-bukto|Cholla-namdo|Inch'on-gwangyoksi|Kangwon-do|Kwangju-gwangyoksi|Kyonggi-do|Kyongsang-bukto|Kyongsang-namdo|Pusan-gwangyoksi|Soul-t'ukpyolsi|Taegu-gwangyoksi|Taejon-gwangyoksi|Ulsan-gwangyoksi";a[126]="Al 'Asimah|Al Ahmadi|Al Farwaniyah|Al Jahra'|Hawalli";a[127]="Batken Oblasty|Bishkek Shaary|Chuy Oblasty (Bishkek)|Jalal-Abad Oblasty|Naryn Oblasty|Osh Oblasty|Talas Oblasty|Ysyk-Kol Oblasty (Karakol)";a[128]="Attapu|Bokeo|Bolikhamxai|Champasak|Houaphan|Khammouan|Louangnamtha|Louangphabang|Oudomxai|Phongsali|Salavan|Savannakhet|Viangchan|Viangchan|Xaignabouli|Xaisomboun|Xekong|Xiangkhoang";a[129]="Aizkraukles Rajons|Aluksnes Rajons|Balvu Rajons|Bauskas Rajons|Cesu Rajons|Daugavpils|Daugavpils Rajons|Dobeles Rajons|Gulbenes Rajons|Jekabpils Rajons|Jelgava|Jelgavas Rajons|Jurmala|Kraslavas Rajons|Kuldigas Rajons|Leipaja|Liepajas Rajons|Limbazu Rajons|Ludzas Rajons|Madonas Rajons|Ogres Rajons|Preilu Rajons|Rezekne|Rezeknes Rajons|Riga|Rigas Rajons|Saldus Rajons|Talsu Rajons|Tukuma Rajons|Valkas Rajons|Valmieras Rajons|Ventspils|Ventspils Rajons";a[130]="Beyrouth|Ech Chimal|Ej Jnoub|El Bekaa|Jabal Loubnane";a[131]="Berea|Butha-Buthe|Leribe|Mafeteng|Maseru|Mohales Hoek|Mokhotlong|Qacha's Nek|Quthing|Thaba-Tseka";a[132]="Bomi|Bong|Grand Bassa|Grand Cape Mount|Grand Gedeh|Grand Kru|Lofa|Margibi|Maryland|Montserrado|Nimba|River Cess|Sinoe";a[133]="Ajdabiya|Al 'Aziziyah|Al Fatih|Al Jabal al Akhdar|Al Jufrah|Al Khums|Al Kufrah|An Nuqat al Khams|Ash Shati'|Awbari|Az Zawiyah|Banghazi|Darnah|Ghadamis|Gharyan|Misratah|Murzuq|Sabha|Sawfajjin|Surt|Tarabulus|Tarhunah|Tubruq|Yafran|Zlitan";a[134]="Balzers|Eschen|Gamprin|Mauren|Planken|Ruggell|Schaan|Schellenberg|Triesen|Triesenberg|Vaduz";a[135]="Akmenes Rajonas|Alytaus Rajonas|Alytus|Anyksciu Rajonas|Birstonas|Birzu Rajonas|Druskininkai|Ignalinos Rajonas|Jonavos Rajonas|Joniskio Rajonas|Jurbarko Rajonas|Kaisiadoriu Rajonas|Kaunas|Kauno Rajonas|Kedainiu Rajonas|Kelmes Rajonas|Klaipeda|Klaipedos Rajonas|Kretingos Rajonas|Kupiskio Rajonas|Lazdiju Rajonas|Marijampole|Marijampoles Rajonas|Mazeikiu Rajonas|Moletu Rajonas|Neringa Pakruojo Rajonas|Palanga|Panevezio Rajonas|Panevezys|Pasvalio Rajonas|Plunges Rajonas|Prienu Rajonas|Radviliskio Rajonas|Raseiniu Rajonas|Rokiskio Rajonas|Sakiu Rajonas|Salcininku Rajonas|Siauliai|Siauliu Rajonas|Silales Rajonas|Silutes Rajonas|Sirvintu Rajonas|Skuodo Rajonas|Svencioniu Rajonas|Taurages Rajonas|Telsiu Rajonas|Traku Rajonas|Ukmerges Rajonas|Utenos Rajonas|Varenos Rajonas|Vilkaviskio Rajonas|Vilniaus Rajonas|Vilnius|Zarasu Rajonas";a[136]="Diekirch|Grevenmacher|Luxembourg";a[137]="Macau";a[138]="Aracinovo|Bac|Belcista|Berovo|Bistrica|Bitola|Blatec|Bogdanci|Bogomila|Bogovinje|Bosilovo|Brvenica|Cair (Skopje)|Capari|Caska|Cegrane|Centar (Skopje)|Centar Zupa|Cesinovo|Cucer-Sandevo|Debar|Delcevo|Delogozdi|Demir Hisar|Demir Kapija|Dobrusevo|Dolna Banjica|Dolneni|Dorce Petrov (Skopje)|Drugovo|Dzepciste|Gazi Baba (Skopje)|Gevgelija|Gostivar|Gradsko|Ilinden|Izvor|Jegunovce|Kamenjane|Karbinci|Karpos (Skopje)|Kavadarci|Kicevo|Kisela Voda (Skopje)|Klecevce|Kocani|Konce|Kondovo|Konopiste|Kosel|Kratovo|Kriva Palanka|Krivogastani|Krusevo|Kuklis|Kukurecani|Kumanovo|Labunista|Lipkovo|Lozovo|Lukovo|Makedonska Kamenica|Makedonski Brod|Mavrovi Anovi|Meseista|Miravci|Mogila|Murtino|Negotino|Negotino-Poloska|Novaci|Novo Selo|Oblesevo|Ohrid|Orasac|Orizari|Oslomej|Pehcevo|Petrovec|Plasnia|Podares|Prilep|Probistip|Radovis|Rankovce|Resen|Rosoman|Rostusa|Samokov|Saraj|Sipkovica|Sopiste|Sopotnika|Srbinovo|Star Dojran|Staravina|Staro Nagoricane|Stip|Struga|Strumica|Studenicani|Suto Orizari (Skopje)|Sveti Nikole|Tearce|Tetovo|Topolcani|Valandovo|Vasilevo|Veles|Velesta|Vevcani|Vinica|Vitoliste|Vranestica|Vrapciste|Vratnica|Vrutok|Zajas|Zelenikovo|Zileno|Zitose|Zletovo|Zrnovci";a[139]="Antananarivo|Antsiranana|Fianarantsoa|Mahajanga|Toamasina|Toliara";a[140]="Balaka|Blantyre|Chikwawa|Chiradzulu|Chitipa|Dedza|Dowa|Karonga|Kasungu|Likoma|Lilongwe|Machinga (Kasupe)|Mangochi|Mchinji|Mulanje|Mwanza|Mzimba|Nkhata Bay|Nkhotakota|Nsanje|Ntcheu|Ntchisi|Phalombe|Rumphi|Salima|Thyolo|Zomba";a[141]="Johor|Kedah|Kelantan|Labuan|Melaka|Negeri Sembilan|Pahang|Perak|Perlis|Pulau Pinang|Sabah|Sarawak|Selangor|Terengganu|Wilayah Persekutuan";a[142]="Alifu|Baa|Dhaalu|Faafu|Gaafu Alifu|Gaafu Dhaalu|Gnaviyani|Haa Alifu|Haa Dhaalu|Kaafu|Laamu|Lhaviyani|Maale|Meemu|Noonu|Raa|Seenu|Shaviyani|Thaa|Vaavu";a[143]="Gao|Kayes|Kidal|Koulikoro|Mopti|Segou|Sikasso|Tombouctou";a[144]="Valletta";a[145]="Man, Isle of";a[146]="Ailinginae|Ailinglaplap|Ailuk|Arno|Aur|Bikar|Bikini|Bokak|Ebon|Enewetak|Erikub|Jabat|Jaluit|Jemo|Kili|Kwajalein|Lae|Lib|Likiep|Majuro|Maloelap|Mejit|Mili|Namorik|Namu|Rongelap|Rongrik|Toke|Ujae|Ujelang|Utirik|Wotho|Wotje";a[147]="Martinique";a[148]="Adrar|Assaba|Brakna|Dakhlet Nouadhibou|Gorgol|Guidimaka|Hodh Ech Chargui|Hodh El Gharbi|Inchiri|Nouakchott|Tagant|Tiris Zemmour|Trarza";a[149]="Agalega Islands|Black River|Cargados Carajos Shoals|Flacq|Grand Port|Moka|Pamplemousses|Plaines Wilhems|Port Louis|Riviere du Rempart|Rodrigues|Savanne";a[150]="Mayotte";a[151]="Aguascalientes|Baja California|Baja California Sur|Campeche|Chiapas|Chihuahua|Coahuila de Zaragoza|Colima|Distrito Federal|Durango|Guanajuato|Guerrero|Hidalgo|Jalisco|Mexico|Michoacan de Ocampo|Morelos|Nayarit|Nuevo Leon|Oaxaca|Puebla|Queretaro de Arteaga|Quintana Roo|San Luis Potosi|Sinaloa|Sonora|Tabasco|Tamaulipas|Tlaxcala|Veracruz-Llave|Yucatan|Zacatecas";a[152]="Chuuk (Truk)|Kosrae|Pohnpei|Yap";a[153]="Midway Islands";a[154]="Balti|Cahul|Chisinau|Chisinau|Dubasari|Edinet|Gagauzia|Lapusna|Orhei|Soroca|Tighina|Ungheni";a[155]="Fontvieille|La Condamine|Monaco-Ville|Monte-Carlo";a[156]="Arhangay|Bayan-Olgiy|Bayanhongor|Bulgan|Darhan|Dornod|Dornogovi|Dundgovi|Dzavhan|Erdenet|Govi-Altay|Hentiy|Hovd|Hovsgol|Omnogovi|Ovorhangay|Selenge|Suhbaatar|Tov|Ulaanbaatar|Uvs";a[157]="Saint Anthony|Saint Georges|Saint Peter's";a[158]="Agadir|Al Hoceima|Azilal|Ben Slimane|Beni Mellal|Boulemane|Casablanca|Chaouen|El Jadida|El Kelaa des Srarhna|Er Rachidia|Essaouira|Fes|Figuig|Guelmim|Ifrane|Kenitra|Khemisset|Khenifra|Khouribga|Laayoune|Larache|Marrakech|Meknes|Nador|Ouarzazate|Oujda|Rabat-Sale|Safi|Settat|Sidi Kacem|Tan-Tan|Tanger|Taounate|Taroudannt|Tata|Taza|Tetouan|Tiznit";a[159]="Cabo Delgado|Gaza|Inhambane|Manica|Maputo|Nampula|Niassa|Sofala|Tete|Zambezia";a[160]="Caprivi|Erongo|Hardap|Karas|Khomas|Kunene|Ohangwena|Okavango|Omaheke|Omusati|Oshana|Oshikoto|Otjozondjupa";a[161]="Aiwo|Anabar|Anetan|Anibare|Baiti|Boe|Buada|Denigomodu|Ewa|Ijuw|Meneng|Nibok|Uaboe|Yaren";a[162]="Bagmati|Bheri|Dhawalagiri|Gandaki|Janakpur|Karnali|Kosi|Lumbini|Mahakali|Mechi|Narayani|Rapti|Sagarmatha|Seti";a[163]="Drenthe|Flevoland|Friesland|Gelderland|Groningen|Limburg|Noord-Brabant|Noord-Holland|Overijssel|Utrecht|Zeeland|Zuid-Holland";a[164]="Netherlands Antilles";a[165]="Iles Loyaute|Nord|Sud";a[166]="Akaroa|Amuri|Auckland|Ashburton|Bay of Islands|Bruce|Buller|Chatham Islands|Cheviot|Christchurch|Clifton|Clutha|Cook|Dannevirke|Egmont|Eketahuna|Ellesmere|Eltham|Eyre|Featherston|Franklin|Golden Bay|Great Barrier Island|Grey|Hauraki Plains|Hawera|Hawke's Bay|Heathcote|Hikurangi|Hobson|Hokianga|Horowhenua|Hurunui|Hutt|Inangahua|Inglewood|Kaikoura|Kairanga|Kiwitea|Lake|Mackenzie|Malvern|Manaia|Manawatu|Mangonui|Maniototo|Marlborough|Masterton|Matamata|Mount Herbert|Ohinemuri|Opotiki|Oroua|Otamatea|Otorohanga|Oxford|Pahiatua|Paparua|Patea|Piako|Pohangina|Raglan|Rangiora|Rangitikei|Rodney|Rotorua|Runanga|Saint Kilda|Silverpeaks|Southland|Stewart Island|Stratford|Strathallan|Taranaki|Taumarunui|Taupo|Tauranga|Thames-Coromandel|Tuapeka|Vincent|Waiapu|Waiheke|Waihemo|Waikato|Waikohu|Waimairi|Waimarino|Waimate|Waimate West|Waimea|Waipa|Waipawa|Waipukurau|Wairarapa South|Wairewa|Wairoa|Waitaki|Waitomo|Waitotara|Wallace|Wanganui|Waverley|Wellington|Westland|Whakatane|Whangarei|Whangaroa|Woodville";a[167]="Atlantico Norte|Atlantico Sur|Boaco|Carazo|Chinandega|Chontales|Esteli|Granada|Jinotega|Leon|Madriz|Managua|Masaya|Matagalpa|Nueva Segovia|Rio San Juan|Rivas";a[168]="Agadez|Diffa|Dosso|Maradi|Niamey|Tahoua|Tillaberi|Zinder";a[169]="Abia|Abuja Federal Capital Territory|Adamawa|Akwa Ibom|Anambra|Bauchi|Bayelsa|Benue|Borno|Cross River|Delta|Ebonyi|Edo|Ekiti|Enugu|Gombe|Imo|Jigawa|Kaduna|Kano|Katsina|Kebbi|Kogi|Kwara|Lagos|Nassarawa|Niger|Ogun|Ondo|Osun|Oyo|Plateau|Rivers|Sokoto|Taraba|Yobe|Zamfara";a[170]="Niue";a[171]="Norfolk Island";a[172]="Northern Islands|Rota|Saipan|Tinian";a[173]="Akershus|Aust-Agder|Buskerud|Finnmark|Hedmark|Hordaland|More og Romsdal|Nord-Trondelag|Nordland|Oppland|Oslo|Ostfold|Rogaland|Sogn og Fjordane|Sor-Trondelag|Telemark|Troms|Vest-Agder|Vestfold";a[174]="Ad Dakhiliyah|Al Batinah|Al Wusta|Ash Sharqiyah|Az Zahirah|Masqat|Musandam|Zufar";a[175]="Balochistan|Federally Administered Tribal Areas|Islamabad Capital Territory|North-West Frontier Province|Punjab|Sindh";a[176]="Aimeliik|Airai|Angaur|Hatobohei|Kayangel|Koror|Melekeok|Ngaraard|Ngarchelong|Ngardmau|Ngatpang|Ngchesar|Ngeremlengui|Ngiwal|Palau Island|Peleliu|Sonsoral|Tobi";a[177]="Bocas del Toro|Chiriqui|Cocle|Colon|Darien|Herrera|Los Santos|Panama|San Blas|Veraguas";a[178]="Bougainville|Central|Chimbu|East New Britain|East Sepik|Eastern Highlands|Enga|Gulf|Madang|Manus|Milne Bay|Morobe|National Capital|New Ireland|Northern|Sandaun|Southern Highlands|West New Britain|Western|Western Highlands";a[179]="Alto Paraguay|Alto Parana|Amambay|Asuncion (city)|Boqueron|Caaguazu|Caazapa|Canindeyu|Central|Concepcion|Cordillera|Guaira|Itapua|Misiones|Neembucu|Paraguari|Presidente Hayes|San Pedro";a[180]="Amazonas|Ancash|Apurimac|Arequipa|Ayacucho|Cajamarca|Callao|Cusco|Huancavelica|Huanuco|Ica|Junin|La Libertad|Lambayeque|Lima|Loreto|Madre de Dios|Moquegua|Pasco|Piura|Puno|San Martin|Tacna|Tumbes|Ucayali";a[181]="Abra|Agusan del Norte|Agusan del Sur|Aklan|Albay|Angeles|Antique|Aurora|Bacolod|Bago|Baguio|Bais|Basilan|Basilan City|Bataan|Batanes|Batangas|Batangas City|Benguet|Bohol|Bukidnon|Bulacan|Butuan|Cabanatuan|Cadiz|Cagayan|Cagayan de Oro|Calbayog|Caloocan|Camarines Norte|Camarines Sur|Camiguin|Canlaon|Capiz|Catanduanes|Cavite|Cavite City|Cebu|Cebu City|Cotabato|Dagupan|Danao|Dapitan|Davao City Davao|Davao del Sur|Davao Oriental|Dipolog|Dumaguete|Eastern Samar|General Santos|Gingoog|Ifugao|Iligan|Ilocos Norte|Ilocos Sur|Iloilo|Iloilo City|Iriga|Isabela|Kalinga-Apayao|La Carlota|La Union|Laguna|Lanao del Norte|Lanao del Sur|Laoag|Lapu-Lapu|Legaspi|Leyte|Lipa|Lucena|Maguindanao|Mandaue|Manila|Marawi|Marinduque|Masbate|Mindoro Occidental|Mindoro Oriental|Misamis Occidental|Misamis Oriental|Mountain|Naga|Negros Occidental|Negros Oriental|North Cotabato|Northern Samar|Nueva Ecija|Nueva Vizcaya|Olongapo|Ormoc|Oroquieta|Ozamis|Pagadian|Palawan|Palayan|Pampanga|Pangasinan|Pasay|Puerto Princesa|Quezon|Quezon City|Quirino|Rizal|Romblon|Roxas|Samar|San Carlos (in Negros Occidental)|San Carlos (in Pangasinan)|San Jose|San Pablo|Silay|Siquijor|Sorsogon|South Cotabato|Southern Leyte|Sultan Kudarat|Sulu|Surigao|Surigao del Norte|Surigao del Sur|Tacloban|Tagaytay|Tagbilaran|Tangub|Tarlac|Tawitawi|Toledo|Trece Martires|Zambales|Zamboanga|Zamboanga del Norte|Zamboanga del Sur";a[182]="Pitcaim Islands";a[183]="Dolnoslaskie|Kujawsko-Pomorskie|Lodzkie|Lubelskie|Lubuskie|Malopolskie|Mazowieckie|Opolskie|Podkarpackie|Podlaskie|Pomorskie|Slaskie|Swietokrzyskie|Warminsko-Mazurskie|Wielkopolskie|Zachodniopomorskie";a[184]="Acores (Azores)|Aveiro|Beja|Braga|Braganca|Castelo Branco|Coimbra|Evora|Faro|Guarda|Leiria|Lisboa|Madeira|Portalegre|Porto|Santarem|Setubal|Viana do Castelo|Vila Real|Viseu";a[185]="Adjuntas|Aguada|Aguadilla|Aguas Buenas|Aibonito|Anasco|Arecibo|Arroyo|Barceloneta|Barranquitas|Bayamon|Cabo Rojo|Caguas|Camuy|Canovanas|Carolina|Catano|Cayey|Ceiba|Ciales|Cidra|Coamo|Comerio|Corozal|Culebra|Dorado|Fajardo|Florida|Guanica|Guayama|Guayanilla|Guaynabo|Gurabo|Hatillo|Hormigueros|Humacao|Isabela|Jayuya|Juana Diaz|Juncos|Lajas|Lares|Las Marias|Las Piedras|Loiza|Luquillo|Manati|Maricao|Maunabo|Mayaguez|Moca|Morovis|Naguabo|Naranjito|Orocovis|Patillas|Penuelas|Ponce|Quebradillas|Rincon|Rio Grande|Sabana Grande|Salinas|San German|San Juan|San Lorenzo|San Sebastian|Santa Isabel|Toa Alta|Toa Baja|Trujillo Alto|Utuado|Vega Alta|Vega Baja|Vieques|Villalba|Yabucoa|Yauco";a[186]="Ad Dawhah|Al Ghuwayriyah|Al Jumayliyah|Al Khawr|Al Wakrah|Ar Rayyan|Jarayan al Batinah|Madinat ash Shamal|Umm Salal";a[187]="Reunion";a[188]="Alba|Arad|Arges|Bacau|Bihor|Bistrita-Nasaud|Botosani|Braila|Brasov|Bucuresti|Buzau|Calarasi|Caras-Severin|Cluj|Constanta|Covasna|Dimbovita|Dolj|Galati|Giurgiu|Gorj|Harghita|Hunedoara|Ialomita|Iasi|Maramures|Mehedinti|Mures|Neamt|Olt|Prahova|Salaj|Satu Mare|Sibiu|Suceava|Teleorman|Timis|Tulcea|Vaslui|Vilcea|Vrancea";a[189]="Adygeya (Maykop)|Aginskiy Buryatskiy (Aginskoye)|Altay (Gorno-Altaysk)|Altayskiy (Barnaul)|Amurskaya (Blagoveshchensk)|Arkhangel'skaya|Astrakhanskaya|Bashkortostan (Ufa)|Belgorodskaya|Bryanskaya|Buryatiya (Ulan-Ude)|Chechnya (Groznyy)|Chelyabinskaya|Chitinskaya|Chukotskiy (Anadyr')|Chuvashiya (Cheboksary)|Dagestan (Makhachkala)|Evenkiyskiy (Tura)|Ingushetiya (Nazran')|Irkutskaya|Ivanovskaya|Kabardino-Balkariya (Nal'chik)|Kaliningradskaya|Kalmykiya (Elista)|Kaluzhskaya|Kamchatskaya (Petropavlovsk-Kamchatskiy)|Karachayevo-Cherkesiya (Cherkessk)|Kareliya (Petrozavodsk)|Kemerovskaya|Khabarovskiy|Khakasiya (Abakan)|Khanty-Mansiyskiy (Khanty-Mansiysk)|Kirovskaya|Komi (Syktyvkar)|Komi-Permyatskiy (Kudymkar)|Koryakskiy (Palana)|Kostromskaya|Krasnodarskiy|Krasnoyarskiy|Kurganskaya|Kurskaya|Leningradskaya|Lipetskaya|Magadanskaya|Mariy-El (Yoshkar-Ola)|Mordoviya (Saransk)|Moskovskaya|Moskva (Moscow)|Murmanskaya|Nenetskiy (Nar'yan-Mar)|Nizhegorodskaya|Novgorodskaya|Novosibirskaya|Omskaya|Orenburgskaya|Orlovskaya (Orel)|Penzenskaya|Permskaya|Primorskiy (Vladivostok)|Pskovskaya|Rostovskaya|Ryazanskaya|Sakha (Yakutsk)|Sakhalinskaya (Yuzhno-Sakhalinsk)|Samarskaya|Sankt-Peterburg (Saint Petersburg)|Saratovskaya|Severnaya Osetiya-Alaniya [North Ossetia] (Vladikavkaz)|Smolenskaya|Stavropol'skiy|Sverdlovskaya (Yekaterinburg)|Tambovskaya|Tatarstan (Kazan')|Taymyrskiy (Dudinka)|Tomskaya|Tul'skaya|Tverskaya|Tyumenskaya|Tyva (Kyzyl)|Udmurtiya (Izhevsk)|Ul'yanovskaya|Ust'-Ordynskiy Buryatskiy (Ust'-Ordynskiy)|Vladimirskaya|Volgogradskaya|Vologodskaya|Voronezhskaya|Yamalo-Nenetskiy (Salekhard)|Yaroslavskaya|Yevreyskaya";a[190]="Butare|Byumba|Cyangugu|Gikongoro|Gisenyi|Gitarama|Kibungo|Kibuye|Kigali Rurale|Kigali-ville|Ruhengeri|Umutara";a[191]="Ascension|Saint Helena|Tristan da Cunha";a[192]="Christ Church Nichola Town|Saint Anne Sandy Point|Saint George Basseterre|Saint George Gingerland|Saint James Windward|Saint John Capisterre|Saint John Figtree|Saint Mary Cayon|Saint Paul Capisterre|Saint Paul Charlestown|Saint Peter Basseterre|Saint Thomas Lowland|Saint Thomas Middle Island|Trinity Palmetto Point";a[193]="Anse-la-Raye|Castries|Choiseul|Dauphin|Dennery|Gros Islet|Laborie|Micoud|Praslin|Soufriere|Vieux Fort";a[194]="Miquelon|Saint Pierre";a[195]="Charlotte|Grenadines|Saint Andrew|Saint David|Saint George|Saint Patrick";a[196]="A'ana|Aiga-i-le-Tai|Atua|Fa'asaleleaga|Gaga'emauga|Gagaifomauga|Palauli|Satupa'itea|Tuamasaga|Va'a-o-Fonoti|Vaisigano";a[197]="Acquaviva|Borgo Maggiore|Chiesanuova|Domagnano|Faetano|Fiorentino|Monte Giardino|San Marino|Serravalle";a[198]="Principe|Sao Tome";a[199]="'Asir|Al Bahah|Al Hudud ash Shamaliyah|Al Jawf|Al Madinah|Al Qasim|Ar Riyad|Ash Sharqiyah (Eastern Province)|Ha'il|Jizan|Makkah|Najran|Tabuk";a[200]="Aberdeen City|Aberdeenshire|Angus|Argyll and Bute|City of Edinburgh|Clackmannanshire|Dumfries and Galloway|Dundee City|East Ayrshire|East Dunbartonshire|East Lothian|East Renfrewshire|Eilean Siar (Western Isles)|Falkirk|Fife|Glasgow City|Highland|Inverclyde|Midlothian|Moray|North Ayrshire|North Lanarkshire|Orkney Islands|Perth and Kinross|Renfrewshire|Shetland Islands|South Ayrshire|South Lanarkshire|Stirling|The Scottish Borders|West Dunbartonshire|West Lothian";a[201]="Dakar|Diourbel|Fatick|Kaolack|Kolda|Louga|Saint-Louis|Tambacounda|Thies|Ziguinchor";a[202]="Anse aux Pins|Anse Boileau|Anse Etoile|Anse Louis|Anse Royale|Baie Lazare|Baie Sainte Anne|Beau Vallon|Bel Air|Bel Ombre|Cascade|Glacis|Grand' Anse (on Mahe)|Grand' Anse (on Praslin)|La Digue|La Riviere Anglaise|Mont Buxton|Mont Fleuri|Plaisance|Pointe La Rue|Port Glaud|Saint Louis|Takamaka";a[203]="Eastern|Northern|Southern|Western";a[204]="Singapore";a[205]="Banskobystricky|Bratislavsky|Kosicky|Nitriansky|Presovsky|Trenciansky|Trnavsky|Zilinsky";a[206]="Ajdovscina|Beltinci|Bled|Bohinj|Borovnica|Bovec|Brda|Brezice|Brezovica|Cankova-Tisina|Celje|Cerklje na Gorenjskem|Cerknica|Cerkno|Crensovci|Crna na Koroskem|Crnomelj|Destrnik-Trnovska Vas|Divaca|Dobrepolje|Dobrova-Horjul-Polhov Gradec|Dol pri Ljubljani|Domzale|Dornava|Dravograd|Duplek|Gorenja Vas-Poljane|Gorisnica|Gornja Radgona|Gornji Grad|Gornji Petrovci|Grosuplje|Hodos Salovci|Hrastnik|Hrpelje-Kozina|Idrija|Ig|Ilirska Bistrica|Ivancna Gorica|Izola|Jesenice|Jursinci|Kamnik|Kanal|Kidricevo|Kobarid|Kobilje|Kocevje|Komen|Koper|Kozje|Kranj|Kranjska Gora|Krsko|Kungota|Kuzma|Lasko|Lenart|Lendava|Litija|Ljubljana|Ljubno|Ljutomer|Logatec|Loska Dolina|Loski Potok|Luce|Lukovica|Majsperk|Maribor|Medvode|Menges|Metlika|Mezica|Miren-Kostanjevica|Mislinja|Moravce|Moravske Toplice|Mozirje|Murska Sobota|Muta|Naklo|Nazarje|Nova Gorica|Novo Mesto|Odranci|Ormoz|Osilnica|Pesnica|Piran|Pivka|Podcetrtek|Podvelka-Ribnica|Postojna|Preddvor|Ptuj|Puconci|Race-Fram|Radece|Radenci|Radlje ob Dravi|Radovljica|Ravne-Prevalje|Ribnica|Rogasevci|Rogaska Slatina|Rogatec|Ruse|Semic|Sencur|Sentilj|Sentjernej|Sentjur pri Celju|Sevnica|Sezana|Skocjan|Skofja Loka|Skofljica|Slovenj Gradec|Slovenska Bistrica|Slovenske Konjice|Smarje pri Jelsah|Smartno ob Paki|Sostanj|Starse|Store|Sveti Jurij|Tolmin|Trbovlje|Trebnje|Trzic|Turnisce|Velenje|Velike Lasce|Videm|Vipava|Vitanje|Vodice|Vojnik|Vrhnika|Vuzenica|Zagorje ob Savi|Zalec|Zavrc|Zelezniki|Ziri|Zrece";a[207]="Bellona|Central|Choiseul (Lauru)|Guadalcanal|Honiara|Isabel|Makira|Malaita|Rennell|Temotu|Western";a[208]="Awdal|Bakool|Banaadir|Bari|Bay|Galguduud|Gedo|Hiiraan|Jubbada Dhexe|Jubbada Hoose|Mudug|Nugaal|Sanaag|Shabeellaha Dhexe|Shabeellaha Hoose|Sool|Togdheer|Woqooyi Galbeed";a[209]="Eastern Cape|Free State|Gauteng|KwaZulu-Natal|Mpumalanga|North-West|Northern Cape|Northern Province|Western Cape";a[210]="Bird Island|Bristol Island|Clerke Rocks|Montagu Island|Saunders Island|South Georgia|Southern Thule|Traversay Islands";a[211]="Andalucia|Aragon|Asturias|Baleares (Balearic Islands)|Canarias (Canary Islands)|Cantabria|Castilla y Leon|Castilla-La Mancha|Cataluna|Ceuta|Communidad Valencian|Extremadura|Galicia|Islas Chafarinas|La Rioja|Madrid|Melilla|Murcia|Navarra|Pais Vasco (Basque Country)|Penon de Alhucemas|Penon de Velez de la Gomera";a[212]="Spratly Islands";a[213]="Central|Eastern|North Central|North Eastern|North Western|Northern|Sabaragamuwa|Southern|Uva|Western";a[214]="A'ali an Nil|Al Bahr al Ahmar|Al Buhayrat|Al Jazirah|Al Khartum|Al Qadarif|Al Wahdah|An Nil al Abyad|An Nil al Azraq|Ash Shamaliyah|Bahr al Jabal|Gharb al Istiwa'iyah|Gharb Bahr al Ghazal|Gharb Darfur|Gharb Kurdufan|Janub Darfur|Janub Kurdufan|Junqali|Kassala|Nahr an Nil|Shamal Bahr al Ghazal|Shamal Darfur|Shamal Kurdufan|Sharq al Istiwa'iyah|Sinnar|Warab";a[215]="Brokopondo|Commewijne|Coronie|Marowijne|Nickerie|Para|Paramaribo|Saramacca|Sipaliwini|Wanica";a[216]="Barentsoya|Bjornoya|Edgeoya|Hopen|Kvitoya|Nordaustandet|Prins Karls Forland|Spitsbergen";a[217]="Hhohho|Lubombo|Manzini|Shiselweni";a[218]="Blekinge|Dalarnas|Gavleborgs|Gotlands|Hallands|Jamtlands|Jonkopings|Kalmar|Kronobergs|Norrbottens|Orebro|Ostergotlands|Skane|Sodermanlands|Stockholms|Uppsala|Varmlands|Vasterbottens|Vasternorrlands|Vastmanlands|Vastra Gotalands";a[219]="Aargau|Ausser-Rhoden|Basel-Landschaft|Basel-Stadt|Bern|Fribourg|Geneve|Glarus|Graubunden|Inner-Rhoden|Jura|Luzern|Neuchatel|Nidwalden|Obwalden|Sankt Gallen|Schaffhausen|Schwyz|Solothurn|Thurgau|Ticino|Uri|Valais|Vaud|Zug|Zurich";a[220]="Al Hasakah|Al Ladhiqiyah|Al Qunaytirah|Ar Raqqah|As Suwayda'|Dar'a|Dayr az Zawr|Dimashq|Halab|Hamah|Hims|Idlib|Rif Dimashq|Tartus";a[221]="Chang-hua|Chi-lung|Chia-i|Chia-i|Chung-hsing-hsin-ts'un|Hsin-chu|Hsin-chu|Hua-lien|I-lan|Kao-hsiung|Kao-hsiung|Miao-li|Nan-t'ou|P'eng-hu|P'ing-tung|T'ai-chung|T'ai-chung|T'ai-nan|T'ai-nan|T'ai-pei|T'ai-pei|T'ai-tung|T'ao-yuan|Yun-lin";a[222]="Viloyati Khatlon|Viloyati Leninobod|Viloyati Mukhtori Kuhistoni Badakhshon";a[223]="Arusha|Dar es Salaam|Dodoma|Iringa|Kagera|Kigoma|Kilimanjaro|Lindi|Mara|Mbeya|Morogoro|Mtwara|Mwanza|Pemba North|Pemba South|Pwani|Rukwa|Ruvuma|Shinyanga|Singida|Tabora|Tanga|Zanzibar Central/South|Zanzibar North|Zanzibar Urban/West";a[224]="Amnat Charoen|Ang Thong|Buriram|Chachoengsao|Chai Nat|Chaiyaphum|Chanthaburi|Chiang Mai|Chiang Rai|Chon Buri|Chumphon|Kalasin|Kamphaeng Phet|Kanchanaburi|Khon Kaen|Krabi|Krung Thep Mahanakhon (Bangkok)|Lampang|Lamphun|Loei|Lop Buri|Mae Hong Son|Maha Sarakham|Mukdahan|Nakhon Nayok|Nakhon Pathom|Nakhon Phanom|Nakhon Ratchasima|Nakhon Sawan|Nakhon Si Thammarat|Nan|Narathiwat|Nong Bua Lamphu|Nong Khai|Nonthaburi|Pathum Thani|Pattani|Phangnga|Phatthalung|Phayao|Phetchabun|Phetchaburi|Phichit|Phitsanulok|Phra Nakhon Si Ayutthaya|Phrae|Phuket|Prachin Buri|Prachuap Khiri Khan|Ranong|Ratchaburi|Rayong|Roi Et|Sa Kaeo|Sakon Nakhon|Samut Prakan|Samut Sakhon|Samut Songkhram|Sara Buri|Satun|Sing Buri|Sisaket|Songkhla|Sukhothai|Suphan Buri|Surat Thani|Surin|Tak|Trang|Trat|Ubon Ratchathani|Udon Thani|Uthai Thani|Uttaradit|Yala|Yasothon";a[225]="Tobago";a[226]="De La Kara|Des Plateaux|Des Savanes|Du Centre|Maritime";a[227]="Atafu|Fakaofo|Nukunonu";a[228]="Ha'apai|Tongatapu|Vava'u";a[229]="Arima|Caroni|Mayaro|Nariva|Port-of-Spain|Saint Andrew|Saint David|Saint George|Saint Patrick|San Fernando|Victoria";a[230]="Ariana|Beja|Ben Arous|Bizerte|El Kef|Gabes|Gafsa|Jendouba|Kairouan|Kasserine|Kebili|Mahdia|Medenine|Monastir|Nabeul|Sfax|Sidi Bou Zid|Siliana|Sousse|Tataouine|Tozeur|Tunis|Zaghouan";a[231]="Adana|Adiyaman|Afyon|Agri|Aksaray|Amasya|Ankara|Antalya|Ardahan|Artvin|Aydin|Balikesir|Bartin|Batman|Bayburt|Bilecik|Bingol|Bitlis|Bolu|Burdur|Bursa|Canakkale|Cankiri|Corum|Denizli|Diyarbakir|Duzce|Edirne|Elazig|Erzincan|Erzurum|Eskisehir|Gaziantep|Giresun|Gumushane|Hakkari|Hatay|Icel|Igdir|Isparta|Istanbul|Izmir|Kahramanmaras|Karabuk|Karaman|Kars|Kastamonu|Kayseri|Kilis|Kirikkale|Kirklareli|Kirsehir|Kocaeli|Konya|Kutahya|Malatya|Manisa|Mardin|Mugla|Mus|Nevsehir|Nigde|Ordu|Osmaniye|Rize|Sakarya|Samsun|Sanliurfa|Siirt|Sinop|Sirnak|Sivas|Tekirdag|Tokat|Trabzon|Tunceli|Usak|Van|Yalova|Yozgat|Zonguldak";a[232]="Ahal Welayaty|Balkan Welayaty|Dashhowuz Welayaty|Lebap Welayaty|Mary Welayaty";a[233]="Tuvalu";a[234]="Adjumani|Apac|Arua|Bugiri|Bundibugyo|Bushenyi|Busia|Gulu|Hoima|Iganga|Jinja|Kabale|Kabarole|Kalangala|Kampala|Kamuli|Kapchorwa|Kasese|Katakwi|Kibale|Kiboga|Kisoro|Kitgum|Kotido|Kumi|Lira|Luwero|Masaka|Masindi|Mbale|Mbarara|Moroto|Moyo|Mpigi|Mubende|Mukono|Nakasongola|Nebbi|Ntungamo|Pallisa|Rakai|Rukungiri|Sembabule|Soroti|Tororo";a[235]="Avtonomna Respublika Krym (Simferopol')|Cherkas'ka (Cherkasy)|Chernihivs'ka (Chernihiv)|Chernivets'ka (Chernivtsi)|Dnipropetrovs'ka (Dnipropetrovs'k)|Donets'ka (Donets'k)|Ivano-Frankivs'ka (Ivano-Frankivs'k)|Kharkivs'ka (Kharkiv)|Khersons'ka (Kherson)|Khmel'nyts'ka (Khmel'nyts'kyy)|Kirovohrads'ka (Kirovohrad)|Kyyiv|Kyyivs'ka (Kiev)|L'vivs'ka (L'viv)|Luhans'ka (Luhans'k)|Mykolayivs'ka (Mykolayiv)|Odes'ka (Odesa)|Poltavs'ka (Poltava)|Rivnens'ka (Rivne)|Sevastopol'|Sums'ka (Sumy)|Ternopil's'ka (Ternopil')|Vinnyts'ka (Vinnytsya)|Volyns'ka (Luts'k)|Zakarpats'ka (Uzhhorod)|Zaporiz'ka (Zaporizhzhya)|Zhytomyrs'ka (Zhytomyr)";a[236]="'Ajman|Abu Zaby (Abu Dhabi)|Al Fujayrah|Ash Shariqah (Sharjah)|Dubayy (Dubai)|Ra's al Khaymah|Umm al Qaywayn";a[237]="Barking and Dagenham|Barnet|Barnsley|Bath and North East Somerset|Bedfordshire|Bexley|Birmingham|Blackburn with Darwen|Blackpool|Bolton|Bournemouth|Bracknell Forest|Bradford|Brent|Brighton and Hove|Bromley|Buckinghamshire|Bury|Calderdale|Cambridgeshire|Camden|Cheshire|City of Bristol|City of Kingston upon Hull|City of London|Cornwall|Coventry|Croydon|Cumbria|Darlington|Derby|Derbyshire|Devon|Doncaster|Dorset|Dudley|Durham|Ealing|East Riding of Yorkshire|East Sussex|Enfield|Essex|Gateshead|Gloucestershire|Greenwich|Hackney|Halton|Hammersmith and Fulham|Hampshire|Haringey|Harrow|Hartlepool|Havering|Herefordshire|Hertfordshire|Hillingdon|Hounslow|Isle of Wight|Islington|Kensington and Chelsea|Kent|Kingston upon Thames|Kirklees|Knowsley|Lambeth|Lancashire|Leeds|Leicester|Leicestershire|Lewisham|Lincolnshire|Liverpool|Luton|Manchester|Medway|Merton|Middlesbrough|Milton Keynes|Newcastle upon Tyne|Newham|Norfolk|North East Lincolnshire|North Lincolnshire|North Somerset|North Tyneside|North Yorkshire|Northamptonshire|Northumberland|Nottingham|Nottinghamshire|Oldham|Oxfordshire|Peterborough|Plymouth|Poole|Portsmouth|Reading|Redbridge|Redcar and Cleveland|Richmond upon Thames|Rochdale|Rotherham|Rutland|Salford|Sandwell|Sefton|Sheffield|Shropshire|Slough|Solihull|Somerset|South Gloucestershire|South Tyneside|Southampton|Southend-on-Sea|Southwark|St. Helens|Staffordshire|Stockport|Stockton-on-Tees|Stoke-on-Trent|Suffolk|Sunderland|Surrey|Sutton|Swindon|Tameside|Telford and Wrekin|Thurrock|Torbay|Tower Hamlets|Trafford|Wakefield|Walsall|Waltham Forest|Wandsworth|Warrington|Warwickshire|West Berkshire|West Sussex|Westminster|Wigan|Wiltshire|Windsor and Maidenhead|Wirral|Wokingham|Wolverhampton|Worcestershire|York";a[238]="Artigas|Canelones|Cerro Largo|Colonia|Durazno|Flores|Florida|Lavalleja|Maldonado|Montevideo|Paysandu|Rio Negro|Rivera|Rocha|Salto|San Jose|Soriano|Tacuarembo|Treinta y Tres";a[239]="Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|District of Columbia|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming";a[240]="Andijon Wiloyati|Bukhoro Wiloyati|Farghona Wiloyati|Jizzakh Wiloyati|Khorazm Wiloyati (Urganch)|Namangan Wiloyati|Nawoiy Wiloyati|Qashqadaryo Wiloyati (Qarshi)|Qoraqalpoghiston (Nukus)|Samarqand Wiloyati|Sirdaryo Wiloyati (Guliston)|Surkhondaryo Wiloyati (Termiz)|Toshkent Shahri|Toshkent Wiloyati";a[241]="Malampa|Penama|Sanma|Shefa|Tafea|Torba";a[242]="Amazonas|Anzoategui|Apure|Aragua|Barinas|Bolivar|Carabobo|Cojedes|Delta Amacuro|Dependencias Federales|Distrito Federal|Falcon|Guarico|Lara|Merida|Miranda|Monagas|Nueva Esparta|Portuguesa|Sucre|Tachira|Trujillo|Vargas|Yaracuy|Zulia";a[243]="An Giang|Ba Ria-Vung Tau|Bac Giang|Bac Kan|Bac Lieu|Bac Ninh|Ben Tre|Binh Dinh|Binh Duong|Binh Phuoc|Binh Thuan|Ca Mau|Can Tho|Cao Bang|Da Nang|Dac Lak|Dong Nai|Dong Thap|Gia Lai|Ha Giang|Ha Nam|Ha Noi|Ha Tay|Ha Tinh|Hai Duong|Hai Phong|Ho Chi Minh|Hoa Binh|Hung Yen|Khanh Hoa|Kien Giang|Kon Tum|Lai Chau|Lam Dong|Lang Son|Lao Cai|Long An|Nam Dinh|Nghe An|Ninh Binh|Ninh Thuan|Phu Tho|Phu Yen|Quang Binh|Quang Nam|Quang Ngai|Quang Ninh|Quang Tri|Soc Trang|Son La|Tay Ninh|Thai Binh|Thai Nguyen|Thanh Hoa|Thua Thien-Hue|Tien Giang|Tra Vinh|Tuyen Quang|Vinh Long|Vinh Phuc|Yen Bai";a[244]="Saint Croix|Saint John|Saint Thomas";a[245]="Blaenau Gwent|Bridgend|Caerphilly|Cardiff|Carmarthenshire|Ceredigion|Conwy|Denbighshire|Flintshire|Gwynedd|Isle of Anglesey|Merthyr Tydfil|Monmouthshire|Neath Port Talbot|Newport|Pembrokeshire|Powys|Rhondda Cynon Taff|Swansea|The Vale of Glamorgan|Torfaen|Wrexham";a[246]="Alo|Sigave|Wallis";a[247]="West Bank";a[248]="Western Sahara";a[249]="'Adan|'Ataq|Abyan|Al Bayda'|Al Hudaydah|Al Jawf|Al Mahrah|Al Mahwit|Dhamar|Hadhramawt|Hajjah|Ibb|Lahij|Ma'rib|Sa'dah|San'a'|Ta'izz";a[250]="Kosovo|Montenegro|Serbia|Vojvodina";a[251]="Central|Copperbelt|Eastern|Luapula|Lusaka|North-Western|Northern|Southern|Western";a[252]="Bulawayo|Harare|ManicalandMashonaland Central|Mashonaland East|Mashonaland West|Masvingo|Matabeleland North|Matabeleland South|Midlands";(function(){if(!window.GLIFFY){window.GLIFFY={}}if(!window.GLIFFY.ENV){window.GLIFFY.ENV={}}if(!window.GLIFFY.FEATURES){window.GLIFFY.FEATURES={}}GLIFFY.FEATURES.enableMru=true;GLIFFY.FEATURES.browserTabs=true;GLIFFY.FEATURES.charts=false;GLIFFY.FEATURES.tables=false;GLIFFY.FEATURES.premiumLibraries=true;GLIFFY.FEATURES.umlV1=true;GLIFFY.FEATURES.umlV2=true;GLIFFY.FEATURES.uiV2=true;GLIFFY.FEATURES.uiV3=true;GLIFFY.FEATURES.allowDisableAutosave=true;GLIFFY.FEATURES.mindmaps=true;GLIFFY.FEATURES.mindmapsAutoLayout=true;GLIFFY.FEATURES.popupNotesViewer=true;GLIFFY.FEATURES.svgPrint=false;GLIFFY.FEATURES.showPremiumShapesLocked=false;GLIFFY.FEATURES.labsMenu=false;GLIFFY.PLUGINS=GLIFFY.PLUGINS||{};GLIFFY.PLUGINS.storage={};GLIFFY.PLUGINS.activePlugins=["gliffyDrivePlugin","googleDrivePlugin"];GLIFFY.PLUGINS.storage.googleDrivePlugin=GLIFFY.PLUGINS.storage.googleDrivePlugin||{}}());(function(){GLIFFY.PLUGINS=GLIFFY.PLUGINS||{};GLIFFY.PLUGINS.storage=GLIFFY.PLUGINS.storage||{};GLIFFY.PLUGINS.storage.gliffyDrivePlugin={init:function(){var f=GLIFFY.PLUGINS.pluginManager.getCurrentDocumentContext();var e=$(".gliffy-filemenu-import, .gliffy-filemenu-revisionhistory");if(f!=="gliffyDrivePlugin"){e.addClass("hide-gliffy-drive-only")}},create:function(f,e,g){var j={diagramName:f.title},h;if(GliffyApp.documentModel.folderId!==null){j.folderId=GliffyApp.documentModel.folderId}f.diagramType=GLIFFY.editor.getDocumentManager().getActiveStage().getAnalyticsData().diagramCategory;window.GLIFFY.API.POST("diagram.json",f,{query:j,success:function(n){if(n.error){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"createByBrowserError",label:GLIFFY.BrowserDetect.browser+"/"+GLIFFY.BrowserDetect.OS});e(n)}else{GLIFFY.editor.mapDto(n);if((window.GLIFFY.ENV.app=="d8e91192-2f34-471c-80a6-900880844ffd"||window.GLIFFY.ENV.app=="818d5dd8-9f25-4401-aa8d-9f97a53642a2")&&window.opener&&window.opener.__controller){window.opener.__controller.refreshList(n.id);this.editor.getDocumentManager().getActiveStage().setUnsavedChanges(false)}if(GLIFFY.FEATURES.browserTabs){c(n.id)}GliffyApp.documentModel.populate(n);GliffyApp.authController.increaseAccountDiagramCount();GliffyApp.authController.fetchAccount(function(){e(n)},function(){console.error("Unable to update account settings after diagram create");e(n)});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"createByBrowser",label:GLIFFY.BrowserDetect.browser+"/"+GLIFFY.BrowserDetect.OS});var l=["flowchart","flow chart","process flow","workflow","class diagram","sequence diagram","component diagram","deployment diagram","object diagram","package diagram","state diagram","use case diagram","activity diagram","network diagram","rack diagram","wireframe","infographic","mindmap","mind map","timeline","org chart","organization chart","swot","model diagram","data flow diagram"];var k=f.title.toLowerCase();for(h=0;h<l.length;h++){if(k.indexOf(l[h])>-1){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"titleKeyword",label:l[h]})}}var m=GLIFFY.editor.getDocumentManager().getActiveStage().getAnalyticsData();GLIFFY.analyticsUtils.logMixpanelEvent("documentCreate",{appId:window.GLIFFY.ENV.app,diagram:n.id,type:m.diagramCategory,keywords:l,accountCreateDate:GliffyApp.authController.getAccountCreateDate(),accountDiagrams:GliffyApp.authController.getAccountDiagrams(),accountUsers:GliffyApp.authController.getAccountUserCount()})}},error:function(m,l,k){GLIFFY.onlineUtils.handleDiagramActionError(m,l,k,"An error occurred during save.",false);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"createByBrowserFail",label:GLIFFY.BrowserDetect.browser+"/"+GLIFFY.BrowserDetect.OS});g(m,l,k)},context:this})},menuNew:function(e){e.doNew();e.doDeselectAll()},menuOpen:function(e){e.doOpen();e.doDeselectAll()},open:function(g,e,f){window.GLIFFY.API.GET(g,{isUrl:true,context:this,success:function(j){if(g.indexOf("/go/clipboard/upload")===0){j=$.parseJSON(j);var h={callback:function(){}};GLIFFY.editor.openTemplateFromGON(j,h);GLIFFY.editor.handleCreateNewTab()}else{if(typeof j.title==="undefined"){GLIFFY.editor.mapDto(j)}j.urls.open=g;GliffyApp.documentModel.populate(j);e(j);if(GLIFFY.FEATURES.browserTabs){GLIFFY.onlineUtils.setDocumentLocation(GliffyApp.documentModel.get("id"))}}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"diagramOpen",label:"success"});GLIFFY.analyticsUtils.logMixpanelEvent("documentOpen",{appId:window.GLIFFY.ENV.app,diagram:j.id,version:j.version,accountCreateDate:GliffyApp.authController.getAccountCreateDate(),accountDiagrams:GliffyApp.authController.getAccountDiagrams(),accountUsers:GliffyApp.authController.getAccountUserCount()});$(window).trigger("gliffy-editor-open-document",[{url:g}])},error:function(k,j,h){GLIFFY.Spinner.hide({context:"preload"});GliffyApp.welcomeScreenController.hide();GliffyApp.fileOpenBrowserController.hide();GliffyApp.templateBrowserController.hide();f(k,j,h)}})},save:function(f,e,g){f.diagramType=GLIFFY.editor.getDocumentManager().getActiveStage().getAnalyticsData().diagramCategory;window.GLIFFY.API.PUT("diagram.json",f,{query:{diagramId:f.urls.id},success:function(k){GLIFFY.editor.mapDto(k);if((window.GLIFFY.ENV.app=="d8e91192-2f34-471c-80a6-900880844ffd"||window.GLIFFY.ENV.app=="818d5dd8-9f25-4401-aa8d-9f97a53642a2")&&window.opener&&window.opener.__controller){window.opener.__controller.updateDiagram(k.id,k.version);this.editor.getDocumentManager().getActiveStage().setUnsavedChanges(false)}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"diagramSave",label:"success"});var j=GLIFFY.editor.getDocumentManager().getActiveStage().getAnalyticsData();GLIFFY.analyticsUtils.logMixpanelEvent("documentSave",{appId:window.GLIFFY.ENV.app,diagram:k.id,version:k.version,type:j.diagramCategory,accountCreateDate:GliffyApp.authController.getAccountCreateDate(),accountDiagrams:GliffyApp.authController.getAccountDiagrams(),accountUsers:GliffyApp.authController.getAccountUserCount()});if(typeof mktoMunchkinFunction=="function"&&GliffyApp.authController.getMunchkinKey()){try{mktoMunchkinFunction("visitWebPage",{url:"/go/application/documentSave",params:"accountDiagrams="+GliffyApp.authController.getAccountDiagrams()+"&accountUsers="+GliffyApp.authController.getAccountUserCount()+"&diagramCategory="+j.diagramCategory})}catch(h){console.log(h)}}e(k)},error:function(k,j,h){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"diagramSave",label:"fail"});GLIFFY.onlineUtils.handleDiagramActionError(k,j,h,"An error occurred during save.",true);g(k,j,h)},context:this});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"diagramSave",label:"begin"})},rename:function(f,h,e,g){window.GLIFFY.API.PUT("diagram/"+f.id+"/rename",null,{query:{name:h},success:function(j){e(j);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"rename",label:window.location.pathname})},error:function(l,j,k){k=GLIFFY.onlineUtils.handleDiagramActionError(l,j,k,"An error occurred during rename.",false);g(k);console.error(l,k)},context:this})},"delete":function(g,e,f){window.GLIFFY.API.DELETE("diagram.json",{query:{diagramId:g},success:function(j,k,h){GliffyApp.authController.decreaseAccountDiagramCount();GliffyApp.authController.fetchAccount(function(){if(GliffyApp.authController.getAccountDiagramsLeft()<=0){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"saveDialog",action:"deleteDocumentAtLimit",value:GliffyApp.authController.getAccountDiagramsLeft()})}e()},function(){console.error("Unable to update account settings after diagram delete");e()})},error:function(k,h,j){j=GLIFFY.onlineUtils.handleDiagramActionError(k,h,j,"An error occurred during delete.",false);f(j);console.error("Error deleting document",j)},context:this})},"export":function(k,f,g){var j=k.data||null,h=k.extension,e,l;if(j){e=function(){var m=GLIFFY.API.getAuthUrl("/go/download/"+d()+"."+h+"?accountId="+GliffyApp.authController.getAccountId());GLIFFY.Utils.iframeAjax(m,{data:j},f,g)}}else{e=function(){var m=GLIFFY.API.getAuthUrl("/go/download/"+d()+"."+h+"?accountId="+GliffyApp.authController.getAccountId());GLIFFY.Utils.iframeDownload(m,f,g)}}if(editor.unsavedChanges()||editor.getDocumentManager().getActiveDocument().isNewNotDirty()){l=function(){editor.save(e)}}else{l=function(){e()}}GLIFFY.analyticsUtils.logMixpanelEvent("documentExport",{diagramId:d()});if(GliffyApp.authController.isAnonymousAccount()){GliffyApp.loginSignupController.show(l)}else{l()}},loadFolders:function(f,g){var e=this;window.GLIFFY.API.GET(f,{query:{accountId:GliffyApp.authController.getAccountId()},success:function(j,k,h){g(null,j)},error:function(){g(new Error())},context:this})},createFolder:function(h,f,g){var e=this;window.GLIFFY.API.PUT("folder.json",null,{query:{accountId:GliffyApp.authController.getAccountId(),folderName:f,parentFolderId:h},success:function(k,l,j){g(null,{id:k.attr.id,type:k.attr.type});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"addFolder",label:window.location.pathname})},error:function(l,j,k){g(new Error(),l.responseText)},context:this})},handleSelectSaveFolderHook:function(e){var f="folder_diagrams.json";GliffyApp.saveDialogController.loadDocuments(f,{folderId:e.id,app:window.GLIFFY.ENV.app})},customizeUI:function(){$(".gliffy-filemenu-import").removeClass("hide-gliffy-drive-only");$(".gliffy-filemenu-revisionhistory").removeClass("hide-gliffy-drive-only")}};function d(){return GLIFFY.editor.getDocumentManager().getActiveDocument().getUrls()["id"]}function c(e){GLIFFY.onlineUtils.setLocation("/go/html5/"+e)}})();(function(){GLIFFY.PLUGINS=GLIFFY.PLUGINS||{};GLIFFY.PLUGINS.storage=GLIFFY.PLUGINS.storage||{};var f;var d="\r\n--gliffy-online-boundary\r\n";var c="\r\n--gliffy-online-boundary--";var m=".gliffy";function e(s,t){return d+"Content-Type: application/json\r\n\r\n"+JSON.stringify(t)+d+"Content-Type: application/json\r\n\r\n"+JSON.stringify(s)+c}function q(t){var u=/.*\/go\/api\/diagram\.json\?diagramId=[0-9]*/;var s=!!u.exec(t);if(s){window.GLIFFY.API.GET(t,{isUrl:true,context:this,success:function(w){var v={callback:function(){GliffyApp.templateBrowserController.hide();var x=GLIFFY.editor.getDocumentManager().getActiveDocument();x.convertToTemplate();if(x.getStage().hasObjects()){x.getStage().setUnsavedChanges(true)}x.getUrls().isPublic=!GliffyApp.authController.isPaidAccount()&&!GliffyApp.authController.isTrialAccount();GliffyApp.documentModel.update(x)}};GLIFFY.editor.openTemplateFromGON(w.gon,v)},error:function(x,w,v){console.log(v)}})}}GLIFFY.PLUGINS.storage.googleDrivePlugin={init:function(){},create:function(z,t,y){var s=z.image;s=s.substring(s.indexOf(",")+1).replace(/\//g,"_").replace(/\+/g,"-");var B=$("#gliffy-save-filename").val();var A={title:B+m,mimeType:"application/gliffy+json",thumbnail:{image:s,mimeType:"image/png"}};var x=GLIFFY.PLUGINS.storage.googleDrivePlugin.currentFolder;if(x.id!="root"){A.parents=[{id:x.id}]}z.gon.metadata.title=B;var v=x.doclist;for(var w=0;w<v.length;w++){if(B==v[w].name){t({error:$.i18n._("online.diagram.name.exists")});return}}var u=e(z.gon,A);GLIFFY.PLUGINS.storage.googleDrivePlugin.util.ajaxWithRetry({method:"POST",url:"https://www.googleapis.com/upload/drive/v2/files?uploadType=multipart",contentLength:u.length,headers:{"Content-Type":'multipart/form-data; boundary="gliffy-online-boundary"'},data:u}).then(function(C){f=C.id;j(f);z.revision=1;z.isPublic=false;z.urls=z.urls||{};z.urls.id=C.id;z.urls.isPublic=z.isPublic;t(z);GLIFFY.analyticsUtils.logMixpanelEvent("documentSaveGDrive",{})},function(C){$("#gliffy-save-modal").modal("hide");y(C.xhr)})},menuNew:function(){window.open("/go/html5/templates","_blank")},menuOpen:function(s){s.doOpenGoogleDrive();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"openGDrive"})},open:function(w,s,u){var v=GLIFFY.PLUGINS.storage.googleDrivePlugin;var t=v.util.ajaxWithRetry;var x=/.*\/drive\/v[0-9]+\/files\/([^\/?]+)/;var y=x.exec(w);if(y){f=y[1];t({url:"https://www.googleapis.com/drive/v2/files/"+f+"/revisions",method:"GET"}).then(function(z){t({url:w,method:"GET"}).then(function(B){if(typeof B==="string"){B=JSON.parse(B)}var A={gon:B,id:f,isPublic:false,title:n(B.metadata.title,m),urls:{open:w},revision:z.items.length};GliffyApp.documentModel.populate(A);j(f);s(A);GLIFFY.analyticsUtils.logMixpanelEvent("documentOpenGDrive",{})})}).then(null,function(z){u(z.xhr,z.status,z.err)})}else{q(w)}},save:function(t,s,u){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"saveGDrive"});var x=t.image;x=x.substring(x.indexOf(",")+1).replace(/\//g,"_").replace(/\+/g,"-");var v={title:t.title+m,mimeType:"application/gliffy+json",thumbnail:{image:x,mimeType:"image/png"}};t.gon.metadata.revision=t.revision+1;t.gon.metadata.title=t.title;var w=e(t.gon,v);GLIFFY.PLUGINS.storage.googleDrivePlugin.util.ajaxWithRetry({method:"PUT",url:"https://www.googleapis.com/upload/drive/v2/files/"+f+"?uploadType=multipart",contentLength:w.length,headers:{"Content-Type":'multipart/form-data; boundary="gliffy-online-boundary"'},data:w}).then(function(y){t.revision+=1;s(t);GLIFFY.analyticsUtils.logMixpanelEvent("documentSaveGDrive",{})},function(y){u(y.xhr)})},rename:function(t,v,s,u){k(v,function(w){if(w){s({error:"Diagram exists with the same name in the folder."})}else{GLIFFY.PLUGINS.storage.googleDrivePlugin.util.ajaxWithRetry({method:"PATCH",url:"https://www.googleapis.com/drive/v2/files/"+f,headers:{"Content-Type":"application/json"},data:JSON.stringify({title:v+m})}).then(function(x){s(x)},function(x){})}},function(y,w,x){x=GLIFFY.onlineUtils.handleDiagramActionError(y,w,x,"An error occurred during rename.",false);u(x)})},"delete":function(t,s,u){GLIFFY.PLUGINS.storage.googleDrivePlugin.util.ajaxWithRetry({method:"DELETE",url:"https://www.googleapis.com/drive/v2/files/"+t}).then(function(v){o(t);s()},function(v){u(GLIFFY.onlineUtils.handleDiagramActionError(v.xhr,v.status,v.err,"An error occurred during delete.",false))})},"export":function(y,t,u){var x=y.data||null,w=y.extension,s,z;if(x){s=function(){var A=GLIFFY.API.getAuthUrl("/go/gdrive/download/"+f+"?ext="+w+"&accountId="+GliffyApp.authController.getAccountId());GLIFFY.Utils.iframeAjax(A,{data:x},t,u)}}else{s=function(){var A=GLIFFY.API.getAuthUrl("/go/gdrive/download/"+f+"?ext="+w+"&accountId="+GliffyApp.authController.getAccountId());GLIFFY.Utils.iframeDownload(A,t,u)}}if(GLIFFY.editor.unsavedChanges()||GLIFFY.editor.getDocumentManager().getActiveDocument().isNewNotDirty()){var v=GLIFFY.editor;z=function(){v.save(s)}}else{z=function(){s()}}if(GliffyApp.authController.isAnonymousAccount()){GliffyApp.loginSignupController.show(z)}else{z()}},loadPicker:function(){var s=GLIFFY.editor;if(s.unsavedChanges()){$("#save-before-google-drive-open").modal("show").on("hide.bs.modal",function(){s.postSaveCallback=null})}else{gapi.load("picker",{callback:l})}},pickerLoadedCallback:l,jsTreeifyGDriveData:function(u,s){var t=[];var v=[];_.forEach(u,function(w){if(w.mimeType==="application/vnd.google-apps.folder"&&(w.userPermission.role!=="owner"||w.userPermission.role!=="writer")){t.push(w)}else{if(w.fileExtension==="gliffy"){v.push(w)}}});_.forEach(t,function(x){var w={data:x.title,attr:{doclist:[],id:x.id,type:"gliffyOnline",parents:_.map(x.parents,function(y){if(y.isRoot){return"root"}else{return y.id}})},state:"closed"};s[x.id]=w});_.forEach(v,function(w){_.forEach(w.parents,function(y){var x={id:w.id,name:w.title.replace(/\.gliffy$/,"")};if(y.isRoot){s.root.attr.doclist.push(x)}else{if(s[y.id]&&!y.isRoot){s[y.id].attr.doclist.push(x)}}})});_.forEach(s,function(x){var w=x.attr.parents;_.forEach(w,function(y){if(!s[y]){return}if(!s[y].children){s[y].children=[]}s[y].children.push(x)})});return s},loadFolders:function(s,y){var w=encodeURIComponent("trashed=false");var v=encodeURIComponent(" and ");var t=encodeURIComponent("(fileExtension='gliffy' or mimeType='application/vnd.google-apps.folder')");var x="https://www.googleapis.com/drive/v2/";var u=encodeURIComponent("'root' in parents");var A={root:[]};var z=this;GliffyApp.authController.getAccessToken().then(function(B){GLIFFY.PLUGINS.storage.googleDrivePlugin.util.retrieveAllFiles({url:x+"files?maxResults=1000&q="+w+v+t+v+u,method:"GET"}).then(function(F){var D={root:{data:$.i18n._("gdrive.google.drive.folder.header"),attr:{id:"root",type:"GDriveFolder",doclist:[]}}};var C=z.jsTreeifyGDriveData(F,D);var E={data:[C.root],ajax:{type:"GET",headers:{Authorization:"Bearer "+GLIFFY.PLUGINS.storage.googleDrivePlugin.token},url:function(G){return x+"files?maxResults=1000&q="+w+v+t+v+encodeURIComponent("'"+G[0].id+"' in parents")},success:function(G){if(G.items.length>0){var I=z.jsTreeifyGDriveData(G.items,C);var H=_.map(_.filter(G.items,function(J){return J.mimeType==="application/vnd.google-apps.folder"}),function(J){return I[J.id]});return H}else{return[]}}},progressive_render:true};y(null,E)},function(C){$("#gliffy-save-modal").modal("hide");y(C)})})},createFolder:function(v,t,B){var z=GliffyApp.accountFoldersController.folder_data;var C=this;var A=GLIFFY.PLUGINS.storage.googleDrivePlugin.currentFolder;var x=p(A.id);if(x.children){var s=x.children;for(var u=0;u<s.length;u++){if(s[u].data===t){B(new Error(),$.i18n._("online.folder.name.exists.in.current.folder"));return}}}var y={title:t,mimeType:"application/vnd.google-apps.folder"};if(A.id!=="root"){y.parents=[{id:A.id}]}var w=JSON.stringify(y);GLIFFY.PLUGINS.storage.googleDrivePlugin.util.ajaxWithRetry({method:"POST",url:"https://www.googleapis.com/drive/v2/files?alt=json",headers:{"Content-Type":"application/json"},data:w}).then(function(D){g(A.id,D.id,t);B(null,{id:D.id,type:"GDriveFolder"})},function(D){B(D.xhr)})},handleSelectSaveFolderHook:function(t){var s=r(t.id);GLIFFY.PLUGINS.storage.googleDrivePlugin.currentFolder=t;GLIFFY.PLUGINS.storage.googleDrivePlugin.currentFolder.doclist=s;var v=GliffyApp.saveDialogController;v.documentList.clear();for(i=0;i<s.length;i++){var u=Ember.Object.create();u.setProperties(s[i]);v.documentList.pushObject(u)}v.hideUIBlocker();setTimeout(function(){v.getModal().find(".gliffy-save-dialog-document-list-item-title").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);v.getModal().find(".gliffy-document-list-item-delete").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);v.getFilenameElement().focus()},1)},customizeUI:function(){$(".gliffy-filemenu-import").addClass("hide-gliffy-drive-only");$(".gliffy-filemenu-revisionhistory").addClass("hide-gliffy-drive-only")}};function j(s){var u=GliffyApp.authController.getOauthUserId();var v='state={"ids":["'+s+'"],"action":"open","userId":"'+u+'"}';var t="/go/gdrive/edit";GLIFFY.onlineUtils.setLocation(t+"?"+encodeURI(v))}function l(){GliffyApp.authController.getAccessToken().then(function(u){var s=new google.picker.View(google.picker.ViewId.DOCS);s.setMimeTypes("application/gliffy+json");var t=new google.picker.PickerBuilder().enableFeature(google.picker.Feature.NAV_HIDDEN).setAppId(GLIFFY.googleDriveAppId).setOAuthToken(u).addView(s).setCallback(h).build();t.setVisible(true);$(".picker-dialog").css("z-index",1000000)})}function h(t){if(t.action===google.picker.Action.PICKED){f=t.docs[0].id;var s=GLIFFY.PLUGINS.storage.googleDrivePlugin.util.ajaxWithRetry;s({method:"GET",url:"https://www.googleapis.com/drive/v2/files/"+f+"/permissions/me"}).then(function(w){if(w.role==="reader"){window.location="/go/gdrive/view?fileId="+f}else{var v=GLIFFY.editor;var u="https://www.googleapis.com/drive/v2/files/"+f+"?alt=media";GLIFFY.PLUGINS.pluginManager.setCurrentDocumentContext("googleDrivePlugin");GLIFFY.PLUGINS.pluginManager.updateUIForCurrentDocumentContext();v.open({url:u,scale:1,callback:function(){}})}},function(u){console.log(u)})}}function n(u,t){if(u){var s=u.lastIndexOf(t);if(s!==-1){return u.slice(0,s)}else{return u}}}function r(s,w){var t=GliffyApp.accountFoldersController.folder_data;if(!w){w=t.data[0]}if(s===w.attr.id){return w.attr.doclist}else{if(w.children){for(var v=0;v<w.children.length;v++){var u=r(s,w.children[v]);if(u){return u}}}else{return null}}}function p(s,w){var t=GliffyApp.accountFoldersController.folder_data;if(!w){w=t.data[0]}if(w.attr.id===s){return w}if(w.children){for(var v=0;v<w.children.length;v++){var u=p(s,w.children[v]);if(u){return u}}}}function g(v,u,s){var t=p(v);if(t){if(!t.children){t.children=[]}t.children.push({data:s,attr:{doclist:[],id:u,type:"GDriveFolder"}})}}function o(s,w){var u=GliffyApp.accountFoldersController.folder_data;var v;if(!w){w=u.data[0];v=GLIFFY.PLUGINS.storage.googleDrivePlugin.currentFolder.doclist;v=_.remove(v,function(x){return(x.id===s)})}var t=this;v=w.attr.doclist;v=_.remove(v,function(x){return(x.id===s)});if(w.children){_.forEach(w.children,function(x){o(s,x)})}}function k(v,s,u){var t=GLIFFY.PLUGINS.storage.googleDrivePlugin.util.ajaxWithRetry;t({method:"GET",url:"https://www.googleapis.com/drive/v2/files/"+f+"/parents"}).then(function(x){var w=_.map(x.items,function(y){return y.id});t({method:"GET",url:"https://www.googleapis.com/drive/v2/files",data:{q:"title='"+v+m+"' and trashed=false",spaces:"drive"}}).then(function(C){var B=C.items;for(var A=0;A<B.length;A++){var z=B[A].parents;for(var y=0;y<z.length;y++){if(w.indexOf(z[y].id)!==-1){s(true);return}}}s(false)},function(y){u(y.xhr,y.status,y.err)})},function(w){u(w.xhr,w.status,w.err)})}})();(function(){var f=false;var d=null;var c=[];GLIFFY.PLUGINS.pluginManager={getCurrentDocumentPlugin:function(){return GLIFFY.PLUGINS.storage[this.getCurrentDocumentContext()]},getActivePlugins:function(){var g={};GLIFFY.PLUGINS.activePlugins.forEach(function(h){g[h]=GLIFFY.PLUGINS.storage[h]});return g},getCurrentDocumentContext:function(){return this.currentDocumentContext||this.getDefaultContext()},setCurrentDocumentContext:function(g){this.currentDocumentContext=g},getDefaultContext:function(){return GliffyApp.authController.getUserPreferences().driveContext},setDefaultContext:function(g){GliffyApp.authController.set("defaultContext",g);GliffyApp.authController.setUserPreference("driveContext",g)},isCurrentDocumentContext:function(g){return this.getCurrentDocumentContext()===g},updateUIForCurrentDocumentContext:function(){var g=this.getCurrentDocumentContext();GliffyApp.authController.set("driveContext",g);e(g)},isGliffyCurrentDocumentContext:function(){return this.currentDocumentContext==="gliffyDrivePlugin"},isGoogleDriveCurrentDocumentContext:function(){return this.currentDocumentContext==="googleDrivePlugin"},getDialogContext:function(){return d},setDialogContext:function(g){d=g},pushContext:function(g){if(g){c.push(g)}else{c.push(this.getCurrentDocumentContext())}},popContext:function(){return this.setCurrentDocumentContext(c.pop())},getDialogPlugin:function(){return d?GLIFFY.PLUGINS.storage[this.getDialogContext()]:this.getCurrentDocumentPlugin()},lockDialogContext:function(){f=true},unlockDialogContext:function(){f=false},handleDialogClose:function(){if(!f){GLIFFY.PLUGINS.pluginManager.setDialogContext(null)}},currentDocumentContext:null};function e(g){$("#tab-title-context-prefix").remove();$("#gliffy").trigger("gliffy.document_tab_updated");if(GLIFFY.PLUGINS.storage[g].customizeUI){GLIFFY.PLUGINS.storage[g].customizeUI()}}})();(function(){GLIFFY.PLUGINS=window.GLIFFY.PLUGINS||{};GLIFFY.PLUGINS.storage=window.GLIFFY.PLUGINS.storage||{};GLIFFY.PLUGINS.storage.googleDrivePlugin=window.GLIFFY.PLUGINS.storage.googleDrivePlugin||{};GLIFFY.PLUGINS.storage.googleDrivePlugin.util=GLIFFY.PLUGINS.storage.googleDrivePlugin.util||{};GLIFFY.PLUGINS.storage.googleDrivePlugin.util.ajaxWithRetry=c;GLIFFY.PLUGINS.storage.googleDrivePlugin.util.retrieveAllFiles=e;function c(f){f.headers=f.headers||{};f.headers.Authorization="Bearer "+GLIFFY.PLUGINS.storage.googleDrivePlugin.token;return d(f).then(null,function(g){if(g.xhr.status===401){return GliffyApp.authController.getAccessToken().then(function(h){f.headers.Authorization="Bearer "+h;return d(f)},function(h){GLIFFY.PLUGINS.pluginManager.setDefaultContext("gliffyDrivePlugin");$("#reinstall-google-drive").modal("show");throw h})}else{throw g}})}function e(f){return new Promise(function(j,h){var g=function(l,k){l.then(function(n){k=k.concat(n.items);var m=n.nextLink;if(m){f.url=m;g(c(f),k)}else{j(k)}})};g(c(f),[])})}function d(f){return new Promise(function(h,g){f.success=function(j){h(j)};f.error=function(l,j,k){g({xhr:l,status:j,err:k})};$.ajax(f)})}})();(function(){window.GLIFFY.onlineUtils={predecorate:function(c,d,f){var e=c.prototype[d];c.prototype[d]=function(){f.apply(this,arguments);return e.apply(this,arguments)}},postdecorate:function(c,d,e){var f=c.prototype[d];c.prototype[d]=function(){var g=[f.apply(this,arguments)].concat(Array.prototype.slice.call(arguments,0));return e.apply(this,g)}},override:function(d,e,c){d.prototype[e]=c},appendTemplates:function(c,e){var d;var f=false;for(d=0;d<c.length;d++){if(d===(c.length-1)){f=true}window.GLIFFY.onlineUtils.appendTemplate(c[d],e,f)}},appendTemplate:function(c,d){d=d||"gliffy-popup-container";setTimeout(function(){var e=Ember.View.create({templateName:c});Ember.View.views[d].pushObject(e)},1)},requireCondition:function(e,c,d){return function(){var f=this,g=arguments,h=f._super;e(function(){var j=f._super;f._super=h;c.apply(f,g);f._super=j},function(){if(d){var j=f._super;f._super=h;d.apply(f,g);f._super=j}})}},requireEmailVerification:function(d,c){return GLIFFY.onlineUtils.requireCondition(function(e,f){GliffyApp.authController.requireAuth(function(){GliffyApp.authController.requireEmailVerification(e,f)},f)},d,c||null)},requireAuth:function(d,c){return GLIFFY.onlineUtils.requireCondition(function(e,f){GliffyApp.authController.requireAuth(e,f)},d,c||null)},requireAccountPermission:function(c,d,f,e){return GLIFFY.onlineUtils.requireCondition(function(g,h){GliffyApp.authController.requireAuth(function(){GliffyApp.authController.requireAccountPermission(c,d,g,h)},h)},f,e||null)},setLocation:function(c){if(window.history&&window.history.replaceState){window.history.replaceState({},document.title,c)}},setDocumentLocation:function(d){var c=window.location.pathname;c=c.replace(/\/[^\/]*$/,"/"+d);this.setLocation(c+window.location.search);window.name="gliffy"+d},setWindowTitle:function(c){document.title=c},openCenteredPopupWindow:function(c,m,n,g){var l=window.screenLeft!=undefined?window.screenLeft:screen.left;var d=window.screenTop!=undefined?window.screenTop:screen.top;var e=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width;var o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var f=((e/2)-(n/2))+l;var k=((o/2)-(g/2))+d;var j=window.open(c,m,"scrollbars=yes, width="+n+", height="+g+", top="+k+", left="+f);if(window.focus){j.focus()}},updateQueryString:function(d,f,c){if(!c){c=window.location.href}var e=new RegExp("([?|&])"+d+"=.*?(&|#|$)(.*)","gi");if(e.test(c)){if(typeof f!=="undefined"&&f!==null){return c.replace(e,"$1"+d+"="+f+"$2$3")}else{return c.replace(e,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof f!=="undefined"&&f!==null){var h=c.indexOf("?")!==-1?"&":"?",g=c.split("#");c=g[0]+h+d+"="+f;if(g[1]){c+="#"+g[1]}return c}else{return c}}},formatFormError:function(e){var d=Array();for(var c=0;c<e.length;c++){if(e[c].key==="global"){d.push(e[c].message)}else{d.push(e[c].key+": "+e[c].message)}}return d.join("<br/>")},setModalErrorMessage:function(c,d){if(typeof(d)!=="string"){d=window.GLIFFY.onlineUtils.formatFormError(d)}$(c).find(".ember-view > .alert").show().children("span").html(d)},isValidEmail:function(d,g){var f=new RegExp("^([\\w+!#$%&'*+-/=?^_`{|}~.])+@(([a-z\\d-]+)|([a-z\\d-]+\\.[a-z\\d-]+))+\\.[a-z]+$","gi");var c=f.exec(d);if(c!==null){var e=c[1];if((e.indexOf(".")!==e.length-1)&&e.indexOf("..")===-1){return true}}return false},feedbackInit:function(){var d={feedback:"c86a7d4a",error:"7aa05b3b"};jQuery.ajax({url:"https://jira.gliffy.com/s/en_US-53ss6r/734/4/1.2.5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId="+d.feedback,type:"get",cache:true,dataType:"script"});jQuery.ajax({url:"https://jira.gliffy.com/s/en_US-53ss6r/734/4/1.2.5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId="+d.error,type:"get",cache:true,dataType:"script"});var c={};c[d.feedback]={triggerFunction:function(e){$("#gliffy-anchor-feedback").click(function(f){f.preventDefault();e()})}};c[d.error]={triggerFunction:function(e){$("body").bind("send-error.gliffy-body",function(g,f){console.log("error ",f.message,f.report);window.ATL_JQ_PAGE_PROPS[d.error].fieldValues.description=f.report;e()})}};window.ATL_JQ_PAGE_PROPS=jQuery.extend(window.ATL_JQ_PAGE_PROPS,c)},handleDiagramActionError:function(j,h,d,f,e){var g=d+": "+f,c;if(j.status===404){g=$.i18n._("online.404.error",[f]);j.responseText=g;c=$.i18n._("online.404.error.title")}if(e){window.GLIFFY.Dialog.showAlertDialog({content:g,title:c})}return g},getFileHandle:function(c){if(c===undefined||c===null){return""}else{return c.substring(c.lastIndexOf(".")+1)}},downloadFile:function(g,d,m){var f=function(p,o,n){};var l="download" in document.createElement("a");var h=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var j=window.URL||window.webkitURL||window.mozURL||window.msURL;navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob;window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs;var e={"image/jpeg":true,"image/png":true,"image/gif":true,"image/svg+xml":true,"image/bmp":true,"image/x-windows-bmp":true,"image/webp":true,"audio/wav":true,"audio/mpeg":true,"audio/webm":true,"audio/ogg":true,"video/mpeg":true,"video/webm":true,"video/ogg":true,"text/plain":true,"text/html":true,"text/xml":true,"application/xhtml+xml":true,"application/json":true};if(h&&(window.saveAs||navigator.saveBlob)){f=function(q,p,r){var o=new h();o.append(q);var n=o.getBlob(m||"application/octet-stream");if(!p){p="Download.bin"}if(window.saveAs){window.saveAs(n,p)}else{navigator.saveBlob(n,p)}}}else{if(h&&j){f=function(u,r,n){var p,q,o=new h();o.append(u);if(!n){n="application/octet-stream"}if(l){p=o.getBlob(n);q=j.createObjectURL(p);var t=document.createElement("a");t.setAttribute("href",q);t.setAttribute("download",r||"Download.bin");var s=document.createEvent("MouseEvents");s.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);t.dispatchEvent(s)}else{if(e[n.split(";")[0]]===true){n="application/octet-stream"}p=o.getBlob(n);q=j.createObjectURL(p);window.open(q,"_blank","")}setTimeout(function(){j.revokeObjectURL(q)},250)}}else{if(l){var k=document.createElement("a");k.setAttribute("href",g);k.setAttribute("download",d);var c=document.createEvent("MouseEvents");c.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);k.dispatchEvent(c)}else{if(/\bSafari\b/.test(navigator.userAgent)){var k=document.createElement("a");k.setAttribute("href",g);var c=document.createEvent("MouseEvents");c.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);k.dispatchEvent(c)}else{if(!/\bMSIE\b/.test(navigator.userAgent)){f=function(p,o,n){if(!n){n="application/octet-stream"}if(e[n.split(";")[0]]===true){n="application/octet-stream"}window.open(p,"_blank","")}}}}}}f(g,d,m)},toTitlecase:function(c){return c.charAt(0).toUpperCase()+c.substr(1).toLowerCase()}}}());(function(){$(function(){var c=$("body");GLIFFY.EditorReady=false;GLIFFY.TemplatesReady=false;c.on("editorReady",GLIFFY.EditorReadyEvent);c.on("templatesReady",GLIFFY.TemplatesReadyEvent)});GLIFFY.EditorReadyEvent=function(){GLIFFY.EditorReady=true;GLIFFY.readyCheck()};GLIFFY.TemplatesReadyEvent=function(){GLIFFY.TemplatesReady=true;GLIFFY.readyCheck()};GLIFFY.readyCheck=function(){if(GLIFFY.EditorReady&&GLIFFY.TemplatesReady){$("body").trigger("editorAndTemplatesReady");Experiments.Editor.load();var c=JSON.parse($.ajax({type:"GET",url:"/go/isInitialOAuthSignup",dataType:"json",async:false}).responseText);if(c!=null&&c.isInitialOAuthSignup===true){GliffyApp.trialSignupInviteModalController.show();GliffyApp.welcomeScreenController.set("hideWelcomeScreen",true);window.GLIFFY.analyticsUtils.logMixpanelEvent("signup",{"$email":GliffyApp.authController.getUsername(),product:GliffyApp.authController.account.productId})}if(GliffyApp.authController.isAuthenticated()){GliffyApp.googleDriveController.initMyDocumentsPopOver()}}}}());window.GLIFFY.constants={LAUNCH_URL:"/go/html5/launch"};(function(){window.GLIFFY=window.GLIFFY||{};window.GLIFFY.analyticsUtils={incrementMixpanelSuperProperty:function(c){var f=c+"Count";var d=["accountManagement","collaborate","documentCreate","documentExport","documentImport","documentOpen","documentSave","login","printMenuClick","publish","purchase","signup","social","tryApp","uncollaborate","unpublish"];if((_.indexOf(d,c)>-1)&&(window.mixpanel&&typeof window.mixpanel.get_property==="function"&&typeof window.mixpanel.register==="function")){var g={};var e=window.mixpanel.get_property(f);if(e&&typeof(e)=="number"){g[f]=e+1}else{g[f]=1}window.mixpanel.register(g)}},logMixpanelEvent:function(d,e){if(window.GliffyApp&&GliffyApp.authController&&GliffyApp.authController.getUserID()&&window.mixpanel&&typeof window.mixpanel.track==="function"){e=(e!=null)?e:{};this.incrementMixpanelSuperProperty(d);if(typeof e.appId==="undefined"&&window.GLIFFY.ENV.app){e.appId=window.GLIFFY.ENV.app}if(typeof e.appName==="undefined"&&window.GLIFFY.ENV.appName){e.appName=window.GLIFFY.ENV.appName}if(typeof e.productId==="undefined"&&GliffyApp.authController.account.productId){e.productId=GliffyApp.authController.account.productId}if(typeof e.userId==="undefined"&&GliffyApp.authController.getUserID()){e.userId=GliffyApp.authController.getUserID()}if(typeof e.accountId==="undefined"&&GliffyApp.authController.getAccountId()){e.accountId=GliffyApp.authController.getAccountId()}if(typeof e.accountCreateDate==="undefined"&&GliffyApp.authController.getAccountCreateDate()){e.accountCreateDate=GliffyApp.authController.getAccountCreateDate()}if(typeof e.accountDiagrams==="undefined"&&GliffyApp.authController.getAccountDiagrams()){e.accountDiagrams=GliffyApp.authController.getAccountDiagrams()}if(typeof e.accountUsers==="undefined"&&GliffyApp.authController.getAccountUserCount()){e.accountUsers=GliffyApp.authController.getAccountUserCount()}if(typeof e.email==="undefined"&&GliffyApp.authController.getUsername()){e.email=GliffyApp.authController.getUsername()}if(typeof e.activeOptimizelyExperiments==="undefined"&&window.optimizely&&window.optimizely.variationMap&&window.optimizely.variationMap.length>0){e.activeOptimizelyExperiments=window.optimizely.variationMap}try{window.mixpanel.track(d,e)}catch(c){console.log(c)}}},optimizelyEvent:function(c){window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];window.optimizely.push(["trackEvent",c])}}}());(function(){var d=window.location.protocol+"//"+window.location.host,c;function f(){var h,g;if(GLIFFY.ENV.app==="d8e91192-2f34-471c-80a6-900880844ffd"&&GliffyApp.authController){h=GliffyApp.authController.getUserID()||"0";g=GliffyApp.authController.getUserToken()||"NOT_A_TOKEN";return{uid:h,token:g}}return{}}function e(g){return g.split("?")[0]}c=GLIFFY.Class.extend({getApiRoot:function(){return d},getQueryUrl:function(h,l){var j,g=[],k="";for(j in l){if(l.hasOwnProperty(j)&&l[j]!==null){g.push(encodeURIComponent(j)+"="+encodeURIComponent(l[j]))}}if(g.length>0){k=g.join("&");if(h.indexOf("?")===-1){k="?"+k}else{k="&"+k}}return h+k},reauthUrl:function(h){var g=$.url(h),j=g.param();delete j.uid;delete j.token;return this.getAuthUrl(e(h),j)},getAuthUrl:function(g,j){var h=f();if(/\?(.*&)?uid=/.test(g)){delete h.uid}if(/\?(.*&)?token=/.test(g)){delete h.token}if(j){h=$.extend(h,j)}return this.getQueryUrl(g,h)},getActionUrl:function(j,h){var g;if(/\/$/.test(d)){g=d+j}else{g=d+"/"+j}return this.getAuthUrl(g,h)},GET:function(h,g){g=g||{};this._ajax("GET",h,g.query||null,null,g.isUrl||false,g.success||null,g.error||null,g.context||null)},POST:function(j,h,g){g=g||{};this._ajax("POST",j,g.query||null,h||null,g.isUrl||false,g.success||null,g.error||null,g.context||null)},PUT:function(j,h,g){g=g||{};this._ajax("PUT",j,g.query||null,h||null,g.isUrl||false,g.success||null,g.error||null,g.context||null)},DELETE:function(h,g){g=g||{};this._ajax("DELETE",h,g.query||null,g.data||null,g.isUrl||false,g.success||null,g.error||null,g.context||null)},_ajax:function(q,g,p,l,r,j,m,h){var o,n,k={type:q,url:r?this.getAuthUrl(g,p||{}):this.getActionUrl(g,p||{})};n=function(){GLIFFY.API._ajax(q,g,p,l,r,j,m,h)};o=m?function(u,s,t){m.call(h||window,u,s,t)}:function(){};if(l){k.processData=false;if(window.File&&l instanceof window.File){k.data=l;k.contentType="application/octet-stream"}else{k.data=JSON.stringify(l);k.contentType="application/json"}}if(j){k.success=function(t,u,s){j.call(h||window,t,u,s);n=null;o=null}}else{k.success=function(t,u,s){n=null;o=null}}k.error=function(u,s,t){if(u.status===401&&GliffyApp.authController){GliffyApp.authController.redirectToLogin(n,function(){o(u,s,t)})}else{o(u,s,t)}};$.ajax(k)}});if(!window.GLIFFY.API){window.GLIFFY.API={}}window.GLIFFY.API.init=function(g){if(g===undefined||g===null){throw new Error("apiRoot was not specified when initializing the API object.")}d=g;window.GLIFFY.API=new c()}}());(function(){GLIFFY.DragProxy=GLIFFY.Class.extend({init:function(c,e,d){this.originalX=e||0;this.originalY=d||0;this.threshold=c||0;this.duration=300;this.element=null},setElement:function(c){this.element=c},getElement:function(){return this.element},aboveThreshold:function(c,d){c-=this.originalX;d-=this.originalY;return this.threshold*this.threshold*2<c*c+d*d},activate:function(e,c){var d=this;$("#super-ui-blocker").show();$(document).bind("mousemove.drag",function(f){d.move(f.pageX,f.pageY);e(f)}).bind("mouseup.drag",function(f){d.deactivate();c(f,function(g){if(g){d.drop()}else{d.cancel()}})})},deactivate:function(){$(document).unbind(".drag");$("#super-ui-blocker").hide()},move:function(c,d){$(this.element).css({top:d,left:c})},drop:function(){var c=$(this.element);c.css({width:c.width()+"px",height:c.height()+"px",overflow:"hidden",whiteSpace:"nowrap"});c.animate({width:"10px",left:"10px",opacity:0},this.duration,function(){c.remove()})},cancel:function(){var c=$(this.element);c.animate({opacity:0,left:this.originalX+"px",top:this.originalY+"px"},this.duration,function(){c.remove()})}})}());(function(){GliffyApp.DocumentListItemModel=Ember.Object.extend({name:null,isFavorite:null,lastModified:null,lastModifiedFriendly:null,createDate:null,createDateFriendly:null,isPublic:false,createdBy:null,lastModifiedBy:null,currentlyEditedBy:null,urls:{thumbnail:null,open:null,update:null},"read-only":null,isBeingEdited:Ember.computed(function(){var c=this.get("currentlyEditedBy");return(c!==undefined&&c!==null&&c!=="N/A")}).property("currentlyEditedBy"),isGliffyOnline:Ember.computed(function(){return this.get("type")===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE}).property("type"),tooltip:Ember.computed(function(){if(this.isEditable){return this.get("name")+", click to edit"}else{return this.get("name")}}).property("name"),isEditable:false,isEditingName:false,isLoaded:false})}());(function(){GliffyApp.ImageInfoModel=Ember.Object.create({filename:null,height:null,id:null,image:null,size:null,tags:null,thumbnail:null,tid:null,uid:null,url:null,useOriginalDimensions:null,width:null,populate:function(c){this.set("filename",c.filename);this.set("height",c.height);this.set("id",c.id);this.set("image",c.image);this.set("size",c.size/1000);this.set("tags",c.tags);this.set("thumbnail",c.thumbnail);this.set("tid",c.tid);this.set("uid",c.uid);this.set("url",c.url);this.set("useOriginalDimensions",c.useOriginalDimensions);this.set("width",c.width);if(this.get("filename")==null){this.set("filename","import")}}})}());(function(){GliffyApp.BillingStatusModel=Ember.Object.extend({status:null,periodEnd:null,source:null,validForAslId:null,load:function(d){var c=this;GLIFFY.API.GET("subscriptions/status/"+d,{success:function(e){c.populate(e)},error:function(e){if(e.status===402){c.status="unpaid";c.validForAslId=JSON.parse(e.responseText).validForAslId}else{console.log("ERROR getting subscription status!",e)}}})},refreshStatusAndAccount:function(){var d=GliffyApp.authController.getAccountId();var c=this;GLIFFY.API.GET("subscriptions/status/"+d,{success:function(e){c.populate(e);GliffyApp.authController.refreshAccountSettings()},error:function(e){if(e.status===402){c.status="unpaid";c.validForAslId=JSON.parse(e.responseText).validForAslId}else{console.log("ERROR getting subscription status!",e)}}})},loadCurrentAccount:function(){this.load(GliffyApp.authController.getAccountId())},populate:function(c){this.set("status",c.status);this.set("periodEnd",c.periodEnd);this.set("source",c.source);this.set("validForAslId",c.validForAslId)}})}());(function(){GliffyApp.UserModel=Ember.Object.extend({uid:null,token:null,username:null,createdDate:null,email:null,OptOut:false,isConfirmed:false,terms:false,isTempPwd:false,authenticated:false,accountUsers:false,currentAccount:null,userPreferences:null,gDriveOAuth2:false,diagramsSharedCount:null,oauthUserId:null,isAuthenticated:Ember.computed(function(){return(this.get("authenticated")||this.get("token")!==null)&&this.get("uid")!==null}).property("token","uid"),init:function(){this.set("accountUsers",Ember.A([]))},displayName:Ember.computed(function(){if(this.get("username")){return this.get("username")}else{return"Demo User"}}).property("username"),optIn:Ember.computed(function(){return(!this.get("OptOut"))}).property("OptOut"),hasGDriveOAuth2:Ember.computed(function(){return(this.get("gDriveOAuth2"))}).property("gDriveOAuth2"),populate:function(d){this.set("authenticated",true);this.set("uid",d.uid||null);this.set("username",d.username||null);this.set("email",d.email||null);this.set("createdDate",d.createdDate||null);this.set("token",d.token||null);this.set("OptOut",d.optOut||null);this.set("isConfirmed",d.isConfirmed||null);this.set("terms",d.token||null);this.set("isTempPwd",d.optOut||null);this.set("munchkinKey",d.munchkinKey||null);this.set("accountUsers",Ember.A([]));this.set("diagramsSharedCount",d.diagramsSharedCount);this.set("fullname",d.fullname||null);this.set("gDriveOAuth2",d.hasGDriveOAuth2||false);this.set("oauthUserId",d.oauthUserId||null);var e=GliffyApp.authController.getAccountId();if(typeof GliffyApp.documentManagerController!="undefined"){GliffyApp.documentManagerController.propertyWillChange("showSwitcher")}for(var c=0;c<d.accountUsers.length;c++){var f=GliffyApp.AccountUserListItem.create({accountId:d.accountUsers[c].accountId,productId:d.accountUsers[c].productId,accountName:d.accountUsers[c].name,userRole:d.accountUsers[c].userRole,isDefault:d.accountUsers[c].isDefault});if(d.accountUsers[c].accountId==e){this.set("currentAccount",f)}this.accountUsers.pushObject(f)}if(typeof GliffyApp.documentManagerController!="undefined"){GliffyApp.documentManagerController.propertyDidChange("showSwitcher")}},loadPreferences:function(e,d){var c=this;c.set("userPreferences",null);return new Promise(function(g,f){GLIFFY.API.GET("user/getAllUserPreferences",{success:function(h){c.getUserPreferences().setProperties(h);g(c)},error:function(k,h,j){f(j);console.error("error getting user preferences",k,h,j)}})})},getUserPreferences:function(){if(this.get("userPreferences")===null){this.userPreferences=Ember.Object.create();this.get("userPreferences").setProperties(this.DEFAULT_USER_PREFERENCES)}return this.get("userPreferences")},setPreference:function(d,e){var c=this;c.getUserPreferences().set(d,e);GLIFFY.API.GET("user/setUserPreference?prefKey="+d+"&prefValue="+e,{success:function(f){},error:function(h,f,g){console.error("error setting user preference",h,f,g)}})},fetch:function(g,e){var d=this.get("uid"),c=this,f;if(d!==0){GLIFFY.API.GET("user.json",{success:function(h){c.populate(h);if(g){g(c)}},error:function(){c.authenticated=false;if(e){e()}}})}},getFullname:function(){var c={};if(this.fullname){if(this.fullname.match(/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/)){return{}}var d=this.fullname.split(/\s+/);if(d.length>0){c.first=d[0]}if(d.length>1){c.last=d.slice(1).join(" ")}}return c},DEFAULT_USER_PREFERENCES:{printerPaperSize:"LETTER",navigatorOn:"true",SHAPE_LIBRARY_TIP:{shown:"false"},driveContext:"gliffyDrivePlugin"},switchAbleAccounts:Ember.computed(function(){var c=Ember.A([]),e=this;var d=e.get("accountUsers");for(var f=0;f<d.length;f++){if(d[f].get("productId").indexOf("GAPP")===-1){c.push(d[f])}}return c}).property("accountUsers")});GliffyApp.AccountUserListItem=Ember.Object.extend({accountId:null,productId:null,accountName:null,userRole:"USER",isDefault:false})}());(function(){var d=1024*1024;var c=0;var e=999999999;GliffyApp.AccountModel=Ember.Object.extend({id:null,userRole:null,name:null,createdDate:null,createdDateMilli:null,daysLeftUntilTrialExpiration:null,appsDomain:null,apiKey:null,apiSecret:null,storage:null,userCount:null,diagramCount:null,features:null,isTrial:null,isAcademic:null,creatorId:null,productId:null,billingPeriod:null,billingPrice:0,productDescription:null,productType:null,productTypeI18nMap:null,aslId:null,accountMetadata:null,accountUserMetadata:null,hasSegmentEditorLoaded:false,init:function(){this.set("id",0);this.set("productType","unauthorized");this.set("features",{});this.set("productTypeI18nMap",{FREE:"online.pricing.free.title",TRIAL:"online.pricing.trial.title",BUSINESS:"online.pricing.business.title",STANDARD:"online.pricing.standard.title"})},displayName:Ember.computed(function(){if(this.get("id")!==0){return this.get("name")}else{return"Demo Account"}}).property("id","name"),populate:function(f){GliffyApp.authController.propertyWillChange("isLoggedIn");this.set("id",f.id||0);this.set("userRole",f.userRole);this.set("creatorId",f.creatorId);this.set("name",f.name);this.set("daysLeftUntilTrialExpiration",f.daysLeftUntilTrialExpiration);this.set("appsDomain",f.appsDomain);this.set("apiKey",f.apiKey);this.set("apiSecret",f.apiSecret);this.set("storage",f.storage);this.set("userCount",f.userCount);this.set("diagramCount",f.diagramCount);this.set("features",f.features);this.set("isTrial",f.isTrial);this.set("createdDate",f.createdDate);this.set("isAcademic",f.isAcademic);this.set("productId",f.productId);this.set("productDescription",f.productDescription);this.set("productType",f.productType||"unauthorized");this.set("aslId",f.aslId||0);this.set("googleDriveUserName",f.googleDriveUserName||0);this.set("googleDriveUserEmail",f.googleDriveUserEmail||0);this.set("googleDriveUserIcon",f.googleDriveUserIcon||0);this.set("accountMetadata",f.accountMetadata||0);this.set("accountUserMetadata",f.accountUserMetadata||0);this.set("createdDateMilli",f.createdDateMilli||0);this.set("billingPeriod",f.billingPeriod||0);this.set("billingPrice",f.billingPrice||0);GLIFFY.Utils.analyticsEvent("setCustomVariables",{product:null,license:this.get("productType"),numUsers:(this.get_max_users()+" Users")});GliffyApp.authController.propertyDidChange("isLoggedIn");GliffyApp.authController.accountIsLoaded(this);if(GliffyApp.authController.isPaidAccount()){GliffyApp.versionHistoryController.removeSubscribeToday();GliffyApp.versionHistoryController.enableRevisionHistory()}if(this.get("id")!==0){if(!this.get("hasSegmentEditorLoaded")){window.segmentUtils.editorLoad();this.set("hasSegmentEditorLoaded",true)}}},fetch:function(j,g){var k=this.get("id"),f=this,h;h={};if(k!==null){h.accountId=k}else{if(k==c){h.accountId=null}}GLIFFY.API.GET("account/settings.json",{query:h,success:function(l){f.populate(l);if(j){j(f)}},error:function(l){if(l.status==400){GliffyApp.authController.noAccount()}if(g){g(f)}}})},__get_feature_value_as_int:function(f){if(!this.features.hasOwnProperty(f)){return -1}return parseInt(this.features[f]["value"])},get_max_users:function(){return this.__get_feature_value_as_int("MAX_USERS")},get_max_storage:function(){return this.__get_feature_value_as_int("MAX_MEGABYTES")*d},get_max_diagrams:function(){return this.__get_feature_value_as_int("MAX_DIAGRAMS")},isUpgradeVisible:Ember.computed(function(){var f=(this.get_max_storage()-this.get("storage"))/d;return !GliffyApp.authController.isAnonymousAccount()&&f<=5&&f>=0}).property("storage","features"),__can_use_quantity:function(j,h,g){if(!this.features[h]){return false}var f=parseInt(this.features[h]["value"]);if(f===e){return true}else{return f*g-this.get(j)>0}},__can_use:function(f){return this.features.hasOwnProperty(f)},__has_unlimited_access_to_feature:function(f){if(!this.features[f]){return false}return parseInt(this.features[f]["value"])===e},can_add_user:function(){return this.__can_use_quantity("userCount","MAX_USERS",1)},can_add_diagram:function(){return this.__can_use_quantity("diagramCount","MAX_DIAGRAMS",1)},can_add_image:function(){return this.__can_use_quantity("storage","MAX_MEGABYTES",d)},can_collaborate:function(){return this.__can_use("COLLABORATE")},can_create_private_diagrams:function(){return this.__can_use("PRIVATE_DIAGRAMS")},can_import_visio_diagrams:function(){return this.__can_use("VISIO_IMPORT")},can_use_google_drive:function(){return this.__can_use("GOOGLE_DRIVE")},can_view_comment:function(){return this.__can_use("COMMENT_VISIBLE")},can_use_comment:function(){return this.__can_use("COMMENT")},can_use_share:function(){return this.__can_use("SHARE_VIEW")},can_use_share_edit:function(){return this.__can_use("SHARE_EDIT")},can_view_share:function(){return this.__can_use("SHARE_VISIBLE")},can_use_premium_shapes:function(){return this.__can_use("PREMIUM_SHAPES")},can_create_custom_libraries:function(){return this.__can_use("CUSTOM_LIBRARIES")},has_unlimited_access_to_diagrams:function(){return this.__has_unlimited_access_to_feature("MAX_DIAGRAMS")},has_unlimited_access_to_image_storage_space:function(){return this.__has_unlimited_access_to_feature("MAX_MEGABYTES")},diagramsLeft:Ember.computed(function(){var f=this.get_max_diagrams()-this.get("diagramCount");if(f<0){return 0}else{return f}}).property("diagramCount"),hasDiagramsLeft:Ember.computed(function(){return(this.get("diagramsLeft")>0)}).property("diagramsLeft"),isLowOnDiagrams:Ember.computed(function(){return(this.get("diagramsLeft")>0&&this.get("diagramsLeft")<6)}).property("diagramsLeft"),storageLeft:Ember.computed(function(){var f=Math.round(((this.get_max_storage()-this.get("storage"))/d)*10)/10;if(f<0){f=0}return f+" MB"}).property("storage"),storageUsed:Ember.computed(function(){return Math.round(((this.get("storage"))/d)*100)/100+" MB"}).property("storage"),storageMax:Ember.computed(function(){return Math.round((this.get_max_storage()/d)*100)/100+" MB"}).property("storage")})}());(function(){GliffyApp.OnlineDocumentModel=GliffyApp.DocumentModel.extend({id:null,isPublic:false,folderId:null,populate:function(c){this.set("id",c.id);if(c.name!==undefined){this.set("title",c.title)}this.set("isPublic",c.isPublic)},update:function(c){this._super(c);this.set("id",c.getUrls().id);this.set("isPublic",c.getUrls().isPublic)},displayTitle:Ember.computed(function(){var c=this.get("title")+", v"+this.get("currentRevision");if(!$.isNumeric(this.get("currentRevision"))||this.get("currentRevision")<1){c=this.get("title")}return(this.get("unsavedChanges")===true?"*":"")+c}).property("title","unsavedChanges","currentRevision")});GliffyApp.documentModel=GliffyApp.OnlineDocumentModel.create()}());(function(){GliffyApp.CollaboratorsModel=Ember.ArrayProxy.extend({toObject:function(){var c={collaborators:[]};this.forEach(function(f,e,d){c.collaborators[c.collaborators.length]=f.toObject()});return c},fromObject:function(f){var e=Ember.A([]);for(var d=0;d<f.collaborators.length;d++){var c=GliffyApp.CollaboratorModel.create();c.fromObject(f.collaborators[d]);e.pushObject(c)}this.set("content",e)}})}());(function(){GliffyApp.CollaboratorModel=Ember.Object.extend({userId:null,permissions:Ember.computed(function(){if(this.get("isOwner")){return"Owner"}else{if(this.get("isCollaborator")){return"View & Edit"}else{return"View Only"}}}).property("isOwner","isViewer","isCollaborator"),canRemove:Ember.computed(function(){if(this.get("id")===Number(GliffyApp.authController.getUserID())){return false}return true}).property("isOwner","id"),toObject:function(){var c={};c.id=this.get("id");c.email=this.get("email");c.isCollaborator=this.get("isCollaborator");c.isViewer=this.get("isViewer");c.isOwner=this.get("isOwner");c.isMemberOfCurrentUsersAccount=this.get("isMemberOfCurrentUsersAccount");return c},fromObject:function(c){this.setProperties(c)}})}());(function(){var g=(new Date()).getTime(),c={collaboration:"Upgrading to a Standard or Pro account will allow you to invite others to collaborate on your diagram.",diagramCount:"Upgrading your account will allow you to make more diagrams.",storage:"Upgrading your account will give you more space for saving your diagrams and images.",userCount:"You have run out of users for this account. Would you like to upgrade the amount of users available for this account?"},f="You will need to upgrade your account to have this feature available.";var h=window.GLIFFY.PLUGINS.pluginManager;function e(){if($.browser.msie&&$.browser.version<10){return true}return false}function j(k){return function(){var l=Array.prototype.slice.call(arguments);if(e()){window.location="/go/gdrive/unsupportedBrowser"}else{if(GliffyApp.authController.canAccountUseGoogleDrive()){k.apply(GliffyApp.toolbarController,l)}else{GliffyApp.ineligibleForGDriveController.show()}}}}function d(k){return function(){var l=Array.prototype.slice.call(arguments);if(e()){window.location="/go/gdrive/unsupportedBrowser"}else{if(GliffyApp.authController.canAccountUseComment()){k.apply(null,l)}else{GliffyApp.ineligibleForCommentController.show()}}}}GliffyApp.AuthController=Ember.Controller.extend({user:null,account:null,doNotShowUpgradeButton:false,ACCOUNT_TYPE_BASIC:"FREE",ACCOUNT_TYPE_STANDARD:"STANDARD",ACCOUNT_TYPE_PREMIUM:"BUSINESS",ACCOUNT_TYPE_TEAM:"BUSINESSTEAM",ACCOUNT_TYPE_ENTERPRISE:"ENTERPRISE",ACCOUNT_PERIOD_ANNUAL:"Annual",ACCOUNT_PERIOD_MONTHLY:"Monthly",DEFAULT_USER_COUNT_SU:1,DEFAULT_USER_COUNT_MU:5,ACCOUNT_STATUS_SUSPENDED:"Suspended",ACCOUNT_STATUS_ACTIVE:"Active",DOCMAN_URL:"/go/documentManager",SIGNUP_URL:"/go/commerce/signup",UPGRADE_URL:"/go/commerce/purchase?accountID=ACCOUNTID&serviceLevel=SERVICELEVEL",PREPURCHASE_OPTIONS_URL:"/go/commerce/saveoptions",PURCHASEPRO_URL:"/go/commerce/purchase?accountID=ACCOUNTID&serviceLevel=TYPE_PREMIUM",PURCHASE_URL:"/go/commerce/purchase",NOACCOUNT_URL:"/go/noaccount",PURCHASE_BROWSER_TAB_NAME:"purchaseWindow",BILLING_INFO:{},init:function(){var k=this;this.set("user",GliffyApp.UserModel.create());this.set("account",GliffyApp.AccountModel.create());this.set("billingStatus",GliffyApp.BillingStatusModel.create());this.__updateAccountTypeClass();this.__callbacks=[];$(window).focus(function(){})},actions:{openPurchaseStd:function(k){GLIFFY.analyticsUtils.optimizelyEvent("editorUpgradeModalChoseStandardPlan");this.openPurchasePage(this.get("ACCOUNT_PERIOD_ANNUAL"),this.get("DEFAULT_USER_COUNT_SU"),this.get("ACCOUNT_TYPE_STANDARD"));GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:k,label:"clickPurchaseStandard"})},openPurchaseProAction:function(k){GLIFFY.analyticsUtils.optimizelyEvent("editorUpgradeModalChoseBusinessPlan");this.openPurchasePage(this.get("ACCOUNT_PERIOD_ANNUAL"),this.get("DEFAULT_USER_COUNT_SU"),this.get("ACCOUNT_TYPE_PREMIUM"));GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:k,label:"clickPurchasePro"})},openPurchaseBusinessTeamAction:function(k){GLIFFY.analyticsUtils.optimizelyEvent("editorUpgradeModalChoseBusinessTeamPlan");this.openPurchasePage(this.get("ACCOUNT_PERIOD_ANNUAL"),this.get("DEFAULT_USER_COUNT_MU"),this.get("ACCOUNT_TYPE_TEAM"));GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:k,label:"clickPurchaseBusinessTeam"})},openChangePayment:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"menuAction",label:"Payment Info"});window.open(this.__formatURL(this.get("UPGRADE_URL")),this.get("PURCHASE_BROWSER_TAB_NAME"));GliffyApp.accountManageController.cancel()},userLogout:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"logout",label:window.location.pathname});window.location="/go/ologout?app="+GLIFFY.ENV.app},openDocumentManager:function(){window.name="gliffy"+GliffyApp.documentModel.get("id");if(GLIFFY.BrowserDetect.browser==="Firefox"){var k=window.open(this.get("documentManagerUrl"),"gliffyDocumentManager");k.close()}window.open(this.get("documentManagerUrl"),"gliffyDocumentManager");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"myDocuments"})},goToGoogleDrive:function(){GliffyApp.googleDriveController.handleInstallAndAuth(function(){window.open("https://drive.google.com","_blank");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"goToGDrive"})})}},checkGoogleDriveEligibility:j,checkCommentEligibility:d,getAccessToken:function(k){k=k||this.getAccountId();return new Promise(function(m,l){$.ajax({url:"/go/gdrive/accessToken?accountId="+k,success:function(o){var n;try{o=JSON.parse(o);n=o.access_token;GLIFFY.PLUGINS.storage.googleDrivePlugin.token=n;m(n)}catch(p){l(p)}},error:function(p,n,o){GLIFFY.PLUGINS.storage.googleDrivePlugin.token=null;l({xhr:p,err:o})}})})},openPurchasePro:function(k){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:k,label:"clickPurchasePro"});window.open(this.__formatURL(this.get("PURCHASEPRO_URL")),this.get("PURCHASE_BROWSER_TAB_NAME"))},openPurchasePage:function(n,m,l){var k=this;k.set("BILLING_INFO",{billingPeriod:n,userCount:m,accountType:l});l=GLIFFY.onlineUtils.toTitlecase(l);$.ajax({url:this.get("PREPURCHASE_OPTIONS_URL"),method:"POST",data:{billingPeriod:n,userCount:m,accountType:l},async:false}).done(function(){var o=$("#gliffy-account-modal");if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.EditorPurchasePage&&window.optimizely.GHAX.EditorPurchasePage.showPurchasePage&&!GliffyApp.authController.getAccountIsExpired()){if(o.css("display")==="none"){if($("#ineligible-for-google-drive-modal").css("display")==="block"){$("#ineligible-for-google-drive-modal").find(".close").click()}if(!o.hasClass("expanded")){o.addClass("expanded")}GliffyApp.accountManageController.theModal=o;GliffyApp.accountManageController.show()}if((window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.Stripe&&window.optimizely.GHAX.Stripe.useStripe)||GliffyApp.authController.billingStatus.source==="ben"){GliffyApp.accountManageController.showEditorStripePurchasePageTab();GliffyApp.accountEditorStripePurchasePageController.showEditorStripePurchasePage()}else{GliffyApp.accountManageController.showEditorPurchasePageTab();GliffyApp.accountEditorPurchasePageController.showEditorPurchasePage()}}else{window.open(GliffyApp.authController.get("PURCHASE_URL"),GliffyApp.authController.get("PURCHASE_BROWSER_TAB_NAME"))}})},addLoginCallback:function(k){this.__callbacks.push(k)},login:function(q,r,p){var n,l=this;this.__removeAccountTypeClass();this.set("user",GliffyApp.UserModel.create());this.populateUserData(q);this.get("billingStatus").load(r);GLIFFY.analyticsUtils.logMixpanelEvent("login",{product:GliffyApp.authController.account.productId});var m={Email:this.getUsername()};var k=this.user.getFullname();if(k.first){m.FirstName=k.first}if(k.last){m.LastName=k.last}if(typeof mktoMunchkinFunction=="function"&&this.getMunchkinKey()){try{mktoMunchkinFunction("associateLead",m,this.getMunchkinKey())}catch(o){console.log(o)}}if(window.qualaroo){window.qualaroo.push(["identify",this.getUsername()])}this.setAccountId(r);this.fetchAccount(function(){l.loadUserPreferences().then(function(){if(l.get("user").get("gDriveOAuth2")){return l.getAccessToken()}return Promise.reject({xhr:{status:401}})}).then(function(){h.setDefaultContext(h.getDefaultContext())},function(t){if(t.xhr.status===401){l.propertyDidChange("account");h.setDefaultContext("gliffyDrivePlugin");if(window.mixpanel){window.mixpanel.people.set({"Google Drive Linked":false})}}}).then(function(){GLIFFY.PLUGINS.pluginManager.updateUIForCurrentDocumentContext()});l.__setHandlerForUserIcon();l.__updateAccountTypeClass();if(window.mixpanel&&typeof window.mixpanel.identify==="function"&&window.mixpanel.people&&typeof window.mixpanel.people.set==="function"){try{window.mixpanel.identify(GliffyApp.authController.user.uid);window.mixpanel.people.set({lastAuthAccountUsers:GliffyApp.authController.getAccountUserCount(),lastAuthAccountDiagrams:GliffyApp.authController.getAccountDiagrams(),lastAuthLoginDate:new Date(),"$email":GliffyApp.authController.getUsername()})}catch(s){console.log(s)}}if(window.qualaroo){try{window.qualaroo.push(["set",{account_users:GliffyApp.authController.getAccountUserCount().toString(),account_diagrams:GliffyApp.authController.getAccountDiagrams().toString(),last_login_date:(new Date()).toString()}])}catch(s){console.log(s)}}GLIFFY.onlineUtils.setLocation(GLIFFY.API.reauthUrl(window.location.href));for(n=0;n<l.__callbacks.length;n++){l.__callbacks[n]()}g=(new Date()).getTime();if(GLIFFY.editor&&GliffyApp.imageBrowserController&&GliffyApp.imageBrowserController.isOpen&&GliffyApp.imageBrowserController.isOpen()){GliffyApp.imageBrowserController.loadImages("")}l.updatePremiumLibraries();l.authLibraryCreate();if(p){p()}},function(){l.setAccountId(null)});if(GLIFFY.editor&&GLIFFY.editor.draftsEnabled){GLIFFY.editor.getDocumentManager().setDraftsEnabled(true)}this.toggleProperty("propMajorStatusChange")},logout:function(){$("html").addClass("gliffy-anonymous");this.set("user",GliffyApp.UserModel.create());g=(new Date()).getTime();if(GLIFFY.editor){GLIFFY.editor.getDocumentManager().setDraftsEnabled(false)}this.toggleProperty("propMajorStatusChange")},requireEmailVerification:function(k,l){if(this.isConfirmed()){k()}else{GliffyApp.verifyEmailController.show(k,l)}},requireAuth:function(k,l){if(this.isAuthenticated()){k()}else{if(GLIFFY.ENV.welcomeController==="loginWelcomeController"){setTimeout(function(){GliffyApp.loginWelcomeController.show(k)},100)}else{setTimeout(function(){GliffyApp.loginSignupController.show(k,l)},100)}}},redirectToLogin:function(k,l){GliffyApp.loginSignupController.show(k,l)},documentManagerUrl:Ember.computed(function(){return(this.__formatURL(this.get("DOCMAN_URL")))}).property(),openSignup:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"adminNav",label:"signup"});window.open(this.get("SIGNUP_URL"),"gliffySignup")},noAccount:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"no_account_error",label:window.location.pathname});window.location=this.get("URL_NOACCOUNT")},getParameterByName:function(l){l=l.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var k="[\\?&]"+l+"=([^&#]*)";var n=new RegExp(k);var m=n.exec(window.location.href);if(m==null){return""}else{return decodeURIComponent(m[1].replace(/\+/g," "))}},refreshAccountSettings:function(m,l){var k=this;this.account.fetch(function(n){k.__handleAccountLoaded(n);if(m){m()}k.expirationTest()},function(n){console.log("Error "+n.status);if(l){l()}});this.fetchUser();this.toggleProperty("propMajorStatusChange")},anonManageLibrarySignon:function(){$("#manageLibrary").modal("hide");GliffyApp.loginSignupController.show()},daysLeftText:Ember.computed(function(){var l=this.daysLeftUntilTrialExpiration();var k;if(l===1){k=$.i18n._("BANNER_AD_TRIAL_TAGLINE_DAY")}else{k=$.i18n._("BANNER_AD_TRIAL_TAGLINE_DAYS")}return $.i18n._("MENU_TRIAL_TAGLINE",[l,k])}).property("daysLeft"),expirationTest:function(){if(this.getAccountIsExpired()){if(window.optimizely&&GliffyApp.accountExpireBusinessTeamDealController&&((window.optimizely.GHAX&&window.optimizely.GHAX.BusinessTeamDeal&&window.optimizely.GHAX.BusinessTeamDeal.promoHash&&window.optimizely.GHAX.BusinessTeamDeal.promoHash.length>1)||(typeof window.optimizely.variationMap!=="undefined"&&(4678360619 in window.optimizely.variationMap)&&window.optimizely.variationMap[4678360619]===1))){if($(".account-expiration-business-team-deal-template-survey").css("display")==="none"){GliffyApp.accountExpireBusinessTeamDealController.show()}}else{if(window.optimizely&&GliffyApp.accountExpireSimplifiedPricingPagesController&&((window.optimizely.GHAX&&window.optimizely.GHAX.SimplifiedPricingPages&&window.optimizely.GHAX.SimplifiedPricingPages.showSimplifiedPricingPages)||(typeof window.optimizely.variationMap!=="undefined"&&(5210331048 in window.optimizely.variationMap)&&window.optimizely.variationMap[5210331048]===1))){if($(".account-expiration-simplified-pricing-pages-template-survey").css("display")==="none"){GliffyApp.accountExpireSimplifiedPricingPagesController.load()}}else{GliffyApp.expirationNoticeController.show()}}$("#gliffy-modal-welcome-screen").modal("hide")}else{if(GliffyApp.accountExpireBusinessTeamDealController){GliffyApp.accountExpireBusinessTeamDealController.hide()}GliffyApp.expirationNoticeController.hide()}},propMajorStatusChange:false,isAuthenticated:function(){return this.get("user").get("isAuthenticated")},getUserPreferences:function(){return this.get("user").getUserPreferences()},setUserPreference:function(k,l){this.get("user").setPreference(k,l)},getUsername:function(){return this.get("user").get("username")},getUserID:function(){return this.get("user").get("uid")},getOauthUserId:function(){return this.get("user").get("oauthUserId")},populateUserData:function(k){this.get("user").populate(k)},loadUserPreferences:function(){return this.get("user").loadPreferences()},getMunchkinKey:function(){return this.get("user").get("munchkinKey")},isConfirmed:function(){return this.get("user").get("isConfirmed")},setIsConfirmed:function(k){this.get("user").set("isConfirmed",k)},getUserToken:function(){return this.get("user").get("token")},fetchUser:function(l,k){this.get("user").fetch(l,k);this.toggleProperty("propMajorStatusChange")},getSwitchableAccounts:function(){return this.get("user").get("accountUsers")},getCurrentUserAccount:function(){return this.get("user").get("currentAccount")},driveContext:null,defaultContext:null,propUsername:Ember.computed(function(){return this.getUsername()}).property("user"),propUserID:Ember.computed(function(){return this.getUserID()}).property("user"),propIsConfirmed:Ember.computed(function(){return this.isConfirmed()}).property("user"),propHasMultipleAccounts:Ember.computed(function(){return this.getSwitchableAccounts().length>1}).property("user"),propShareButton:Ember.computed(function(){return h.isCurrentDocumentContext("gliffyDrivePlugin")}).property("driveContext"),propShowGDriveCheckbox:Ember.computed(function(){return GLIFFY.PLUGINS.pluginManager.getDefaultContext()==="googleDrivePlugin"}).property("defaultContext"),setAccountId:function(n,m){var l,k=this;if(k.getAccountId()!==n){k.__removeAccountTypeClass();l=GliffyApp.AccountModel.create();if(n!==null){l.set("id",n);l.fetch(function(o){k.expirationTest();k.__handleAccountLoaded(o);if(m){m()}},function(o){console.log("Error "+o.status)})}GliffyApp.expirationNoticeController.show()}},accountIsLoaded:function(k){this.propertyWillChange("account");this.set("account",k);this.propertyDidChange("account");$(window).trigger("gliffy.authController.accountLoadedEvent")},__handleAccountLoaded:function(k){this.accountIsLoaded(k);this.authLibraryCreate();this.updatePremiumLibraries();this.__updateAccountTypeClass();this.toggleProperty("propMajorStatusChange")},__setHandlerForUserIcon:function(){if(this.account){this.account.addObserver("googleDriveUserIcon",function(){if(GliffyApp.authController.getGoogleDriveUserIcon()){$(".gliffy-profile-icon").css({"background-size":"20px 20px","background-position":"right","background-image":"url("+GliffyApp.authController.getGoogleDriveUserIcon()+")"})}})}},getAccountId:function(){return this.get("account").get("id")},fetchAccount:function(l,k){this.get("account").fetch(l,k);this.toggleProperty("propMajorStatusChange")},hasAccount:function(){return(this.get("account"))?true:false},getTrialAccountIsExpired:function(){return this.daysLeftUntilTrialExpiration()==0},getAccountIsExpired:function(){return GliffyApp.authController.getTrialAccountIsExpired()||GliffyApp.authController.isPaidAccountWithNoSubscription()},isPaidAccountWithNoSubscription:function(){return this.get("account").get("billingPrice")!==0&&this.get("billingStatus").get("status")==="unpaid"&&this.get("account").get("aslId")===this.get("billingStatus").get("validForAslId")},daysLeftUntilTrialExpiration:function(){return this.get("account").get("daysLeftUntilTrialExpiration")},getAccountCreateDate:function(){return this.get("account").get("createdDate")},canAccountAddUser:function(){return this.get("account").can_add_user()},canAccountAddDiagram:function(){return this.get("account").can_add_diagram()},canAccountAddImage:function(){return this.get("account").can_add_image()},canAccountCollaborate:function(){return this.get("account").can_collaborate()},canAccountCreatePrivateDiagrams:function(){return this.get("account").can_create_private_diagrams()},canAccountImportVisioDiagrams:function(){return this.get("account").can_import_visio_diagrams()},canAccountUseGoogleDrive:function(){return this.get("account").can_use_google_drive()},canAccountViewComment:function(){return this.get("account").can_view_comment()},canAccountUseComment:function(){return this.get("account").can_use_comment()},canAccountUseShare:function(){return this.get("account").can_use_share()},canAccountUseShareEdit:function(){return this.get("account").can_use_share_edit()},canAccountViewShare:function(){return this.get("account").can_view_share()},canAccountUsePremiumShapes:function(){return this.get("account").can_use_premium_shapes()},canAccountCreateCustomLibraries:function(){return this.get("account").can_create_custom_libraries()},getGoogleDriveUserIcon:function(){return this.get("account").get("googleDriveUserIcon")},unlinkGoogleDriveFromAccount:function(){this.get("account").set("googleDriveUserName",null);this.get("account").set("googleDriveUserEmail",null);this.get("account").set("googleDriveUserIcon",null)},getAccountName:function(){return this.get("account").get("name")},getAccountUserCount:function(){return this.get("account").get("userCount")},getAccountDiagrams:function(){return this.get("account").get("diagramCount")},increaseAccountDiagramCount:function(){this.get("account").set("diagramCount",this.getAccountDiagrams()+1)},decreaseAccountDiagramCount:function(){this.get("account").set("diagramCount",this.getAccountDiagrams()-1)},getAccountDiagramsLeft:function(){return this.get("account").get("diagramsLeft")},accountHasUnlimitedDiagrams:function(){return this.get("account").has_unlimited_access_to_diagrams()},accountHasUnlimitedImageStorageSpace:function(){return this.get("account").has_unlimited_access_to_image_storage_space()},propAccountID:Ember.computed(function(){return this.getAccountId()}).property("account"),propGoogleDriveUserIcon:Ember.computed(function(){return this.getGoogleDriveUserIcon()}).property("account"),propIsAccountAdmin:Ember.computed(function(){return this.get("account").get("userRole")==="ADMIN"}).property("account"),propAccountName:Ember.computed(function(){return this.getAccountName()}).property("account"),propAccountDisplayName:Ember.computed(function(){return this.get("account").get("displayName")}).property("account"),propAccountDaysLeftUntilTrialExpiration:Ember.computed(function(){return this.daysLeftUntilTrialExpiration()}).property("account"),propAccountDiagramsCount:Ember.computed(function(){return this.getAccountDiagrams()}).property("account"),propGoogleDriveUserName:Ember.computed(function(){return this.get("account").get("googleDriveUserName")}).property("account"),propGoogleDriveUserEmail:Ember.computed(function(){return this.get("account").get("googleDriveUserEmail")}).property("account"),propAccountAppsDomain:Ember.computed(function(){return this.get("account").get("appsDomain")}).property("account"),propAccountAPIKey:Ember.computed(function(){return this.get("account").get("apiKey")}).property("account"),propAccountAPISecret:Ember.computed(function(){return this.get("account").get("apiSecret")}).property("account"),propPaidSubscriptionStatus:Ember.computed(function(){return this.get("billingStatus").get("status")}).property("account"),propIsActiveSubscription:Ember.computed(function(){return this.get("billingStatus").get("status")==="active"}).property("account"),propIsBenSubscription:Ember.computed(function(){return this.get("billingStatus").get("source")==="ben"}).property("account"),propPeriodEndDate:Ember.computed(function(){var k=this.get("billingStatus").get("periodEnd");if(k==null||k==0){return""}var l=moment(k,"X");return l.format("MM/DD/YYYY")}).property("account"),__setAccountProductType:function(k){this.get("account").set("productType",k)},__getAccountProductID:function(){return this.get("account").get("productId")},__getAccountMaxUsers:function(){return this.get("account").get_max_users()},__handleFreemiumUpgradeClick:function(l,k){$("#manageLibrary").modal("hide");GliffyApp.accountUpgradePurchaseController.show()},__handlePremiumUpgradeClick:function(m,l){var k=$(m.currentTarget).data("uid");m.preventDefault();if(this.isAnonymousAccount()){l=l+"SignInClick";$("#manageLibrary").modal("hide");GliffyApp.loginSignupController.show()}else{l=l+"UpgradeToProClick";this.openPurchasePro("premiumLibraries")}GLIFFY.analyticsUtils.logMixpanelEvent("account",{action:l,label:k});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:l,label:k})},__removeAccountTypeClass:function(){$("html").removeClass("gliffy-"+this.getProductType())},__updateAccountTypeClass:function(){$("html").addClass("gliffy-"+this.getProductType())},__isStandardAccount:function(){return this.getProductType()===this.ACCOUNT_TYPE_STANDARD},__formatURL:function(l){var m={ACCOUNTID:this.getAccountId(),USEREMAIL:encodeURIComponent(this.getUsername()),ACCOUNTTYPE:this.__isAccountAcademic()?"ACADEMIC":this.ACCOUNT_TYPE_PREMIUM,SERVICELEVEL:this.__isStandardAccount()?this.ACCOUNT_TYPE_STANDARD:this.ACCOUNT_TYPE_PREMIUM,TYPE_PREMIUM:this.ACCOUNT_TYPE_PREMIUM,TYPE_STANDARD:this.ACCOUNT_TYPE_STANDARD};for(var k in m){l=l.replace(k,m[k])}return l},__isAccountAcademic:function(){return this.get("account").get("isAcademic")},getProductType:function(){return this.get("account").get("productType")},getAccountMaxUsers:function(){return this.get("account").get_max_users()},isPremiumAccount:function(){return this.get("account").get("productType")===this.ACCOUNT_TYPE_PREMIUM},isEnterpriseAccount:function(){return this.get("account").get("productType")===this.ACCOUNT_TYPE_ENTERPRISE},isFreeAccount:function(){return this.get("account").get("productType")===this.ACCOUNT_TYPE_BASIC},updatePremiumLibraries:function(){var v=this,u,k,n,q,w,t,o,s,m;if(GLIFFY.FEATURES.premiumLibraries){$("#gliffy-symbol-library .gliffy-shape-library-panel-premium-ui-blocker").each(function(){$(this).remove()});$("#gliffy-symbol-library .gliffy-shape-library-panel-premium-alert").each(function(){$(this).remove()});$("#gliffyLibraryPreview .gliffy-library-preview-upgrade").each(function(){$(this).remove()});$("#manageLibrary .gliffy-library-list-container input").each(function(){$(this).attr("disabled",false)});GLIFFY.FEATURES.showPremiumShapesLocked=!(this.canAccountUsePremiumShapes()||this.isAnonymousAccount());var l=["com.gliffy.libraries.uml.uml_v2","com.gliffy.libraries.ui.ui_v3"];for(o=0;o<l.length&&GLIFFY.FEATURES.showPremiumShapesLocked;o++){u=l[o];s=$.i18n._("online.premium.libraries.to.business.users");m=$.i18n._("online.premium.libraries.upgrade.link");if(v.isTrialAccount()){m=$.i18n._("online.premium.library.trial.users")}else{if(this.isAnonymousAccount()){m=$.i18n._("online.premium.libraries.signin.link")}}var p=(v.isTrialAccount())?"<div class='gliffy-shape-library-panel-premium-alert alert alert-block'><div><div><a href='http://support.gliffy.com/entries/28625864-Premium-Shapes-' target='_blank'>These shapes are <b>Pro</b></a></div><div><a href='http://support.gliffy.com/entries/28625864-Premium-Shapes-' target='_blank'>only. Click here for</a></div><div><a href='http://support.gliffy.com/entries/28625864-Premium-Shapes-' target='_blank'>more info</a></div></div></div>":"<div class='gliffy-shape-library-panel-premium-alert alert alert-block'><div class='gliffy-premium-libraries-upgrade-alert-message'><div>"+$.i18n._("online.premium.libraries.panel.msg.line1")+"</div><div>"+$.i18n._("online.premium.libraries.panel.msg.line2")+"</div><div>"+s+"</div></div><div class='gliffy-premium-libraries-upgrade-link'><a data-uid='"+u+"' href='#'>"+m+"</a></div></div>";$("#gliffy-symbol-library .gliffy-accordion-group[data-uid^='"+u+"']").each(function(){k=$(this);n=$("<div class='gliffy-shape-library-panel-premium-ui-blocker'></div>");t=$(p);q=k.find(".gliffy-accordion-inner");n.height(q.height());n.width(q.width()+50);q.prepend(t);if(!v.isTrialAccount()){t.find("a").on("click",function(x){v.__handlePremiumUpgradeClick(x,"shapePanelPremiumLibrary")})}n.css("left","0px");n.css("display","block");n.css("visibility","visible");if(!v.isAnonymousAccount()&&!v.isTrialAccount()){q.parent().append(n);n.mousedown(function(x){x.preventDefault();return false});q.find(".gliffy-shape-library-panel-premium-alert").removeClass("alert-block").addClass("alert-error");n.css("top",(k.find(".gliffy-shape-library-panel-premium-alert").height()+40)+"px")}});w=$("<div class='gliffy-library-preview-upgrade alert alert-block'><div class='gliffy-premium-libraries-upgrade-alert-message'><span>"+$.i18n._("online.premium.libraries.panel.msg.line1")+" "+$.i18n._("online.premium.libraries.panel.msg.line2")+" "+s+"</span><span class='gliffy-premium-libraries-upgrade-link'><br/><a data-uid='"+u+"' href='#'>"+m+"</a><span></div></div>");if(!v.isPaidAccount()){w.find("a").on("click",function(x){v.__handleFreemiumUpgradeClick(x,"manageLibraryPremiumLibrary")})}var r=$("#gliffyLibraryPreview h4[data-uid^='"+u+"']");if(r.size()>0){var o=0;for(;o<r.size();o++){if($(r[o]).has(".gliffy-shape-library-panel-premium-alert").size()<1&&$(r[o]).has(".gliffy-library-preview-upgrade").size()<1){r.append(w)}}}if(!v.isAnonymousAccount()){$("#manageLibrary .gliffy-library-list-container input[value^='"+u+"']").attr("disabled",true)}}}},authLibraryCreate:function(){$(".gliffy-add-library-container #library_auth").remove();if(this.isAnonymousAccount()){$(".gliffy-add-library-container a.btn").hide();$(".gliffy-add-library-container").prepend('<div id="library_auth">'+$.i18n._("online.custom.shape.library.sell")+' <a href="#" onclick="GliffyApp.authController.anonManageLibrarySignon()">'+$.i18n._("online.custom.shape.library.login")+"</a></div>")}else{if(!this.canAccountCreateCustomLibraries()){$(".gliffy-add-library-container a.btn").hide();$(".gliffy-add-library-container").prepend('<div id="library_auth">'+$.i18n._("online.custom.shape.library.sell")+' <a href="#" onclick="GliffyApp.authController.openUpgrade(\'customLibrary\')">'+$.i18n._("online.custom.shape.library.upgrade")+"</a></div>")}else{$(".gliffy-add-library-container a.btn").show()}}return false},openUpgrade:function(k){window.open(this.get("__upgradeUrl"),this.get("PURCHASE_BROWSER_TAB_NAME"));if(k){GLIFFY.Utils.analyticsEvent("trackEvent",{category:k,action:"upgrade"})}else{GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"adminNav",label:"upgrade"})}},requireAccountPermission:function(k,l,n,m){if(l()){n()}else{this.showUpgradeDialog(k,n,m)}},isPaidAccount:function(){return(this.isPremiumAccount()||this.__isStandardAccount()||this.isEnterpriseAccount())},showUpgradeDialog:function(k,n,m){var l=this;GLIFFY.Dialog.showYesNoDialog({title:$.i18n._("online.upgrade.title"),content:c[k]||f,cancelCallback:null,buttons:[{text:$.i18n._("online.modal.cancel"),callback:m,primary:false,dismiss:true},{text:$.i18n._("online.modal.upgrade"),callback:function(){l.openUpgrade(k)},primary:true,dismiss:true}]})},isTrialAccount:function(){return this.get("account").get("isTrial")},isAnonymousAccount:function(){return(this.getProductType()==null||this.getProductType()=="unauthorized")},__upgradeUrl:Ember.computed(function(){return(this.__formatURL(this.get("UPGRADE_URL")))}).property(),isLoggedIn:Ember.computed(function(){return(!this.isAnonymousAccount()&&this.getParameterByName("app")!="d8e91192-2f34-471c-80a6-900880844ffd")}).property(),propAccountIsUpgradeVisible:Ember.computed(function(){return this.get("account").get("isUpgradeVisible")}).property("account"),propProductDescription:Ember.computed(function(){return this.get("account").get("productDescription")}).property("account"),propProductType:Ember.computed(function(){return this.getProductType()}).property("account"),propAccountHasDiagramsLeft:Ember.computed(function(){return this.canAccountAddDiagram()}).property("account"),propAccountDiagramsLeft:Ember.computed(function(){return this.getAccountDiagramsLeft()}).property("account"),propIsLowOnDiagrams:Ember.computed(function(){return this.get("account").get("isLowOnDiagrams")}).property("account"),propAccountMaxDiagrams:Ember.computed(function(){return this.get("account").get_max_diagrams()}).property("account"),propAccountMaxStorageSpace:Ember.computed(function(){return this.get("account").get("storageMax")}).property("account"),propAccountStorageUsed:Ember.computed(function(){return this.get("account").get("storageUsed")}).property("account"),propAccountHasUnlimitedDiagrams:Ember.computed(function(){return this.accountHasUnlimitedDiagrams()}).property("account"),propAccountHasUnlimitedImageStorageSpace:Ember.computed(function(){return this.accountHasUnlimitedImageStorageSpace()}).property("account"),propIsFreeAccount:Ember.computed(function(){return !this.isPaidAccount()&&!this.isTrialAccount()}).property("account"),propIsPaidAccount:Ember.computed(function(){return this.isPaidAccount()}).property("account"),propIsTrialAccount:Ember.computed(function(){return this.isTrialAccount()}).property("account"),propIsAnonymousAccount:Ember.computed(function(){return this.isAnonymousAccount()}).property("account"),messageDiagramsLeftFreeAd:Ember.computed(function(){return $.i18n._("online.save.free.banner.part1",[this.getAccountDiagramsLeft(),this.get("account").get_max_diagrams()])}).property("account"),messageDiagramsLeft:Ember.computed(function(){return $.i18n._("online.save.diagram.limit.notice",[this.get("account").get_max_diagrams(),this.getProductType()])}).property("account"),messageMaxUsers:Ember.computed(function(){return $.i18n._("online.account.management.add.users.warning.part1",[this.get("account").get_max_users()])}).property("account"),messageStorageLeftUpgrade:Ember.computed(function(){return $.i18n._("online.image.browser.upgrade",[this.get("account").get("storageLeft")])}).property("account"),messageBannerDiagramsLeft:Ember.computed(function(){return $.i18n._("BANNER_AD_STD_TAGLINE",[this.getAccountDiagramsLeft(),this.get("account").get_max_diagrams()])}).property("account"),messageGDriveCurrentPlan:Ember.computed(function(){return $.i18n._("gdrive.upgrade.multiuser.current.plan",[this.getAccountMaxUsers(),$.i18n._(this.get("account").get("productTypeI18nMap")[this.getProductType()])])}).property("account"),isTrialOrFreeAccount:Ember.computed(function(){return(this.isTrialAccount()||this.isFreeAccount())}).property("account"),propDoNotShowUpgradeButton:Ember.computed(function(){if(window.optimizely&&window.optimizely.GHAX){if(window.optimizely.GHAX.BusinessTeamDeal){return true}if(window.optimizely.GHAX.SimplifiedPricingPages){return true}if(window.optimizely.GHAX.DetailedPurchase&&!window.optimizely.GHAX.DetailedPurchase.showUpgradeModal){return true}}return false}).property("doNotShowUpgradeButton")});GliffyApp.authController=GliffyApp.AuthController.create()}());(function(){GliffyApp.OnlineToolbarController=GliffyApp.ToolbarController.extend({actions:{menuNew:function(){GLIFFY.PLUGINS.pluginManager.getCurrentDocumentPlugin().menuNew(this)},menuRename:function(){$("#gliffy-rename-document-modal .gliffy-input-modal-error").hide();$("#gliffy-rename-document-modal .modal").modal("show");$("#gliffy-rename-document-modal input").val(GliffyApp.documentModel.title);$("#gliffy-rename-document-modal input").select()},menuOpen:function(){GLIFFY.PLUGINS.pluginManager.getCurrentDocumentPlugin().menuOpen(this)},openFromGliffyDrive:function(){this.doOpen()},openFromGoogleDrive:function(){return GliffyApp.authController.checkGoogleDriveEligibility(function(){this.doOpenGoogleDrive();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"openFromGDrive"})})()},saveAsGliffyDrive:function(){var c=GLIFFY.PLUGINS.pluginManager;c.setDialogContext("gliffyDrivePlugin");$("#gliffy-save-modal").find("h4").text($.i18n._("online.save.modal.title"));GliffyApp.saveDialogController.show();$("#gliffy-save-modal").on("hide.bs.modal",c.handleDialogClose);GliffyApp.saveDialogController.mode=GliffyApp.saveDialogController.DIALOG_MODE_SAVE_AS},saveAsGoogleDrive:function(){GliffyApp.googleDriveController.handleInstallAndAuth(function(){var c=GLIFFY.PLUGINS.pluginManager;c.setDialogContext("googleDrivePlugin");$("#gliffy-save-modal").find("h4").text($.i18n._("online.save.modal.title.gdrive"));GliffyApp.saveDialogController.show();$("#gliffy-save-modal").on("hide.bs.modal",c.handleDialogClose);GliffyApp.saveDialogController.mode=GliffyApp.saveDialogController.DIALOG_MODE_SAVE_AS;GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"saveAsGDrive"})})}},doNew:window.GLIFFY.onlineUtils.requireAccountPermission("diagramCount",function(){return GliffyApp.authController.canAccountAddDiagram()},function(){this._super();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"new"})}),doOpen:window.GLIFFY.onlineUtils.requireAuth(function(){if(this.__editor.diagramManager&&this.__editor.diagramManager.selectDiagram){this.__editor.diagramManager.selectDiagram("gliffyDrivePlugin")}}),doOpenGoogleDrive:window.GLIFFY.onlineUtils.requireAuth(function(){GliffyApp.googleDriveController.handleInstallAndAuth(GLIFFY.PLUGINS.storage.googleDrivePlugin.loadPicker)}),doSave:window.GLIFFY.onlineUtils.requireAuth(function(){this._super()}),doSaveAndClose:window.GLIFFY.onlineUtils.requireAuth(function(){this._super()}),doClose:function(){this._super()},doExportSvg:window.GLIFFY.onlineUtils.requireAuth(function(){this._super()}),doExportImage:window.GLIFFY.onlineUtils.requireAuth(function(e,d,c){this._super(e,d,c)}),doExportData:window.GLIFFY.onlineUtils.requireAuth(function(d,c){this._super(d,c)}),doCollaborate:GLIFFY.onlineUtils.requireAccountPermission("collaboration",function(){return GliffyApp.authController.canAccountCollaborate},GLIFFY.onlineUtils.requireEmailVerification(function(){var c=GliffyApp.collaborationController;if(this.__editor.getDocumentManager().getActiveStage().hasUnsavedChanges()||this.__editor.getDocumentManager().getActiveDocument().isNewNotDirty()){this.__editor.postSaveCallback=function(d){c.show()};this.doSave()}else{c.show()}})),doPublish:window.GLIFFY.onlineUtils.requireAuth(function(){if(this.__editor.getDocumentManager().getActiveStage().hasUnsavedChanges()||this.__editor.getDocumentManager().getActiveDocument().isNewNotDirty()){this.__editor.postSaveCallback=function(c){GliffyApp.publishController.show()};this.doSave()}else{GliffyApp.publishController.show()}}),__generateSvg:function(c){this.__editor.getDocumentManager().getSvgData(this.__editor.getDocumentManager().getActiveStage(),function(e){GliffyApp.progressBarController.getBar().delay(500).queue(function(f){GliffyApp.progressBarController.hide();f()});var d=e.getSerializedSvg(true);if(c){c(d)}},true)}});GliffyApp.toolbarController=GliffyApp.OnlineToolbarController.create()}());(function(){GliffyApp.OnlineSaveDialogController=GliffyApp.SaveDialogController.extend({DEFAULT_FOLDERS:null,DIALOG_MODE_SAVE:"save",DIALOG_MODE_SAVE_AS:"saveAs",documentList:null,selectedDocument:null,actions:{handleCancel:function(){this.cancelSave()},handleSave:function(){this.applySave()},handleDocumentSelect:function(c){this.selectedDocument=c;this.getModal().find(".gliffy-save-dialog-document-list-item").removeClass("gliffy-selected").find(".gliffy-document-list-item-delete").hide();this.getSelectedDocumentDOM().addClass("gliffy-selected").find(".gliffy-document-list-item-delete").show()},handleDocumentDelete:function(){var c=this;if(this.selectedDocument!==null){GLIFFY.PLUGINS.pluginManager.lockDialogContext();this.hide();GliffyApp.documentListController.doDocumentDelete(this.selectedDocument,function(){c.__removeDocumentItemDOMElement();GLIFFY.Spinner.hide({context:"deleteDiagram"})},function(d){GLIFFY.Spinner.hide({context:"deleteDiagram"});c.__displayErrorMessage(d)},function(){GLIFFY.PLUGINS.pluginManager.unlockDialogContext();c.show(true)})}},handleAddFolder:function(){var c=this;GLIFFY.PLUGINS.pluginManager.lockDialogContext();this.hide();GliffyApp.accountFoldersController.showCreateFolderModal();$("#gliffy-folder-create-modal .gliffy-modal").on("hide",function(d){$("#gliffy-folder-create-modal .gliffy-modal").off("hide");GLIFFY.PLUGINS.pluginManager.unlockDialogContext();c.show(true)})},upgrade:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"saveDialog",action:"clickUpgrade"});GliffyApp.authController.openUpgrade("saveDialog")}},getModal:function(){return $("#gliffy-save-modal")},init:function(){this.documentList=Ember.A([])},show:function(d){var c=this,e=this.getFilenameElement().val();if(!d===true){this.refresh()}GliffyApp.authController.fetchAccount(function(){},function(){c.hide();throw new Error("Unable to update account settings for showing save dialog.")});c._super();if(d){this.getFilenameElement().val(e)}else{this.getFilenameElement().blur()}},reset:function(){this.mode=this.DIALOG_MODE_SAVE;this.selectedDocument=null;this.documentList.clear();GliffyApp.accountFoldersController.defaultFolders=this.DEFAULT_FOLDERS},refresh:function(){var c=this;this.reset();this.showUIBlocker();GliffyApp.accountFoldersController.loadFolderTree(c.getModal().find(".gliffy-account-folders-container")).then(function(d){return GliffyApp.accountFoldersController.constructFolderStucture(d)}).then(function(d){GliffyApp.accountFoldersController.showFolderContainer();if(GliffyApp.documentModel.folderId!==null&&c.getModal().find(".gliffy-account-folders-container").find("#"+GliffyApp.documentModel.folderId).length>0){GliffyApp.accountFoldersController.selectFolder("#"+GliffyApp.documentModel.folderId)}else{GliffyApp.accountFoldersController.selectFolder("#"+d)}setTimeout(function(){GliffyApp.accountFoldersController.positionSelectionBar()},100)})},applySave:function(){this.__hideErrorMessage();if(this.__validate(this.getModal().find(".gliffy-save-filename").val())){GliffyApp.documentModel.set("folderId",Number(GliffyApp.accountFoldersController.getSelectedFolderId()));if(this.mode===this.DIALOG_MODE_SAVE_AS){this.doSaveAs()}else{this._super()}}},cancelSave:function(){this.__hideErrorMessage();this._super()},doSaveAs:function(){var f=this,g=GLIFFY.editor.getDocumentManager(),d,e,c=g.getActiveDocument(),h=c.getCurrentRevision();c.setCurrentRevision(0);d=function(j){if(j.error){c.setCurrentRevision(h);GliffyApp.documentModel.update(c);GLIFFY.PLUGINS.pluginManager.popContext()}};e=function(l,j,k){c.setCurrentRevision(h);GliffyApp.documentModel.update(c);GLIFFY.PLUGINS.pluginManager.popContext()};GLIFFY.PLUGINS.pluginManager.pushContext();GLIFFY.PLUGINS.pluginManager.setCurrentDocumentContext(GLIFFY.PLUGINS.pluginManager.getDialogContext());GLIFFY.PLUGINS.pluginManager.updateUIForCurrentDocumentContext();GLIFFY.editor.__doSave(d,e)},handleFolderClick:function(c){GLIFFY.PLUGINS.pluginManager.getDialogPlugin().handleSelectSaveFolderHook(c)},getSelectedDocumentDOM:function(){return this.getModal().find(".gliffy-save-dialog-document-list-item[data-gliffy-id='"+this.selectedDocument.id+"']")},showUIBlocker:function(){this.getModal().find(".gliffy-modal-ui-blocker").show()},hideUIBlocker:function(){this.getModal().find(".gliffy-modal-ui-blocker").hide()},showErrorMessage:function(c){this.__displayErrorMessage(c)},loadDocuments:function(f,e){var c=this,d,g;this.showUIBlocker();window.GLIFFY.API.GET(f,{query:e,success:function(j,k,h){c.documentList.clear();for(d=0;d<j.diagrams.length;d++){g=Ember.Object.create();g.setProperties(j.diagrams[d]);c.documentList.pushObject(g)}c.hideUIBlocker();setTimeout(function(){c.getModal().find(".gliffy-save-dialog-document-list-item-title").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);c.getModal().find(".gliffy-document-list-item-delete").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);c.getFilenameElement().focus()},1)},error:function(k,h,j){console.error("error loading document list",k,h,j);c.hideUIBlocker()},context:this})},__removeDocumentItemDOMElement:function(){GLIFFY.Dialog.hide();this.show(true);if(this.selectedDocument!==null){this.getSelectedDocumentDOM().remove()}},__validate:function(c){if(c.split(" ").join("")===""){this.__displayErrorMessage("Filename is required");return false}else{if(c.indexOf('"')>-1||c.indexOf("\\")>-1||c.indexOf("/")>-1||c.indexOf("<")>-1){this.__displayErrorMessage('Invalid characters:  " \\ / <');return false}}return true},__displayErrorMessage:function(c){this.getModal().find(".gliffy-save-dialog-error p").html(c);this.getModal().find(".gliffy-save-dialog-error").show();GliffyApp.accountFoldersController.positionSelectionBar()},__hideErrorMessage:function(){this.getModal().find(".gliffy-save-dialog-error").hide();GliffyApp.accountFoldersController.positionSelectionBar()},__showPremiumShapeWarning:function(){this.getModal().find(".gliffy-save-dialog-premium-shapes").show();this.getModal().find(".gliffy-save-dialog-fields").hide();this.getModal().find(".gliffy-save-dialog-button").attr("disabled",true);GliffyApp.accountFoldersController.positionSelectionBar()},__hidePremiumShapeWarning:function(){this.getModal().find(".gliffy-save-dialog-premium-shapes").hide();this.getModal().find(".gliffy-save-dialog-fields").show();this.getModal().find(".gliffy-save-dialog-button").attr("disabled",false);GliffyApp.accountFoldersController.positionSelectionBar()}});GliffyApp.saveDialogController=GliffyApp.OnlineSaveDialogController.create()}());(function(){GliffyApp.ShareModalController=Ember.Controller.extend(GliffyApp.require("ember-sharing/mixins/share-actions"),{shareModalVisible:false,shareModel:null,diagramId:null,isPublic:false,canAccountUseShare:true,canAccountUseShareEdit:false,sharingSupported:true,accountId:null,store:Ember.inject.service(),features:Ember.inject.service(),eventHub:Ember.inject.service(),actions:{handleDocumentShare:function(c){this.set("canAccountUseShare",this.features.get("sharingSupported")&&this.features.get("sharingPermitted"));this.set("canAccountUseShareEdit",this.features.get("sharingSupported")&&this.features.get("sharingEditPermitted"));this.set("shareModel",this.store.queryRecord("share",{diagramId:c.id}));this.set("shareModalVisible",true);this.set("diagramId",c.id);this.set("isPublic",c.isPublic);this.set("accountId",GliffyApp.authController.getAccountId());GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"shareClick",label:window.location.pathname})}}});GliffyApp.instanceInitializer({name:"initializeSharing",after:"registerGlobalInstancesGop",initialize:function(c){c.registry.register("controller:share-modal",GliffyApp.ShareModalController,{singleton:true});c.registry.register("services:shareModalController",c.container.lookup("controller:share-modal"),{instantiate:false,singleton:true});c.registry.injection("controller","shareModalController","services:shareModalController")}})}());(function(){GliffyApp.AbstractFileDialogController=Ember.Controller.extend({DEFAULT_FOLDERS:null,containerSelector:null,INITIAL_IMAGE_LOAD_LIMIT:5,__sortKeys:["lastEdited","alphabetical","reverseAlphabetical","createDate"],createNewTab:true,init:function(c){this._super();this.containerSelector=c},configDocumentList:function(){GliffyApp.documentListController.clear();GliffyApp.documentListController.setContainer($(this.containerSelector+" .gliffy-document-list-container"));GliffyApp.documentListController.setListLayout(true)},configDocumentSearch:function(){GliffyApp.documentSearchController.clear()},configDocumentSort:function(){GliffyApp.documentSortController.populateDropdown(this.__sortKeys)},configAccountFolders:function(){GliffyApp.accountFoldersController.defaultFolders=this.DEFAULT_FOLDERS;var c=this;GliffyApp.accountFoldersController.loadFolderTree($(this.containerSelector+" .gliffy-account-folders-container")).then(function(d){return GliffyApp.accountFoldersController.constructFolderStucture(d)}).then(function(d){GliffyApp.accountFoldersController.showFolderContainer();$(c.containerSelector+" .gliffy-common-folder.recent").click()})},open:function(g){var d=this,e,c=null,f;if(g!==null){if(window.GLIFFY.FEATURES.browserTabs){window.open(g.urls.launch,"gliffy"+g.id);if(GLIFFY.editor){GliffyApp.fileOpenBrowserController.hide()}}else{f=g.urls.open;c=GLIFFY.editor.findOpenDocumentByUrl(f);if(c===null){e={url:f,callback:function(){d.hide()}};if(this.createNewTab){GLIFFY.editor.openInNewTab(e)}else{GLIFFY.editor.open(e)}}else{GliffyApp.documentTabsController.selectTab(c);this.hide()}}}},sortDocumentList:function(d,c){GliffyApp.documentListController.doSort(c,d)},search:function(c){GliffyApp.documentListController.doSearch(c)},handleDoubleClickItem:function(){GliffyApp.documentListController.handleDoubleClickItem()},handleDocumentListScroll:function(c){GliffyApp.documentListController.scroll(c)},handleDocumentListScrollStart:function(c){GliffyApp.documentListController.scrollStart(c)},handleDocumentListScrollEnd:function(c){GliffyApp.documentListController.scrollEnd(c)},handleFolderClick:function(c){if(c.id===GliffyApp.accountFoldersController.SHARED_FOLDER_ID){GliffyApp.documentListController.load("shared_diagrams.json",{app:window.GLIFFY.ENV.app},this.INITIAL_IMAGE_LOAD_LIMIT)}else{if(c.id===GliffyApp.accountFoldersController.RECENT_FOLDER_ID){GliffyApp.documentListController.load("recent_diagrams.json",{userId:GliffyApp.authController.getUserID(),accountId:GliffyApp.authController.getAccountId(),max:20,app:window.GLIFFY.ENV.app},this.INITIAL_IMAGE_LOAD_LIMIT)}else{if(c.id===GliffyApp.accountFoldersController.STARRED_FOLDER_ID){GliffyApp.documentListController.load("favorite_diagrams.json",{accountId:GliffyApp.authController.getAccountId(),app:window.GLIFFY.ENV.app},this.INITIAL_IMAGE_LOAD_LIMIT)}else{var d="folder_diagrams.json";GliffyApp.documentListController.load(d,{folderId:c.id,app:window.GLIFFY.ENV.app},this.INITIAL_IMAGE_LOAD_LIMIT)}}}}})}());(function(){GliffyApp.AbstractModalController=Ember.Controller.extend({theModal:null,hide:function(){this.theModal.modal("hide")},setTitle:function(c){this.theModal.find(".gliffy-modal-header h4").html(c)},resetSize:function(c){this.setSize(this.theModal.css("max-width"),this.theModal.css("max-height"),c)},setSize:function(c,e,d){this.setWidth(c);this.setHeight(e,d)},setWidth:function(c){this.theModal.width(c);this.__center()},setHeight:function(e,d){var c=this;if(d===true){this.theModal.animate({height:e},{duration:500,step:function(){c.__center()}})}else{this.theModal.height(e);this.__center()}},__center:function(){this.theModal.css("margin","-"+(this.theModal.height()/2)+"px 0 0 -"+(this.theModal.width()/2)+"px")},showUIBlocker:function(){var c=this.theModal.find(".gliffy-modal-ui-blocker");var d=this.theModal.height()-this.theModal.find(".gliffy-modal-header").innerHeight();c.height(d);c.show()},hideUIBlocker:function(){this.theModal.find(".gliffy-modal-ui-blocker").hide()},__displayErrorMessage:function(c){var d=this.theModal.find(".alert-floating");d.removeClass("alert-success").addClass("alert-error").find("span").html(c);d.show()}})}());(function(){GliffyApp.DocumentTabsController=GliffyApp.DocumentTabsController.extend({getTabTemplateHTML:function(f,c){var e,d;if(GLIFFY.FEATURES.browserTabs){e=this._super(false,c)}else{e=this._super(f,c)}d=$(e);if(GliffyApp.documentModel.isPublic){$('<div class="gliffy-icon-public icon" title="public diagram"></div>').insertAfter(d.find("span:first"))}else{$('<div class="gliffy-icon-private icon" title="private diagram"></div>').insertAfter(d.find("span:first"))}setTimeout(function(){$("#gliffy-tabs-container div.icon").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)},1000);e=d.wrap("<p/>").parent().html();return e},updateTabText:function(){var c=this.__editor.getDocumentManager().getActiveDocument().tabDomElement;c.find("div.icon").removeAttr("data-original-title").tooltip("hide");this._super()}})}());(function(){GliffyApp.ResumingModalController=Ember.Object.extend({modalSelector:null,init:function(){this.__onCancel=null;this.__onResume=null;this.__currentModal=null},resume:function(){$(this.__currentModal).unbind("hidden.gliffycancel").modal("hide");this.__currentModal=null;if(this.__onResume){this.__onResume()}this.__onCancel=null;this.__onResume=null},cancel:function(){$(this.__currentModal).unbind("hidden.gliffycancel");this.__currentModal=null;if(this.__onCancel){this.__onCancel()}this.__onCancel=null;this.__onResume=null},isModalUp:function(){return this.__currentModal!==null},getModal:function(){return this.__currentModal},show:function(f,e){var d=this,c;this.__onCancel=e||null;this.__onResume=f||null;c=function(){var g=$(d.modalSelector);if(g.length===0){setTimeout(c,10)}else{g.unbind("hidden.gliffycancel");if(e){g.bind("hidden.gliffycancel",function(){d.cancel()})}d.__currentModal=g;g.modal("show")}};c()}})}());(function(){GliffyApp.DocumentSearchController=Ember.Object.extend({searchValue:"",actions:{search:function(c){}},updateSearchValue:function(c){this.set("searchValue",c)},search:function(){},clear:function(){this.set("searchValue","");$(".gliffy-document-search input").val("")}});GliffyApp.documentSearchController=GliffyApp.DocumentSearchController.create()}());(function(){GliffyApp.DocumentSortController=Ember.Controller.extend({SORT_KEY_OBJECTS:null,sortKeys:null,init:function(){this.sortKeys=Ember.A([])},actions:{selectItem:function(c){$(".gliffy-document-sort-dropdown .dropdown-toggle").click();$(".gliffy-document-sort-dropdown-button").html(c.desc)}},populateDropdown:function(e){var c,d;this.sortKeys.clear();for(c=0;c<e.length;c++){d=Ember.Object.create();if(!this.SORT_KEY_OBJECTS){this.SORT_KEY_OBJECTS={lastEdited:{desc:$.i18n._("online.document.sort.filter.last.edited"),sortOrder:"desc",sortProperty:"lastModified"},alphabetical:{desc:$.i18n._("online.document.sort.filter.alphabetical.a.to.z"),sortOrder:"asc",sortProperty:"name"},reverseAlphabetical:{desc:$.i18n._("online.document.sort.filter.alphabetical.z.to.a"),sortOrder:"desc",sortProperty:"name"},createDate:{desc:$.i18n._("online.document.sort.filter.date.created"),sortOrder:"asc",sortProperty:"createDate"}}}d.setProperties(this.SORT_KEY_OBJECTS[e[c]]);this.sortKeys.pushObject(d)}}});GliffyApp.documentSortController=GliffyApp.DocumentSortController.create()}());(function(){GliffyApp.DocumentListController=Ember.Controller.extend({__documentsCount:0,__documentsLoaded:0,__initialLoadLimit:5,__itemIsBeingSelected:false,__lazyRenderTimeout:null,__loadZoomPreviewBound:false,__renamingDocument:false,__scrolling:null,__scrollTimeout:null,__tempTime:null,__zoomImgLoadCheckCounter:0,container:null,currentAction:null,documentList:null,filterProperty:null,filterValue:null,introShown:false,isEditableItems:false,isListLayout:false,itemHeight:125,masterDocumentList:null,selectedItem:null,sortOrder:null,sortProperty:null,actions:{closeAlert:function(){$(".gliffy-document-list-alert").hide()},handleInputKeyUp:function(){if(event.keyCode===13){this.handleRenameDocument(event.target.value)}else{if(event.keyCode===27){GliffyApp.documentListController.hideRenameInput()}}return true},handleDocumentNameClick:function(){event.preventDefault();var c=this;var d;var f=Number($(event.target).closest(".gliffy-document-content-column").prop("id"));var e=this.documentList.findBy("id",f);this.handleSelectItem(event,e);if(this.isEditableItems){$(event.currentTarget).removeAttr("data-original-title").tooltip("hide");this.selectedItem.set("isEditingName",true);d=setTimeout(function(){c.container.find(".gliffy-selected input").focus().select();c.hideRenameSpinner(c.getSelectedItemDOM())},5)}},handleDocumentDelete:function(){this.handleDocumentDelete.apply(this,arguments)},handleDocumentPublish:function(){this.handleDocumentPublish.apply(this,arguments)},handleDocumentCollaborate:function(){this.handleDocumentCollaborate.apply(this,arguments)}},init:function(){this._super();this.documentList=Ember.A([]);this.masterDocumentList=Ember.A([]);this.reset()},setContainer:function(c){this.container=c},setListLayout:function(c){this.set("isListLayout",c)},clear:function(){this.documentList.clear();this.__documentsLoaded=0;this.__documentsCount=0;this.filterValue="";if(this.__lazyRenderTimeout!==null){clearTimeout(this.__lazyRenderTimeout);this.__lazyRenderTimeout=null}},reset:function(){this.sortOrder="desc";this.sortProperty="lastModified";this.filterValue="";this.filterProperty="name";this.__initialLoadLimit=5;this.__itemIsBeingSelected=false},load:function(f,e,d){var c=this;c.set("currentAction",f);this.clear();this.clearSelectedItem();this.hideDocumentItemError();this.__itemIsBeingSelected=false;if(d){this.__initialLoadLimit=d}this.showSpinner();if(this.isDemo){this.__buildMasterDocumentList(this.documentListJSONStub.diagrams);this.render()}else{window.GLIFFY.API.GET(f,{query:e,success:function(h,j,g){c.__buildMasterDocumentList(h.diagrams);c.render();c.called="called"},error:function(j,g,h){console.error("error loading document list",j,g,h);c.hideSpinner()},context:this})}},isGoogleDrive:Ember.computed(function(){return(this.currentAction==="gdrive_folder_diagrams.json")}).property("currentAction"),showSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").show()},hideSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").hide()},setFilterValue:function(c){if(this.get("filterValue")!==c){this.set("filterValue",c);this.render()}},getSortedData:function(e){var d,c=this;if(this.get("sortOrder")=="asc"){d=e.sort(function(g,f){if(typeof g[c.sortProperty]=="number"){return g[c.sortProperty]-f[c.sortProperty]}else{return((g[c.sortProperty].toLowerCase()<f[c.sortProperty].toLowerCase())?-1:((g[c.sortProperty].toLowerCase()>f[c.sortProperty].toLowerCase())?1:0))}})}else{d=e.sort(function(g,f){if(typeof g[c.sortProperty]=="number"){return f[c.sortProperty]-g[c.sortProperty]}else{return((f[c.sortProperty].toLowerCase()<g[c.sortProperty].toLowerCase())?-1:((f[c.sortProperty].toLowerCase()>g[c.sortProperty].toLowerCase())?1:0))}})}return d},render:function(){var c=this;var f=Ember.A([]);var g=this.getFilteredData(this.getSortedData(this.masterDocumentList));var e=50;this.__documentsCount=g.length;if(e>this.__documentsCount){e=this.__documentsCount}if(this.__documentsCount===0){this.hideSpinner()}for(var d=0;d<e;d++){if(d>=0&&d<=this.__initialLoadLimit){if(!g[d].get("isLoaded")){g[d].set("isLoaded",true)}}this.__documentsLoaded++;f.pushObject(g[d])}this.set("documentList",f);if(this.__documentsLoaded<this.__documentsCount){this.__lazyRenderTimeout=setTimeout(function(){c.__renderRemaining(g,e)},250)}if(this.get("documentList").length===0){if(this.get("introShown")==false&&GliffyApp.authController.getAccountDiagrams()==0&&window.GLIFFY.ENV.location=="DOCUMENT_MANAGER"){$(".gliffy-recent-intro-documents").show();$(".gliffy-document-list-no-documents-message").hide()}else{$(".gliffy-document-list-no-documents-message").show();$(".gliffy-recent-intro-documents").hide()}}else{$(".gliffy-document-list-no-documents-message").hide();$(".gliffy-recent-intro-documents").hide()}this.set("introShown",true);this.container.parent().scrollTop(0);setTimeout(function(){c.hideSpinner();c.loadVisibleDocuments()},50)},__renderRemaining:function(h,g){var d=this;var c=this.__documentsCount-this.__documentsLoaded;var e=this.__documentsLoaded;if(g>c){g=c}for(var f=e;f<(e+g);f++){this.__documentsLoaded++;this.documentList.pushObject(h[f])}if(this.__documentsLoaded<this.__documentsCount){this.__lazyRenderTimeout=setTimeout(function(){d.__renderRemaining(h,g)},250)}},doSort:function(c,d){var e=this.filterValue;this.showSpinner();this.clear();this.set("filterValue",e);this.set("sortOrder",c);this.set("sortProperty",d);this.render();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentList",action:"sort",label:d+"/"+c})},doSearch:function(c){this.showSpinner();this.clear();this.set("filterValue",c);this.render();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentList",action:"search"})},__buildMasterDocumentList:function(f){var d,e,c;this.masterDocumentList=Ember.A([]);for(d=0;d<f.length;d++){e=f[d];c=GliffyApp.DocumentListItemModel.create();if(d>=0&&d<=5){c.set("isLoaded",true)}c.setProperties(e);c.set("isEditable",this.isEditableItems);this.masterDocumentList[this.masterDocumentList.length]=c}},getFilteredData:function(e){var c=this,d;d=e.filter(function(f){if(f[c.filterProperty].length>=c.get("filterValue").length&&f[c.filterProperty].toLowerCase().search(c.get("filterValue").toLowerCase())>-1){return true}else{return false}});return d},handleSelectItem:function(d,c){if(this.selectedItem!==null&&c.id!==this.selectedItem.id){this.clearSelectedItem();this.hideDocumentItemError()}if(this.isListLayout){$(".gliffy-document-list tr").removeClass("gliffy-selected")}else{$(".gliffy-document-list .gliffy-grid-item").removeClass("gliffy-selected")}$(d.currentTarget).addClass("gliffy-selected");this.selectedItem=c;if(this.isEditableItems){$(".gliffy-document-list-item-delete").hide();$(d.currentTarget).find(".gliffy-document-list-item-delete").show();$(".gliffy-document-list-item-share").hide();$(d.currentTarget).find(".gliffy-document-list-item-share").show()}},getDocumentTitleMaxWidth:function(){return $(".gliffy-document-list").width()-$(".gliffy-document-preview-column").width()-$(".gliffy-document-list-item-col3").width()-30},handleDoubleClickItem:function(){if(this.selectedItem!==null){this.container.trigger("documentListItemOpen",this.selectedItem)}},handleRenameDocument:function(d){var c=this;this.hideDocumentItemError();var e=this.getSelectedItemDOM();var f=this.selectedItem;if(f.name===d){this.hideRenameInput();return}if(this.validateDocumentName(d,function(g){c.displayDocumentItemError(g)})){if(!this.__renamingDocument){this.__renamingDocument=true;this.showRenameSpinner(e);this.renameDocument(f,d,function(g){if(g.error){c.displayDocumentItemError(g.error+" Press ESC to exit editing.")}else{f.set("name",d);c.hideRenameInput(f)}c.hideRenameSpinner(e);c.__renamingDocument=false},function(g){c.displayDocumentItemError(g);c.hideRenameSpinner(e);c.hideRenameInput(f);c.__renamingDocument=false})}}},renameDocument:function(d,f,c,e){GLIFFY.PLUGINS.pluginManager.getCurrentDocumentPlugin().rename(d,f,c,e)},showRenameSpinner:function(c){c.find("input").hide();c.find(".gliffy-document-rename-saving").show()},hideRenameSpinner:function(c){c.find(".gliffy-document-rename-saving").hide();c.find("input").show()},validateDocumentName:function(d,c){if(d.replace(" ","")===""){c("Document name cannot be blank.");return false}else{if(d.indexOf('"')>-1||d.indexOf("\\")>-1||d.indexOf("/")>-1||d.indexOf("<")>-1){c('Document name cannot contain the characters "/ or <.');return false}}return true},displayDocumentItemError:function(c){var d=this.getErrorAlertDOM();d.css("top",this.getSelectedItemDOM().position().top+50);d.css("left",this.getSelectedItemDOM().position().left+250);d.show();d.find("strong").html("Error!");d.find("span").html(c)},hideDocumentItemError:function(){this.getErrorAlertDOM().hide()},getSelectedItemDOM:function(){return this.container.find(".gliffy-selected")},getErrorAlertDOM:function(){return GliffyApp.documentListController.container.parent().find(".alert-floating")},clearSelectedItem:function(){if(this.selectedItem!==null){if(this.selectedItem.isEditingName){this.hideRenameInput(this.selectedItem)}this.selectedItem=null}},hideRenameInput:function(d){this.selectedItem.set("isEditingName",false);var c=setTimeout(function(){$(".gliffy-document-list-item-tooltip").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)},5)},handleDocumentDelete:function(d){var c=this;if(this.selectedItem!==null){this.doDocumentDelete(this.selectedItem,function(){c.removeSelectedDocumentItem();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"deleteDiagram",label:window.location.pathname});GLIFFY.Spinner.hide({context:"deleteDiagram"})},function(e){GLIFFY.Spinner.hide({context:"deleteDiagram"});c.displayDocumentItemError(e)})}},doDocumentDelete:function(e,c,d,j){var k=this,f,l,g,h;if(GliffyApp.accountFoldersController.isSharedFolderSelected()){f=$.i18n._("online.document.list.remove.shared.diagram");l=$.i18n._("online.document.list.remove.shared.diagram.confirm",[e.name]);g=$.i18n._("online.document.list.remove.shared.diagram.button");h=function(m){GliffyApp.collaborationController.removeCollaborator({id:GliffyApp.authController.getUserID()},e.id,function(){c()},function(p,n,o){d(o)})}}else{f=$.i18n._("online.document.list.delete.diagram");l=$.i18n._("online.document.list.delete.diagram.confirm",[e.name]);g=$.i18n._("online.modal.delete");h=function(m){GLIFFY.Spinner.show({context:"deleteDiagram"});k.deleteDocument(e.id,c,d)}}GLIFFY.Dialog.showYesNoDialog({title:f,content:l,cancelCallback:j,buttons:[{text:$.i18n._("online.modal.cancel"),callback:j,primary:false,dismiss:true},{text:g,callback:h,primary:true,dismiss:true}]})},deleteDocument:function(e,c,d){GLIFFY.PLUGINS.pluginManager.getDialogPlugin()["delete"](e,c,d)},removeSelectedDocumentItem:function(){this.masterDocumentList.removeObject(this.selectedItem);this.container.find("#"+this.selectedItem.id).parent().remove();this.clearSelectedItem()},handleDocumentCollaborate:function(c){if(this.selectedItem!==null){GliffyApp.collaborationController.show(this.selectedItem.id,this.selectedItem.name);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"collaborateClick",label:window.location.pathname})}},handleDocumentPublish:function(d){var c=this;if(this.selectedItem!==null){GliffyApp.documentModel.populate(this.selectedItem);GliffyApp.publishController.show(function(){c.selectedItem.set("isPublic",GliffyApp.documentModel.get("isPublic"))});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"publishClick",label:window.location.pathname})}},handleSelectFavorite:function(d,c){if($(d.target).hasClass("gliffy-icon-star-off")){this.callFavoriteAPI(c,true,function(){$(d.target).removeClass("gliffy-icon-star-off");$(d.target).addClass("gliffy-icon-star");$(d.target).attr("data-original-title","click to un-star")})}else{this.callFavoriteAPI(c,false,function(){$(d.target).removeClass("gliffy-icon-star");$(d.target).addClass("gliffy-icon-star-off");$(d.target).attr("data-original-title","click to star")})}},callFavoriteAPI:function(e,f,c){var d=this;window.GLIFFY.API.PUT("diagram_favorite.json",{value:f},{query:{diagramId:e.id},success:function(h,j,g){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"star",label:window.location.pathname});c()},error:function(j,g,h){h=GLIFFY.onlineUtils.handleDiagramActionError(j,g,h,"An error occurred setting favorite.",false);d.displayDocumentItemError(h);console.error("error setting favorite",j,g,h)},context:this})},isScrolledIntoView:function(e){var g=0;var f=g+this.container.parent().height();var c=$(e).offset().top-this.container.parent().offset().top;var d=c+$(e).height();return(d>=g&&d<=f)||(c>=g&&c<=f)},scroll:function(f){var c=this;var d=(new Date()).getTime();if(d-c.__tempTime>200&&!c.__scrolling){c.container.trigger("scrollStart");c.__tempTime=d}clearTimeout(c.__scrollTimeout);c.__scrollTimeout=setTimeout(function(){if(c.__scrolling){c.container.trigger("scrollEnd")}},200)},scrollStart:function(c){this.__scrolling=true},scrollEnd:function(c){this.__scrolling=false;this.loadVisibleDocuments()},loadVisibleDocuments:function(){var e,c;for(var d=0;d<this.documentList.length;d++){if(this.isListLayout){e=this.container.find("tr").get(d)}else{e=this.container.find(".gliffy-grid-item").get(d)}c=this.documentList.get(d);if(!c.get("isLoaded")){if(e!==null&&$(e).offset()!==null&&this.isScrolledIntoView(e)){if(!c.get("isLoaded")){c.set("isLoaded",true)}}}}},zoom:function(d){var c=this;this.__zoomImgLoadCheckCounter=0;$(".gliffy-zoom-view-modal .gliffy-zoom-view-modal-img").hide();$(".gliffy-zoom-view-modal .gliffy-inner-spinner-icon").show();$(".gliffy-zoom-view-modal-img").width("auto");$(".gliffy-zoom-view-modal-img").height("auto");if(!this.__loadZoomPreviewBound){$(".gliffy-zoom-view-modal-img").on("load",function(){c.__zoomImgLoadCheck()});this.__loadZoomPreviewBound=true}$(".gliffy-zoom-view-modal").modal("show");$(".gliffy-zoom-view-modal-img").attr("src","/go/view/"+d.id+".png?size=large");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentList",action:"previewZoom"})},__zoomImgLoadCheck:function(){var c,e,d=this;setTimeout(function(){d.__zoomImgLoadCheckCounter++;c=$(".gliffy-zoom-view-modal-img").width();e=$(".gliffy-zoom-view-modal-img").height();if((c>0&&e>0)||d.__zoomImgLoadCheckCounter>100){$(".gliffy-zoom-view-modal .gliffy-zoom-view-modal-img").show();$(".gliffy-zoom-view-modal .gliffy-inner-spinner-icon").hide();d.__resizeZoomView()}else{d.__zoomImgLoadCheck()}},100)},__resizeZoomView:function(){var k=60,l=80,g,c,d=$(".gliffy-zoom-view-modal-img").width()+k,f=$(".gliffy-zoom-view-modal-img").height()+l,e=$(window).width(),j=$(window).height();if(d>e){g=d;d=e-50;f=d/g*f;$(".gliffy-zoom-view-modal-img").width(d-k);$(".gliffy-zoom-view-modal-img").height(f-l)}if(f>j){c=f;f=j-50;d=f/c*d;$(".gliffy-zoom-view-modal-img").width(d-k);$(".gliffy-zoom-view-modal-img").height(f-l)}$(".gliffy-zoom-view-modal").width(d);$(".gliffy-zoom-view-modal").height(f);$(".gliffy-zoom-view-modal").css("margin","-"+((f)/2)+"px 0 0 -"+((d)/2)+"px")},documentListJSONStub:{diagrams:[{name:"My Cool Diagram",isFavorite:true,lastModified:1350950400,lastModifiedFriendly:"October 23, 2012",createDate:1212969600,createDateFriendly:"June 09, 2008",isPublic:false,createdBy:"Jack Muir",lastModifiedBy:"Han Lee",currentlyEditedBy:"Han Lee",urls:{thumbnail:"/go/view/90209.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90000",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"Aardvark Migration",isFavorite:true,lastModified:1352678400,lastModifiedFriendly:"November 12, 2012",createDate:1342828800,createDateFriendly:"July 21, 2012",isPublic:true,createdBy:"Clint Dickson",lastModifiedBy:"Kerry Liu",urls:{thumbnail:"/go/view/90172.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"BPMN",isFavorite:false,lastModified:1338854400,lastModifiedFriendly:"June 05, 2012",createDate:1334188800,createDateFriendly:"April 12, 2012",isPublic:false,createdBy:"Todd",lastModifiedBy:"Rocco",urls:{thumbnail:"/go/view/90000.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"Floorplan of a really nice house on Mars that has big chickens in the garage and a small car in the yard",isFavorite:false,lastModified:1233792000,lastModifiedFriendly:"February 05, 2009",createDate:1231718400,createDateFriendly:"January 12, 2009",isPublic:true,createdBy:"Todd",lastModifiedBy:"Eric Chiang",urls:{thumbnail:"/go/view/90004.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"BPMN 2",isFavorite:false,lastModified:1272326400,lastModifiedFriendly:"April 27, 2010",createDate:1193788800,createDateFriendly:"October 31, 2007",isPublic:false,createdBy:"Ron",lastModifiedBy:"Carole",urls:{thumbnail:"/go/view/90001.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false}]}});GliffyApp.instanceInitializer({name:"initializeDocumentList",after:"registerGlobalInstancesGop",initialize:function(c){c.registry.register("controller:document-list",GliffyApp.DocumentListController,{singleton:true});c.registry.injection("controller:document-list","features","service:features");GliffyApp.documentListController=c.container.lookup("controller:document-list");c.registry.register("services:documentListController",GliffyApp.documentListController,{instantiate:false,singleton:true});c.registry.injection("controller","documentListController","services:documentListController")}})}());(function(){GliffyApp.AccountFoldersController=Ember.Controller.extend({SHARED_FOLDER_ID:"Shared",RECENT_FOLDER_ID:"Recent",STARRED_FOLDER_ID:"Starred",GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE:"gliffyOnline",defaultFolders:null,selectedItem:null,selectedCommonFolderId:0,container:null,rootFolderId:0,__dropZones:null,__scrollTimeout:null,__tempTime:null,__scrolling:null,allowDelete:false,init:function(){var c=this;this.__dropZones=[]},actions:{handleSettingsClick:function(){this.toggleSettingsDropdown()},handleDeleteClick:function(){this.toggleSettingsDropdown();this.handleDelete()},handleRenameMenuClick:function(){this.toggleSettingsDropdown();this.showRenameFolderModal()},handlePermissionsClick:function(){this.toggleSettingsDropdown();GliffyApp.folderPermissionsModalController.show(this.getSelectedFolderId(),this.getSelectedFolderTitle());GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"folderPermissions",label:window.location.pathname})}},showFolderContainer:function(){$(".gliffy-account-folders-loading").hide();this.container.show()},hideFolderContainer:function(){this.container.hide();$(".gliffy-account-folders-loading").show()},updateDropZones:function(){var d=this.__dropZones,e=$(".gliffy-account-folders-container"),c=e.offset().left,f=c+e.width();d.length=0;$(".gliffy-account-folders-container a:visible").each(function(h,j){var j=$(j),l=j.offset(),k=new GLIFFY.BoundingBox(c,l.top,f,l.top+j.height()),m=j.parent().attr("id"),g=GliffyApp.accountFoldersController.getFolderTitleById(m);d.push({element:j,bounds:k,id:m,name:g})})},getFolderInfoAtPosition:function(c,f){var d,e;for(d=0;d<this.__dropZones.length;d++){e=this.__dropZones[d];if(e.bounds.pointInside(c,f)){return e}}return null},scroll:function(g,f){var c=this;var d=(new Date()).getTime();this.positionSelectionBar();if(d-c.__tempTime>200&&!c.__scrolling){$(f).trigger("scrollStart");c.__tempTime=d}clearTimeout(c.__scrollTimeout);c.__scrollTimeout=setTimeout(function(){if(c.__scrolling){$(f).trigger("scrollEnd")}},200)},scrollStart:function(c){this.__scrolling=true},scrollEnd:function(c){this.__scrolling=false;this.updateDropZones()},loadTemplates:function(c){var d=this;this.container=c;this.hideFolderContainer();return new Promise(function(f,e){GLIFFY.PLUGINS.storage.gliffyDrivePlugin.loadFolders("templates_folder_tree.json",function(h,g){if(h){d.defaultFolders=null;if(!c.is(":visible")){d.showFolderContainer()}e(h)}else{f(g)}})})},loadFolderTree:function(c){var d=this;d.container=c;d.hideFolderContainer();var e=GLIFFY.PLUGINS.pluginManager.getDialogPlugin();return new Promise(function(g,f){e.loadFolders("folder_tree.json",function(j,h){if(j){d.defaultFolders=null;if(!c.is(":visible")){d.showFolderContainer()}f(j)}else{g(h)}})})},constructFolderStucture:function(e){var d=this;var c;return new Promise(function(g,f){d.rootFolderId=0;if(d.defaultFolders){d.folder_data=$.extend(true,{},d.defaultFolders);d.folder_data.data.push(e);c=e.attr.id}else{d.folder_data=e;c=e.data[0].attr.id}d.rootFolderId=c;d.defaultFolders=null;d.container.jstree({json_data:d.folder_data,plugins:["themes","json_data","ui","sort"],themes:{theme:"gliffy-folder-tree",dots:false,icons:true,url:"../../go/assets/stylesheets/gliffy-folder-tree.css"},core:{html_titles:true},sort:function(j,h){return this.get_text(j).toLowerCase()>this.get_text(h).toLowerCase()?1:-1}}).bind("select_node.jstree",function(j,h){d.handleSelectNode(j,h)}).bind("loaded.jstree",function(j,h){g([c]);d.updateDropZones()}).bind("hover_node.jstree",function(j,h){d.showHoverBar(h.rslt.obj.attr("id"))}).bind("dehover_node.jstree",function(j,h){d.hideHoverBar()}).bind("open_node.jstree",function(j,h){d.updateDropZones()}).bind("after_open.jstree",function(j,h){if(!d.container.is(":visible")){setTimeout(function(){d.showFolderContainer()},500)}})})},selectFolder:function(c){this.container.jstree("select_node",c+":first")},openFolder:function(c,d){this.container.jstree("open_node",c+":first",function(){if(d){d()}})},openSelectedFolder:function(){this.openFolder(this.getSelectedFolder().attr("id"))},createFolder:function(d,c,f){var h=this.checkFolderNameError(d);var l=this;var g="inside";var j=this.container.jstree("get_selected");var k;var e=this.getSelectedFolderId();if(h){if(f){f.prop("disabled",false)}this.displayFolderNameError(h)}else{if(e<0){this.selectFolder(this.rootFolderId);j=this.container.jstree("get_selected");e=this.rootFolderId}GLIFFY.PLUGINS.pluginManager.getDialogPlugin().createFolder(e,d,function(n,m){if(f){f.prop("disabled",false)}if(n){l.displayFolderNameError(m);console.error(n);return}k={data:d,attr:m};l.container.jstree("create_node",j,g,k,false,false);l.container.jstree("correct_state",k);c();l.openSelectedFolder();l.updateDropZones()})}},renameFolder:function(h,d,c){var f=this.checkFolderNameError(d),e=this,g=this.container.jstree("get_selected"),j=this.getSelectedFolderId();this.showSpinner();if(f){this.displayFolderRenameError(f);this.hideSpinner()}else{window.GLIFFY.API.PUT("folder/"+this.selectedItem.attr("id")+"/rename",null,{query:{name:d},success:function(l,m,k){if(l.success==="false"||l.success===false){}else{e.renameNode(e.selectedItem.nodeName,d);e.deselectAllCommonFolders();e.showSelectionBar();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"renameFolder",label:window.location.pathname})}c();e.updateDropZones();e.hideSpinner()},error:function(m,k,l){console.log(m.responseText);e.displayFolderRenameError(m.responseText);e.hideSpinner();console.error("I borked")},context:this})}},displayFolderNameError:function(c){$("#gliffy-folder-create-modal .gliffy-input-modal-error").show();$("#gliffy-folder-create-modal .gliffy-input-modal-error p").html(c)},showCreateFolderModal:function(){$("#gliffy-folder-create-modal .gliffy-input-modal-input").val("");$("#gliffy-folder-create-modal .gliffy-input-modal-error").hide();$("#gliffy-folder-create-modal .gliffy-modal").modal("show");$("#gliffy-folder-create-modal .gliffy-input-modal-input").focus()},showRenameFolderModal:function(){$("#gliffy-folder-rename-modal .gliffy-input-modal-input").val($(".jstree-clicked").text().trim());$("#gliffy-folder-rename-modal .gliffy-input-modal-error").hide();$("#gliffy-folder-rename-modal .gliffy-modal").modal("show");$("#gliffy-folder-rename-modal .gliffy-input-modal-input").focus().select()},displayFolderRenameError:function(c){$("#gliffy-folder-rename-modal .gliffy-input-modal-error").show();$("#gliffy-folder-rename-modal .gliffy-input-modal-error p").html(c)},checkFolderNameError:function(d){var c=null,g="abcdefghijklmnopqrstuvwxyz0123456789@.-_ ",e,f;if(d.split(" ").join("")===""){c="Folder name is blank"}else{for(e=0;e<d.length;e++){f=d.charAt(e).toLowerCase();if(g.indexOf(f)!=-1){continue}c="Alpha-numeric characters only";break}}return c},handleSelectNode:function(g,f){var j=f.rslt.obj.attr("id"),h=$("#"+j+" .jstree-clicked").text(),d=f.rslt.obj.attr("type"),c=f.rslt.obj.attr("showOnlyPublic");this.container.trigger("folderClicked",{id:j,title:h,type:d,showOnlyPublic:c});this.selectedItem=f.rslt.obj;this.deselectAllCommonFolders();this.showSelectionBar();this.toggleDeleteButton(f)},showSelectionBar:function(){this.container.parent().find(".gliffy-folder-selection-bar").show();this.positionSelectionBar()},toggleDeleteButton:function(d){var c=$(".jstree-clicked").width();if(this.allowDelete&&c>0&&d.rslt.obj.parents("li").length>0&&d.rslt.obj.attr("type")===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE){$(".gliffy-folder-settings-button").show()}else{$(".gliffy-folder-settings-button").hide()}},hideSelectionBar:function(){$(".gliffy-folder-selection-bar").hide();$(".gliffy-folder-settings-button").hide()},showHoverBar:function(d){var c=this.container.parent().find(".gliffy-folder-hover-bar");c.show();c.css("top",this.container.find("#"+d+" a:first").offset().top-this.container.offset().top+this.container.position().top);c.css("left",3);c.width(this.container.width()-3)},hideHoverBar:function(){$(".gliffy-folder-hover-bar").hide()},positionSelectionBar:function(){var c=this.container.parent().find(".gliffy-folder-selection-bar");if(c.is(":visible")){c.width(this.container.width()-3);if(this.container.find(".jstree-clicked").offset()){c.css("top",this.container.find(".jstree-clicked").offset().top-this.container.offset().top+this.container.position().top);c.css("left",3);this.positionDeleteButton()}}},positionDeleteButton:function(){var c=this.container.parent().find(".gliffy-folder-selection-bar");$(".gliffy-folder-settings-button").css("top",c.offset().top+3);$(".gliffy-folder-settings-button").css("left",c.offset().left+c.width()-20)},handleDelete:function(){var c=this;GLIFFY.Dialog.showYesNoDialog({title:$.i18n._("online.account.folder.delete"),content:$.i18n._("online.account.folder.delete.confirm",[this.getSelectedFolderTitle()]),cancelCallback:null,buttons:[{text:$.i18n._("online.modal.cancel"),callback:null,primary:false,dismiss:true},{text:$.i18n._("online.modal.delete"),callback:function(d){c.deleteSelectedFolder()},primary:true,dismiss:true}]})},deleteSelectedFolder:function(){var c=this;window.GLIFFY.API.DELETE("folder.json",{query:{accountId:GliffyApp.authController.getAccountId(),folderId:c.selectedItem.attr("id")},success:function(e,f,d){if(e.success==="false"||e.success===false){c.displayFolderError(e.error)}else{c.hideSelectionBar();c.container.jstree("delete_node",c.selectedItem);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"deleteFolder",label:window.location.pathname})}c.updateDropZones()},error:function(f,d,e){c.displayFolderError(e);console.error("I borked")},context:this})},displayFolderError:function(c){GLIFFY.Dialog.showAlertDialog({title:$.i18n._("ERRORHANDLER_ERROR"),content:c,buttons:[{text:$.i18n._("DIALOG_OK"),primary:true,dismiss:true}]})},isNestedFolder:function(c){if(this.selectedItem!==null){if(this.container.jstree("get-parent",c)){return true}}return false},renameNode:function(d,c){this.container.jstree("rename_node",d,c)},getSelectedFolder:function(){return this.selectedItem},getSelectedFolderId:function(){if(this.selectedItem!==null){return this.selectedItem.attr("id")}return -1},getSelectedFolderType:function(){if(this.selectedItem!==null){return this.selectedItem.attr("type")}return null},getFolderTitleById:function(d){var c=$("#"+d+" > a").text();return c.substring(1)},getSelectedFolderTitle:function(){var c;if(this.selectedItem!==null){c=$("#"+this.selectedItem.attr("id")+" .jstree-clicked").text();return c.substring(1)}return null},handleCommonFolderClick:function(d,c){this.hideSelectionBar();this.deselectAllCommonFolders();$(d.currentTarget).addClass("gliffy-selected");if(this.selectedItem!==null){this.container.jstree("deselect_node",this.selectedItem);this.selectedItem=null}this.selectedCommonFolderId=c;this.container.trigger("folderClicked",{id:c})},deselectAllCommonFolders:function(){$(".gliffy-common-folders-container div.gliffy-common-folder").removeClass("gliffy-selected")},isSharedFolderSelected:function(){return(this.selectedItem===null&&this.selectedCommonFolderId===this.SHARED_FOLDER_ID)},toggleSettingsDropdown:function(){this.container.find(".gliffy-folder-settings-button .dropdown-toggle").click()},showSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").show()},hideSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").hide()},folder_data:null});GliffyApp.accountFoldersController=GliffyApp.AccountFoldersController.create()}());(function(){GliffyApp.FileOpenBrowserController=GliffyApp.AbstractFileDialogController.extend({init:function(){this._super(".gliffy-file-open-browser")},actions:{open:function(){this.handleDoubleClickItem()}},show:function(c){GLIFFY.PLUGINS.pluginManager.setDialogContext(c);this.createNewTab=true;$("#gliffy-modal-file-open-browser").modal("show").on("hide.bs.modal",GLIFFY.PLUGINS.pluginManager.handleDialogClose);GliffyApp.documentListController.set("isEditableItems",false);this.configDocumentList();this.configDocumentSearch();this.configDocumentSort();this.configAccountFolders();GliffyApp.accountFoldersController.set("allowDelete",false)},hide:function(){$("#gliffy-modal-file-open-browser").modal("hide")}});GliffyApp.fileOpenBrowserController=GliffyApp.FileOpenBrowserController.create()}());(function(){GliffyApp.fileUploadController=Ember.Object.create({DEFAULT_MESSAGE_TYPE_ERROR:"This is not a valid file type for upload",DEFAULT_TEXT_UPLOAD_BUTTON:"Upload",FILE_EXTENSION_VDX:"vdx",FILE_EXTENSION_VSDX:"vsdx",FILE_EXTENSION_GXML:"gxml",FILE_EXTENSION_GON:"gon",FILE_EXTENSION_GLIFFY:"gliffy",FILE_EXTENSION_JPG:"jpg",FILE_EXTENSION_JPEG:"jpeg",FILE_EXTENSION_PNG:"png",FILE_EXTENSION_GIF:"gif",FILE_EXTENSION_SVG:"svg",init:function(){},createFileUploaderButton:function(d,c){d.fineUploader(this.getFileUploadConfigObject(c)).on("error",function(f,h,e,g){d.trigger("gliffy_fileUploadError",{id:h,filename:e,reason:g})}).on("complete",function(f,h,e,g){if(g&&g.success){d.trigger("gliffy_fileUploadSuccess",{id:h,filename:e,data:g})}}).on("progress",function(g,j,e,f,h){d.trigger("gliffy_fileUploadProgress",{currentSize:f,totalSize:h})}).on("upload",function(f,g,e){d.trigger("gliffy_fileUploadStart",e)}).on("submit",function(f,g,e){$(this).fineUploader("setParams",{filename:e})}).on("click",function(e){console.log("upload click");GLIFFY.analyticsUtils.logMixpanelEvent("documentImport",{});if(c.click){return c.click(e)}});return d},updateOptions:function(d,c){d.fineUploader(this.getFileUploadConfigObject(c))},getFileUploadConfigObject:function(d){var c=this;if(!d||!d.url){throw new Error("GliffyApp.fileUploadController.getFileUploadConfigObject must have an options object passed in with a url parameter")}return{request:{endpoint:d.url},multiple:(d.multiple?d.multiple:false),validation:{allowedExtensions:(d.allowExtensions?d.allowExtensions:[]),acceptFiles:(d.acceptFiles?d.acceptFiles:[]),sizeLimit:d.sizeLimit},messages:{typeError:(d.invalidTypeMessage?d.invalidTypeMessage:c.DEFAULT_MESSAGE_TYPE_ERROR),sizeError:d.sizeLimitError},showMessage:function(e){},text:{uploadButton:(d.buttonText?d.buttonText:c.DEFAULT_TEXT_UPLOAD_BUTTON)},failedUploadTextDisplay:{mode:"none"},dragAndDrop:{disableDefaultDropzone:true}}},importDocument:function(){var c=window.GLIFFY.ENV.importDiagramUrl+"&accountId="+GliffyApp.authController.getAccountId()+"&noc="+(new Date()).getTime();if(GliffyApp.documentManagerController){c+="&currentDocumentContext=gliffyDrivePlugin"}GLIFFY.Dialog.showYesNoDialog({title:$.i18n._("online.file.upload.import.file"),content:$.i18n._("online.file.upload.import.success"),cancelCallback:null,buttons:[{text:$.i18n._("online.modal.open"),callback:function(d){window.open(c)},primary:true,dismiss:true},{text:$.i18n._("online.modal.cancel"),callback:null,primary:false,dismiss:true}]})}})}());(function(){GliffyApp.WelcomeScreenController=Ember.Controller.extend({recentDiagramList:null,templateList:null,hideWelcomeScreen:false,isDemo:false,mode:null,showNoDocumentsState:false,init:function(){this.recentDiagramList=Ember.A([]);this.templateList=Ember.A([])},actions:{openAnotherDiagram:function(){this.handleOpenAnotherDiagram()},openTemplate:function(c){this.hide();this.handleOpenTemplate(c)},openFromGoogleDrive:function(){GliffyApp.toolbarController.doOpenGoogleDrive()},openFromGliffy:function(){GliffyApp.toolbarController.doOpen()},handleUploadClick:function(){$(".thumb-blue .qq-upload-button input[type=file]").trigger("click")},create:function(c){this.handleCreate(c)}},show:function(){var c=$.url().param("showUserManagement");if($.url().param("teaminvite")){GliffyApp.trialTeamInviteModalController.show()}else{if(c==="false"||c===undefined||c===null){if(this.get("hideWelcomeScreen")===false){$("#gliffy-modal-welcome-screen").modal("show")}}}this.recentDiagramList.clear();this.loadRecentDiagramList("recent_diagrams.json",{userId:GliffyApp.authController.getUserID(),accountId:GliffyApp.authController.getAccountId(),max:5,app:window.GLIFFY.ENV.app});this._loadTemplates();this.clearUploadControlsUI()},_loadTemplates:function(){var c=this;this.templateList.clear();window.GLIFFY.API.GET("welcomeScreenTemplates",{success:function(e,f,d){_.forEach(e.templates,function(g){c._addTemplate(g.diagramID,g.name,g.imageName)})},error:function(f,d,e){console.error("error loading templates")}})},__getUploadOptions:function(){return{url:window.GLIFFY.API.getActionUrl("import_file.json",null),allowExtensions:[GliffyApp.fileUploadController.FILE_EXTENSION_GON,GliffyApp.fileUploadController.FILE_EXTENSION_GXML,GliffyApp.fileUploadController.FILE_EXTENSION_GLIFFY,GliffyApp.fileUploadController.FILE_EXTENSION_VDX,GliffyApp.fileUploadController.FILE_EXTENSION_VSDX],buttonText:$.i18n._("online.welcome.import.top"),click:function(c){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"importClick"})}}},createFileUploadControls:function(){var d=this.__getUploadOptions(),c=this;GliffyApp.fileUploadController.createFileUploaderButton($(".gliffy-welcome-screen .gliffy-file-upload-button"),jQuery.extend(d,{acceptFiles:[".gxml,application/gliffy+xml",".gliffy,application/gliffy+json",".gon,application/gliffy+json",".vdx,application/vnd.ms-visio",".vsdx,application/vnd.visio2013"]}));d.buttonText=$.i18n._("online.welcome.import.button");GliffyApp.authController.addLoginCallback(function(){var e=c.__getUploadOptions();GliffyApp.fileUploadController.updateOptions($(".gliffy-welcome-screen .gliffy-file-upload-button"),jQuery.extend(e,{acceptFiles:[".gxml,application/gliffy+xml"]}))});$(".gliffy-welcome-screen [class^='gliffy-file-upload-button']").bind("gliffy_fileUploadSuccess",function(g,f){c.handleFileImportSuccess(f)}).bind("gliffy_fileUploadError",function(g,f){c.handleFileImportError(f)}).bind("gliffy_fileUploadProgress",function(g,f){c.handleFileImportProgress(f)}).bind("gliffy_fileUploadStart",function(g,f){c.handleFileImportStart(f)})},clearUploadControlsUI:function(){$(".gliffy-welcome-screen-list-item").trigger("mouseleave")},handleFileImportSuccess:function(c){GliffyApp.progressBarController.hide();var d={callback:function(){GLIFFY.editor.handleCreateNewTab()}};GLIFFY.editor.openTemplateFromGON(c.data.diagram,d);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"import",action:"importSuccess",label:"welcomeScreen;"+GLIFFY.onlineUtils.getFileHandle(c.filename)})},handleFileImportError:function(d){var c=this;this.hide();GliffyApp.progressBarController.hide();GLIFFY.Dialog.showAlertDialog({title:$.i18n._("ERRORHANDLER_ERROR"),content:$.i18n._("online.file.upload.import.error")+" "+d.reason+". "+$.i18n._("online.file.upload.import.error.action"),buttons:[{text:$.i18n._("DIALOG_OK"),callback:function(f){c.show()},primary:true,dismiss:true}]});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"import",action:"importError",label:d.reason+";welcomeScreen;"+GLIFFY.onlineUtils.getFileHandle(d.filename)})},handleFileImportProgress:function(c){GliffyApp.progressBarController.updateProgress(c.currentSize,c.totalSize)},handleFileImportStart:function(c){this.hide();GliffyApp.progressBarController.show($.i18n._("online.welcome.importing")+" "+c)},hide:function(){$("#gliffy-modal-welcome-screen").modal("hide")},loadRecentDiagramList:function(d,c){if(this.isDemo){this.buildRecentDiagramList(GliffyApp.documentListController.documentListJSONStub.diagrams);this.render()}else{if(this.mode&&this.mode=="create"){this.set("showNoDocumentsState",true);$("#gliffy-modal-welcome-screen").height(400)}else{window.GLIFFY.API.GET(d,{query:c,success:function(f,g,e){this.buildRecentDiagramList(f.diagrams);this.render()},error:function(g,e,f){console.error("error loading document list",g,e,f)},context:this})}}},render:function(){if(this.recentDiagramList.length>0){this.set("showNoDocumentsState",false)}else{this.set("showNoDocumentsState",true)}},buildRecentDiagramList:function(f){var e,g,d,c=f.length;for(e=0;e<f.length;e++){g=f[e];d=Ember.Object.create();d.setProperties(g);this.recentDiagramList.pushObject(d)}setTimeout(function(){$(".gliffy-welcome-screen-list-item").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)},1)},showSpinner:function(){},hideSpinner:function(){},handleOpenAnotherDiagram:function(c){this.hide();GliffyApp.fileOpenBrowserController.show();GliffyApp.fileOpenBrowserController.createNewTab=false;GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openAnother"})},handleSelectRecentDiagram:function(k,c){var f=this,g,d=null,j,h=c.content.urls.open;if(!GLIFFY.FEATURES.browserTabs){d=GLIFFY.editor.findOpenDocumentByUrl(h)}if(d===null){g={url:h,callback:function(){f.hide();if(c){c.alreadyClicked=true}}};GLIFFY.editor.open(g)}else{GliffyApp.documentTabsController.selectTab(d);this.hide()}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openExisting"})},handleCreate:function(c){this.hide();if(c==="template"){GliffyApp.templateBrowserController.show();GliffyApp.templateBrowserController.createNewTab=false}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"createNew",label:c})},handleShowTips:function(e){var c=this;this.hide();var d=e.data("gliffy-tip-num");GliffyApp.tipsController.open(function(){c.show()});GliffyApp.tipsController.showTip(d);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openTips",value:d})},_addTemplate:function(f,e,d){GliffyApp.templateBrowserController.set("createNewTab",false);var c=GliffyApp.welcomeTemplate.create({title:e,id:f,image:d,urls:{thumbnail:"/go/view/"+f+".png?size=thumbnail",open:"/go/api/diagram.json?diagramId="+f,update:"/go/api/diagram.json?diagramId="+f,template:"/go/api/diagram.json?diagramId="+f},"read-only":false});this.templateList.pushObject(c)},handleOpenTemplate:function(c){GLIFFY.API.GET(c.urls.template,{isUrl:true,success:function(d){GLIFFY.editor.open({jsonObj:d});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openGliffyTemplate",label:c.title})},error:function(f,e,d){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openGliffyTemplate",label:"fail"});GLIFFY.onlineUtils.handleDiagramActionError(f,e,d,$.i18n._("online.welcome.template.error"),true)}})},shouldShowRecentDiagrams:Ember.computed(function(){return GLIFFY.PLUGINS.pluginManager.getDefaultContext()==="gliffyDrivePlugin"}).property()});GliffyApp.welcomeTemplate=Ember.Object.extend({title:null,image:null,id:null,urls:{thumbnail:null,open:null,update:null},"read-only":false});GliffyApp.welcomeScreenController=GliffyApp.WelcomeScreenController.create()}());(function(){GliffyApp.TemplateBrowserController=Ember.Controller.extend({createNewTab:true,actions:{open:function(){this.handleDoubleClickItem()}},show:function(){this.createNewTab=!GLIFFY.FEATURES.browserTabs;$("#gliffy-modal-template-browser").modal("show");GliffyApp.documentListController.clear();GliffyApp.documentListController.setContainer($(".gliffy-template-browser .gliffy-document-list-container"));GliffyApp.documentListController.setListLayout(false);GliffyApp.accountFoldersController.allowDelete=false;var d=$(".gliffy-template-browser").find(".gliffy-account-folders-container");var c=$.url().param("templateId");d.hide();Promise.all([GliffyApp.accountFoldersController.loadTemplates(d),GliffyApp.accountFoldersController.loadFolderTree(d)]).then(function(e){return GliffyApp.accountFoldersController.constructFolderStucture({data:[e[0].data[0],e[1].data[0]]})}).then(function(e){if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.OnboardingStepTwoChange&&window.optimizely.GHAX.OnboardingStepTwoChange.showStepTwoChange===true){e[0]=5005}else{if(c){e[0]=c}}$(".gliffy-template-browser .gliffy-account-folders-container > ul > li > a").css("font-weight","bold");GliffyApp.accountFoldersController.selectFolder("#"+e);GliffyApp.accountFoldersController.openFolder("#"+e);GliffyApp.accountFoldersController.showSelectionBar()})},hide:function(){$("#gliffy-modal-template-browser").modal("hide")},handleCreate:function(e){var c=this,d=e.data("gliffy-create-type");if(d==="template"){this.hide();GliffyApp.templateBrowserController.show()}else{GLIFFY.editor.createUntitledTab(function(){c.hide()})}},openTemplate:function(f){var d=this,e,c;GLIFFY.API.GET(f.urls.open,{isUrl:true,success:function(g){GLIFFY.editor.open({jsonObj:g});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"templateBrowser",action:"openGliffyTemplate",label:f.name});d.hide()},error:function(j,h,g){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"templateBrowser",action:"openGliffyTemplate",label:"fail"});GLIFFY.onlineUtils.handleDiagramActionError(j,h,g,$.i18n._("online.welcome.template.error"),true)}});if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.OnboardingStepTwoChange&&window.optimizely.GHAX.OnboardingStepTwoChange.showStepTwoChange===true){if($.cookie("template-opened")&&$.cookie("template-opened")==="false"){$.cookie("template-opened",true,{expires:365,path:"/"});GliffyApp.explicitOnboardingStepsController.set("alternativeStepTwoComplete",true);GLIFFY.analyticsUtils.logMixpanelEvent("onboardingStepTwo",{$email:GliffyApp.authController.getUsername(),action:"Template"});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"ExplicitOnboardingSteps",action:"onboardingStepTwoTemplate"})}}},handleFolderClick:function(c){if(c.showOnlyPublic){var d=GliffyApp.authController.getAccountId();GliffyApp.documentListController.load("folder_public_diagrams.json",{folderId:c.id,accountId:d},12)}else{GliffyApp.documentListController.load("folder_diagrams.json",{folderId:c.id},12)}},handleDoubleClickItem:function(){GliffyApp.documentListController.handleDoubleClickItem()},handleDocumentListScroll:function(c){GliffyApp.documentListController.scroll(c)},handleDocumentListScrollStart:function(c){GliffyApp.documentListController.scrollStart(c)},handleDocumentListScrollEnd:function(c){GliffyApp.documentListController.scrollEnd(c)}});GliffyApp.templateBrowserController=GliffyApp.TemplateBrowserController.create()}());(function(){GliffyApp.LoginSignupController=Ember.Controller.extend({user:null,modalBackdropState:"default",canCloseModal:true,init:function(){this.__signupModal=GliffyApp.ResumingModalController.create({modalSelector:"#gliffy-login-signup-modal"});this.__loginModal=GliffyApp.ResumingModalController.create({modalSelector:"#gliffy-login-signup-modal"})},actions:{handleLoginClick:function(){this.handleLoginClick()},handleSignupClick:function(){this.signUp()},handleForgotPassword:function(){window.open("/go/ologin/password/forgot?app=1b5094b0-6042-11e2-bcfd-0800200c9a66&email="+encodeURIComponent($("#gliffy-login-email").val()),"_blank")},handleGooglePlusLogin:function(){var c=window.open("/go/oauthStart?provider=google&app=1b5094b0-6042-11e2-bcfd-0800200c9a66");c.focus();this.hideEnhancedModals()},handleFacebookLogin:function(){var c=window.open("/go/oauthStart?provider=facebook&app=1b5094b0-6042-11e2-bcfd-0800200c9a66");c.focus();this.hideEnhancedModals()},handleMicrosoftLiveLogin:function(){var c=window.open("/go/oauthStart?provider=microsoft&app=1b5094b0-6042-11e2-bcfd-0800200c9a66");c.focus();this.hideEnhancedModals()},signupLinkClick:function(){this.signupLinkClick()}},hideEnhancedModals:function(){if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.EnhancedModals&&window.optimizely.GHAX.EnhancedModals.showEnhancedModals){GliffyApp.enhancedLoginSignupModalController.hideModal()}},resume:function(){if(this.__signupModal.isModalUp()){this.__signupModal.resume()}if(this.__loginModal.isModalUp()){this.__loginModal.resume()}},resumeExplicit:function(){var c=GliffyApp.loginSignupController;if(c.__signupModal.isModalUp()){c.__signupModal.resume()}if(c.__loginModal.isModalUp()){c.__loginModal.resume()}},handleLoginClick:function(){var c=this;window.GLIFFY.API.POST("login.json",{email:$("#gliffy-login-signup-modal").find(".gliffy-login-email").val(),password:$("#gliffy-login-signup-modal").find(".gliffy-login-password").val()},{success:function(e,f,d){if(e.errors&&e.errors.length>0){if(e.noaccount==true){window.location="/go/noaccount"}GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-signup-modal",e.errors)}else{c.loginAndResume(e);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"loginSuccess"})}if(GliffyApp.authController.account.isTrial){$("body").trigger("updateOnboardingSteps")}},error:function(f,d,e){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-signup-modal",e);console.error("error logging in",f,d,e)},context:this})},loginAndResume:function(c){var d=this;var e=c.defaultAccountId||c.accountId||null;GliffyApp.authController.login(c,e,function(){if(c.isTempPassword){$(d.__loginModal.modalSelector).unbind("hidden.gliffycancel").modal("hide");GliffyApp.tempPasswordController.show(function(){d.resume()})}else{d.resume()}if(GliffyApp.authController.account.isTrial){GliffyApp.explicitOnboardingStepsController.showOnboardingPopup();$("body").trigger("updateOnboardingSteps")}$(window).trigger("gliffy.loginEvent")})},center:function(){this.theModal.css("margin-top","-"+(this.theModal.height()/2)+"px")},signupLinkClick:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"SignIn"});this.showSignup()},showSignup:function(c,d){if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.EnhancedModals&&window.optimizely.GHAX.EnhancedModals.showEnhancedModals){GliffyApp.enhancedLoginSignupModalController.showSignup()}else{this.theModal=$("#gliffy-login-signup-modal");this.__enablePrimaryButtons();this.__signupModal.show(c,d);this.center()}if(typeof GLIFFY.onlineUtils.signupModalTimer!=="undefined"&&GLIFFY.onlineUtils.signupModalTimer){clearTimeout(GLIFFY.onlineUtils.signupModalTimer)}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"lzxclient",action:"View Sign Up",label:window.location.pathname});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"viewSignUp",label:window.location.pathname})},resetForms:function(){$("#gliffy-login-email").val("");$("#gliffy-login-password").val("");$("#gliffy-signup-fullname").val("");$("#gliffy-signup-email").val("");$("#gliffy-signup-password").val("");$("#gliffy-signup-confirm").val("");$("#gliffy-signup-organization-size").val("");$("#gliffy-signup-accept-terms").attr("checked",false);$("#gliffy-login-signup-modal .alert-error").hide()},show:function(c,d){this.theModal=$("#gliffy-login-signup-modal");$(".gliffy-modal-instr.registered-instruction").show();this.__enablePrimaryButtons();this.resetForms();if(GliffyApp.authController.isAnonymousAccount()){this.showSignup(c,d)}else{if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.EnhancedModals&&window.optimizely.GHAX.EnhancedModals.showEnhancedModals){GliffyApp.enhancedLoginSignupModalController.showLogin();d()}else{this.__loginModal.show(c,d)}}},signUp:function(){var c=this;c.__disablePrimaryButtons();window.GLIFFY.API.POST("signup.json",{email:$("#gliffy-signup-email").val(),password:$("#gliffy-signup-password").val(),fullName:$("#gliffy-signup-fullname").val(),organizationSize:$("#organizationSizeField").val(),termsAndConditions:$("#gliffy-signup-accept-terms").is(":checked")?"true":""},{success:function(e,h,d){if(e.errors&&e.errors.length>0){$("#gliffy-login-signup-modal .alert").show().children("span").html(GLIFFY.onlineUtils.formatFormError(e.errors));this.__enablePrimaryButtons();c.center()}else{if(window.mixpanel&&typeof window.mixpanel.get_distinct_id==="function"&&typeof window.mixpanel.alias==="function"&&typeof window.mixpanel.identify==="function"&&window.mixpanel.people&&typeof window.mixpanel.people.set==="function"&&typeof window.mixpanel.track==="function"){var g=window.mixpanel.get_distinct_id().toString();if(g.indexOf("-")>-1){window.mixpanel.alias(e.uid)}window.mixpanel.identify(e.uid);window.mixpanel.people.set({"$email":e.username,"$created":new Date(),product:e.accountUsers[0].productID});window.mixpanel.track("signup",{"$email":GliffyApp.authController.getUsername(),product:e.accountUsers[0].productID})}GliffyApp.trialSignupInviteModalController.newUserSignup=true;var f=window.Experiments;if(f){if(f.ShowRecommendGliffyMenu){if($.cookie("refererId")!==null&&$.cookie("refererId")!==undefined){f.ShowRecommendGliffyMenu.writeInvitedUsersTable($.cookie("refererId"),e.uid)}}}c.loginAndResume(e);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"lzxclient",action:"signUpSuccess",label:window.location.pathname});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"signUpSuccess",label:window.location.pathname});if((typeof chrome!=="undefined")&&chrome.app.isInstalled){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"signUpSuccessChromeAppUser",label:window.location.pathname})}window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];window.optimizely.push(["trackEvent","signUpSuccess"]);if(GliffyApp.authController.account.isTrial){GliffyApp.explicitOnboardingStepsController.showOnboardingPopup();$("body").trigger("updateOnboardingSteps")}}},error:function(f,d,e){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-signup-modal",e);c.center();console.error("error logging in",f,d,e);c.__enablePrimaryButtons()},context:this})},__disablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",true);this.theModal.find(".gliffy-save-spinner").show()},__enablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",false);this.theModal.find(".gliffy-save-spinner").hide()}});GliffyApp.loginSignupController=GliffyApp.LoginSignupController.create()}());(function(){GliffyApp.loginWelcomeController=Ember.Object.create({actions:{handleLoginClick:function(){this.handleLoginClick.apply(this,arguments)}},__loginModal:null,onLogin:null,init:function(){},show:function(c,d){if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.EnhancedModals&&window.optimizely.GHAX.EnhancedModals.showEnhancedModals){GliffyApp.enhancedLoginSignupModalController.showRequiredLogin()}else{this.onLogin=null;if(c){this.onLogin=c}this.__loginModal=$("#gliffy-login-modal");this.__loginModal.modal("show");if(window.GLIFFY.ENV.loginEmail){this.__loginModal.find(".gliffy-login-email").val(window.GLIFFY.ENV.loginEmail);this.__loginModal.find(".gliffy-login-password").focus()}else{this.__loginModal.find(".gliffy-login-email").focus()}}if(typeof GLIFFY.onlineUtils.signupModalTimer!=="undefined"&&GLIFFY.onlineUtils.signupModalTimer){clearTimeout(GLIFFY.onlineUtils.signupModalTimer)}},hide:function(){this.__loginModal.modal("hide")},showWelcomeScreen:function(){this.__loginModal.modal("hide");if(this.onLogin!==null){this.onLogin()}else{if(window.GLIFFY.ENV.newDiagramUrl&&window.GLIFFY.ENV.newDiagramUrl.indexOf(window.location.pathname)>-1){GliffyApp.templateBrowserController.show()}else{GliffyApp.welcomeScreenController.show()}}},handleLoginClick:function(d){var c=this;window.GLIFFY.API.POST("login.json",{email:this.__loginModal.find(".gliffy-login-email").val(),password:this.__loginModal.find(".gliffy-login-password").val(),folderId:(window.GLIFFY.ENV.newDiagramFolderId||null)},{success:function(f,g,e){if(f.errors&&f.errors.length>0){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-modal",f.errors)}else{c.loginAndResume(f);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"loginSuccess"})}},error:function(g,e,f){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-modal",f);console.error("error logging in",g,e,f)},context:this})},loginAndResume:function(c){var d=this;GliffyApp.authController.login(c,c.accountId||null,function(){if(c.isTempPassword){d.hide();GliffyApp.tempPasswordController.show(function(){d.showWelcomeScreen()})}else{d.showWelcomeScreen()}})}})}());(function(){GliffyApp.CollaborationController=GliffyApp.AbstractModalController.extend({masterCollaboratorList:null,newCollaboratorList:null,accountUserList:null,collaboratorCountHtml:0,diagramUrl:null,diagramId:0,diagramTitle:null,EMAIL_VERIFY_STATE:"email-verify",MAIN_STATE:"main",LOADING_STATE:"loading",UPGRADE_STATE:"upgrade",actions:{verifyEmailSubmit:function(){this.verifyEmail($("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").val())},resendLinkClick:function(){this.resendVerifyEmail()},learnMoreClick:function(){},upgrade:function(){GliffyApp.authController.openUpgrade("collaborate")},closeAlert:function(){$("#gliffy-collaboration-modal .alert-floating").hide()},handleRemoveUser:function(c){this.removeCollaborator(c,this.diagramId)},share:function(c){window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];window.optimizely.push(["trackEvent","collaboratorClickedInviteBtn"]);this.addCollaborators($("#gliffy-collaboration-modal textarea").val(),$("#gliffy-collaboration-modal .gliffy-collaboration-state-main input").get(0).checked)}},show:function(c,d){if(c){this.diagramId=c;this.diagramTitle=d}else{this.diagramId=window.GLIFFY.editor.getDocumentManager().getActiveDocument().getUrls().id;this.diagramTitle=window.GLIFFY.editor.getDocumentManager().getActiveDocument().getTitle()}this.theModal=$("#gliffy-collaboration-modal");this.theModal.find(".gliffy-manage-users-permissions").hide();this.reset();this.theModal.modal("show");if(GliffyApp.authController.get("propIsFreeAccount")){this.__showState(this.UPGRADE_STATE)}else{if(GliffyApp.authController.isConfirmed()){this.__getAccountUserList()}else{this.__showState(this.EMAIL_VERIFY_STATE)}}},reset:function(){var c=window.location.protocol+"//"+window.location.host;this.__showState(this.LOADING_STATE);this.theModal.find(".alert-floating").hide();this.__hideListUIBlocker();this.__enablePrimaryButtons();this.accountUserList=[];this.set("collaboratorCountHtml",0);this.__populateCollaboratorsModel("newCollaboratorList",{collaborators:[]});this.set("diagramUrl",c+"/go/html5/"+this.diagramId)},addCollaborators:function(g,d){var c,f;g=g.split(" ").join("");g=g.split("\r").join("");g=g.split("\n").join("");if(this.__validateEmailList(g)){f=this.__getCleanEmailList(g);if(f.length>1){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"collaborate",action:"multipleEmails",value:f.length})}for(c=0;c<f.length;c++){var e=GliffyApp.CollaboratorModel.create();e.set("email",f[c]);e.set("isViewer",d);e.set("isCollaborator",!d);e.set("isOwner",false);this.newCollaboratorList.pushObject(e)}this.__persistCollaboratorList()}},removeCollaborator:function(g,d,c,f){var e=this;if(this.theModal){e.__showListUIBlocker()}window.GLIFFY.API.DELETE("diagram/"+d+"/collaborator/"+g.id,{query:{},success:function(j,k,h){if(c){c(j,k,h)}else{e.__hideListUIBlocker();e.masterCollaboratorList.removeObject(g)}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"collaborate",action:"removeSuccess"});GLIFFY.analyticsUtils.logMixpanelEvent("uncollaborate",{diagramId:GliffyApp.documentModel.id});if(typeof mktoMunchkinFunction=="function"&&GliffyApp.authController.getMunchkinKey()){mktoMunchkinFunction("visitWebPage",{url:"/go/application/uncollaborate"})}if(GliffyApp.authController.account.isTrial){$("body").trigger("updateOnboardingSteps")}},error:function(k,h,j){j=GLIFFY.onlineUtils.handleDiagramActionError(k,h,j,"Failed to remove collaborator.",false);if(f){f(k,h,j)}else{e.__hideListUIBlocker();e.__displayErrorMessage(e.MAIN_STATE,"Failed to remove collaborator. "+j)}console.error("error removing collaborator",k,h,j)},context:this})},verifyEmail:function(d){var c=this;this.__disablePrimaryButtons();window.GLIFFY.API.PUT("user/verifyEmail",null,{query:{confCode:d},success:function(e){GliffyApp.authController.setIsConfirmed(true);c.__enablePrimaryButtons();c.show();if(GliffyApp.authController.account.isTrial){$("body").trigger("updateOnboardingSteps")}},error:function(g,f,e){c.__enablePrimaryButtons();c.__displayErrorMessage(c.EMAIL_VERIFY_STATE,"Failed to verify email with confirmation code. Please enter a valid confirmation code.");console.error("error verifying confirmation code",g,status,e)},context:this})},resendVerifyEmail:function(){var c=this;window.GLIFFY.API.GET("user/resendVerification",{query:{app:window.GLIFFY.ENV.app},success:function(e,f,d){c.__displaySuccessMessage(c.EMAIL_VERIFY_STATE,"Verification email sent to "+e+".")},error:function(f,d,e){c.__displayErrorMessage(c.EMAIL_VERIFY_STATE,"Failed to send verification email.");console.error("error loading collaborator list",f,d,e)},context:this})},__displaySuccessMessage:function(d,c,f){var e=this.theModal.find(".gliffy-collaboration-state-"+d+" .alert-floating");e.removeClass("alert-error").addClass("alert-success").find("span").html(c);e.show();if(f){setTimeout(function(){e.fadeOut(1000)},f)}},__displayErrorMessage:function(d,c){var e=this.theModal.find(".gliffy-collaboration-state-"+d+" .alert-floating");e.removeClass("alert-success").addClass("alert-error").find("span").html(c);e.show()},__showState:function(c){$("[class*='gliffy-collaboration-state-']").hide();$(".gliffy-collaboration-state-"+c).show();if(c===this.EMAIL_VERIFY_STATE){this.setTitle("Confirm Your Email");this.setSize(600,320);$("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").focus();$("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").val("")}else{this.setTitle("Collaborate");if(c===this.UPGRADE_STATE){this.setSize(this.theModal.css("max-width"),210)}else{this.setSize(this.theModal.css("max-width"),this.theModal.css("max-height"))}}},__persistCollaboratorList:function(){var c=this;this.__disablePrimaryButtons();window.GLIFFY.API.PUT("diagram/"+this.diagramId+"/collaborators.json",{master:this.masterCollaboratorList.toObject().collaborators,"new":this.newCollaboratorList.toObject().collaborators},{query:{accountId:GliffyApp.authController.getAccountId(),app:GLIFFY.ENV.app},success:function(d){c.__displaySuccessMessage("main","<b>Done!</b> Your invitation has been sent!",4000);c.__enablePrimaryButtons();$("#gliffy-collaboration-modal textarea").val("");c.__getCollaboratorList();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"collaborate",action:"addSuccess"});GLIFFY.analyticsUtils.logMixpanelEvent("collaborate",{diagramId:GliffyApp.documentModel.id});if(typeof mktoMunchkinFunction=="function"&&GliffyApp.authController.getMunchkinKey()){mktoMunchkinFunction("visitWebPage",{url:"/go/application/collaborate"})}if(GliffyApp.authController.account.isTrial){$("body").trigger("updateOnboardingSteps")}c.newCollaboratorList.clear()},error:function(f,e,d){c.newCollaboratorList.clear();c.__enablePrimaryButtons();d=GLIFFY.onlineUtils.handleDiagramActionError(f,e,d,"Failed to add collaborator.",false);c.__displayErrorMessage(c.MAIN_STATE,"Failed to add collaborator. "+d)},context:this})},__disablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",true);this.theModal.find(".gliffy-save-spinner").show()},__enablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",false);this.theModal.find(".gliffy-save-spinner").hide()},__showListUIBlocker:function(){this.theModal.find(".gliffy-processing-list-ui-blocker").css("left",0)},__hideListUIBlocker:function(){this.theModal.find(".gliffy-processing-list-ui-blocker").css("left",5000)},__getAccountUserList:function(){var c=this;window.GLIFFY.API.GET("account/users.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,f,d){if(e.users){c.accountUserList=e.users}c.__getCollaboratorList()},error:function(f,d,e){c.__displayErrorMessage(c.LOADING_STATE,"Error getting account user list. "+e+"<br/>Please contact support@gliffy.com if problem persists.");console.error("error loading account user list",f,d,e)},context:this})},__getCollaboratorList:function(){var c=this;this.__showListUIBlocker();window.GLIFFY.API.GET("diagram/"+this.diagramId+"/listCollaborators.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,f,d){c.__showState("main");c.__populateCollaboratorsModel("masterCollaboratorList",e);c.__updateCountDisplay();$("#gliffy-collaboration-modal textarea").focus();$("#gliffy-collaboration-modal textarea").val("");c.__hideListUIBlocker()},error:function(f,d,e){console.log("ERROR!");e=GLIFFY.onlineUtils.handleDiagramActionError(f,text,e,"Error getting collaborator list.",false);c.__displayErrorMessage(c.LOADING_STATE,"Error getting collaborator list. "+e+"<br/>Please contact support@gliffy.com if problem persists.");c.__hideListUIBlocker();console.error("error loading collaborator list",f,d,e)},context:this})},__populateCollaboratorsModel:function(d,e){var c=GliffyApp.CollaboratorsModel.create();c.fromObject(e);this.set(d,c)},__updateCountDisplay:function(){var c=this.get("masterCollaboratorList").content.length;if(c>1){this.set("collaboratorCountHtml",""+c+" Collaborators")}else{this.set("collaboratorCountHtml","1 Collaborator")}},__validateEmailList:function(e){var c,d,f=[];if(e===""){return false}d=e.split(",");for(c=0;c<d.length;c++){if(!window.GLIFFY.onlineUtils.isValidEmail(d[c])){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"collaborate",action:"invalidEmailEntry"});this.__displayErrorMessage(this.MAIN_STATE,d[c]+" is an invalid email");return false}}return true},__getCleanEmailList:function(e){var c,d=e.split(","),f=[];for(c=0;c<d.length;c++){if(this.__collaboratorExists(d[c])){continue}if(!($.inArray(d[c],f)>-1)){f[f.length]=d[c]}}return f},__collaboratorExists:function(e){var f,d=this.masterCollaboratorList.content,c=this.n;for(f=0;f<d.length;f++){if(d[0].email===e){return true}}return false},__collaboratorIsInAccount:function(c){var d;for(d=0;d<this.accountUserList.length;d++){if(c===this.accountUserList[d].email){return true}}return false}});GliffyApp.collaborationController=GliffyApp.CollaborationController.create()}());(function(){GliffyApp.PublishController=GliffyApp.AbstractModalController.extend({webPageUrl:null,imageUrl:null,embedCode:null,showUpgrade:false,IMAGE_SIZE_LARGE:null,IMAGE_SIZE_MEDIUM:null,IMAGE_SIZE_SMALL:null,IMAGE_SIZE_THUMBNAIL:null,__publishCallback:null,__createdSocialButtons:false,auth:GliffyApp.authController,actions:{upgrade:function(){this.auth.openUpgrade("publish")},closeAlert:function(){this.theModal.find(".alert-floating").hide()},publish:function(){this.doPublish()},unpublish:function(){this.doUnpublish()}},config:function(){this.IMAGE_SIZE_LARGE=$.i18n._("online.publish.link.image.large");this.IMAGE_SIZE_MEDIUM=$.i18n._("online.publish.link.image.medium");this.IMAGE_SIZE_SMALL=$.i18n._("online.publish.link.image.small");this.IMAGE_SIZE_THUMBNAIL=$.i18n._("online.publish.link.image.thumbnail")},show:function(c){this.__publishCallback=c;this.theModal=$("#gliffy-publish-modal");this.theModal.modal("show");this.reset()},reset:function(){var e=this;var c=this.webPageUrl;var d=GliffyApp.documentModel.isPublic&&"public"||"private";var f="input[name=gliffy-published-radio-group][value="+d+"]";this.theModal.find(f).prop("checked",true);var g=window.location.protocol+"//"+window.location.host+"/go/publish/"+GliffyApp.documentModel.id;this.set("webPageUrl",g);this.handleImageSizeSelect(this.IMAGE_SIZE_LARGE);if(GliffyApp.documentModel.isPublic&&this.webPageUrl!==c){e.__destroySocialButtons();e.__createSocialButtons()}e.theModal.find("textarea").text(e.__generateEmbedCode(e.IMAGE_SIZE_LARGE));e.toggleUpgradeMessage(false)},handleImageSizeSelect:function(e){this.theModal.find(".gliffy-publish-images-share button:first-child").html(e);var d=this.theModal.find('.gliffy-publish-images-share ul li a[name="'+e+'"]').attr("code");var c=window.location.protocol+"//"+window.location.host+"/go/publish/image/"+GliffyApp.documentModel.id+"/"+d+".png";this.set("imageUrl",c);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"publish",action:"diagramUrlChange",label:e})},handleSocialPublish:function(c){},toggleUpgradeMessage:function(c){this.set("showUpgrade",c);this.updateModalUI()},updateModalUI:function(){var c=this;if(GliffyApp.documentModel.isPublic){if(this.get("showUpgrade")){this.theModal.find(".gliffy-modal-body-section.public").hide();this.theModal.find(".gliffy-modal-body-section.upgrade").show();this.setHeight(255,true)}else{this.theModal.find(".gliffy-modal-body-section.public").show();this.theModal.find(".gliffy-modal-body-section.upgrade").hide();this.resetSize(true);setTimeout(function(){if(!c.__createdSocialButtons){c.__destroySocialButtons();c.__createSocialButtons()}},500)}}else{this.theModal.find(".gliffy-modal-body-section.public").hide();this.theModal.find(".gliffy-modal-body-section.upgrade").hide();this.setHeight(160,true)}},doPublish:function(){var c=this;c.showUIBlocker();window.GLIFFY.API.PUT("diagram/"+GliffyApp.documentModel.id+"/publish",null,{query:{},success:function(d){c.hideUIBlocker();GliffyApp.documentModel.set("isPublic",true);if(window.GLIFFY.editor){window.GLIFFY.editor.getDocumentManager().getActiveDocument().getUrls().isPublic=true}c.reset();if(c.__publishCallback!==undefined){c.__publishCallback()}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"publish",action:"publishClick",label:c.auth.getProductType()});GLIFFY.analyticsUtils.logMixpanelEvent("publish",{diagramId:GliffyApp.documentModel.id})},error:function(f,e,d){c.hideUIBlocker();c.reset();d=GLIFFY.onlineUtils.handleDiagramActionError(f,e,d,"Failed to publish your diagram.",false);c.__displayErrorMessage(d+"<br/>Please contact support@gliffy.com if the problem persists.");console.error("Failed to publish your diagram",f,status,d)},context:this})},doUnpublish:function(){var c=this;if(this.auth.get("propIsFreeAccount")){this.toggleUpgradeMessage(true)}else{this.showUIBlocker();window.GLIFFY.API.PUT("diagram/"+GliffyApp.documentModel.id+"/unpublish",null,{query:{},success:function(d){c.hideUIBlocker();GliffyApp.documentModel.set("isPublic",false);if(window.GLIFFY.editor){window.GLIFFY.editor.getDocumentManager().getActiveDocument().getUrls().isPublic=false}c.reset();if(c.__publishCallback!==undefined){c.__publishCallback()}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"publish",action:"privateClick",label:c.auth.getProductType()});GLIFFY.analyticsUtils.logMixpanelEvent("unpublish",{diagramId:GliffyApp.documentModel.id})},error:function(f,e,d){c.hideUIBlocker();d=GLIFFY.onlineUtils.handleDiagramActionError(f,e,d,"Failed to un-publish your diagram.",false);c.__displayErrorMessage(d+"<br/>Please contact support@gliffy.com if the problem persists.");console.error("error unpublishing the diagram",f,status,d)},context:this})}},__createSocialButtons:function(){var d=this;var f,e,k="",c,j;var h=this.webPageUrl;var g=encodeURIComponent(this.webPageUrl);if(!this.__createdSocialButtons){$("body").append($('<div id="fb-root"></div><script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "'+window.location.protocol+'//connect.facebook.net/en_US/all.js#xfbml=1&status=0";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk"));<\/script>'));e='<a href="'+this.__getTwitterHref(g)+'"><span></span></a>';$(".gliffy-publish-twitter").append($(e));k='<script src="'+window.location.protocol+'//platform.linkedin.com/in.js" type="text/javascript"><\/script><script type="IN/Share" data-url="'+h+'"><\/script>';$(".gliffy-publish-linkedin").append(k);$(".gliffy-publish-linkedin").on("click",function(){d.__tracksSocialButtonClick("linkedin")});j='<a data-pin-config="none" target="_blank" href="'+this.__getPinterestHref(g)+'" data-pin-do="buttonPin" ><img src="'+window.location.protocol+'//assets.pinterest.com/images/pidgets/pin_it_button.png" /></a><script type="text/javascript" src="'+window.location.protocol+'//assets.pinterest.com/js/pinit.js"><\/script>';$(".gliffy-publish-pinterest").append(j);setTimeout(function(){$(".gliffy-publish-pinterest a").click(function(){d.__tracksSocialButtonClick("pinterest")});$(".gliffy-publish-twitter a").on("click",function(l){d.__tracksSocialButtonClick("twitter");l.preventDefault();window.open(d.__getTwitterHref(encodeURIComponent(d.webPageUrl)),"_blank","width=550,height=450")});if(FB){FB.Event.subscribe("edge.create",function(l){d.__tracksSocialButtonClick("facebook")})}},1000)}else{$(".gliffy-publish-linkedin script").attr("data-url",h);$(".gliffy-publish-pinterest a").attr("href",this.__getPinterestHref(g));$(".gliffy-publish-twitter a").attr("href",this.__getTwitterHref(g))}if(GLIFFY.FEATURES.browserTabs){f='<fb:like href="'+h+'" send="false" layout="button_count" width="450" show_faces="true"></fb:like>'}else{f=$('<iframe src="'+window.location.protocol+"//www.facebook.com/plugins/like.php?href="+g+'&amp;send=false&amp;layout=button_count&amp;width=450&amp;show_faces=false&amp;font=arial&amp;colorscheme=light&amp;action=like&amp;height=22" scrolling="no" frameborder="0" style="border:none; overflow:visible; width:47px; height:22px;" allowTransparency="true"></iframe>')}$(".gliffy-publish-facebook").append(f);c='<div class="g-plusone" data-size="medium" data-annotation="none" data-href="'+h+'" data-callback="plusOneClick"></div><script type="text/javascript">function plusOneClick(response) {    GliffyApp.publishController.__tracksSocialButtonClick("google");}(function() {var po = document.createElement("script"); po.type = "text/javascript"; po.async = true;po.src = "'+window.location.protocol+'//apis.google.com/js/plusone.js";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(po, s);})();<\/script>';$(".gliffy-publish-google").append(c);this.__createdSocialButtons=true},__tracksSocialButtonClick:function(c){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"publish",action:"socialButtonClick",label:c});GLIFFY.analyticsUtils.logMixpanelEvent("social",{channel:c,diagramId:GliffyApp.documentModel.id})},__getPinterestHref:function(c){return window.location.protocol+"//pinterest.com/pin/create/button/?url="+c+"&media="+encodeURIComponent(this.imageUrl)+"&description=Check%20out%20my%20Gliffy%20Diagram:%20"+encodeURIComponent(GliffyApp.documentModel.title)},__getTwitterHref:function(c){return window.location.protocol+"//twitter.com/share?via=gliffy&url="+c+"&text=Check%20out%20my%20Gliffy%20Diagram:%20"+encodeURIComponent(GliffyApp.documentModel.title)},__destroySocialButtons:function(){$(".gliffy-publish-facebook").empty();$(".gliffy-publish-google").empty()},__generateEmbedCode:function(e,d,c){return('<script src="'+window.location.protocol+'//www.gliffy.com/diagramEmbed.js" type="text/javascript"><\/script><script type="text/javascript">gliffy_did="'+GliffyApp.documentModel.id+'";embedGliffy();<\/script>')}});GliffyApp.publishController=GliffyApp.PublishController.create()}());(function(){GliffyApp.AccountManageController=Ember.Controller.extend({USER_ROLE_ADMIN:"ADMIN",USER_ROLE_USER:"USER",accountUsers:null,accountUserNumber:null,accountMaxUsers:null,remainingDiagrams:null,remainingUsers:null,errorMessages:null,emailErrorMessages:null,emailUpdateSuccess:false,theModal:null,accountHistory:null,infoUpdateSuccess:false,changeEmail:null,changeAccountName:null,accountNameErrors:null,accountNameUpdateSuccess:false,showErrors:false,showEmailErrors:false,showAccountNameErrors:false,oldPassword:null,password1:null,password2:null,__tabIdToOpenOnLoad:null,init:function(){this.accountUsers=Ember.A([]);this.errorMessages=Ember.A([]);this.cancelReasons=Ember.A([]);this.accountNameErrors=Ember.A([])},populate:function(){this.loadBasic();this.loadUsers();GliffyApp.authController.fetchUser()},showEditorPurchasePageTab:function(){this.setTab("#account-editor-purchase-page-container")},showPurchaseSuccessTab:function(){this.setTab("#account-editor-purchase-page-success-container")},showEditorStripePurchasePageTab:function(){this.setTab("#account-editor-stripe-purchase-page-container")},showStripePurchaseSuccessTab:function(){this.setTab("#account-editor-stripe-purchase-page-success-container")},actions:{showAccountModal:function(){this.show()},showUpdate:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"/event/gliffy/upgrade",action:"viewAccountManageUpgradeTab"});this.setTab("#account-upgrade")},showTestTemplate:function(){this.setTab("#account-upgrade-test")},getInvoice:function(c){window.open("/go/api/account/invoice?accountId="+GliffyApp.authController.account.id+"&invoiceId="+c.get("id")+"&dataSource="+c.get("dataSource"),"_blank")},closePIAlert:function(){this.hidePIAlerts()},submitEMailChange:function(){var c=this;c.clearErrors();c.hidePIAlerts();GLIFFY.API.POST("user/changeEmail",{email:c.get("changeEmail")},{success:function(g,h,f){if(g.errors&&g.errors.length>0){for(var e=0;e<g.errors.length;e++){var d=GliffyApp.errorMsg.create({key:g.errors[e].key,message:g.errors[e].message});c.emailErrorMessages.pushObject(d)}c.set("showEmailErrors",true)}else{c.set("emailUpdateSuccess",true)}c.accountLoad();GliffyApp.authController.fetchUser()},error:function(f,e,d){var e=GliffyApp.ACMErrorMessage.create({fieldName:null,errorMsg:"The server encountered an error. Please try again later or contact support@gliffy.com"})}})},submitPasswordChange:function(){this.ga("piChangeSubmit","");var c=this;c.clearErrors();c.hidePIAlerts();GLIFFY.API.POST("user/changeUserPassword",{oldPassword:c.get("oldPassword"),password1:c.get("password1"),password2:c.get("password2")},{success:function(g,h,f){if(g.errors&&g.errors.length>0){for(var e=0;e<g.errors.length;e++){var d=GliffyApp.errorMsg.create({key:g.errors[e].key,message:g.errors[e].message});c.errorMessages.pushObject(d)}c.set("showErrors",true)}else{c.set("infoUpdateSuccess",true)}c.clearPassForm()},error:function(f,e,d){var e=GliffyApp.ACMErrorMessage.create({fieldName:null,errorMsg:"The server encountered an error. Please try again later or contact support@gliffy.com"})}})},unlinkGoogleDrive:function(){var c=this;GLIFFY.API.GET("user/unlinkGoogleDrive",{success:function(e,f,d){GLIFFY.PLUGINS.pluginManager.setDefaultContext("gliffyDrivePlugin");GLIFFY.PLUGINS.pluginManager.setCurrentDocumentContext("gliffyDrivePlugin");GLIFFY.PLUGINS.pluginManager.updateUIForCurrentDocumentContext();GLIFFY.editor.getDocumentManager().getActiveDocument().setCurrentRevision(0);GLIFFY.editor.getDocumentManager().getActiveDocument().setTitle("untitled");GLIFFY.editor.getDocumentManager().getActiveStage().setUnsavedChanges(true);GLIFFY.onlineUtils.setLocation(window.GLIFFY.constants.LAUNCH_URL);GLIFFY.PLUGINS.storage.googleDrivePlugin.token=null;GliffyApp.authController.unlinkGoogleDriveFromAccount();c.populate()}})},launchVerify:function(){GliffyApp.verifyEmailController.show()},submitAccountNameChange:function(){var c=this;c.clearErrors();c.hidePIAlerts();GLIFFY.API.POST("account/changeName",{accountname:c.get("changeAccountName"),accountId:GliffyApp.authController.getAccountId()},{success:function(g,h,f){if(g.errors&&g.errors.length>0){for(var e=0;e<g.errors.length;e++){var d=GliffyApp.errorMsg.create({key:g.errors[e].key,message:g.errors[e].message});c.accountNameErrors.pushObject(d)}c.set("showAccountNameErrors",true)}else{c.set("accountNameUpdateSuccess",true)}c.accountLoad();GliffyApp.authController.get("account").fetch()},error:function(f,e,d){var e=GliffyApp.ACMErrorMessage.create({fieldName:null,errorMsg:"The server encountered an error. Please try again later or contact support@gliffy.com"})}})},upgradeClick:function(){GliffyApp.authController.openUpgrade()},closeAlert:function(){this.hideManageUsersErrorMessage()},handleAddClick:function(){this.addUsers()},handleRemoveUser:function(c){this.removeUser(c)},handleAdminClick:function(c){this.updateUserAdminStatus(c,!c.get("isAdmin"))},showAccountUsersUpgradeModal:function(){this.showAccountUsersUpgradeModal()},cancel:function(){this.cancel()}},ga:function(c,d){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:c,label:d})},loadBasic:function(){var c=this;var d=0;GliffyApp.authController.fetchAccount(function(){d=GliffyApp.authController.propAccountMaxDiagrams-GliffyApp.authController.getAccountDiagrams();if(d<0){d=0}c.set("remainingDiagrams",d);if(c.__tabIdToOpenOnLoad){c.setTab(c.__tabIdToOpenOnLoad)}})},hasRemainingUsers:Ember.computed(function(){return(this.get("remainingUsers")>0)}).property("remainingUsers"),accountLoad:function(){this.loadBasic();this.loadHistory()},show:function(c){this.set("infoUpdateSuccess",false);this.set("showErrors",false);this.ga("showModal","");this.set("changeEmail",GliffyApp.authController.getUsername());this.set("changeAccountName",GliffyApp.authController.getAccountName());var d=this;this.theModal=$("#gliffy-account-modal");this.__enablePrimaryButtons();this.hideManageUsersErrorMessage();this.theModal.find(".gliffy-manage-users-add-textarea").val("");d.populate();d.setTab("#account-settings");$(".first-menu").addClass("open-pill-account");this.theModal.find(".cancel").click(function(){d.cancel()});if(typeof c==="function"){this.theModal.on("shown",function(){setTimeout(function(){c()},200)})}this.loadReasons();this.accountLoad();if(GliffyApp.accountUpgradeBusinessTeamDealController){GliffyApp.accountUpgradeBusinessTeamDealController.set("inAppBusinessTeamPricing",window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.BusinessTeamDeal&&window.optimizely.GHAX.BusinessTeamDeal.promoHash&&window.optimizely.GHAX.BusinessTeamDeal.promoHash.length>0)}GLIFFY.analyticsUtils.logMixpanelEvent("accountManagement",{});this.theModal.modal("show")},showAccountUsersModal:function(){var c=this;this.show(function(){GliffyApp.accountManageController.setTab("#gliffy-account-users");c.__hideUserListUIBlocker();window.segmentUtils.segmentTracking(true,!GliffyApp.authController.account.isTrial)})},showAccountUsersUpgradeModal:function(){var c=this;this.show(function(){GliffyApp.accountManageController.setTab("#account-upgrade");c.__hideUserListUIBlocker()})},setTab:function(c){if(!$(c).length){this.__tabIdToOpenOnLoad=c}else{this.__tabIdToOpenOnLoad=null}this.ga("modalNav",c);$(".open-pill-account").removeClass("open-pill-account");$("#gliffy-account-modal .contentbox div").removeClass("open-content-account");$("#gliffy-account-modal .contentbox "+c).addClass("open-content-account");$("#gliffy-account-modal .menubox li."+c.substring(1)+" a").addClass("open-pill-account");if(!this.theModal.find(".gliffy-btn-primary").attr("disabled")){this.theModal.find(".gliffy-save-spinner").hide()}$("#gliffy-account-modal").removeClass("expand taller-box");if(c==="#account-upgrade"){$("#gliffy-account-modal").addClass("expanded")}else{if(c==="#account-upgrade-business-team-deal"){$("#gliffy-account-modal").addClass("expand taller-box")}else{if(c==="#gliffy-account-users"){window.segmentUtils.segmentTracking(true,true)}}}},cancel:function(){this.ga("closeModal","cancel");$("#gliffy-account-modal").modal("hide");$("#gliffy-account-modal .cancel").unbind("click")},loadUsers:function(){var c=this;this.__showUserListUIBlocker();GLIFFY.API.GET("account/users.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,g,d){c.set("accountMaxUsers",e.max_users);var f=e.max_users-e.users.length;if(f<0){f=0}c.set("remainingUsers",f);c.notifyPropertyChange("remainingUsers");c.populateUsers(e);c.__hideUserListUIBlocker()}})},sendSegmentDataOnCancel:function(c){window.segmentUtils.segmentTracking(true,true)},updateAccountStatus:function(c){setTimeout(function(){GliffyApp.authController.get("billingStatus").refreshStatusAndAccount()},1000)},populateUsers:function(c){var e=this;e.set("accountUsers",Ember.A([]));e.set("accountUserNumber",c.users.length);for(var f=0;f<c.users.length;f++){var d=GliffyApp.AccountUser.create({userId:c.users[f].user_id,email:c.users[f].email,lastToken:c.users[f].last_token,userRole:c.users[f].user_role});e.accountUsers.pushObject(d)}},numberUsersLabel:Ember.computed(function(){return(this.get("accountUserNumber")==1)?"One User":this.get("accountUserNumber")+" users"}).property("accountUserNumber"),removeUser:function(d){var c=this;$("#gliffy-account-modal").modal("hide");GLIFFY.Dialog.showYesNoDialog({title:$.i18n._("online.account.user.remove.title"),content:$.i18n._("online.account.user.remove.confirm",[d.email]),cancelCallback:null,buttons:[{text:$.i18n._("online.modal.cancel"),callback:function(f){$("#gliffy-account-modal").modal("show")},primary:false,dismiss:true},{text:$.i18n._("online.modal.remove"),callback:function(f){$("#gliffy-account-modal").modal("show");c.__removeUser(d)},primary:true,dismiss:true}]})},__removeUser:function(d){var c=this;this.__showUserListUIBlocker();window.GLIFFY.API.DELETE("account/user",{query:{userId:d.userId,accountId:GliffyApp.authController.getAccountId()},success:function(f,g,e){c.accountUsers.removeObject(d);c.set("remainingUsers",c.get("remainingUsers")+1);c.__hideUserListUIBlocker();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"removeUser"});if(GliffyApp.authController.account.isTrial){$("body").trigger("updateOnboardingSteps")}},error:function(g,e,f){c.displayManageUsersErrorMessage("Failed to remove user. "+f);c.__hideUserListUIBlocker();console.error("error removing user",g,e,f)},context:this})},addUsers:function(){var m=this,h=[],d=[],j=GliffyApp.authController.getAccountMaxUsers(),c=this.accountUsers.length,l,e=this.theModal.find(".gliffy-manage-users-add-textarea").val(),f,g,k=this.theModal.find(".gliffy-manage-users-experiment-id").val();e=e.split(" ").join("");e=e.split("\r").join("");e=e.split("\n").join("");if(this.__validateEmailList(e)){l=e.split(",");for(g=0;g<l.length;g++){if(c>=j){d[d.length]=l[g]}else{f=GliffyApp.AccountUser.create();f.set("email",l[g]);f.set("userRole","USER");h[h.length]=f}c++}this.__disablePrimaryButtons();this.__persistUserList(h,k,function(){m.loadUsers();var n=m.theModal.find(".gliffy-manage-users-add-textarea").val();if(d.length>0){m.theModal.find(".gliffy-manage-users-add-textarea").val(d.join(", "))}else{m.theModal.find(".gliffy-manage-users-add-textarea").val("")}m.displayManageUsersSuccessMessage("Users added to account",5000);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"manageUsers",action:"addUsers",value:c});if(GliffyApp.trialSignupInviteModalController.newUserSignup){GliffyApp.trialSignupInviteModalController.hide(true,c)}var o=window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.EnhancedModals&&window.optimizely.GHAX.EnhancedModals.showEnhancedModals;var p=window.Experiments&&GliffyApp.enhancedTeamInviteModalController;if(o&&p){GliffyApp.enhancedTeamInviteModalController.showSuccessMessage(n,c)}window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];window.optimizely.push(["trackEvent","InvitedUsers"]);GliffyApp.trialTeamInviteModalController.showSuccessMessage();if(GliffyApp.authController.account.isTrial){$("body").trigger("updateOnboardingSteps")}},function(n){m.displayManageUsersErrorMessage("unable to add users",n);console.error("unable to add users, failure",xhr,n)})}},updateUserAdminStatus:function(d,e){var c=this;this.__showUserListUIBlocker();if(e){d.set("userRole",this.USER_ROLE_ADMIN)}else{d.set("userRole",this.USER_ROLE_USER)}this.__persistUserList(null,null,function(){c.__hideUserListUIBlocker();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"makeUserAdmin",label:e});c.loadUsers()},function(){c.__hideUserListUIBlocker();c.displayManageUsersErrorMessage("unable to update admin status",error);console.error("unable to update admin status",xhr,error);c.loadUsers()})},clearPassForm:function(){this.set("oldPassword",null);this.set("password1",null);this.set("password2",null)},hidePIAlerts:function(){this.set("showErrors",false);this.set("showEmailErrors",false);this.set("infoUpdateSuccess",false);this.set("showAccountNameErrors",false);this.set("emailUpdateSuccess",false);this.set("accountNameUpdateSuccess",false)},clearErrors:function(){this.set("errorMessages",Ember.A([]));this.set("emailErrorMessages",Ember.A([]))},displayManageUsersErrorMessage:function(c){var d=this.theModal.find(".gliffy-manage-users-error");d.removeClass("alert-success").addClass("alert-error").find("span").html(c);d.show()},displayManageUsersSuccessMessage:function(c,e){var d=this.theModal.find(".gliffy-manage-users-error");d.removeClass("alert-error").addClass("alert-success").find("span").html(c);d.show();if(e){setTimeout(function(){d.fadeOut(1000)},e)}},hideManageUsersErrorMessage:function(){this.theModal.find(".gliffy-manage-users-error").hide()},__persistUserList:function(d,g,c,f){var e=this;if(d===null){d={users:[]}}window.GLIFFY.API.PUT("account/users.json",{master:this.getAccountUsersAsJson(this.accountUsers).users,"new":this.getAccountUsersAsJson(d).users,experimentId:g},{query:{accountId:GliffyApp.authController.getAccountId(),app:GLIFFY.ENV.app},success:function(h){e.__enablePrimaryButtons();c()},error:function(k,j,h){e.__enablePrimaryButtons();f()},context:this})},__hideUserListUIBlocker:function(){$("#gliffy-account-users .gliffy-processing-list-ui-blocker").hide()},__showUserListUIBlocker:function(){$("#gliffy-account-users .gliffy-processing-list-ui-blocker").show()},__disablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",true);this.theModal.find(".gliffy-save-spinner").show()},__enablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",false);this.theModal.find(".gliffy-save-spinner").hide()},__validateEmailList:function(e){var c,d;if(e===""){return false}d=e.split(",");for(c=0;c<d.length;c++){if(!window.GLIFFY.onlineUtils.isValidEmail(d[c])){this.displayManageUsersErrorMessage(d[c]+" is an invalid email");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"addUsersInvalid",label:d[c]});return false}}return true},getAccountUsersAsJson:function(f){var e,d={},c=[];if(f){for(e=0;e<f.length;e++){c[c.length]=f[e].toJSON()}}d.users=c;return d},loadReasons:function(){var c=this;GLIFFY.API.GET("account/reasons.json",{success:function(e,f,d){c.populateReasons(e)}})},populateReasons:function(e){var c=this;c.set("cancelReasons",Ember.A([]));for(var d=0;d<e.reasons.length;d++){var f=GliffyApp.CancelReason.create({label:e.reasons[d].label,id:e.reasons[d].id});c.cancelReasons.pushObject(f)}},loadHistory:function(){var c=this;GLIFFY.API.GET("account/history.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,f,d){c.populateHistory(e)}})},populateHistory:function(f){var c=this;c.set("accountHistory",Ember.A([]));for(var e=0;e<f.transactions.length;e++){var d=GliffyApp.TransactionHistory.create({id:f.transactions[e].id,payment:f.transactions[e].payment,paymentCurrency:f.transactions[e].payment_currency,status:f.transactions[e].status,transactionDate:f.transactions[e].transaction_date,transactionId:f.transactions[e].transaction_id,dataSource:f.transactions[e].dataSource});c.accountHistory.pushObject(d)}}});GliffyApp.AccountUser=Ember.Object.extend({userId:0,email:null,lastToken:null,userRole:null,isChecked:false,toJSON:function(){return{id:this.get("userId"),email:this.get("email"),user_role:this.get("userRole"),last_token:this.get("lastToken")}},notCurrentUser:Ember.computed(function(){return(Number(this.get("userId"))!==GliffyApp.authController.getUserID())}).property("userId"),isAdmin:Ember.computed(function(){return this.get("userRole")==="ADMIN"}).property("userRole"),canRemove:Ember.computed(function(){return(Number(this.get("userId"))!==GliffyApp.authController.getUserID())}).property("userRole")});GliffyApp.CancelReason=Ember.Object.extend({label:null,id:null});GliffyApp.TransactionHistory=Ember.Object.extend({id:null,payment:null,paymentCurrency:null,status:null,transactionDate:null,transactionId:null,dataSource:null,showInvoiceBtn:Ember.computed(function(){if(this.get("status")==="processed"){return true}else{if(this.get("dataSource")==="ben"&&this.get("status")==="refunded"){return true}else{return false}}}).property("status")});GliffyApp.errorMsg=Ember.Object.extend({key:null,message:null});GliffyApp.accountManageController=GliffyApp.AccountManageController.create()}());(function(){GliffyApp.tempPasswordController=Ember.Object.create({init:function(){},show:function(c){$("#gliffy-temp-password-modal").modal({show:true,keyboard:false,backdrop:"static"}).bind("hidden.gliffy",function(){$("#gliffy-temp-password-modal").unbind("hidden.gliffy");if(c){c()}})},hide:function(){$("#gliffy-temp-password-modal").modal("hide")}})}());(function(){GliffyApp.VerifyEmailController=GliffyApp.AbstractModalController.extend({init:function(){this.__resumingModal=GliffyApp.ResumingModalController.create({modalSelector:"#gliffy-verify-email-modal"})},actions:{verifyEmailSubmit:function(){this.verifyEmail($("#gliffy-verify-email-modal input").val())},resendLinkClick:function(){this.resendVerifyEmail()},closeAlert:function(){$("#gliffy-verify-email-modal .alert-floating").hide()}},show:function(d,c){this.__resumingModal.show(d,c);$("#gliffy-verify-email-modal .alert-floating").hide();$("#gliffy-verify-email-modal input").focus();$("#gliffy-verify-email-modal input").val("");this.__enablePrimaryButtons();this.theModal=this.__resumingModal.getModal();this.setSize(600,320)},verifyEmail:function(d){var c=this;this.__disablePrimaryButtons();window.GLIFFY.API.PUT("user/verifyEmail",null,{query:{confCode:d},success:function(e){GliffyApp.authController.setIsConfirmed(true);c.__resumingModal.resume();if(GliffyApp.authController.account.isTrial){$("body").trigger("updateOnboardingSteps")}},error:function(g,f,e){c.__displayErrorMessage(c.EMAIL_VERIFY_STATE,"Failed to verify email with confirmation code. Please enter a valid confirmation code.");c.__enablePrimaryButtons()},context:this})},resendVerifyEmail:function(){var c=this;window.GLIFFY.API.GET("user/resendVerification",{query:{app:GLIFFY.ENV.app},success:function(e,f,d){c.__displaySuccessMessage(c.EMAIL_VERIFY_STATE,"Verification email sent to "+e+".")},error:function(f,d,e){c.__displayErrorMessage(c.EMAIL_VERIFY_STATE,"Failed to send verification email.");console.error("error loading collaborator list",f,d,e)},context:this})},__disablePrimaryButtons:function(){this.__resumingModal.getModal().find(".gliffy-btn-primary").attr("disabled",true);this.__resumingModal.getModal().find(".gliffy-save-spinner").show()},__enablePrimaryButtons:function(){this.__resumingModal.getModal().find(".gliffy-btn-primary").attr("disabled",false);this.__resumingModal.getModal().find(".gliffy-save-spinner").hide()},__displaySuccessMessage:function(d,c){var e=this.__resumingModal.getModal().find(".alert-floating");e.removeClass("alert-error").addClass("alert-success").find("span").html(c);e.show()},__displayErrorMessage:function(d,c){var e=this.__resumingModal.getModal().find(".alert-floating");e.removeClass("alert-success").addClass("alert-error").find("span").html(c);e.show()}});GliffyApp.verifyEmailController=GliffyApp.VerifyEmailController.create()}());(function(){GliffyApp.AccountSwitchController=Ember.ArrayController.extend({actions:{switchAccounts:function(){this.show()},submitSwitch:function(){this.submitSwitch.apply(this,arguments)},cancel:function(){this.cancel.apply(this,arguments)},change:function(){var c=Number($("#gliffy-account-switch-modal-select").val());var d=this.accountList.findBy("accountId",c);GliffyApp.currentAccountSelect.set("selectedAccount",d)}},accountList:[],currentAccount:null,init:function(){this.set("accountList",Ember.A([]))},show:function(){var c=this;$("#setAsDefault").attr("checked",false);GliffyApp.authController.fetchUser(function(){c.populate();c.theModal=$("#gliffy-account-switch-modal");c.theModal.modal("show")})},showSwitcher:Ember.computed(function(){if(this.get("accountList").length>1){return true}else{return false}}).property(),populate:function(){this.set("accountList",Ember.A([]));this.set("accountList",GliffyApp.authController.getSwitchableAccounts());var c=GliffyApp.authController.getCurrentUserAccount();this.set("currentAccount",c);this.get("accountList").forEach(function(d){d.selected=d.accountId===c.accountId});GliffyApp.currentAccountSelect.set("selectedAccount",c)},submitSwitch:function(){var d=this;var h=this.get("currentAccount");var f=GliffyApp.currentAccountSelect.get("selectedAccount");var c=f.get("accountId");var e=$("#setAsDefault").prop("checked");var g=GliffyApp.documentManagerController;if(f.accountId!==h.accountId){this.set("currentAccount",f)}if(g){$(window).unbind("focus",g.handleRefocus)}if(e){d.setDefaultAccount(c,function(){d.setDefaultAccountId(c)})}else{d.setDefaultAccountId(c)}GliffyApp.authController.getAccessToken(c);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accounts",action:"switchAccount",label:e});d.theModal.modal("hide");if(g){$(window).bind("focus",g.handleRefocus)}GliffyApp.authController.get("billingStatus").loadCurrentAccount()},setDefaultAccountId:function(c){var d=false;var e=GliffyApp.documentManagerController;if(e){d=function(){e.configAccountFolders()}}GliffyApp.authController.setAccountId(c,d);if(e){e.configAccountFolders()}GliffyApp.authController.expirationTest();self.theModal=$("#gliffy-account-switch-modal");self.theModal.modal("hide")},setDefaultAccount:function(d,c){if(d!==0){GLIFFY.API.GET("user/setDefaultAccount",{query:{accountId:d},success:function(){c()},error:function(){alert("An error has occurred!")}})}},cancel:function(){self.theModal=$("#gliffy-account-switch-modal");self.theModal.modal("hide")}});GliffyApp.currentAccountSelect=Ember.Object.create({selectedAccount:null});GliffyApp.accountSwitchController=GliffyApp.AccountSwitchController.create()}());(function(){GliffyApp.FolderPermissionsModalController=GliffyApp.AbstractModalController.extend({folderName:null,folderId:null,usersWithAccess:null,usersWithoutAccess:null,accountUsers:null,userToAddList:null,userToRemoveList:null,init:function(){this.usersWithAccess=Ember.A([]);this.usersWithoutAccess=Ember.A([]);this.userToAddList=[];this.userToRemoveList=[];this.accountUsers=[]},actions:{accountUsersLinkClick:function(){this.openAccountUsers()},leftArrowClick:function(){this.handleLeftArrowClick()},rightArrowClick:function(){this.handleRightArrowClick()},submit:function(){GLIFFY.analyticsUtils.logMixpanelEvent("shareFolder",{});this.updateUsers()},closeAlert:function(){$("#gliffy-folder-permissions-modal .alert-floating").hide()},handleWithAccessListClick:function(c){var d,e=$("#gliffy-folder-permissions-modal .gliffy-folder-permissions-access-list ."+c.uid);if(!c.isAdmin){if(e.hasClass("selected")){e.removeClass("selected");d=$.inArray(c,this.userToRemoveList);if(d>-1){this.userToRemoveList.splice(d,1)}}else{e.addClass("selected");if(this.userToRemoveList.indexOf(c)===-1){this.userToRemoveList[this.userToRemoveList.length]=c}}}},handleWithoutAccessUserClicked:function(c){var d,e=$("#gliffy-folder-permissions-modal .gliffy-folder-permissions-no-access-list ."+c.uid);if(e.hasClass("selected")){e.removeClass("selected");d=$.inArray(c,this.userToAddList);if(d>-1){this.userToAddList.splice(d,1)}}else{e.addClass("selected");if(this.userToAddList.indexOf(c)===-1){this.userToAddList[this.userToAddList.length]=c}}}},show:function(c,d){this.theModal=$("#gliffy-folder-permissions-modal");this.reset();this.theModal.modal("show");this.set("folderName",d);this.set("folderId",c);this.__loadAccountUsers()},reset:function(){this.usersWithAccess.clear();this.usersWithoutAccess.clear();this.userToAddList=[];this.userToRemoveList=[];this.accountUsers=[];this.theModal.find(".gliffy-folder-permissions-access-list div").removeClass("selected");this.theModal.find(".gliffy-folder-permissions-no-access-list div").removeClass("selected");this.theModal.find(".alert-floating").hide()},handleWithoutAccessUserClicked:function(e,c){var d;if(e.hasClass("selected")){e.removeClass("selected");d=$.inArray(c,this.userToAddList);if(d>-1){this.userToAddList.splice(d,1)}}else{e.addClass("selected");if(this.userToAddList.indexOf(c)===-1){this.userToAddList[this.userToAddList.length]=c}}},handleLeftArrowClick:function(){for(var c=0;c<this.userToAddList.length;c++){this.usersWithoutAccess.removeObject(this.userToAddList[c])}this.usersWithAccess.pushObjects(this.userToAddList);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"folderPermissions",action:"addingUsers",value:this.userToAddList.length});this.userToAddList=[]},openAccountUsers:function(){this.hide();GliffyApp.accountManageController.show();GliffyApp.accountManageController.setTab("#gliffy-account-users");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"folderPermissions",action:"addUsersLinkClick"})},updateUsers:function(){var c=this;this.showUIBlocker();window.GLIFFY.API.PUT("folder/"+this.folderId+"/users.json",this.__getJSONForUsersWithAccess(),{query:{},success:function(d){c.hideUIBlocker();c.hide()},error:function(f,e,d){c.hideUIBlocker();c.__displayErrorMessage("Failed to save folder users: "+d);console.error("error saving folder users",f,status,d)},context:this})},handleRightArrowClick:function(){for(var c=0;c<this.userToRemoveList.length;c++){this.usersWithAccess.removeObject(this.userToRemoveList[c])}this.usersWithoutAccess.pushObjects(this.userToRemoveList);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"folderPermissions",action:"removingUsers",value:this.userToRemoveList.length});this.userToRemoveList=[]},__loadAccountUsers:function(){var c=this;this.showUIBlocker();GLIFFY.API.GET("account/users.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,f,d){this.accountUsers=e.users;c.__loadFolderUsers()},error:function(f,e,d){c.hideUIBlocker();c.__displayErrorMessage("Failed to load account users: "+d);console.error("error loading account users",f,status,d)},context:this})},__loadFolderUsers:function(){var c=this;this.showUIBlocker();GLIFFY.API.GET("folder/"+this.folderId+"/users.json",{query:{},success:function(e,f,d){c.__populateUserAccessLists(e.users);c.hideUIBlocker()},error:function(f,e,d){c.hideUIBlocker();c.__displayErrorMessage("Failed to load folder users: "+d);console.error("error loading folder users",f,status,d)},context:this})},__populateUserAccessLists:function(h){var e,d,c,f=false,g=[];for(d=0;d<h.length;d++){g[g.length]=h[d].email}for(e=0;e<this.accountUsers.length;e++){c=Ember.Object.create({uid:this.accountUsers[e].user_id,email:this.accountUsers[e].email,isAdmin:(this.accountUsers[e].user_role==="ADMIN")});if(g.indexOf(this.accountUsers[e].email)>-1){this.usersWithAccess.pushObject(c)}else{this.usersWithoutAccess.pushObject(c)}}},__getJSONForUsersWithAccess:function(){var d,c={users:[]};for(d=0;d<this.usersWithAccess.length;d++){c.users[c.users.length]={id:this.usersWithAccess[d].uid}}return c}});GliffyApp.folderPermissionsModalController=GliffyApp.FolderPermissionsModalController.create()}());(function(){GliffyApp.BannerController=Ember.Controller.extend({integrations:null,init:function(){this.integrations=Ember.A([{display1:"Confluence",display2:"Plugin",url:"https://www.gliffy.com/products/confluence-plugin/?utm_source=gliffyonline_editor&utm_medium=bannerad&utm_term=confluence&utm_campaign=editorad"},{display1:"Chrome",display2:"App",url:"https://chrome.google.com/webstore/detail/gliffy-diagrams/bhmicilclplefnflapjmnngmkkkkpfad"},{display1:"Google",display2:"Apps",url:"https://www.google.com/enterprise/marketplace/viewListing?productListingId=5534+8831970581056655981&pli=1"},{display1:"Google Docs",display2:"Add-on",url:"https://chrome.google.com/webstore/detail/gliffy-diagrams/dajfclncmimpnbpagicmlglpbpamaabo?authuser=0&utm_source=Gliffy%20Customers&utm_campaign=c3cd2e4381-Google_Docs_Add_on_Announcement3_10_2014&utm_medium=editorad"},{display1:"Microsoft",display2:"App",url:"http://office.microsoft.com/en-us/store/gliffy-diagrams-WA103795937.aspx"}])},actions:{handleSignupClick:function(){GliffyApp.loginSignupController.show();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"bannerAd",action:"signUpClick"})},handleIntegrationClick:function(c){window.open(c);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"bannerAd",action:"integrationClick",label:c})},handleUpgradeClick:function(){if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.SimplifiedPricingPages&&window.optimizely.GHAX.SimplifiedPricingPages.showSimplifiedPricingPages){GliffyApp.accountManageController.show();GliffyApp.accountManageController.setTab("#account-upgrade-simplified-pricing-pages-container");$(".account-upgrade").find("a").click()}else{if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.EditorPurchasePage&&window.optimizely.GHAX.EditorPurchasePage.showPurchasePage){GliffyApp.accountManageController.show();GliffyApp.accountManageController.setTab("#account-upgrade");$(".account-upgrade").find("a").click()}else{GliffyApp.accountManageController.loadUsers();GliffyApp.accountUpgradePurchaseController.show()}}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"bannerAd",action:"upgradeClick",label:window.location.pathname})},handleFeedbackClick:function(){GliffyApp.feedbackController.show();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"bannerAd",action:"betaFeedback"})}}});GliffyApp.bannerController=GliffyApp.BannerController.create()}());(function(){GliffyApp.AccountUpgradePurchaseController=Ember.Controller.extend({actions:{upgradeAccountMenuShow:function(){this.upgradeAccountMenuShow.apply(this,arguments)}},show:function(){if(window.GLIFFY.ENV.location=="DOCUMENT_MANAGER"){GliffyApp.accountManageController.show();GliffyApp.accountManageController.showUpdate()}else{this.theModal=$("#gliffy-account-upgrade-modal");this.theModal.addClass("expanded no-sidebar");this.theModal.find(".cancel").click(function(){self.cancel()});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"/event/gliffy/upgrade",action:"viewUpgradeDialog"});this.theModal.modal("show")}},upgradeAccountMenuShow:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"FreeAccountUpgrade",action:"userClickedUpgradeInAccountDropdown"});GLIFFY.analyticsUtils.logMixpanelEvent("userClickedUpgradeInAccountDropdown",{accountId:GliffyApp.authController.getAccountId(),userId:GliffyApp.authController.getUserID()});this.show()}});GliffyApp.accountUpgradePurchaseController=GliffyApp.AccountUpgradePurchaseController.create()}());(function(){GliffyApp.FeedbackController=Ember.Controller.extend({init:function(){},actions:{send:function(){this.send()}},show:function(){$("#gliffy-feedback-modal").modal("show");$("#gliffy-feedback-modal input[name='fullname']").val("");if(GliffyApp.authController.isAuthenticated()){$("#gliffy-feedback-modal input[name='email']").val(GliffyApp.authController.getUsername());$("#gliffy-feedback-modal input[name='email']").attr("readonly","readonly")}else{$("#gliffy-feedback-modal input[name='email']").val("")}$("#gliffy-feedback-modal textarea").val("");$("#gliffy-feedback-modal input[name='performance']").attr("checked",false);$("#gliffy-feedback-modal input[name='design']").attr("checked",false);setTimeout(function(){$("#gliffy-feedback-modal input[name='fullname']").focus()},100)},hide:function(){$("#gliffy-feedback-modal").modal("hide")},send:function(){var l,m,c,k,h,e,f,n=$("#gliffy-feedback-modal input[name='fullname']").val(),j=$("#gliffy-feedback-modal input[name='email']").val(),g;c=$("#gliffy-feedback-modal textarea").val();if(n===""){n="N/A"}if(j===""){j="N/A"}l=c.substring(0,50);e=$("#gliffy-feedback-modal input[name='performance']:checked").val();f=$("#gliffy-feedback-modal input[name='design']:checked").val();k=GliffyApp.authController.getAccountId();h=GliffyApp.authController.getUserID();m="*Feedback:*\n"+c+"\n\n*"+$(".gliffy-feedback-performance-label").html()+":* "+e+"\n\n*"+$(".gliffy-feedback-design-label").html()+":* "+f+"\n\n*UID:* "+GliffyApp.authController.getUserID()+"\n\n*Account ID:* "+GliffyApp.authController.getAccountId();var d=this.uaMatch(window.navigator.userAgent);g="*Location*: "+window.location.href+"\n *Browser*: "+d.browser+" "+d.version+"\n *Platform*: "+window.navigator.platform+"\n *Screen Resolution*: "+screen.width+" X "+screen.height+"\n *User-Agent*: "+window.navigator.userAgent+"\n";$.post("/go/api/user/sendFeedback",{fullname:n,email:j,summary:l,description:m,webInfo:g,feedback:c,accountId:k,userId:h,performanceRating:e,designRating:f});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"feedbackClick",action:"submit"});this.hide();GLIFFY.Utils.notify("success",$.i18n._("FEEDBACK_THANKS"),$.i18n._("FEEDBACK_APPRECIATION"),4000,$(window).width()/2-125,null)},uaMatch:function(d){d=d.toLowerCase();var c=/(chrome)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+)/.exec(d)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(d)||/(msie) ([\w.]+)/.exec(d)||d.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(d)||[];return{browser:c[1]||"",version:c[2]||"0"}}});GliffyApp.feedbackController=GliffyApp.FeedbackController.create()}());(function(){function c(){var d=window.GLIFFY.ENV.app;var e=GliffyApp.authController.account.id;GLIFFY.onlineUtils.openCenteredPopupWindow("/go/gdrive/installOrLaunchDrive?app="+d+"&accountId="+e,"installWindow",525,660);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"integrations",action:"GDrive",label:"startAuth"})}GliffyApp.GoogleDriveController=Ember.Controller.extend({init:function(){},actions:{install:function(){this.handleInstallAndAuth()},saveBeforeOpen:function(f){var e=function(){gapi.load("picker",{callback:GLIFFY.PLUGINS.storage.googleDrivePlugin.pickerLoadedCallback})};if(f){var d=GLIFFY.editor;d.postSaveCallback=function(){e();d.postSaveCallback=null};GliffyApp.toolbarController.doSave()}else{e()}}},afterInstallNotification:function(){var d=this;GLIFFY.PLUGINS.pluginManager.setDefaultContext("googleDrivePlugin");$("#gliffy-gdrive-connected-modal").modal("show").on("hide.bs.modal",function(){d.completeAfterInstallAndAuth()})},handleInstallAndAuth:function(d){return GliffyApp.authController.checkGoogleDriveEligibility(function(f){if(GliffyApp.googleDriveController.isGDriveInstalled()){if(f){f()}}else{var e=GLIFFY.PLUGINS.pluginManager;GliffyApp.googleDriveController.afterInstallCallback=f;e.setCurrentDocumentContext(e.getDefaultContext());c()}})(d)},completeAfterInstallAndAuth:function(){if(this.isGDriveInstalled()){if(this.afterInstallCallback){this.afterInstallCallback()}}this.afterInstallCallback=null},isGDriveInstalled:function(){return !!GLIFFY.PLUGINS.storage.googleDrivePlugin.token},setMenu:function(){if(!window.GLIFFY.ENV.googleDriveInstalled){$("#gliffy-mydocuments-googledrive a").text($.i18n._("online.menu.my.documents.install.google.drive"))}},showSaveDiagramModal:function(){GliffyApp.saveGdriveDiagramModal.showSaveModal()},initMyDocumentsPopOver:function(){var e=$("#my-documents-menu");if(e.length){var j=e.offset();var d=e.height();var f=e.width();var h=250;var g=new GLIFFY.Popover({title:$.i18n._("online.menu.my.documents.google.drive"),content:$.i18n._("online.mydocuments.popover.google.drive.content"),placement:"sw",zIndex:560000,shouldShow:function(){return !GliffyApp.authController.getUserPreferences().get("GOOGLE_DRIVE_V1_shown")},onHide:function(){$(".gliffy-popover-title-content").css("overflow-y","scroll");GliffyApp.authController.get("user").setPreference("GOOGLE_DRIVE_V1_shown","true")},width:h,top:j.top+d+6,left:j.left+f-h});$(".gliffy-popover-title-content").css("overflow-y","auto")}}});GliffyApp.googleDriveController=GliffyApp.GoogleDriveController.create()}());(function(){GliffyApp.GDriveConnectedModalController=Ember.Controller.extend({init:function(){},actions:{showAccountInfo:function(){$("#gliffy-account-modal").modal("show");$("#gliffy-account-modal").find(".google-drive-settings-link").find("a").click()}}});GliffyApp.gdriveConnectedModalController=GliffyApp.GDriveConnectedModalController.create()}());(function(){GliffyApp.ExpirationNoticeController=Ember.Controller.extend({expireUrl:"account/expire",freeSurveyComment:null,disableExpiration:false,adminList:Ember.A([]),actions:{goBasicSurveyPane:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickBasicSurvey"});this.showBasicSurveyPane()},goUpgradePane:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickUpgrade"});this.showUpgradePane()},goBasic:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickBasic"});if(!this.disableExpiration){this.expire();this.disableExpiration=true;var c=this;setTimeout(function(){c.disableExpiration=false},500)}},closeAlert:function(){this.theModal.find(".alert-floating").hide()}},show:function(){if(GliffyApp.authController.getAccountIsExpired()){$("#gliffy-modal-welcome-screen").modal("hide");if(GliffyApp.authController.get("propIsAccountAdmin")&&$("#gliffy-expiration-modal").find(".exp_upgrade_pane").css("display")!=="none"){$("#gliffy .gliffy-expiration-modals").addClass("taller-box")}$("#gliffy-expiration-modal").modal({keyboard:false,backdrop:"static",show:true});var c=this;window.GLIFFY.API.GET("account/users.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,f,d){c.adminList.addObjects(e.users.filter(function(g){return g.user_role==="ADMIN"}).map(function(g){return g.email}))}});if(GliffyApp.authController.account.isTrial){GliffyApp.explicitOnboardingStepsController.hideOnboardingPopup()}}else{this.hide()}},hide:function(){$("#gliffy-expiration-modal").modal("hide")},showBasicSurveyPane:function(){$("#gliffy").find(".gliffy-expiration-modals").removeClass("taller-box");$(".exp_upgrade_pane").hide();$("#title_tagline").hide();$(".exp_free_survey_pane").show()},showUpgradePane:function(){if(GliffyApp.authController.get("propIsAccountAdmin")){$("#gliffy").find(".gliffy-expiration-modals").addClass("taller-box")}$(".exp_upgrade_pane").show();$("#title_tagline").show();$(".exp_free_survey_pane").hide()},expire:function(){var c=this;c.theModal=$("#gliffy-expiration-modal");if($("#gliffy #gliffy-expiration-modal .exp_free_survey_pane #survey").is(":visible")&&!this.freeSurveyComment){$(".exp_free_survey_pane .alert span").html($.i18n._("online.free.survey.comment.required"));$(".exp_free_survey_pane .alert").show()}else{$.post("/go/api/user/sendFeedback",{email:GliffyApp.authController.getUsername(),description:"Expired Account Going To Basic",feedback:this.freeSurveyComment,accountId:GliffyApp.authController.getAccountId(),userId:GliffyApp.authController.getUserID(),dbOnly:"true"});window.GLIFFY.API.GET(c.get("expireUrl"),{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,f,d){this.theModal.modal("hide");GliffyApp.authController.fetchAccount()},error:function(f,d,e){alert("I am sorry, you do not have authorization to perform this operation. Please contact support <support@gliffy.com> if you believe you have received this notice in error.")},context:this})}}});GliffyApp.expirationNoticeController=GliffyApp.ExpirationNoticeController.create()}());(function(){GliffyApp.ApiEditorController=Ember.Controller.extend({returnToButtonText:Ember.computed(function(){return GLIFFY.ENV.returnButtonText}).property(),actions:{returnToUrlAction:function(){window.location.href=GLIFFY.ENV.returnUrl}}});GliffyApp.apiEditorController=GliffyApp.ApiEditorController.create()}());(function(){GliffyApp.TrialTeamInviteModalController=Ember.Controller.extend({actions:{show:function(){this.show.apply(this,arguments)}},bindEvents:function(){var c=this;$("#gliffy-trial-team-invite-modall").find("a.close").each(function(){if($(this).data("dismiss")==="modal"){$(c).on("click",function(){c.hide(false)})}});$("#gliffy-manage-users-add-user").on("click",this.addUsers)},showTeamMenu:function(){var c=$("ul.nav.pull-right").find("#menu-username");if($("#team-menu").length===0){$('<li id="team-menu" class="dropdown"><a class="dropdown-top-menu dropdown-toggle">'+$.i18n._("online.my.team.menu")+"</a></li>").insertBefore(c);$("#team-menu").find("a").on("click",this.show)}},show:function(){var c=$("#gliffy-trial-team-invite-modal");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"MyTeamPage",action:"ShowedPageInTrial"});GliffyApp.accountManageController.theModal=c;c.modal("show")},hide:function(){GliffyApp.accountManageController.theModal=null;$("#gliffy-trial-team-invite-modal").modal("hide")},showSuccessMessage:function(){var c=$("#gliffy-trial-team-invite-modal");if(c){GLIFFY.analyticsUtils.logMixpanelEvent("ShowedPageInTrial",{$email:GliffyApp.authController.getUsername()});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"MyTeamPage",action:"InvitesSent"});c.find(".gliffy-manage-users-error").removeClass("alert-error").addClass("alert-success").html("Invites sent!")}}});GliffyApp.trialTeamInviteModalController=GliffyApp.TrialTeamInviteModalController.create()}());(function(){GliffyApp.TrialSignupInviteModalController=Ember.Controller.extend({init:function(){this.newUserSignup=false;this.bindEvents()},bindEvents:function(){var c=this;$(".trial-signup-invite-modal a.close").each(function(){if($(this).data("dismiss")==="modal"){$(this).on("click",function(){c.hide(false)})}});$(".trial-signup-invite-modal-skip").on("click",function(){c.hide(false,0)});$("#trial-signup-invite-modal").on("hidden",c.handleNoInvites)},handleNoInvites:function(){GliffyApp.trialSignupInviteModalController.sendGAInviteData(false,0);GliffyApp.trialSignupInviteModalController.sendMixpanelInviteData(false,0);$("#trial-signup-invite-modal").off("hidden",GliffyApp.trialSignupInviteModalController.handleNoInvites)},show:function(){var c=$("#trial-signup-invite-modal");GliffyApp.accountManageController.theModal=c;c.modal("show")},hide:function(d,c){GliffyApp.accountManageController.theModal=null;$("#trial-signup-invite-modal").off("hidden",this.handleNoInvites);$("#trial-signup-invite-modal").modal("hide");this.newUserSignup=false;this.sendGAInviteData(d,c);this.sendMixpanelInviteData(d,c);if(GliffyApp.authController.account.isTrial){$("body").trigger("updateOnboardingSteps")}},sendGAInviteData:function(d,c){var e=(d)?" Users invited":"No users invited";GLIFFY.Utils.analyticsEvent("trackEvent",{category:"trialSignupInviteModal",action:e,value:c})},sendMixpanelInviteData:function(d,c){var e=(d)?" Users invited":"No users invited";GLIFFY.analyticsUtils.logMixpanelEvent("TrialSignupInviteModal",{$email:GliffyApp.authController.getUsername(),usersInvited:e,invitedUserCount:c})}});GliffyApp.trialSignupInviteModalController=GliffyApp.TrialSignupInviteModalController.create()}());(function(){GliffyApp.ineligibleForGDriveController=Ember.Object.create({show:function(){$("#ineligible-for-google-drive-modal").modal("show")}})}());(function(){GliffyApp.ineligibleForCommentController=Ember.Object.create({show:function(){$("#ineligible-for-comment-modal").modal("show")}})}());(function(){GliffyApp.ExplicitOnboardingStepsController=Ember.Controller.extend({invitedUsers:null,isStepOneComplete:false,isStepTwoComplete:false,isStepThreeComplete:false,isStepFourComplete:false,activeTimeOut:false,successMessage:"",errorMessage:"",showAlternativeStepTwo:false,alternativeStepTwoComplete:false,eventHub:Ember.inject.service(),shareDiagram:function(c){c.stopImmediatePropagation();if(this.features.get("sharingSupported")){this.get("eventHub").trigger("showShareModal")}else{$(".gliffy-filemenu-collaborate").click()}GLIFFY.analyticsUtils.logMixpanelEvent("onboardingStepThree",{$email:GliffyApp.authController.getUsername(),$action:"newShare"});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"ExplicitOnboardingSteps",action:"onboardingStepThree"})},sendToPurchasePage:function(){var c="Business",d=5;GLIFFY.analyticsUtils.logMixpanelEvent("onboardingStepFour",{$email:GliffyApp.authController.getUsername()});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"ExplicitOnboardingSteps",action:"onboardingStepFour"});$.ajax({url:"/go/commerce/saveoptions",method:"POST",data:{billingPeriod:"Annual",userCount:d,accountType:c,hideMonthly:true}}).done(function(){if(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.EditorPurchasePage&&window.optimizely.GHAX.EditorPurchasePage.showPurchasePage){GliffyApp.accountManageController.show();GliffyApp.accountManageController.setTab("#account-upgrade");$(".account-upgrade").find("a").click()}else{window.location.href="/go/commerce/purchase"}})},showOnboardingPopup:function(){var c=this,d=$(".explicit-onboarding-steps-popup");$("#explicit-onboard-share").on("click",function(e){c.shareDiagram(e)});if(d.length>0){this.updateOnboardingSteps();d.show()}},hideOnboardingPopup:function(){var c=$(".explicit-onboarding-steps-popup");if(c.length>0){c.hide()}},updateOnboardingSteps:function(){var c=this;GliffyApp.authController.fetchAccount(function(){GliffyApp.authController.user.fetch(function(){if(GliffyApp.authController.user.isConfirmed){c.set("isStepOneComplete",true)}if(GliffyApp.authController.account.userCount>1){c.set("isStepTwoComplete",true)}if(GliffyApp.authController.user.diagramsSharedCount>0){c.set("isStepThreeComplete",true)}if(GliffyApp.authController.isPaidAccount()&&!GliffyApp.authController.account.isTrial){c.set("isStepFourComplete",true)}})})},actions:{togglePopup:function(d){var c=$(".explicit-onboarding-steps-popup");if(c.hasClass("min")){c.removeClass("min")}else{c.addClass("min")}},resendVerifyEmail:function(){var c=this,d=$(".explicit-onboarding-step1-alert"),e=$(".explicit-onboarding-step-1").find("a");c.set("successMessage",$.i18n._("online.explicit.steps.one.sent.success"));c.set("errorMessage",$.i18n._("online.explicit.steps.one.sent.error"));if(!e.hasClass("disabled")){window.GLIFFY.API.GET("user/resendVerification",{query:{app:GLIFFY.ENV.app},success:function(g,h,f){d.find(".alert-success").show();d.find(".alert-error").hide();d.show();d.fadeOut(5000);e.addClass("disabled");c.activeTimeOut=false;GLIFFY.analyticsUtils.logMixpanelEvent("onboardingStepOne",{$email:GliffyApp.authController.getUsername()});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"ExplicitOnboardingSteps",action:"onboardingStepOne"})},error:function(h,f,g){d.find(".alert-success").hide();d.find(".alert-error").show();d.show();d.fadeOut(5000)},context:c})}else{if(!c.activeTimeOut){c.activeTimeOut=true;setTimeout(function(){e.removeClass("disabled")},30000)}}},openInviteModal:function(){var c=$("#trial-signup-invite-modal");GliffyApp.accountManageController.theModal=c;c.modal("show");GLIFFY.analyticsUtils.logMixpanelEvent("onboardingStepTwo",{$email:GliffyApp.authController.getUsername()});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"ExplicitOnboardingSteps",action:"onboardingStepTwo"})},openTemplateModal:function(){GliffyApp.templateBrowserController.show()},sendToPurchasePage:function(){this.sendToPurchasePage()}},propIsInExplicitOnboardingSteps:Ember.computed(function(){return this.get("isInExplicitOnboardingSteps")}).property("isInExplicitOnboardingSteps"),propIsStepOneComplete:Ember.computed(function(){return this.get("isStepOneComplete")}).property("isStepOneComplete"),propIsStepTwoComplete:Ember.computed(function(){return this.get("isStepTwoComplete")}).property("isStepTwoComplete"),propIsStepThreeComplete:Ember.computed(function(){return this.get("isStepThreeComplete")}).property("isStepThreeComplete"),propIsStepFourComplete:Ember.computed(function(){return this.get("isStepFourComplete")}).property("isStepFourComplete"),propSuccessMessage:Ember.computed(function(){return this.get("successMessage")}).property("successMessage"),propErrorMessage:Ember.computed(function(){return this.get("errorMessage")}).property("errorMessage"),propShowAlternativeStepTwo:Ember.computed(function(){return this.get("showAlternativeStepTwo")}).property("showAlternativeStepTwo"),propAlternativeStepTwoComplete:Ember.computed(function(){return this.get("alternativeStepTwoComplete")}).property("alternativeStepTwoComplete")});GliffyApp.instanceInitializer({name:"registerExplicitOnboardingStepsController",after:"registerGlobalInstancesGop",initialize:function(c){c.registry.register("controller:explicit-onboarding-steps",GliffyApp.ExplicitOnboardingStepsController,{singleton:true});GliffyApp.explicitOnboardingStepsController=c.container.lookup("controller:explicit-onboarding-steps");c.registry.register("services:explicitOnboardingStepsController",GliffyApp.explicitOnboardingStepsController,{instantiate:false,singleton:true});c.registry.injection("controller","explicitOnboardingStepsController","services:explicitOnboardingStepsController")}})}());(function(){GliffyApp.VersionHistoryController=Ember.Controller.extend({disableRevisionHistory:function(){var c=0,d,f;GLIFFY.analyticsUtils.logMixpanelEvent("ClickedRevisionHistory",{$email:GliffyApp.authController.getUsername()});if(GliffyApp.authController.isFreeAccount()||GliffyApp.authController.account.isTrial){GliffyApp.versionHistoryController.injectSubscribeToday();var e=setInterval(function(){f=$('[name="gliffy-revision-radio-button"]');if(f.length>0){d=$(".gliffy-revision-history-modal").find(".modal-footer");d.find(".btn").attr("disabled",true);$("#gliffy-revision-history-next-button").hide();f.attr("disabled",true);$(".gliffy-revision-history-item-desc").css("color","#ccc");clearInterval(e)}else{if(c>10){clearInterval(e)}c++}},250)}},enableRevisionHistory:function(){var c,d;d=$('[name="gliffy-revision-radio-button"]');c=$(".gliffy-revision-history-modal").find(".modal-footer");c.find(".btn").removeAttr("disabled");if(d.length>=10){$("#gliffy-revision-history-next-button").show()}d.removeAttr("disabled");$(".gliffy-revision-history-item-desc").css("color","")},injectSubscribeToday:function(){if($("#revision-lock-btn").length===0){$(".gliffy-revision-history-modal").find(".modal-footer").prepend("<div id='unlock-revision-history'><div id='revision-lock'></div><span id='revision-lock-msg'>"+$.i18n._("online.experiment.unlock.revision.history.msg")+"</span><a id='revision-lock-btn' class='button'>"+$.i18n._("online.experiment.unlock.revision.history.button")+"</a><div class='clr'></div></div>");$("#revision-lock-btn").on("click",GliffyApp.versionHistoryController.saveOptionsAndGoToPurchasePage)}},removeSubscribeToday:function(){$("#unlock-revision-history").remove()},saveOptionsAndGoToPurchasePage:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"limitRevisionHistory",action:"revisionHistoryPurchaseButtonClicked"});GLIFFY.analyticsUtils.logMixpanelEvent("ClickedSubscribeToday",{$email:GliffyApp.authController.getUsername()});var c=$.ajax({type:"POST",url:"/go/commerce/saveoptions",data:"accountType=Business&userCount=5&billingPeriod=Monthly"});c.done(function(){window.location.href="/go/commerce/purchase"});c.error(function(d){console.warn=(console.warn)?console.warn:[];console.warn(d)})}});GliffyApp.versionHistoryController=GliffyApp.VersionHistoryController.create()}());(function(){var g=".enhanced-signup-organization-size";var k=g+" ul";var c=g+" .dropdown-toggle";var j=".organizationSizeField";var f="orgSizeEmpty";var e="orgSize20Plus";var h=".modal-content";var d=h+" .additional-info-modal";GliffyApp.AccountUserAdditionalInfoController=Ember.ArrayController.extend({bindAdditionalInfoLargeOrgSizeModalEvents:function(){GliffyApp.accountUserAdditionalInfoController.sendAnalyticsCalls(e,false,true)},bindAdditionalInfoNoOrgSizeModalEvents:function(){$(h).find(k).on("click",function(m){m.preventDefault();var l=$(m.target);FormHelpers.updateDropDown(c,l);FormHelpers.updateHiddenField(j,l)});GliffyApp.accountUserAdditionalInfoController.sendAnalyticsCalls(f,false,true)},hideModal:function(){GliffyApp.enhancedModalController.removeCloseCallback();GliffyApp.enhancedModalController.close()},show:function(){var l=this;this.hideModal();if(typeof GliffyApp.authController.account.accountMetadata.organizationSizeMin=="number"&&GliffyApp.authController.account.accountMetadata.organizationSizeMin>20&&typeof GliffyApp.authController.account.accountUserMetadata.id==="undefined"){GliffyApp.enhancedModalController.display(".additional-info-container-has-large-org-size",l.bindAdditionalInfoLargeOrgSizeModalEvents);GliffyApp.enhancedModalController.addCloseCallback(GliffyApp.accountUserAdditionalInfoController.submitDataForLargeOrgSize)}else{GliffyApp.enhancedModalController.displayRequired(".additional-info-container-no-org-size",l.bindAdditionalInfoNoOrgSizeModalEvents)}},submitDataForLargeOrgSize:function(m){var l={};l.accountId=GliffyApp.authController.account.id;l.name=$(d).find(".name").val().trim();l.organizationName=$(d).find(".organization").val().trim();l.title=$(d).find(".job-title").val().trim();l.phone=$(d).find(".phone").val().trim();$.ajax({url:"/go/api/account/accountusermetadata",method:"POST",data:l,dataType:"json",success:function(o,p,n){window.segmentUtils.ajaxLoadAccount();window.segmentUtils.segmentTracking(true,false)}});if(typeof m==="undefined"||_.isEmpty(l.name)&&_.isEmpty(l.organizationName)&&_.isEmpty(l.title)&&_.isEmpty(l.phone)){GliffyApp.accountUserAdditionalInfoController.sendAnalyticsCalls(e,false,false)}else{GliffyApp.accountUserAdditionalInfoController.sendAnalyticsCalls(e,true,false)}GliffyApp.accountUserAdditionalInfoController.hideModal()},sendAnalyticsCalls:function(n,m,l){var p="modalDisplayed",o={};if(!l){if(m===true){o.userProvidedAdditionalInfo=1;p="userProvidedMoreAccountInfo"}else{o.userProvidedAdditionalInfo=0;p="userNotProvidedMoreAccountInfo"}}o.accountId=GliffyApp.authController.getAccountId();o.userId=GliffyApp.authController.getUserID();o.dialogName=n;GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"ProgressiveProfileDialog",label:p});GLIFFY.analyticsUtils.logMixpanelEvent("ProgressiveProfileDialog",o)},actions:{submitAdditionalInfoLargeOrgSize:function(){this.submitDataForLargeOrgSize(true)},submitAdditionalInfoNoOrgSize:function(){var l={};l.accountId=GliffyApp.authController.account.id;l.organizationName=$(d).find(".organization").val().trim();l.title=$(d).find(".job-title").val().trim();l.organizationSize=$(d).find("#account-user-organization-size").val();$(d).find(".organizationSize .error-field").hide();if(!_.isEmpty(l.organizationSize)){$.ajax({url:"/go/api/account/accountusermetadata",method:"POST",data:l,dataType:"json",success:function(n,o,m){window.segmentUtils.ajaxLoadAccount();window.segmentUtils.segmentTracking(true,false)}});this.sendAnalyticsCalls(f,true,false);GliffyApp.accountUserAdditionalInfoController.hideModal()}else{$(d).find(".organizationSize .error-field").show()}}}});GliffyApp.accountUserAdditionalInfoController=GliffyApp.AccountUserAdditionalInfoController.create()}());(function(){GliffyApp.AccountUpgradeBusinessTeamDealController=Ember.Controller.extend({STANDARD_PRICING:"Standard",BUSINESS_PRICING:"Business",ANNUAL_PRICING:"Annual",MONTHLY_PRICING:"Monthly",SINGLE_USER:1,priceList:[],currentTeamMonthlyPrice:0,currentTeamAnnualPricePerMonth:0,currentTeamAnnualPricePerMonthNonDiscounted:0,singleStandardAnnualPricePerMonth:0,singleStandardMonthlyPrice:0,singleBusinessAnnualPricePerMonth:0,singleBusinessMonthlyPrice:0,inAppBusinessTeamPricing:null,isDiscounted:false,show:function(){if(window.GLIFFY.ENV.location=="DOCUMENT_MANAGER"){GliffyApp.accountManageController.show();GliffyApp.accountManageController.showUpdate()}else{this.theModal=$("#gliffy-account-upgrade-modal");this.theModal.find(".cancel").click(function(){self.cancel()});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"/event/gliffy/upgrade",action:"viewUpgradeDialog"});this.theModal.modal("show")}},bindClickEvents:function(){var c=this,d=$(".upgrade-business-team-deal-template");$(".user-count").on("change",function(){c.setPrices()});d.find("#per-user-pricing-standard-select").on("click",function(){window.optimizely.push(["trackEvent","editorUpgradeModalChosePaidPlan"]);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"BusinessTeamDeal",action:"editorUpgradeModalChosePaidPlan"});c.sendToPurchasePage("Standard",1)});d.find("#per-user-pricing-business-select").on("click",function(){window.optimizely.push(["trackEvent","editorUpgradeModalChosePaidPlan"]);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"BusinessTeamDeal",action:"editorUpgradeModalChosePaidPlan"});c.sendToPurchasePage("Business",1)});d.find("#per-user-pricing-business-team-select").on("click",function(){window.optimizely.push(["trackEvent","editorUpgradeModalChosePaidPlan"]);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"BusinessTeamDeal",action:"editorUpgradeModalChosePaidPlanBusinessTeam"});var e=d.find(".user-count").val();c.sendToPurchasePage("Business",e)})},sendToPurchasePage:function(c,d){$.ajax({url:"/go/commerce/saveoptions",method:"POST",data:{billingPeriod:"Annual",userCount:d,accountType:c,hideMonthly:true}}).done(function(){window.location.href="/go/commerce/purchase"})},getProductInfo:function(){var c=this;$.ajax({url:"/go/commerce/productinfo?promoHash="+window.optimizely.GHAX.BusinessTeamDeal.promoHash,dataType:"json",async:false}).done(function(d){c.priceList=d;c.setInitialUserList();c.bindClickEvents()})},getAnnualPricePerMonth:function(c){var d=0;if(c&&c.Price!==null){d=Math.ceil(((c.Price/12)*100))/100}return d},setInitialUserList:function(){var g,f,d;var j=this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING];var e=$(".upgrade-business-team-deal-template").find(".user-count");e.empty();var c=$.i18n._("online.account.management.menu.users");for(var h in j){if(h>1){d={userCountValue:h,userText:c};g="<option value='{{userCountValue}}'>{{userCountValue}} {{userText}}</option>";f=Handlebars.compile(g);e.append(f(d))}}this.setPrices()},setPrices:function(){var c=$(".upgrade-business-team-deal-template");var d=Number(c.find(".user-count").val())||5;this.set("singleStandardMonthlyPrice",(this.priceList[this.STANDARD_PRICING][this.ANNUAL_PRICING][this.SINGLE_USER].Price/12).toFixed(2));this.set("singleBusinessMonthlyPrice",(this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][this.SINGLE_USER].Price/12).toFixed(2));if(d>=25){this.set("isDiscounted",true);this.set("currentTeamMonthlyPrice",(this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][d].Price/d/12).toFixed(2))}else{this.set("isDiscounted",false);this.set("currentTeamMonthlyPrice",(this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][this.SINGLE_USER].Price/12).toFixed(2))}this.set("currentTeamAnnualPricePerMonthNonDiscounted",(this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][d].Price/12*2).toFixed(2));this.setPerUserPrice();this.setFontSizeByUserCount(d,c)},setPerUserPrice:function(){var c=$(".upgrade-business-team-deal-template").find(".user-count").val();if(c!=null&&typeof c!="undefined"){var d=this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][c];this.set("currentTeamAnnualPricePerMonth",this.getAnnualPricePerMonth(d).toFixed(2))}},setFontSizeByUserCount:function(e,d){var c=d.find(".per-user-pricing-for-month");if(e===1000){c.css("font-size","16px")}else{c.css("font-size","18px")}},propIsDiscounted:Ember.computed(function(){return this.get("isDiscounted")}).property("isDiscounted"),propSingleStandardAnnualPricePerMonth:Ember.computed(function(){return this.get("singleStandardAnnualPricePerMonth")}).property("singleStandardAnnualPricePerMonth"),propSingleStandardMonthlyPrice:Ember.computed(function(){return this.get("singleStandardMonthlyPrice")}).property("singleStandardMonthlyPrice"),propSingleBusinessAnnualPricePerMonth:Ember.computed(function(){return this.get("singleBusinessAnnualPricePerMonth")}).property("singleBusinessAnnualPricePerMonth"),propSingleBusinessMonthlyPrice:Ember.computed(function(){return this.get("singleBusinessMonthlyPrice")}).property("singleBusinessMonthlyPrice"),propCurrentTeamAnnualPricePerMonth:Ember.computed(function(){return this.get("currentTeamAnnualPricePerMonth")}).property("currentTeamAnnualPricePerMonth"),propCurrentTeamAnnualPricePerMonthNonDiscounted:Ember.computed(function(){return this.get("currentTeamAnnualPricePerMonthNonDiscounted")}).property("currentTeamAnnualPricePerMonthNonDiscounted"),propCurrentTeamMonthlyPrice:Ember.computed(function(){return this.get("currentTeamMonthlyPrice")}).property("currentTeamMonthlyPrice"),propInAppBusinessTeamPricing:Ember.computed(function(){if(this.get("inAppBusinessTeamPricing")===null||typeof this.get("inAppBusinessTeamPricing")==="undefined"){this.set("inAppBusinessTeamPricing",window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.BusinessTeamDeal&&window.optimizely.GHAX.BusinessTeamDeal.promoHash&&window.optimizely.GHAX.BusinessTeamDeal.promoHash.length>0);return(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.BusinessTeamDeal&&window.optimizely.GHAX.BusinessTeamDeal.promoHash&&window.optimizely.GHAX.BusinessTeamDeal.promoHash.length>0)}return this.get("inAppBusinessTeamPricing")}).property("inAppBusinessTeamPricing")});GliffyApp.accountUpgradeBusinessTeamDealController=GliffyApp.AccountUpgradeBusinessTeamDealController.create()}());(function(){GliffyApp.AccountExpireBusinessTeamDealController=Ember.Controller.extend({actions:{closeAlert:function(){this.closeAlert.apply(this,arguments)},goUpgradePane:function(){this.goUpgradePane.apply(this,arguments)},goBasic:function(){this.goBasic.apply(this,arguments)}},expireUrl:"account/expire",freeSurveyComment:null,disableExpiration:false,STANDARD_PRICING:"Standard",BUSINESS_PRICING:"Business",ANNUAL_PRICING:"Annual",MONTHLY_PRICING:"Monthly",SINGLE_USER:1,priceList:[],currentTeamMonthlyPrice:0,currentTeamAnnualPricePerMonth:0,currentTeamAnnualPricePerMonthNonDiscounted:0,singleStandardAnnualPricePerMonth:0,singleStandardMonthlyPrice:0,singleBusinessAnnualPricePerMonth:0,singleBusinessMonthlyPrice:0,inAppBusinessTeamPricing:null,adminList:Ember.A([]),isDiscounted:false,gotProductInfo:false,show:function(){if(GliffyApp.authController.getAccountIsExpired()){$("#gliffy-modal-welcome-screen").modal("hide");$("#gliffy-expiration-modal").modal("hide");$(".account-expiration-business-team-deal-template").modal({keyboard:false,backdrop:"static",show:true});var c=this;window.GLIFFY.API.GET("account/users.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,f,d){c.adminList.addObjects(e.users.filter(function(g){return g.user_role==="ADMIN"}).map(function(g){return g.email}))}})}else{this.hide()}},hide:function(){$(".account-expiration-business-team-deal-template").modal("hide")},bindClickEvents:function(){var d=this,c=$(".account-expiration-business-team-deal-template");c.find(".user-count").on("change",function(){d.setPrices()});c.find("#standard-select").on("click",function(){window.optimizely.push(["trackEvent","editorExpirationModalChosePaidPlan"]);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"BusinessTeamDeal",action:"editorExpirationModalChosePaidPlan"});d.sendToPurchasePage("Standard",1)});c.find("#business-select").on("click",function(){window.optimizely.push(["trackEvent","editorExpirationModalChosePaidPlan"]);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"BusinessTeamDeal",action:"editorExpirationModalChosePaidPlan"});d.sendToPurchasePage("Business",1)});c.find("#business-team-select").on("click",function(){var e=$(".account-expiration-business-team-deal-template").find(".user-count").val();window.optimizely.push(["trackEvent","editorExpirationModalChosePaidPlan"]);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"BusinessTeamDeal",action:"editorExpirationModalChosePaidPlan"});d.sendToPurchasePage("Business",e)});c.find("#free-single-select").on("click",function(f){f.preventDefault();c.hide();if(GliffyApp.authController.get("propIsTrialAccount")){d.goBasicSurveyPane()}else{d.goBasic()}})},goBasicSurveyPane:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickBasicSurvey"});this.showBasicSurveyPane()},goUpgradePane:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickUpgrade"});$(".account-expiration-business-team-deal-template-survey").modal("hide");this.show()},goBasic:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickBasic"});if(!this.disableExpiration){this.expire();this.disableExpiration=true;var c=this;setTimeout(function(){c.disableExpiration=false},500)}},showBasicSurveyPane:function(){this.hide();$(".account-expiration-business-team-deal-template-survey").modal({keyboard:false,backdrop:"static",show:true})},sendToPurchasePage:function(c,d){$.ajax({url:"/go/commerce/saveoptions",method:"POST",data:{billingPeriod:"Annual",userCount:d,accountType:c,hideMonthly:true}}).done(function(){window.location.href="/go/commerce/purchase"})},expire:function(){var c=this;c.theModal=$(".account-expiration-business-team-deal-template-survey");if(c.theModal.find(".exp_free_survey_pane #survey").is(":visible")&&!this.freeSurveyComment){c.theModal.find(".exp_free_survey_pane .alert span").html($.i18n._("online.free.survey.comment.required"));c.theModal.find(".exp_free_survey_pane .alert").show()}else{$.post("/go/api/user/sendFeedback",{email:GliffyApp.authController.getUsername(),description:"Expired Account Going To Basic",feedback:c.freeSurveyComment,accountId:GliffyApp.authController.getAccountId(),userId:GliffyApp.authController.getUserID(),dbOnly:"true"});window.GLIFFY.API.GET(c.get("expireUrl"),{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,f,d){c.theModal.modal("hide");GliffyApp.authController.fetchAccount()},error:function(f,d,e){alert("I am sorry, you do not have authorization to perform this operation. Please contact support <support@gliffy.com> if you believe you have received this notice in error.")},context:c})}},getProductInfo:function(){var c=this;if(!this.get("gotProductInfo")){$.ajax({url:"/go/commerce/productinfo?promoHash="+window.optimizely.GHAX.BusinessTeamDeal.promoHash,dataType:"json",async:false}).done(function(d){c.priceList=d;c.setInitialUserList();c.bindClickEvents()});this.set("gotProductInfo",true)}},getAnnualPricePerMonth:function(c){var d=0;if(c&&c.Price!==null){d=Math.ceil(((c.Price/12)*100))/100}return d},setInitialUserList:function(){var g,f,d;var j=this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING];var e=$(".account-expiration-business-team-deal-template").find(".user-count");e.empty();var c=$.i18n._("online.account.management.menu.users");for(var h in j){if(h>1){d={userCountValue:h,userText:c};g="<option value='{{userCountValue}}'>{{userCountValue}} {{userText}}</option>";f=Handlebars.compile(g);e.append(f(d))}}this.setPrices()},setPrices:function(){var c=$(".account-expiration-business-team-deal-template");var d=Number(c.find(".user-count").val());this.set("singleStandardMonthlyPrice",(this.priceList[this.STANDARD_PRICING][this.ANNUAL_PRICING][this.SINGLE_USER].Price/12).toFixed(2));this.set("singleBusinessMonthlyPrice",(this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][this.SINGLE_USER].Price/12).toFixed(2));if(d>=25){this.set("isDiscounted",true);this.set("currentTeamMonthlyPrice",(this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][d].Price/d/12).toFixed(2))}else{this.set("isDiscounted",false);this.set("currentTeamMonthlyPrice",(this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][this.SINGLE_USER].Price/12).toFixed(2))}this.set("currentTeamAnnualPricePerMonthNonDiscounted",(this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][d].Price/12*2).toFixed(2));this.setPerUserPrice();this.setFontSizeByUserCount(d,c)},setPerUserPrice:function(){var c=$(".account-expiration-business-team-deal-template").find(".user-count").val();if(c!=null&&typeof c!="undefined"){var d=this.priceList[this.BUSINESS_PRICING][this.ANNUAL_PRICING][c];this.set("currentTeamAnnualPricePerMonth",this.getAnnualPricePerMonth(d).toFixed(2))}},setFontSizeByUserCount:function(e,c){var d=c.find(".per-user-pricing-for-month");if(e===1000){d.css("font-size","16px")}else{if(e===500){d.css("font-size","17px")}else{d.css("font-size","18px")}}},propIsDiscounted:Ember.computed(function(){return this.get("isDiscounted")}).property("isDiscounted"),propSingleStandardAnnualPricePerMonth:Ember.computed(function(){return this.get("singleStandardAnnualPricePerMonth")}).property("singleStandardAnnualPricePerMonth"),propSingleStandardMonthlyPrice:Ember.computed(function(){return this.get("singleStandardMonthlyPrice")}).property("singleStandardMonthlyPrice"),propSingleBusinessAnnualPricePerMonth:Ember.computed(function(){return this.get("singleBusinessAnnualPricePerMonth")}).property("singleBusinessAnnualPricePerMonth"),propSingleBusinessMonthlyPrice:Ember.computed(function(){return this.get("singleBusinessMonthlyPrice")}).property("singleBusinessMonthlyPrice"),propCurrentTeamAnnualPricePerMonth:Ember.computed(function(){return this.get("currentTeamAnnualPricePerMonth")}).property("currentTeamAnnualPricePerMonth"),propCurrentTeamAnnualPricePerMonthNonDiscounted:Ember.computed(function(){return this.get("currentTeamAnnualPricePerMonthNonDiscounted")}).property("currentTeamAnnualPricePerMonthNonDiscounted"),propCurrentTeamMonthlyPrice:Ember.computed(function(){return this.get("currentTeamMonthlyPrice")}).property("currentTeamMonthlyPrice"),propInAppBusinessTeamPricing:Ember.computed(function(){if(this.get("inAppBusinessTeamPricing")===null||typeof this.get("inAppBusinessTeamPricing")==="undefined"){this.set("inAppBusinessTeamPricing",window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.BusinessTeamDeal&&window.optimizely.GHAX.BusinessTeamDeal.promoHash&&window.optimizely.GHAX.BusinessTeamDeal.promoHash.length>0);return(window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.BusinessTeamDeal&&window.optimizely.GHAX.BusinessTeamDeal.promoHash&&window.optimizely.GHAX.BusinessTeamDeal.promoHash.length>0)}return this.get("inAppBusinessTeamPricing")}).property("inAppBusinessTeamPricing")});GliffyApp.accountExpireBusinessTeamDealController=GliffyApp.AccountExpireBusinessTeamDealController.create()}());(function(){GliffyApp.AccountExpireSimplifiedPricingPagesController=Ember.Controller.extend({actions:{closeAlert:function(){this.closeAlert.apply(this,arguments)},goUpgradePane:function(){this.goUpgradePane.apply(this,arguments)},goBasic:function(){this.goBasic.apply(this,arguments)}},expireUrl:"account/expire",freeSurveyComment:null,disableExpiration:false,adminList:Ember.A([]),load:function(){$("#gliffy-modal-welcome-screen").modal("hide");$("#gliffy-expiration-modal").modal("hide");$(".account-expiration-simplified-pricing-pages-template").modal({keyboard:false,backdrop:"static",show:true})},hide:function(){$(".account-expiration-simplified-pricing-pages-template").modal("hide")},bindClickEvents:function(){var c=this,d=$(".account-expiration-simplified-pricing-pages-template");d.find(".personal").on("click",function(){GLIFFY.analyticsUtils.optimizelyEvent("cameFromAccountExpirationPage");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"SimplifiedPricingPages",action:"cameFromAccountExpirationPage"});c.sendToPurchasePage("Business",1)});d.find(".business-team").on("click",function(){GLIFFY.analyticsUtils.optimizelyEvent("cameFromAccountExpirationPage");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"SimplifiedPricingPages",action:"cameFromAccountExpirationPage"});c.sendToPurchasePage("Business",5)});d.find("#free-single-select").on("click",function(f){f.preventDefault();d.hide();if(GliffyApp.authController.get("propIsTrialAccount")){c.goBasicSurveyPane()}else{c.goBasic()}})},goBasicSurveyPane:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickBasicSurvey"});this.showBasicSurveyPane()},goUpgradePane:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickUpgrade"});$(".account-expiration-simplified-pricing-pages-template-survey").modal("hide");this.load()},goBasic:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickBasic"});if(!this.disableExpiration){this.expire();this.disableExpiration=true;var c=this;setTimeout(function(){c.disableExpiration=false},500)}},showBasicSurveyPane:function(){this.hide();$(".account-expiration-simplified-pricing-pages-template-survey").modal({keyboard:false,backdrop:"static",show:true})},sendToPurchasePage:function(c,d){$.ajax({url:"/go/commerce/saveoptions",method:"POST",data:{billingPeriod:"Annual",userCount:d,accountType:c}}).done(function(){window.location.href="/go/commerce/purchase"})},expire:function(){var c=this;c.theModal=$(".account-expiration-simplified-pricing-pages-template-survey");if(c.theModal.find(".exp_free_survey_pane #survey").is(":visible")&&!this.freeSurveyComment){c.theModal.find(".exp_free_survey_pane .alert span").html($.i18n._("online.free.survey.comment.required"));c.theModal.find(".exp_free_survey_pane .alert").show()}else{$.post("/go/api/user/sendFeedback",{email:GliffyApp.authController.getUsername(),description:"Expired Account Going To Basic",feedback:c.freeSurveyComment,accountId:GliffyApp.authController.getAccountId(),userId:GliffyApp.authController.getUserID(),dbOnly:"true"});window.GLIFFY.API.GET(c.get("expireUrl"),{query:{accountId:GliffyApp.authController.getAccountId()},success:function(e,f,d){c.theModal.modal("hide");GliffyApp.authController.fetchAccount()},error:function(f,d,e){alert("I am sorry, you do not have authorization to perform this operation. Please contact support <support@gliffy.com> if you believe you have received this notice in error.")},context:c})}}});GliffyApp.accountExpireSimplifiedPricingPagesController=GliffyApp.AccountExpireSimplifiedPricingPagesController.create()}());(function(){GliffyApp.AccountUpgradeSimplifiedPricingPagesController=Ember.Controller.extend({inAppSimplifiedPricingPages:false,bindClickEvents:function(){var d=this,c=$(".upgrade-simplified-pricing-pages-template"),e=$("#inner-ad-box"),f=$(".gliffy-account-user-remaining");e.find(".to-upgrade").remove();e.append('<button class="btn btn-orange to-upgrade">'+$.i18n._("online.menu.upgrade")+"!</button>");e.find(".to-upgrade").on("click",function(g){g.preventDefault();$(".account-upgrade").find("a").click()});$("#gliffy-account-users").find(".to-upgrade").remove();f.find(".upgrade-to-larger-account").append('<a href="#account-upgrade" class="to-upgrade" >'+$.i18n._("online.account.management.add.users.warning.part2")+"</a>");f.find(".upgrade-to-larger-account").find(".to-upgrade").on("click",function(g){g.preventDefault();$(".account-upgrade").find("a").click()});c.find(".personal").on("click",function(){GLIFFY.analyticsUtils.optimizelyEvent("cameFromUpgradeModal");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"SimplifiedPricingPages",action:"cameFromUpgradeModal"});d.sendToPurchasePage("Business",1)});c.find(".business-team").on("click",function(){GLIFFY.analyticsUtils.optimizelyEvent("cameFromUpgradeModal");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"SimplifiedPricingPages",action:"cameFromUpgradeModal"});d.sendToPurchasePage("Business",5)})},sendToPurchasePage:function(c,d){$.ajax({url:"/go/commerce/saveoptions",method:"POST",data:{billingPeriod:"Annual",userCount:d,accountType:c,hideMonthly:true}}).done(function(){window.location.href="/go/commerce/purchase"})},propInAppSimplifiedPricingPages:Ember.computed(function(){return this.get("inAppSimplifiedPricingPages")}).property("inAppSimplifiedPricingPages")});GliffyApp.accountUpgradeSimplifiedPricingPagesController=GliffyApp.AccountUpgradeSimplifiedPricingPagesController.create()}());(function(){GliffyApp.DetailedPurchasePageRedirectController=Ember.Controller.extend({showRedirectUpgradeButton:false,inDetailedPurchasePage:false,load:function(){this.set("propShowRedirectUpgradeButton",true)},actions:{handleUpgradeClick:function(){window.location="/go/commerce/purchase"}},propShowRedirectUpgradeButton:Ember.computed(function(){return this.get("showRedirectUpgradeButton")}).property("showRedirectUpgradeButton"),propInDetailedPurchasePage:Ember.computed(function(){return this.get("inDetailedPurchasePage")}).property("inDetailedPurchasePage")});GliffyApp.detailedPurchasePageRedirectController=GliffyApp.DetailedPurchasePageRedirectController.create()}());(function(){GliffyApp.EnhancedModalController=Ember.Controller.extend({APP_GLIFFY_DOCUMENT_MANAGER_WEBAPP_UUID:"1b5094b0-6042-11e2-bcfd-0800200c9a66",closeCallback:null,escapeKeyClose:function(c){if(c.keyCode===27){GliffyApp.enhancedModalController.close()}},addCloseCallback:function(c){this.closeCallback=c},removeCloseCallback:function(){this.closeCallback=null},bindModalEvents:function(){var c=this;var d=$(".enhanced-modal");d.find(".close-button").on("click",c.close);d.find(".enhanced-modal-backdrop").on("click",c.close);$("body").on("keydown",c.escapeKeyClose);d.find(".close-button").show()},unbindModalEvents:function(){var c=$(".enhanced-modal");c.find(".close-button").off("click");c.find(".enhanced-modal-backdrop").off("click");$("body").off("keydown",self.escapeKeyClose);c.find(".close-button").hide();GliffyApp.enhancedModalController.closeCallback=null},display:function(e,d){var c=$(".enhanced-modal");c.find(".modal-content").html($(e).html());c.show();if(typeof d==="function"){d()}this.bindModalEvents()},displayRequired:function(e,d){var c=$(".enhanced-modal");c.find(".modal-content").html($(e).html());c.show();if(typeof d==="function"){d()}},close:function(){var c=$(".enhanced-modal");if(typeof GliffyApp.enhancedModalController.closeCallback==="function"){GliffyApp.enhancedModalController.closeCallback()}c.trigger("hidden");c.find(".modal-content").html("");c.hide();GliffyApp.enhancedModalController.unbindModalEvents()}});GliffyApp.enhancedModalController=GliffyApp.EnhancedModalController.create()}());(function(){var d;var e=".enhanced-signup-organization-size";var g=e+" ul";var c=e+" .dropdown-toggle";var f=".organizationSizeField";GliffyApp.EnhancedLoginSignupModalController=Ember.Controller.extend({requiredLogin:false,actions:{submitLoginForm:function(){this.submitLoginForm.apply(this,arguments)},showResetPassword:function(){this.showResetPassword.apply(this,arguments)},showSignup:function(){this.showSignup.apply(this,arguments)},submitSignupForm:function(){this.submitSignupForm.apply(this,arguments)},showLogin:function(){this.showLogin.apply(this,arguments)},submitResetPasswordForm:function(){this.submitResetPasswordForm.apply(this,arguments)},returnToLogin:function(){this.returnToLogin.apply(this,arguments)}},hideModal:function(){GliffyApp.enhancedModalController.close()},showSignup:function(){var h=this;this.hideModal();GliffyApp.enhancedModalController.display(".enhanced-signup-container",h.bindLoginSignupEvents)},showLogin:function(){var h=this;this.hideModal();GliffyApp.enhancedModalController.display(".enhanced-login-container",h.bindLoginSignupEvents)},returnToLogin:function(){if(this.requiredLogin===true){this.showRequiredLogin()}else{this.showLogin()}},showRequiredLogin:function(){var h=this;h.requiredLogin=true;this.hideModal();GliffyApp.enhancedModalController.display(".enhanced-login-container",h.bindLoginSignupEvents);GliffyApp.enhancedModalController.unbindModalEvents();$(".modal-content").find(".signup-link").hide()},showResetPassword:function(){var h=this;this.hideModal();GliffyApp.enhancedModalController.display(".enhanced-reset-password-container",h.bindLoginSignupEvents);if(h.requiredLogin===true){GliffyApp.enhancedModalController.unbindModalEvents()}},showResetPasswordSubmitted:function(){var h=this;this.hideModal();GliffyApp.enhancedModalController.display(".enhanced-reset-password-submitted-container",h.bindLoginSignupEvents)},submitSignupForm:function(){var h=$(".modal-content");h.find(".error-field").hide();h.find(".error-message").hide();$.ajax({url:"/go/commerce/createaccount.json",method:"POST",data:{fullName:h.find(".enhanced-signup-fullname").val(),organizationSize:h.find(f).val(),termsAndConditions:h.find(".enhanced-signup-accept-terms").val(),email:h.find(".enhanced-signup-email").val(),password:h.find(".enhanced-signup-password").val()},success:function(l,m,k){if(m==="success"&&k.status.toString()==="200"){if(window.mixpanel&&typeof window.mixpanel.get_distinct_id==="function"&&typeof window.mixpanel.alias==="function"&&typeof window.mixpanel.identify==="function"&&window.mixpanel.people&&typeof window.mixpanel.people.set==="function"&&typeof window.mixpanel.track==="function"){window.mixpanel.track("signup",{"$email":GliffyApp.authController.getUsername(),product:l.accountUsers[0].productID})}var j=(window.Experiments&&window.Experiments.Utils)?window.Experiments.Utils:null;if(j){j.sendGAEvent("lzxclient","signUpSuccess",window.location.pathname);j.sendGAEvent("user","signUpSuccess",window.location.pathname);if((typeof chrome!=="undefined")&&chrome.app.isInstalled){j.sendGAEvent("user","signUpSuccessChromeAppUser",window.location.pathname)}}$(".enhanced-menu-login").remove();$(".enhanced-menu-signup").remove();$("#top-menu-user-signin").show();GliffyApp.enhancedLoginSignupModalController.hideModal();GliffyApp.loginSignupController.loginAndResume(l);GliffyApp.enhancedTeamInviteModalController.showTeamInviteForm()}},error:function(m,j,l){var n=JSON.parse(m.responseText);for(var k in n){if(k==="errors"){h.find(".error-message").show().html(n[k][0].message)}else{h.find("."+k).find(".error-field").show().html(n[k])}}}})},submitLoginForm:function(){var h=$(".modal-content");h.find(".error-field").hide();h.find(".error-message").hide();$.ajax({url:"/go/api/login.json",method:"POST",data:{email:h.find(".enhanced-login-email").val(),password:h.find(".enhanced-login-password").val()},success:function(m,n,l){if(typeof(m)=="object"){if(typeof(m.errors)=="object"&&m.errors.length>0){for(var j in m.errors){var k=h.find(".enhanced-login").find(".enhanced-login-"+m.errors[j].key).parent().parent().find(".error-field");k.html(m.errors[j].message);k.show()}}else{if(typeof(m.authenticated)=="boolean"&&m.authenticated==true){$(".enhanced-menu-login").remove();$(".enhanced-menu-signup").remove();$("#top-menu-user-signin").show();GliffyApp.enhancedLoginSignupModalController.hideModal();GliffyApp.loginSignupController.loginAndResume(m);if(GliffyApp.enhancedLoginSignupModalController.requiredLogin){window.location.reload()}}}}else{console.log("Undetermined error with Login submission.")}},error:function(j,l,k){console.log("Undetermined error with Login submission.")}})},submitResetPasswordForm:function(j){var k=$(".enhanced-modal-wrapper").find(".enhanced-reset-password");var h=k.find(".enhanced-reset-password-email");$(".modal-content").find(".error-field").hide();if(h.val()==""){k.find(".error-field").html($.i18n._("online.field.required")).show()}else{$.ajax({url:"/go/commerce/password/forgot",method:"POST",data:{email:h.val(),app:GliffyApp.enhancedModalController.APP_GLIFFY_DOCUMENT_MANAGER_WEBAPP_UUID},success:function(m,n,l){if(typeof(m)=="string"){GliffyApp.enhancedLoginSignupModalController.showResetPasswordSubmitted();$(".enhanced-modal-wrapper").find(".enhanced-reset-password-success").find(".message").html(m)}},error:function(m,q,n){var p=m.responseJSON.errors;if(typeof(m.responseJSON.email)!=="undefined"){var l=$(".enhanced-modal-wrapper").find(".enhanced-reset-password").find(".input-block.email").find(".error-field");l.html(m.responseJSON.email);l.show()}else{if(typeof(p[0].message)=="string"){GliffyApp.enhancedLoginSignupModalController.showResetPasswordSubmitted();var o=$(".enhanced-modal-wrapper").find(".enhanced-reset-password-success");o.find(".message").hide();o.find(".message-failure").html(p[0].message).show()}}}})}},bindLoginSignupEvents:function(){if(typeof GLIFFY.onlineUtils.signupModalTimer!=="undefined"&&GLIFFY.onlineUtils.signupModalTimer){clearTimeout(GLIFFY.onlineUtils.signupModalTimer)}$(".modal-content").find(g).on("click",function(h){h.preventDefault();d=$(h.target);FormHelpers.updateDropDown(c,d);FormHelpers.updateHiddenField(f,d)})}});GliffyApp.enhancedLoginSignupModalController=GliffyApp.EnhancedLoginSignupModalController.create()}());(function(){GliffyApp.EnhancedTeamInviteModalController=Ember.Controller.extend({showTeamInviteForm:function(){var c=this;GliffyApp.enhancedModalController.display(".enhanced-team-invite-container",c.bindTeamInviteEvents);GliffyApp.accountManageController.theModal=$(".enhanced-modal").find(".enhanced-team-invite")},showSuccessMessage:function(e,c){var k=this;var f,g;var j=$(".enhanced-modal");var d=$.i18n._("ENHANCED_TEAM_INVITE_MODAL_EMAIL_LIST");var h=$.i18n._("ENHANCED_TEAM_INVITE_MODAL_EMAIL_LIST_MULTIPLE");var l=e.replace(" ","").split(",");if(l.length>1){f=l.pop();g=l.join(", ");h=h.replace("{0}",g);h=h.replace("{1}",f);d=h}else{d=d.replace("{0}",l[0])}k.sendGAInviteData(true,c);k.sendMixpanelInviteData(true,c);j.off("hidden",GliffyApp.enhancedTeamInviteModalController.handleNoInvites);GliffyApp.enhancedModalController.display(".enhanced-team-invite-sent-container",k.bindTeamInviteSent);j.find(".description").html(d)},bindTeamInviteEvents:function(){$(".enhanced-modal").on("hidden",GliffyApp.enhancedTeamInviteModalController.handleNoInvites)},handleNoInvites:function(){GliffyApp.enhancedTeamInviteModalController.sendGAInviteData(false,0);GliffyApp.enhancedTeamInviteModalController.sendMixpanelInviteData(false,0);$(".enhanced-modal").off("hidden",GliffyApp.enhancedTeamInviteModalController.handleNoInvites)},bindTeamInviteSent:function(){},sendGAInviteData:function(d,c){var e=(d)?" Users invited":"No users invited";GLIFFY.Utils.analyticsEvent("trackEvent",{category:"trialSignupInviteModal",action:e,value:c})},sendMixpanelInviteData:function(d,c){var e=(d)?" Users invited":"No users invited";GLIFFY.analyticsUtils.logMixpanelEvent("TrialSignupInviteModal",{$email:GliffyApp.authController.getUsername(),usersInvited:e,invitedUserCount:c})},actions:{skipStep:function(){GliffyApp.enhancedModalController.close()}}});GliffyApp.enhancedTeamInviteModalController=GliffyApp.EnhancedTeamInviteModalController.create()}());(function(){var v=window.FormHelpers;var ac=".editor-purchase-page-container";var p=".billing-form";var S="#country";var aa=S+" ul";var q=S+" .dropdown-toggle";var D="#countryField";var m="#state";var Q=m+" ul";var u=m+" .dropdown-toggle";var w="#stateField";var L="#plan-users";var o=L+" ul";var t=L+" .dropdown-toggle";var Y="#userCountField";var W="#plan-type";var V=W+" ul";var ag=W+" .dropdown-toggle";var h=".plan-name";var P=".selected-billing";var r=".billing-period";var j="#billingPeriodField";var g="#accountTypeField";var d=".monthly-billing";var x=".annual-billing";var A=".price";var F=".cvc-link";var n="#cvc-template";var H="input[name='ccNumField']";var af="input[name='ccNum']";var X="input[name='cvc']";var ab="input[name='expirationDate']";var e="input[name='firstName']";var s="input[name='lastName']";var M=".cvc-info";var E=".student-or-teacher";var N=".student-or-teacher-info";var C="The CVC is a 3 digit number on the back of your card (Visa / Mastercard) or a 4 digit number on the front and to the right of your main card number (Amex).";var ae="We offer a discount to teachers and students, subject to verification. Academic pricing is not available for plans for two users or fewer. Please sign up with your school’s email address to qualify.";var c="<div class='popover'><div class='arrow'></div><div class='popover-inner'><div class='popover-content'><p></p></div></div></div>";var K=238;var l="Annual";var Z="Monthly";var f="Standard";var R="Business";var I="Businessteam";var O=".editor-purchase-page-submit";var J="Processing...";var z="Purchase";var ad={};var T={};var G,B,k;var y=$(ac).find(E).prop("checked");var U={plan:f,period:Z,userCount:1,price:0};GliffyApp.AccountEditorPurchasePageController=Ember.Controller.extend({currentlyUsedUsersBinding:Ember.Binding.oneWay("GliffyApp.authController.account.userCount"),cardNameError:null,firstNameError:null,lastNameError:null,address1Error:null,ccNumError:null,cityError:null,expirationDateError:null,cvcError:null,stateError:null,zipError:null,phoneNumberError:null,container:null,email:null,accountName:null,transactionID:null,accountType:null,userCount:null,billingPeriod:null,nextBillingDate:null,actions:{closeAccountModal:function(){GliffyApp.accountManageController.cancel()}},showEditorPurchasePage:function(){GliffyApp.authController.refreshAccountSettings();this.clearCreditCardData();this.loadContainer();this.loadTemplates();this.loadCountries();this.loadStates(0);this.loadPricingData()},loadContainer:function(){this.container=$(ac)},loadTemplates:function(){var ai='{{#each items}}<li><a href="#" data-index="{{@index}}" data-value="{{this}}">{{this}}</a></li>{{/each}}';var aj='Select <span class="caret"></span>';var ah='<div class="selection"> <h4>Selected Plan</h4> <h5>{{plan}}</h5> {{#if period}}<p>{{period}} Billing</p> {{/if}}<p>{{userCount}} {{pluralize userCount "User" "Users"}}</p> {{#if discount}}<p class="promotion">{{discount}}% off 1 year</p> {{/if}}</div> <div class="cart"> <h5>Amount</h5> <span class="amount-due">${{format-price price}}<sup class="disclaimer">*</sup> </span> <span class="payment-frequency quarterly"> / 3 mo </span> <span class="payment-frequency monthly"> / mo </span> <span class="payment-frequency yearly"> / yr </span> </div> <div class="disclaimer"> <sup>*</sup>Single user accounts are billed every 3 months (93 days)</div>';G=Handlebars.compile(ai);k=Handlebars.compile(aj);B=Handlebars.compile(ah)},toTitleCase:function(ah){return ah.replace(/\w\S*/g,function(ai){return ai.charAt(0).toUpperCase()+ai.substr(1).toLowerCase()})},loadPricingData:function(){var ah=this;$.ajax({url:"/go/commerce/productinfo",dataType:"json",success:function(ak){var aj=GliffyApp.authController.get("BILLING_INFO");T=ak;ah.initializeCart();ah.bindEvents();ah.inputMasking();ah.checkToDisableAcademic();if(ah.toTitleCase(aj.accountType)===I){ah.greyOutNumUserDropDown((ah.get("currentlyUsedUsers")<5)?2:ah.get("currentlyUsedUsers"))}else{ah.greyOutNumUserDropDown(ah.get("currentlyUsedUsers"))}var ai=ah.container.find(n).html();ah.container.find(F).webuiPopover({placement:"top",title:"",content:ai,width:420});ah.container.find(O).unbind("click").on("click",ah.submitForm);if(ah.container.find(w).val()!=""||ah.container.find(D).val()!=""){ah.refillStateAndCountry()}else{ah.container.find(aa+" li >a[data-index='"+K+"']").click()}}})},initializeCart:function(){var al,aj=this.container.find(h),ak,ai,am=parseInt(this.findLowestUsableUserCount()),an=this.container.find(t),ah=$(".more-users");ai=GliffyApp.authController.get("BILLING_INFO");ah.hide();if(ai!==null&&ai!==undefined){ak=this.toTitleCase(ai.accountType);U.plan=ak;U.period=ai.billingPeriod;an.removeClass("disabled").attr("data-toggle","dropdown");this.set("bindUserCount",true);if(U.plan===I&&am<5){U.userCount=5}else{U.userCount=am}if(U.plan===I||(U.plan===R&&am>1)){U.plan=R;aj.html("Business Team")}else{if(U.plan===R&&am===1){this.set("bindUserCount",false);an.addClass("disabled").removeAttr("data-toggle");aj.html("Business");ah.show()}else{aj.html(ak)}}}this.container.find(g).val(U.plan);this.container.find(j).val(U.period);this.container.find(Y).val(U.userCount);U.price=this.getPrice();U.discount=this.getPromotionDiscount();this.onPlanTypeClick(this.container.find(W).find("[data-value="+U.plan+"]"));this.container.find(".billing-period").removeClass("selected-plan");this.container.find("."+U.period.toLowerCase()+"-billing").addClass("selected-plan").find(P).show();al=this.container.find(L+" a[data-value='"+U.userCount+"']");v.updateDropDown(t,al);if(U.userCount===1){this.container.find(".single-user-pricing").show()}this.updatePrice()},bindEvents:function(){var ah=this,aj,ai,ak=ah.container.find(r);ak.on("click",function(al){al.preventDefault();ah.onBillingPeriodChange($(al.target))});ak.on("keydown",function(am){if(am.keyCode===13||am.keyCode===32){am.preventDefault();ah.onBillingPeriodChange($(am.target))}if(am.keyCode===40&&$(am.target).hasClass("monthly-billing")){var al=ah.container.find(x);al.focus();ah.onBillingPeriodChange(al)}if(am.keyCode===38&&$(am.target).hasClass("annual-billing")){var an=ah.container.find(d);an.focus();ah.onBillingPeriodChange(an)}});ah.container.find(o).on("click",function(al){al.preventDefault();aj=$(al.target);ah.onUserCountClick(aj)});ah.container.find(aa).on("click",function(al){al.preventDefault();aj=$(al.target);ah.onCountryClick(aj)});ah.container.find(Q).on("click",function(al){al.preventDefault();ah.onStateClick(al.target)});ah.container.find(V).on("click",function(al){al.preventDefault();ah.onPlanTypeClick(al.target)});ah.container.find(q).on("keydown",function(al){ai=v.onDropDownKeyDown(al,D);if(ai!=null){ah.resetStates(ai)}});ah.container.find(u).on("keydown",v.onDropDownKeyDown,function(al){v.onDropDownKeyDown(al,ac+" "+w)});if(ah.get("bindUserCount")){ah.container.find(t).on("keydown",ah.userCountBindingDropDown)}else{ah.container.find(t).off("keydown",ah.userCountBindingDropDown)}ah.container.find(ag).on("keydown",v.onDropDownKeyDown,function(al){v.onDropDownKeyDown(al,ac+" "+g);if(al.keyCode===13||al.keyCode===32){ah.onPlanTypeClick($(al.target))}});ah.container.find(E).on("change",function(al){y=$(E).prop("checked");ah.updateCart()});ah.container.find(M).webuiPopover({trigger:"hover",content:C,template:c,placement:"bottom"});ah.container.find(N).webuiPopover({trigger:"hover",content:ae,template:c,placement:"bottom"});ah.container.find(".change-plan").on("click",function(){GliffyApp.accountManageController.setTab("#account-upgrade")});ah.container.find("input[type='checkbox']").each(function(an){var am=$(this);var al=am.prop("name");ah.container.find("label[for='"+al+"']").on("click",function(){am.trigger("click")})})},userCountBindingDropDown:function(ah){v.onDropDownKeyDown(ah,EDITOR_STRIPE_PURCHASE_CONTAINER+" "+Y);if(ah.keyCode===13||ah.keyCode===32){this.onUserCountClick($(ah.target))}},submitForm:function(am){var ah="",aj="",an="",ai=GliffyApp.accountEditorPurchasePageController.container;am.preventDefault();ah=ai.find(H).val();aj=ai.find(X).val();an=ai.find(ab).val();ah=ah.replace(/\s+/g,"");aj=aj.replace(/\s+/g,"");an=an.replace(/\s+/g,"");ai.find(af).val(ah);ai.find(X).val(aj);ai.find(ab).val(an);var ak=$("input[name='cardName']").val();if(ak.length>0&&ak.indexOf(" ")>-1){var al=ak.indexOf(" ");var ao=ak.substr(0,al);var ap=ak.substr(al+1);ai.find(e).val(ao);ai.find(s).val(ap)}GliffyApp.accountEditorPurchasePageController.resetErrorMessages();ai.find(O).off("click",GliffyApp.accountEditorPurchasePageController.submitForm);ai.find(O).html(J).addClass("processing");$.ajax({url:"/go/commerce/processeditorpurchase",type:"POST",data:ai.find(p).serialize(),success:function(ar){ai.find(O).html(z).removeClass("processing");if(ar.result==="error"){$(".error-msg ").show();$(X).val("");for(var aq in ar.errors){GliffyApp.accountEditorPurchasePageController.set(aq+"Error",ar.errors[aq][0].toString())}ai.find(O).on("click",GliffyApp.accountEditorPurchasePageController.submitForm)}else{GliffyApp.authController.refreshAccountSettings();GliffyApp.accountManageController.loadHistory();GliffyApp.accountEditorPurchasePageController.purchaseSuccess()}}})},purchaseSuccess:function(){$.ajax({url:"/go/commerce/success.json",type:"GET",success:function(ah){GliffyApp.accountEditorPurchasePageController.sendAnalytics(ah);GliffyApp.accountEditorPurchasePageController.set("email",GliffyApp.authController.user.username);GliffyApp.accountEditorPurchasePageController.set("accountName",ah.accountName);GliffyApp.accountEditorPurchasePageController.set("transactionID",ah.transactionID);GliffyApp.accountEditorPurchasePageController.set("accountType",GliffyApp.authController.account.productType);GliffyApp.accountEditorPurchasePageController.set("userCount",ah.userCount);GliffyApp.accountEditorPurchasePageController.set("billingPeriod",ah.billingPeriod);GliffyApp.accountEditorPurchasePageController.set("nextBillingDate",GliffyApp.authController.get("propPeriodEndDate"));GliffyApp.accountManageController.showPurchaseSuccessTab()}})},sendAnalytics:function(ai){var ah=ai.price/100;window.dataLayer=window.dataLayer||[];dataLayer.push({transactionId:ai.transactionID,transactionAffiliation:ai.accountName,transactionTotal:ah,transactionTax:0,transactionShipping:0,transactionProducts:[{sku:ai.productID,name:ai.planName,price:ah,quantity:1}],currency:"USD",productId:ai.productID,event:"purchase goal",goalUrl:"/4048237854/goal"});if(ai.userCount>1){window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];window.optimizely.push(["trackEvent","purchaseSuccessMU"])}window.segmentUtils.ajaxLoadAccount();window.segmentUtils.segmentTracking(true,true);window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];if(!isNaN(ai.paymentGross)){window.optimizely.push(["trackEvent","purchaseSuccess",{revenue:ai.paymentGross}]);ai.paymentGross=ai.paymentGross/100}else{window.optimizely.push(["trackEvent","purchaseSuccess"])}if(window.mixpanel&&typeof window.mixpanel.identify==="function"&&window.mixpanel.people&&typeof window.mixpanel.people.set==="function"&&typeof window.mixpanel.people.track_charge==="function"&&typeof window.mixpanel.track==="function"){window.mixpanel.identify(ai.uid);window.mixpanel.people.set({product:ai.productID,"$email":ai.email});window.mixpanel.track("purchase",{accountId:ai.accountId,userId:ai.userId,product:ai.productID,organizationSizeMin:ai.organizationSizeMin,organizationSizeMax:ai.organizationSizeMax,accountCreateDate:ai.accountCreateDate,paymentGross:ai.paymentGross});window.mixpanel.people.track_charge(ai.paymentGross);if(ai.userCount>1){window.mixpanel.track("purchaseMU",{accountId:ai.accountId,userId:ai.userId,product:ai.productID,organizationSizeMin:ai.organizationSizeMin,organizationSizeMax:ai.organizationSizeMax,accountCreateDate:ai.accountCreateDate,paymentGross:ai.paymentGross})}window.mixpanel.track("viewPage",{"page name":document.title,url:window.location.pathname})}if(ai.userCount>=25){window.optimizely.push(["trackEvent","purchaseSuccessMU25plus"])}if(ai.accountType==="BUSINESS"){if(ai.userCount>1){window.optimizely.push(["trackEvent","businessPurchaseMU"])}else{window.optimizely.push(["trackEvent","businessPurchaseSU"])}}else{if(ai.userCount>1){window.optimizely.push(["trackEvent","standardPurchaseMU"])}else{window.optimizely.push(["trackEvent","standardPurchaseSU"])}}},resetErrorMessages:function(){$(".error-msg ").hide();this.set("cardNameError",null);this.set("firstNameError",null);this.set("lastNameError",null);this.set("address1Error",null);this.set("ccNumError",null);this.set("cityError",null);this.set("expirationDateError",null);this.set("cvcError",null);this.set("stateError",null);this.set("zipError",null);this.set("phoneNumberError",null)},clearCreditCardData:function(){$(H).val("");$(af).val("");$(X).val("");$(ab).val("")},inputMasking:function(){this.container.find(H).formatter({pattern:"{{9999}}   {{9999}}   {{9999}}   {{9999}}",persistent:false});this.container.find(ab).formatter({pattern:"{{99}}  /  {{9999}}",persistent:false});this.container.find(X).formatter({pattern:"{{9999}}",persistent:false})},loadCountries:function(){var ah,ai;if(typeof a!="undefined"&&a!=null&&typeof b!="undefined"&&b!=null){ah={items:b};ai=G(ah);this.container.find(aa).html(ai)}},loadStates:function(aj){var ai,ah,al,ak;ai=a[aj];if(typeof ai!="undefined"){ah=ai.split("|");al={items:ah};ak=G(al);this.container.find(Q).html(ak)}},resetStates:function(ah){var ai;this.loadStates(ah+1);ai=$(u);ai.data("index",0);ai.html(k);v.updateHiddenField(w,"")},refillStateAndCountry:function(){var ah,ai;ah=this.container.find(w).val();ai=this.container.find(D).val();if(ai!=""){this.container.find(aa+" li a:contains('"+ai+"')").click()}if(ah!=""){this.container.find(Q+" li a:contains('"+ah+"')").click()}},updateCart:function(){this.fillCart();this.updatePrice()},fillCart:function(){var ai;var ah=this.container.find(g);var aj=this.container.find(j);U.plan=(ah.length>0&&ah.val()!="")?ah.val():f;U.period=(ah.length>0&&aj.val()!="")?aj.val():Z;ai=parseInt(this.container.find(Y).val());if(ai===ai){U.userCount=parseInt(ai)}else{U.userCount=1}U.price=this.getPrice();U.price=U.price.toFixed(2)},updatePrice:function(){var ai,ah;ai=T[U.plan][Z][U.userCount].Price;ah=T[U.plan][l][U.userCount].Price;if(y!==null&&y===true&&U.userCount>1){ai=ai/2;ai=Math.round(ai*100)/100;ah=ah/2;ah=Math.round(ah*100)/100}this.container.find(d).find(A).html(ai.toFixed(2));this.container.find(x).find(A).html(ah.toFixed(2))},getPrice:function(){var ah,ai;ai=T[U.plan][U.period][U.userCount].Price;if(y!=null&&y==true&&U.userCount>1){ah=ai/2;ai=Math.round(ah*100)/100}return ai},getPromotionDiscount:function(){if(ad&&ad.discountMultiplier){if(T[U.plan][U.period][U.userCount].PromoApplied){return(Math.round(ad.discountMultiplier*100)).toString()}}return null},findLowestUsableUserCount:function(){var ai=this,aj,ah;aj=$.map($(L+" ul li a"),function(ak){return $(ak).html()});ah=aj.filter(function(ak){return ak>=ai.get("currentlyUsedUsers")});return Math.min.apply(Math,ah)},onBillingPeriodChange:function(ah){var ai=this.container.find(r);ai.removeClass("selected-plan");ai.find(P).hide();if(!ah.hasClass("billing-period")){ah=ah.closest(r)}ah.find(P).show();ah.addClass("selected-plan");$(j).val(ah.data("value"));this.updateCart()},onBillingPlanChange:function(ah){v.updateHiddenField(g,ah);this.updateCart()},onUserCountClick:function(ah){var ai=this.container.find(E);if(!$(ah).hasClass("disabled")){if(ah.data("value")===1){this.container.find(".single-user-pricing").show()}else{this.container.find(".single-user-pricing").hide()}if(ah.data("value")>=5){ai.attr("disabled",false)}else{ai.attr("disabled",true)}ai.removeAttr("checked");y=false;v.updateDropDown(ac+" "+t,ah);v.updateHiddenField(ac+" "+Y,ah);this.updateCart()}},onCountryClick:function(ai){var ah=$(ai).data("index");v.updateDropDown(q,ai);v.updateHiddenField(D,ai);this.resetStates(ah)},onStateClick:function(ah){v.updateDropDown(u,ah);v.updateHiddenField(w,ah)},onPlanTypeClick:function(ah){if($(ah).length>0&&!$(ah).hasClass("disabled")){v.updateDropDown(ag,ah);v.updateHiddenField(g,ah);this.updateCart()}},greyOutNumUserDropDown:function(ah){var ai;this.container.find(L+" ul li a").removeClass("disabled");this.container.find(L+" ul li a").filter(function(aj,ak){ai=$(ak).html();return parseInt(ai)<parseInt(ah)}).addClass("disabled")},checkToDisableAcademic:function(){if(parseInt(this.container.find("#userCountField").val())<5){y=false;this.container.find(".student-or-teacher").attr("disabled","disabled")}else{this.container.find(".student-or-teacher").removeAttr("disabled")}},propCardNameError:Ember.computed(function(){return this.get("cardNameError")}).property("cardNameError"),propFirstNameError:Ember.computed(function(){return this.get("firstNameError")}).property("firstNameError"),propLastNameError:Ember.computed(function(){return this.get("lastNameError")}).property("lastNameError"),propAddress1Error:Ember.computed(function(){return this.get("address1Error")}).property("address1Error"),propCcNumError:Ember.computed(function(){return this.get("ccNumError")}).property("ccNumError"),propCityError:Ember.computed(function(){return this.get("cityError")}).property("cityError"),propExpirationDateError:Ember.computed(function(){return this.get("expirationDateError")}).property("expirationDateError"),propCvcError:Ember.computed(function(){return this.get("cvcError")}).property("cvcError"),propStateError:Ember.computed(function(){return this.get("stateError")}).property("stateError"),propZipError:Ember.computed(function(){return this.get("zipError")}).property("zipError"),propPhoneNumberError:Ember.computed(function(){return this.get("phoneNumberError")}).property("phoneNumberError"),propEmail:Ember.computed(function(){return this.get("email")}).property("email"),propAccountName:Ember.computed(function(){return this.get("accountName")}).property("accountName"),propTransactionID:Ember.computed(function(){return this.get("transactionID")}).property("transactionID"),propAccountType:Ember.computed(function(){return this.get("accountType")}).property("accountType"),propUserCount:Ember.computed(function(){return this.get("userCount")}).property("userCount"),propBillingPeriod:Ember.computed(function(){return this.get("billingPeriod")}).property("billingPeriod"),propNextBillingDate:Ember.computed(function(){return this.get("nextBillingDate")}).property("nextBillingDate")});GliffyApp.accountEditorPurchasePageController=GliffyApp.AccountEditorPurchasePageController.create()}());(function(){var B=window.FormHelpers;var aa=".editor-stripe-purchase-page-container";var r=".billing-form";var T="#plan-users";var q=T+" ul";var y=T+" .dropdown-toggle";var ai="#userCountField";var af="#plan-type";var ad=af+" ul";var at=af+" .dropdown-toggle";var h=".plan-name";var X=".selected-billing";var x=".billing-period";var k="#billingPeriodField";var g="#accountTypeField";var e=".monthly-billing";var C=".annual-billing";var H=".price";var M=".cvc-link";var p="#cvc-template";var am="input[name='ccToken']";var Q="input[name='ccNumField']";var ah="input[name='cvc']";var an="input[name='expirationDate']";var aj="input[name='zip']";var j=".no-zipcode-check";var t=".no-zip-message";var d=".coupon-code";var A=".editor-stripe-coupon-submit";var G="#couponCodeField";var ag=".coupon-msg";var D="Coupon Applied";var O="Not a valid coupon";var ae=".card-required";var aq=".exp-required";var al=".zip-required";var J=".cvc-required";var s=".credit-card-error";var v=".card-exp-error";var o=".card-cvc-error";var au=".card-zip-error";var Z=".purchase-radio-set";var ao=".use-existing-card";var z=".use-new-card";var n=".billing-inputs-container";var u=".bottom-block";var w=".general-error";var U=".stripe-cvc-info";var L=".student-or-teacher";var V=".student-or-teacher-info";var K="The CVC is a 3 digit number on the back of your card (Visa / Mastercard) or a 4 digit number on the front and to the right of your main card number (Amex).";var ar="We offer a discount to teachers and students, subject to verification. Academic pricing is not available for plans for two users or fewer. Please sign up with your school’s email address to qualify.";var c="<div class='popover'><div class='arrow'></div><div class='popover-inner'><div class='popover-content'><p></p></div></div></div>";var m="Annual";var ak="Monthly";var f="Standard";var Y="Business";var R="Businessteam";var W=".editor-stripe-purchase-page-submit";var S="Processing...";var F="Purchase";var ap={};var ab={};var P=null;var N,I,l;var E=$(aa).find(L).prop("checked");var ac={plan:f,period:ak,userCount:1,price:0};GliffyApp.AccountEditorStripePurchasePageController=Ember.Controller.extend({currentlyUsedUsersBinding:Ember.Binding.oneWay("GliffyApp.authController.account.userCount"),cardNameError:null,address1Error:null,ccNumError:null,expirationDateError:null,cvcError:null,zipError:null,container:null,email:null,accountName:null,transactionID:null,accountType:null,userCount:null,billingPeriod:null,nextBillingDate:null,bindUserCount:true,appliedCouponType:null,appliedCouponDiscount:null,actions:{closeAccountModal:function(){GliffyApp.accountManageController.cancel()}},showEditorStripePurchasePage:function(){GliffyApp.authController.refreshAccountSettings();this.loadStripeApiToken();this.clearCreditCardData();this.loadContainer();this.loadTemplates();this.resetErrorMessages();this.loadPricingData();this.inputMasking();this.getExistingCoupon()},loadContainer:function(){this.container=$(aa);this.injectAffiliateScript()},injectAffiliateScript:function(){if($(this.container).find("#idevaffilate-script").length===0){var av=$("<script id='idevaffilate-script'><\/script>");av.attr("type","text/javascript");av.attr("src","https://www.idevaffiliate.com/33164/connect/stripe_ip.php");$(this.container).append(av)}},loadTemplates:function(){var aw='{{#each items}}<li><a href="#" data-index="{{@index}}" data-value="{{this}}">{{this}}</a></li>{{/each}}';var ax='Select <span class="caret"></span>';var av='<div class="selection"> <h4>Selected Plan</h4> <h5>{{plan}}</h5> {{#if period}}<p>{{period}} Billing</p> {{/if}}<p>{{userCount}} {{pluralize userCount "User" "Users"}}</p> {{#if discount}}<p class="promotion">{{discount}}% off 1 year</p> {{/if}}</div> <div class="cart"> <h5>Amount</h5> <span class="amount-due">${{format-price price}}<sup class="disclaimer">*</sup> </span> <span class="payment-frequency quarterly"> / 3 mo </span> <span class="payment-frequency monthly"> / mo </span> <span class="payment-frequency yearly"> / yr </span> </div> <div class="disclaimer"> <sup>*</sup>Single user accounts are billed every 3 months (93 days)</div>';N=Handlebars.compile(aw);l=Handlebars.compile(ax);I=Handlebars.compile(av)},toTitleCase:function(av){return av.replace(/\w\S*/g,function(aw){return aw.charAt(0).toUpperCase()+aw.substr(1).toLowerCase()})},loadPricingData:function(){var av=this;$.ajax({url:"/go/commerceV2/productinfo",dataType:"json",success:function(ay){var ax=GliffyApp.authController.get("BILLING_INFO");ab=ay;av.initializeCart();av.bindEvents();av.getCreditCardData();av.checkToDisableAcademic();if(av.toTitleCase(ax.accountType)===R){av.greyOutNumUserDropDown((av.get("currentlyUsedUsers")<5)?2:av.get("currentlyUsedUsers"))}else{av.greyOutNumUserDropDown(av.get("currentlyUsedUsers"))}var aw=av.container.find(p).html();av.container.find(M).webuiPopover({placement:"top",title:"",content:aw,width:420});av.container.find(W).unbind("click").on("click",av.submitForm)}})},initializeCart:function(){var az,ax=this.container.find(h),ay,aw,aA=parseInt(this.findLowestUsableUserCount()),aB=this.container.find(y),av=$(".more-users");aw=GliffyApp.authController.get("BILLING_INFO");av.hide();if(aw!==null&&aw!==undefined){ay=this.toTitleCase(aw.accountType);ac.plan=ay;ac.period=aw.billingPeriod;aB.removeClass("disabled").attr("data-toggle","dropdown");this.set("bindUserCount",true);if(ac.plan===R&&aA<5){ac.userCount=5}else{ac.userCount=aA}if(ac.plan===R||(ac.plan===Y&&aA>1)){ac.plan=Y;ax.html("Business Team")}else{if(ac.plan===Y&&aA===1){this.set("bindUserCount",false);aB.addClass("disabled").removeAttr("data-toggle");ax.html("Business");av.show()}else{ax.html(ay)}}}this.container.find(g).val(ac.plan);this.container.find(k).val(ac.period);this.container.find(ai).val(ac.userCount);ac.price=this.getPrice();ac.discount=this.getPromotionDiscount();this.onPlanTypeClick(this.container.find(af).find("[data-value="+ac.plan+"]"));this.container.find(".billing-period").removeClass("selected-plan");this.container.find("."+ac.period.toLowerCase()+"-billing").addClass("selected-plan").find(X).show();az=this.container.find(T+" a[data-value='"+ac.userCount+"']");B.updateDropDown(aa+" "+y,az);if(ac.userCount===1){this.container.find(".single-user-pricing").show()}this.updatePrice()},bindEvents:function(){var av=this,ax,aw,ay=av.container.find(x);ay.on("click",function(az){az.preventDefault();av.onBillingPeriodChange($(az.target))});ay.on("keydown",function(aA){if(aA.keyCode===13||aA.keyCode===32){aA.preventDefault();av.onBillingPeriodChange($(aA.target))}if(aA.keyCode===40&&$(aA.target).hasClass("monthly-billing")){var az=av.container.find(C);az.focus();av.onBillingPeriodChange(az)}if(aA.keyCode===38&&$(aA.target).hasClass("annual-billing")){var aB=av.container.find(e);aB.focus();av.onBillingPeriodChange(aB)}});av.container.find(q).on("click",function(az){az.preventDefault();ax=$(az.target);av.onUserCountClick(ax)});av.container.find(ad).on("click",function(az){az.preventDefault();av.onPlanTypeClick(az.target)});if(av.get("bindUserCount")){av.container.find(y).on("keydown",av.userCountBindingDropDown)}else{av.container.find(y).off("keydown",av.userCountBindingDropDown)}av.container.find(at).on("keydown",B.onDropDownKeyDown,function(az){B.onDropDownKeyDown(az,aa+" "+g);if(az.keyCode===13||az.keyCode===32){av.onPlanTypeClick($(az.target))}});av.container.find(L).on("change",function(az){E=av.container.find(L).prop("checked");av.updateCart()});av.container.find(U).popover({trigger:"hover",content:K,template:c,placement:"right"});av.container.find(V).webuiPopover({trigger:"hover",content:ar,template:c,placement:"bottom"});av.container.find(".change-plan").on("click",function(){GliffyApp.accountManageController.setTab("#account-upgrade")});av.container.find("input[type='checkbox']").each(function(aB){var aA=$(this);var az=aA.prop("name");av.container.find("label[for='"+az+"']").on("click",function(){aA.trigger("click")})});av.container.find(ao).on("change",function(){av.hidePurchaseForm()});av.container.find(z).on("change",function(){av.showPurchaseForm()});av.container.find(j).change(function(){if(av.container.find(j).is(":checked")){av.container.find(aj).hide()}else{av.container.find(aj).show()}});av.container.find(A).on("click",function(az){az.preventDefault();av.validateCouponCode()})},hidePurchaseForm:function(){this.container.find(n).hide();this.container.find(u).addClass("purchase-btn-fl")},showPurchaseForm:function(){this.container.find(n).show();this.container.find(u).removeClass("purchase-btn-fl")},getCreditCardData:function(){var av=this;$.ajax({url:"/go/api/subscriptions/card/"+GliffyApp.authController.get("account").id,type:"GET",dataType:"json",success:function(aw){if(aw.response===200&&aw.data.hasCardOnFile){av.populateCardInfo(aw);av.container.find(Z).show();av.container.find(ao).attr("checked","checked");av.hidePurchaseForm()}else{av.container.find(Z).hide()}},error:function(aw){av.container.find(ao).attr("checked",null);av.container.find(Z).hide()}})},populateCardInfo:function(av){this.container.find(".existing-card").html(av.data.maskedCard);this.container.find(".purchase-radio-card-type").html(av.data.cardType);this.container.find(".purchase-radio-card-expiration").html("Exp "+av.data.expirationDate)},userCountBindingDropDown:function(av){B.onDropDownKeyDown(av,aa+" "+ai);if(av.keyCode===13||av.keyCode===32){GliffyApp.accountEditorStripePurchasePageController.onUserCountClick($(av.target))}},hideGeneralError:function(aw){var av=GliffyApp.accountEditorStripePurchasePageController.container;av.find(w).hide()},showGeneralError:function(aw){var av=GliffyApp.accountEditorStripePurchasePageController.container;av.find(w).show()},submitForm:function(ax){var av=GliffyApp.accountEditorStripePurchasePageController.container,aw=av.find(r);ax.preventDefault();GliffyApp.accountEditorStripePurchasePageController.resetErrorMessages();if(!$(ao).is(":checked")){if(!GliffyApp.accountEditorStripePurchasePageController.validateRequiredFields()){return false}Stripe.card.createToken(aw,GliffyApp.accountEditorStripePurchasePageController.stripeResponseHandler)}else{GliffyApp.accountEditorStripePurchasePageController.ajaxPurchase()}av.find(W).off("click",GliffyApp.accountEditorStripePurchasePageController.submitForm);av.find(W).html(S).addClass("processing")},validateRequiredFields:function(){var aw=true;var av=GliffyApp.accountEditorStripePurchasePageController.container;if(av.find(Q).val()===""){av.find(ae).show();aw=false}if(av.find(an).val()===""){av.find(aq).show();aw=false}if(av.find(ah).val()===""){av.find(J).show();aw=false}if(av.find(aj).val()===""&&!av.find(j).is(":checked")){av.find(al).show();aw=false}return aw},stripeResponseHandler:function(aw,ax){var ay=$("input[name='cardName']").val(),av=GliffyApp.accountEditorStripePurchasePageController.container;if(aw===200){$(am).val(ax.id);GliffyApp.accountEditorStripePurchasePageController.clearFormFields();GliffyApp.accountEditorStripePurchasePageController.ajaxPurchase()}else{av.find(W).on("click",GliffyApp.accountEditorStripePurchasePageController.submitForm).html(F).removeClass("processing");if(ax.error.type!=="invalid_request_error"){if(ax.error.code==="incorrect_number"||ax.error.code==="card_declined"){av.find(s).show();GliffyApp.accountEditorStripePurchasePageController.set("ccNumError",ax.error.message)}else{if(ax.error.code==="invalid_expiry_year"){av.find(v).show();GliffyApp.accountEditorStripePurchasePageController.set("expirationDateError",ax.error.message)}else{av.find(s).show();GliffyApp.accountEditorStripePurchasePageController.set("ccNumError",ax.error.message)}}}else{if(ax.error.code==="invalid_cvc"){av.find(o).show();GliffyApp.accountEditorStripePurchasePageController.set("cvcError",ax.error.message)}else{av.find(s).show();GliffyApp.accountEditorStripePurchasePageController.set("ccNumError",ax.error.message)}}}},ajaxPurchase:function(){var av=GliffyApp.accountEditorStripePurchasePageController.container;$.ajax({url:"/go/commerceV2/processeditorpurchase",type:"POST",data:av.find(r).serialize(),success:function(ax){av.find(W).html(F).removeClass("processing");if(ax.result==="error"){av.find(".error-msg ").show();av.find(ah).val("");for(var aw in ax.errors){GliffyApp.accountEditorStripePurchasePageController.set(aw+"Error",ax.errors[aw][0].toString())}av.find(W).on("click",GliffyApp.accountEditorStripePurchasePageController.submitForm)}else{GliffyApp.authController.get("billingStatus").refreshStatusAndAccount();GliffyApp.accountManageController.loadHistory();GliffyApp.accountEditorStripePurchasePageController.stripePurchaseSuccess()}},error:function(ax){GliffyApp.accountEditorStripePurchasePageController.showGeneralError();var aw=av.find(W);aw.html(F).removeClass("processing");aw.on("click",GliffyApp.accountEditorStripePurchasePageController.submitForm)}})},clearFormFields:function(){var av=[Q,ah,an,aj];av.forEach(function(aw){$(aw).val("")})},stripePurchaseSuccess:function(){GliffyApp.accountEditorStripePurchasePageController.container.find(am).val("");$.ajax({url:"/go/commerceV2/success.json",type:"GET",success:function(av){GliffyApp.accountEditorStripePurchasePageController.set("email",av.email);GliffyApp.accountEditorStripePurchasePageController.set("accountName",av.accountName);GliffyApp.accountEditorStripePurchasePageController.set("accountType",av.accountType);GliffyApp.accountEditorStripePurchasePageController.set("userCount",av.userCount);GliffyApp.accountEditorStripePurchasePageController.set("billingPeriod",av.billingPeriod);GliffyApp.accountManageController.showStripePurchaseSuccessTab()}})},sendAnalytics:function(aw){var av=aw.price/100;window.dataLayer=window.dataLayer||[];dataLayer.push({transactionId:aw.transactionID,transactionAffiliation:aw.accountName,transactionTotal:av,transactionTax:0,transactionShipping:0,transactionProducts:[{sku:aw.productID,name:aw.planName,price:av,quantity:1}],currency:"USD",productId:aw.productID,event:"purchase goal",goalUrl:"/4048237854/goal"});if(aw.userCount>1){window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];window.optimizely.push(["trackEvent","purchaseSuccessMU"])}window.segmentUtils.ajaxLoadAccount();window.segmentUtils.segmentTracking(true,true);window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];if(!isNaN(aw.paymentGross)){window.optimizely.push(["trackEvent","purchaseSuccess",{revenue:aw.paymentGross}]);aw.paymentGross=aw.paymentGross/100}else{window.optimizely.push(["trackEvent","purchaseSuccess"])}if(window.mixpanel&&typeof window.mixpanel.identify==="function"&&window.mixpanel.people&&typeof window.mixpanel.people.set==="function"&&typeof window.mixpanel.people.track_charge==="function"&&typeof window.mixpanel.track==="function"){window.mixpanel.identify(aw.uid);window.mixpanel.people.set({product:aw.productID,"$email":aw.email});window.mixpanel.track("purchase",{accountId:aw.accountId,userId:aw.userId,product:aw.productID,organizationSizeMin:aw.organizationSizeMin,organizationSizeMax:aw.organizationSizeMax,accountCreateDate:aw.accountCreateDate,paymentGross:aw.paymentGross});window.mixpanel.people.track_charge(aw.paymentGross);if(aw.userCount>1){window.mixpanel.track("purchaseMU",{accountId:aw.accountId,userId:aw.userId,product:aw.productID,organizationSizeMin:aw.organizationSizeMin,organizationSizeMax:aw.organizationSizeMax,accountCreateDate:aw.accountCreateDate,paymentGross:aw.paymentGross})}window.mixpanel.track("viewPage",{"page name":document.title,url:window.location.pathname})}if(aw.userCount>=25){window.optimizely.push(["trackEvent","purchaseSuccessMU25plus"])}if(aw.accountType==="BUSINESS"){if(aw.userCount>1){window.optimizely.push(["trackEvent","businessPurchaseMU"])}else{window.optimizely.push(["trackEvent","businessPurchaseSU"])}}else{if(aw.userCount>1){window.optimizely.push(["trackEvent","standardPurchaseMU"])}else{window.optimizely.push(["trackEvent","standardPurchaseSU"])}}},resetErrorMessages:function(){var av=GliffyApp.accountEditorStripePurchasePageController.container;$(".error-msg ").hide();this.set("cardNameError",null);this.set("ccNumError",null);this.set("expirationDateError",null);this.set("cvcError",null);this.set("zipError",null);this.hideGeneralError();av.find(ae).hide();av.find(aq).hide();av.find(J).hide();av.find(al).hide()},clearCreditCardData:function(){$(Q).val("");$(ah).val("");$(an).val("");$(aj).val("")},inputMasking:function(){GliffyApp.accountEditorStripePurchasePageController.container.find(Q).formatter({pattern:"{{9999}}   {{9999}}   {{9999}}   {{9999}}",persistent:false});GliffyApp.accountEditorStripePurchasePageController.container.find(an).formatter({pattern:"{{99}}  /  {{9999}}",persistent:false});GliffyApp.accountEditorStripePurchasePageController.container.find(ah).formatter({pattern:"{{9999}}",persistent:false})},updateCart:function(){this.fillCart();this.updatePrice()},fillCart:function(){var aw;var av=this.container.find(g);var ax=this.container.find(k);ac.plan=(av.length>0&&av.val()!="")?av.val():f;ac.period=(av.length>0&&ax.val()!="")?ax.val():ak;aw=parseInt(this.container.find(ai).val());if(aw===aw){ac.userCount=parseInt(aw)}else{ac.userCount=1}ac.price=this.getPrice();ac.price=ac.price.toFixed(2)},updatePrice:function(){var aw,av;aw=ab[ac.plan][ak][ac.userCount].Price;av=ab[ac.plan][m][ac.userCount].Price;if(E!==null&&E===true&&ac.userCount>1){aw=aw/2;aw=Math.round(aw*100)/100;av=av/2;av=Math.round(av*100)/100}this.container.find(e).find(H).html(aw.toFixed(2));this.container.find(C).find(H).html(av.toFixed(2));this.container.find(".amount-due-price").html("$"+$(".selected-plan").find(".price").html());if(this.get("appliedCouponType")!==null&&this.get("appliedCouponDiscount")!==null){this.applyCouponToSubTotal(this.get("appliedCouponType"),this.get("appliedCouponDiscount"))}},getPrice:function(){var av,aw;aw=ab[ac.plan][ac.period][ac.userCount].Price;if(E!=null&&E==true&&ac.userCount>1){av=aw/2;aw=Math.round(av*100)/100}return aw},getPromotionDiscount:function(){if(ap&&ap.discountMultiplier){if(ab[ac.plan][ac.period][ac.userCount].PromoApplied){return(Math.round(ap.discountMultiplier*100)).toString()}}return null},findLowestUsableUserCount:function(){var aw=this,ax,av;ax=$.map($(T+" ul li a"),function(ay){return $(ay).html()});av=ax.filter(function(ay){return ay>=aw.get("currentlyUsedUsers")});return Math.min.apply(Math,av)},onBillingPeriodChange:function(av){var aw=this.container.find(x);aw.removeClass("selected-plan");aw.find(X).hide();if(!av.hasClass("billing-period")){av=av.closest(x)}av.find(X).show();av.addClass("selected-plan");this.container.find(k).val(av.data("value"));this.updateCart()},onBillingPlanChange:function(av){B.updateHiddenField(g,av);this.updateCart()},onUserCountClick:function(av){var aw=this.container.find(L);if(!$(av).hasClass("disabled")){if(av.data("value")===1){this.container.find(".single-user-pricing").show()}else{this.container.find(".single-user-pricing").hide()}if(av.data("value")>=5){aw.attr("disabled",false)}else{aw.attr("disabled",true)}aw.removeAttr("checked");E=false;B.updateDropDown(aa+" "+y,av);B.updateHiddenField(aa+" "+ai,av);this.updateCart()}},onPlanTypeClick:function(av){if($(av).length>0&&!$(av).hasClass("disabled")){B.updateDropDown(at,av);B.updateHiddenField(g,av);this.updateCart()}},greyOutNumUserDropDown:function(av){var aw;this.container.find(T+" ul li a").removeClass("disabled");this.container.find(T+" ul li a").filter(function(ax,ay){aw=$(ay).html();return parseInt(aw)<parseInt(av)}).addClass("disabled")},checkToDisableAcademic:function(){if(parseInt(this.container.find("#userCountField").val())<5){E=false;this.container.find(".student-or-teacher").attr("disabled","disabled")}else{this.container.find(".student-or-teacher").removeAttr("disabled")}},loadStripeApiToken:function(){$.ajax({url:"/go/commerceV2/stripeapitoken",dataType:"json",success:function(av){Stripe.setPublishableKey(av.stripeApiKey)},error:function(ax,av,aw){}})},validateCouponCode:function(){var aw=this,av=aw.container,ax=av.find(d).val();av.find(ag).html("").hide().removeClass("coupon-success").removeClass("coupon-error");if(ax!==null&&ax!=="undefined"&&ax!==""){$.ajax({url:"/go/api/subscriptions/coupon/"+ax,type:"GET",dataType:"json",success:function(ay){if(ay.valid){var az=0;av.find(G).val(ay.id);if(ay.type==="percent"){az=ay.percentOff}else{az=ay.amountOff}aw.applyCouponToSubTotal(ay.type,az);av.find(ag).html(D).addClass("coupon-success").show()}else{aw.resetPriceAndCoupon();av.find(ag).html(ay.error.message).addClass("coupon-error").show()}},error:function(ay){aw.resetPriceAndCoupon();av.find(ag).html(O).addClass("coupon-error").show()}})}else{aw.resetPriceAndCoupon();av.find(ag).html(O).addClass("coupon-error").show()}},applyCouponToSubTotal:function(aw,ax){var ay=this.container.find(".amount-due-price");var av=$(".selected-plan").find(".price").html();av=parseFloat(av);this.set("appliedCouponType",aw);this.set("appliedCouponDiscount",ax);if(aw==="percent"){av=(av-(av*(ax*0.01))).toFixed(2)}else{av=Math.max(av-(ax*0.01),0).toFixed(2)}ay.html("$"+av)},resetPriceAndCoupon:function(){var av=$(".selected-plan").find(".price").html(),aw=this.container.find(".amount-due-price");aw.html("$"+av);this.set("appliedCouponType",null);this.set("appliedCouponDiscount",null);this.container.find(G).val(null)},getExistingCoupon:function(){var av=this;$.ajax({url:"/go/api/subscriptions/getcoupon/"+GliffyApp.authController.get("account").id,type:"GET",dataType:"json",success:function(aw){if(aw.valid){var ax=0;av.container.find(d).val(aw.id);av.container.find(G).val(aw.id);if(aw.type==="percent"){ax=aw.percentOff}else{ax=aw.amountOff}av.applyCouponToSubTotal(aw.type,ax);av.container.find(ag).html(D).addClass("coupon-success").show()}},error:function(aw){}})},propCardNameError:Ember.computed(function(){return this.get("cardNameError")}).property("cardNameError"),propCcNumError:Ember.computed(function(){return this.get("ccNumError")}).property("ccNumError"),propExpirationDateError:Ember.computed(function(){return this.get("expirationDateError")}).property("expirationDateError"),propCvcError:Ember.computed(function(){return this.get("cvcError")}).property("cvcError"),propZipError:Ember.computed(function(){return this.get("zipError")}).property("zipError"),propEmail:Ember.computed(function(){return this.get("email")}).property("email"),propAccountName:Ember.computed(function(){return this.get("accountName")}).property("accountName"),propTransactionID:Ember.computed(function(){return this.get("transactionID")}).property("transactionID"),propAccountType:Ember.computed(function(){return this.get("accountType")}).property("accountType"),propUserCount:Ember.computed(function(){return this.get("userCount")}).property("userCount"),propBillingPeriod:Ember.computed(function(){return this.get("billingPeriod")}).property("billingPeriod"),propNextBillingDate:Ember.computed(function(){return this.get("nextBillingDate")}).property("nextBillingDate")});GliffyApp.accountEditorStripePurchasePageController=GliffyApp.AccountEditorStripePurchasePageController.create()}());(function(){GliffyApp.HeaderView=Ember.View.extend({MSAppId:"d8e91192-2f34-471c-80a6-900880844ffd",appName:Ember.computed(function(){return GLIFFY.ENV.appName||"Gliffy Demo App"}).property(),isMSApp:Ember.computed(function(){return(GLIFFY.ENV.app==this.get("MSAppId"))}).property()})}());(function(){GliffyApp.FontLoaderView=Ember.View.extend({didInsertElement:function(){var c=$(".font-list").html();$("head").append(c)}})}());(function(){GliffyApp.FileOpenBrowserView=Ember.View.extend({didInsertElement:function(){$(".gliffy-file-open-browser .gliffy-document-list").bind("documentListItemOpen",function(d,c){GliffyApp.fileOpenBrowserController.open(c)});$(".gliffy-file-open-browser .gliffy-document-list").scroll(function(c){GliffyApp.fileOpenBrowserController.handleDocumentListScroll(c)});$(".gliffy-file-open-browser .gliffy-document-list").bind("scrollStart",function(c){GliffyApp.fileOpenBrowserController.handleDocumentListScrollStart(c)});$(".gliffy-file-open-browser .gliffy-document-list").bind("scrollEnd",function(c){GliffyApp.fileOpenBrowserController.handleDocumentListScrollEnd(c)});$(".gliffy-file-open-browser .gliffy-document-sort-dropdown").delegate("a","click",function(c){c.preventDefault();GliffyApp.fileOpenBrowserController.sortDocumentList($(c.currentTarget).data("gliffy-sort-key"),$(c.currentTarget).data("gliffy-sort-order"))});$(".gliffy-file-open-browser .gliffy-document-search a").on("click",function(c){GliffyApp.fileOpenBrowserController.search($(".gliffy-file-open-browser .gliffy-document-search input").attr("value"))});$(".gliffy-file-open-browser .gliffy-document-search input").on("keyup",function(c){if(c.keyCode===13){GliffyApp.fileOpenBrowserController.search($(".gliffy-file-open-browser .gliffy-document-search input").attr("value"))}});$(".gliffy-file-open-browser .gliffy-account-folders-container").bind("folderClicked",function(d,c){GliffyApp.fileOpenBrowserController.handleFolderClick(c)});$("#gliffy-modal-file-open-browser .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-file-open-browser .gliffy-account-folders").scroll(function(c){GliffyApp.accountFoldersController.positionSelectionBar()});$(".gliffy-file-open-browser .gliffy-common-folder span").hover(function(){GliffyApp.accountFoldersController.hideHoverBar();$(this).parent().addClass("gliffy-folder-hovered")},function(){$(this).parent().removeClass("gliffy-folder-hovered")})}})}());(function(){GliffyApp.ShareMenuView=GliffyApp.AbstractMenuView.extend({eventHub:Ember.inject.service(),didInsertElement:function(){var c=this;$(".gliffy-filemenu-publish").on("click",function(d){c.menuPublish(d)});$(".gliffy-filemenu-collaborate").on("click",function(d){c.menuCollaborate(d)})},menuPublish:function(c){if(!c.isTrigger){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"publish"})}this.onMenuClick(c,"gliffy-toolbar-menu-file",false);this.get("eventHub").trigger("showShareModal")},menuCollaborate:function(c){if(!c.isTrigger){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"collaborate"})}this.onMenuClick(c,"gliffy-toolbar-menu-file",false);this.get("eventHub").trigger("showCollaborateModal")}})}());(function(){GliffyApp.WelcomeScreenView=Ember.View.extend({appName:"",didInsertElement:function(){$("#gliffy-modal-welcome-screen .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);GliffyApp.welcomeScreenController.createFileUploadControls();this.set("appName",window.GLIFFY.ENV.appName)},willDestroyElement:function(){$(".gliffy-sidebar.scrollable").css("overflow-y","auto")},selectRecent:function(c){c.preventDefault();GliffyApp.welcomeScreenController.handleSelectRecentDiagram(c)},showTips:function(c){c.preventDefault();GliffyApp.welcomeScreenController.handleShowTips($(c.currentTarget))}});GliffyApp.WelcomeScreenTemplateView=Ember.View.extend({openTemplate:function(c){GliffyApp.welcomeScreenController.hide();c.preventDefault();GliffyApp.welcomeScreenController.handleOpenTemplate(c.context)}})}());(function(){GliffyApp.WelcomeScreenDocumentListItemView=Ember.View.extend({alreadyClicked:false,didInsertElement:function(c){$(".gliffy-document-list-item-tooltip").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-welcome-screen-list-item").on("mouseenter",function(){$(this).css("background-color","#E9EEF4")});$(".gliffy-welcome-screen-list-item").on("mouseleave",function(){$(this).css("background-color","#FFFFFF")})},click:function(c){c.preventDefault();if(!this.alreadyClicked){this.alreadyClicked=true;GliffyApp.welcomeScreenController.handleSelectRecentDiagram(c,this)}}})}());(function(){GliffyApp.TemplateBrowserView=Ember.View.extend({didInsertElement:function(){var c=$(".gliffy-template-browser .gliffy-document-list");$(".gliffy-template-browser .gliffy-account-folders-container").bind("folderClicked",function(f,d){GliffyApp.templateBrowserController.handleFolderClick(d)});c.bind("documentListItemOpen",function(f,d){GliffyApp.templateBrowserController.openTemplate(d);if(GliffyApp.accountFoldersController.selectedItem.attr("showOnlyPublic")==="true"&&GliffyApp.accountFoldersController.rootFolderId===5000){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"templateManager",action:"openGliffyTemplate",label:GliffyApp.accountFoldersController.getSelectedFolderTitle()+"/"+d.name})}else{GLIFFY.Utils.analyticsEvent("trackEvent",{category:"templateManager",action:"openAccountTemplate"})}});c.scroll(function(d){GliffyApp.templateBrowserController.handleDocumentListScroll(d)});c.bind("scrollStart",function(d){GliffyApp.templateBrowserController.handleDocumentListScrollStart(d)});c.bind("scrollEnd",function(d){GliffyApp.templateBrowserController.handleDocumentListScrollEnd(d)});$("#gliffy-modal-template-browser .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-template-browser .gliffy-account-folders").scroll(function(d){GliffyApp.accountFoldersController.positionSelectionBar()});$("#gliffy-modal-template-browser a[data-dismiss='modal']").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"templateManager",action:"closeOrCancel"})})}})}());(function(){GliffyApp.AccountFoldersView=Ember.View.extend({didInsertElement:function(){$(".gliffy-common-folders-container .recent").on("click",function(c){GliffyApp.accountFoldersController.handleCommonFolderClick(c,GliffyApp.accountFoldersController.RECENT_FOLDER_ID)});$(".gliffy-common-folders-container .starred").on("click",function(c){GliffyApp.accountFoldersController.handleCommonFolderClick(c,GliffyApp.accountFoldersController.STARRED_FOLDER_ID);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"starredFolderClick",label:window.location.pathname})});$(".gliffy-common-folders-container .shared").on("click",function(c){GliffyApp.accountFoldersController.handleCommonFolderClick(c,GliffyApp.accountFoldersController.SHARED_FOLDER_ID);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"sharedFolderClick",label:window.location.pathname})})}})}());(function(){var c=true;GliffyApp.DocumentListItemView=Ember.View.extend({documentListItem:null,didInsertElement:function(h){var f=this,d,g;$(".gliffy-document-list-item-tooltip").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-icon-star").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-icon-star-off").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-document-list-item-delete").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);this.$().bind("dblclick",function(j){GliffyApp.documentListController.handleDoubleClickItem()});this.$().bind("mousedown",function(e){if(GliffyApp.accountFoldersController.getSelectedFolderType()===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE){f.mousedown(e)}});this.$().bind("mouseover",function(j){if($(j.currentTarget).hasClass("gliffy-grid-item")){if($(j.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-grid-item-preview-zoom").length===0){$(j.currentTarget).find(".gliffy-document-list-item-preview-container").append('<div class="gliffy-document-grid-item-preview-zoom"></div>');$(j.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-grid-item-preview-zoom").on("click",function(k){GliffyApp.documentListController.zoom(f.documentListItem)})}}else{if($(j.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-list-item-preview-zoom").length===0){$(j.currentTarget).find(".gliffy-document-list-item-preview-container").append('<div class="gliffy-document-list-item-preview-zoom"></div>');$(j.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-list-item-preview-zoom").on("click",function(k){GliffyApp.documentListController.zoom(f.documentListItem)})}}});this.$().bind("mouseout",function(j){g=$(j.currentTarget);setTimeout(function(){if(!g.is(":hover")){$(j.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-list-item-preview-zoom").remove();$(j.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-grid-item-preview-zoom").remove()}},50)});this.$(".favorite").bind("click",function(e){f.favorite(e)});this.$("img").bind("mousedown",function(e){if(GliffyApp.accountFoldersController.getSelectedFolderType()===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE&&GliffyApp.documentListController.isEditableItems){f.mousedown(e)}return false});$(".gliffy-document-list-container .gliffy-document-title").delegate("input","dblclick",function(j){return false});$(".gliffy-document-list-container .gliffy-document-title").delegate("input","focusout",function(j){GliffyApp.documentListController.handleRenameDocument(j.currentTarget.value)});this.$().find(".gliffy-document-title").css("max-width",GliffyApp.documentListController.getDocumentTitleMaxWidth())},mousedown:function(e){var d=this;if(!d.isRenameInputActive()){this.proxy=new GLIFFY.DragProxy(5,e.pageX,e.pageY);this.$().bind("mousemove.dragthreshold",function(f){d.startDrag(f)}).bind("mouseup.dragthreshold",function(f){d.endDrag(f)}).bind("mouseout.dragthreshold",function(f){d.endDrag(f)})}},isRenameInputActive:function(){return this.$().find(".gliffy-document-title input").is(":visible")},startDrag:function(f){var d=this,e;if(this.proxy.aboveThreshold(f.pageX,f.pageY)){this.click(f);$(f.currentTarget).unbind(".dragthreshold");this.proxy.setElement($("<div></div>").addClass("gliffy-document-proxy").html("<span class='dropping'><span class='gliffy-document-rename-spinner'></span></span><span class='dragging'>Move</span> <strong class='source'></strong> to <strong class='target'></strong><span class='no-target'>...</span>").appendTo("#gliffy"));this.proxy.getElement().children(".source").html(d.documentListItem.name);this.proxy.getElement().children(".dropping").hide();this.proxy.activate(function(g){d.drag(g)},function(h,g){d.drop(h,g)});this.proxy.move(f.pageX,f.pageY)}},endDrag:function(d){this.proxy=null;$(d.currentTarget).unbind(".dragthreshold")},drag:function(e){var d=GliffyApp.accountFoldersController.getFolderInfoAtPosition(e.pageX,e.pageY);$(".gliffy-dropzone").removeClass("gliffy-dropzone");if(d){$(d.element).addClass("gliffy-dropzone");this.proxy.getElement().children(".target").html(d.name);this.proxy.getElement().children(".no-target").hide()}else{this.proxy.getElement().children(".target").html("");this.proxy.getElement().children(".no-target").show()}return true},drop:function(j,f){var h=GliffyApp.accountFoldersController.getFolderInfoAtPosition(j.pageX,j.pageY),e=this.proxy,d=this,g;this.proxy=null;if(!h){$(".gliffy-dropzone").removeClass("gliffy-dropzone");f(false)}else{if(h.id===GliffyApp.accountFoldersController.getSelectedFolderId()){$(".gliffy-dropzone").removeClass("gliffy-dropzone");f(true)}else{e.getElement().children(".dropping").show();e.getElement().children(".dragging").hide();g=this.get("content");GLIFFY.API.POST("move_diagram.json",{diagramId:d.documentListItem.id,folderId:h.id},{success:function(k){if(k&&k.error){GliffyApp.documentListController.displayDocumentItemError(k.error);e.getElement().css({backgroundColor:"#ffbbaa"}).children(".dropping").hide();f(false)}else{e.getElement().css({backgroundColor:"#ccffdd"}).children(".dropping").hide();d.$().hide();GliffyApp.documentListController.removeSelectedDocumentItem();f(true);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"moveDiagram",label:window.location.pathname})}$(".gliffy-dropzone").removeClass("gliffy-dropzone")},error:function(n,l,k){var m;if(l==="timeout"){m="This could not be moved to "+h.name+" because the server could not be reached. Please make sure that you are connected to the internet and try again."}else{if(l==="error"&&n.status===401){m="You do not have permissions to move this to "+h.name+"."}else{if(l==="error"&&n.status===404){m="The document or folder does not exist anymore."}else{m="This could not be moved to "+h.name+" because of an unknown error. Please contact support if this continues to happen."}}}GliffyApp.documentListController.displayDocumentItemError(m);$(".gliffy-dropzone").removeClass("gliffy-dropzone");e.getElement().css({backgroundColor:"#ffbbaa"}).children(".dropping").hide();f(false)}})}}},click:function(d){d.preventDefault();if(!d.target.className.match(/\bclickable\b/)){GliffyApp.documentListController.handleSelectItem(d,this.documentListItem)}},handleDocumentCollaborate:function(d){d.preventDefault();GliffyApp.documentListController.handleDocumentCollaborate(d)},handleDocumentPublish:function(d){d.preventDefault();GliffyApp.documentListController.handleDocumentPublish(d)},favorite:function(d){d.preventDefault();GliffyApp.documentListController.handleSelectFavorite(d,this.documentListItem)},handleDocumentNameClick:function(d){d.preventDefault();GliffyApp.documentListController.handleDocumentNameClick(d,this.documentListItem)},handleInputKeyDown:function(d){if(d.keyCode===13){GliffyApp.documentListController.handleRenameDocument(d.currentTarget.value)}else{if(d.keyCode===27){GliffyApp.documentListController.hideRenameInput()}}}})}());(function(){GliffyApp.DocumentListView=Ember.View.extend({})}());(function(){GliffyApp.DocumentSearchView=Ember.View.extend({});GliffyApp.DocumentSearchTextField=Ember.TextField.extend({keyDown:function(c){if(c.keyCode===13){c.preventDefault();GliffyApp.documentSearchController.updateSearchValue(this.value)}},keyUp:function(c){GliffyApp.documentSearchController.updateSearchValue(c.currentTarget.value)}})}());(function(){GliffyApp.DocumentSortView=Ember.View.extend({})}());(function(){GliffyApp.FileMenuView=GliffyApp.FileMenuView.extend({menuRename:function(c){if(!c.isTrigger){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"rename"})}this.onMenuClick(c,"gliffy-toolbar-menu-file",false);$("#gliffy-rename-document-modal .gliffy-input-modal-error").hide();$("#gliffy-rename-document-modal .modal").modal("show");$("#gliffy-rename-document-modal input").val(GliffyApp.documentModel.title);$("#gliffy-rename-document-modal input").select()},menuSaveAs:function(c){if(!c.isTrigger){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"saveAs"})}this.onMenuClick(c,"gliffy-toolbar-menu-file",false);GliffyApp.saveDialogController.show();GliffyApp.saveDialogController.mode=GliffyApp.saveDialogController.DIALOG_MODE_SAVE_AS}})}());(function(){GliffyApp.FolderCreateModalView=GliffyApp.AbstractInputModalView.extend({didInsertElement:function(){var c=this;this.set("titleText",$.i18n._("online.folder.create.folder"));this.set("submitButtonText",$.i18n._("online.folder.create"));this.set("inputPlaceholderText",$.i18n._("online.folder.create.folder.untitled"));$("#gliffy-folder-rename-modal input").on("keydown",function(d){c.handleInputKeyDown(d)});$("#gliffy-folder-create-modal .gliffy-modal-footer .gliffy-btn-primary").on("click",function(f){var d=$(this);c.handleSubmit(f,d)})},handleSubmit:function(d,c){this._super(d);c.prop("disabled",true);GliffyApp.accountFoldersController.createFolder($("#gliffy-folder-create-modal input").val(),function(){c.prop("disabled",false);$("#gliffy-folder-create-modal .gliffy-modal").modal("hide")},c)}})}());(function(){GliffyApp.RenameModalView=GliffyApp.AbstractInputModalView.extend({didInsertElement:function(){var c=this;this.set("titleText",$.i18n._("online.document.rename.diagram"));this.set("submitButtonText",$.i18n._("online.document.rename"));$("#gliffy-rename-document-modal .gliffy-btn-primary").on("click",function(d){c.handleSubmit(d)});$("#gliffy-rename-document-modal .gliffy-input-modal-input").on("keydown",function(d){c.handleInputKeyDown(d)})},handleSubmit:function(g){var d=this,f=$("#gliffy-rename-document-modal input").val(),c=GLIFFY.editor.getDocumentManager().getActiveDocument();this._super(g);if(GliffyApp.documentListController.validateDocumentName($("#gliffy-rename-document-modal input").val(),function(e){d.displayErrorMessage(e)})){GliffyApp.documentListController.renameDocument(GliffyApp.documentModel,f,function(e){if(e.error){d.displayErrorMessage(e.error)}else{c.setTitle(f);GliffyApp.documentModel.update(c);$("#gliffy-rename-document-modal .gliffy-modal").modal("hide")}},function(e){d.displayErrorMessage(e)})}}})}());(function(){GliffyApp.TagImageModalView=Ember.View.extend({didInsertElement:function(d){var c=this;$("#gliffy-modal-online-tag-image").on("hide",function(f){$(".gliffy-tag-name-error").hide()});$("#gliffy-modal-online-tag-image").on("show",function(f){$("#gliffy-image-tag-input").val("")});$("#gliffy-modal-online-tag-image").on("shown",function(f){$("#gliffy-image-tag-input").focus()});$("#gliffy-image-tag-input").on("keydown",function(f){c.handleInputKeyDown(f)})},handleInputKeyDown:function(c){if(c.keyCode===13){$("#gliffy-modal-online-tag-image .gliffy-modal-footer .gliffy-btn-primary").click()}}})}());(function(){GliffyApp.ImageSearchResultsModalView=Ember.View.extend({currentPageBinding:Ember.Binding.oneWay("GliffyApp.imageBrowserController.externalImageSearchPage"),currentPageHtml:Ember.computed(function(){var c=Number(this.get("currentPage"))*20;var d=c-20+1;return d+" of "+c}).property("currentPage"),totalResultsBinding:Ember.Binding.oneWay("GliffyApp.imageBrowserController.externalImageSearchResults"),totalResultsHtml:Ember.computed(function(){if(this.get("totalResults")){return this.get("totalResults").toLocaleString()}else{return null}}).property("totalResults"),imageSearchResultsSummaryMessage:Ember.computed(function(){return $.i18n._("online.image.search.results.instructions",[this.get("currentPageHtml"),this.get("totalResultsHtml")])}).property("currentPageHtml","totalResultsHtml"),didInsertElement:function(){$("#gliffy-modal-image-search-results .gliffy-pager-previous-btn").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-modal-image-search-results .gliffy-pager-next-btn").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-modal-image-search-results .gliffy-image-search-results").delegate(".gliffy-image-search-result img","click",function(c){GliffyApp.imageBrowserController.addExternalImage($(c.currentTarget).parent().data("params"))});$("#gliffy-modal-image-search-results .gliffy-image-search-results-body-top").on("keydown",function(c){if(c.keyCode===13){GliffyApp.imageBrowserController.doExternalImageSearch($("#gliffy-modal-image-search-results input").val())}})}})}());(function(){GliffyApp.LoginSignupModalView=Ember.View.extend({didInsertElement:function(k){var l,f,h,d=0;var m="#gliffy-signup-organization-size";var g=m+" ul";var c=m+" .dropdown-toggle";var j="#organizationSizeField";$.ajax({url:"/go/getOrganizationSizesJson",dataType:"json",success:function(e){l=e;_.each(l,function(n){$(g).append('<li><a href="#" data-index="'+d+'">'+n+"</a></li>");d++});$(g).on("click",function(n){n.preventDefault();f=$(n.target);FormHelpers.updateDropDown(c,f);FormHelpers.updateHiddenField(j,f)});if($(j).val()!=""){h=$(j).val();if(h!=""){$(g+" li a:contains('"+h+"')").click()}}}})}})}());(function(){GliffyApp.LoginView=Ember.View.extend({controller:null})}());(function(){GliffyApp.SignupView=Ember.View.extend({})}());(function(){GliffyApp.CollaborationModalView=Ember.View.extend({didInsertElement:function(d){var c=this;$("#gliffy-collaboration-modal .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").on("keydown",function(f){c.handleConfirmCodeKeyDown(f)})},handleConfirmCodeKeyDown:function(c){if(c.keyCode===13){GliffyApp.collaborationController.verifyEmail($("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").val())}}})}());(function(){GliffyApp.UserListItemView=Ember.View.extend({})}());(function(){GliffyApp.CollaboratorListItemView=GliffyApp.UserListItemView.extend({})}());(function(){GliffyApp.CollaboratorListItemExperimentAddToTeamAccountView=GliffyApp.UserListItemView.extend({})}());(function(){GliffyApp.PublishModalView=Ember.View.extend({didInsertElement:function(d){var c=this;GliffyApp.publishController.config();$("#gliffy-publish-modal .gliffy-icon-question").popover({placement:"right",trigger:"hover",delay:{show:650,hide:50}});$("#gliffy-publish-modal .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-publish-modal .gliffy-publish-images-share li a").on("click",function(f){c.handleImageSizeSelect(f)})},handleImageSizeSelect:function(c){c.preventDefault();GliffyApp.publishController.handleImageSizeSelect($(c.currentTarget).html())},handleSocialClick:function(c){GliffyApp.publishController.handleSocialPublish($(c.currentTarget).data("gliffy-social"))}})}());(function(){GliffyApp.AccountManageModalView=Ember.View.extend({didInsertElement:function(){var c=$.url().param("showUserManagement");if(c==="true"){GliffyApp.accountManageController.theModal=$("#gliffy-account-modal");GliffyApp.accountManageController.showAccountUsersModal()}function e(){var g=$("#account-gdrive .gdrive-default-message");var f=g.find("span");window.clearTimeout(d);if($(this).is(":checked")){f.html($.i18n._("gdrive.default.save.location.message"));GLIFFY.PLUGINS.pluginManager.setDefaultContext("googleDrivePlugin")}else{f.html($.i18n._("gliffy.default.save.location.message"));GLIFFY.PLUGINS.pluginManager.setDefaultContext("gliffyDrivePlugin")}g.show();d=setTimeout(function(){g.fadeOut(1000)},3000)}var d;$(window).on("gliffy.authController.accountLoadedEvent",function(){if(!$(".gdrive-default-checkbox :checkbox").data("events")){$(".gdrive-default-checkbox :checkbox").change(e)}});$("#sbmtCancel").on("click",this.cancelEvents)},cancelEvents:function(c){GliffyApp.accountManageController.sendSegmentDataOnCancel(c);GliffyApp.accountManageController.updateAccountStatus(c)},remainingUsersBinding:Ember.Binding.oneWay("GliffyApp.accountManageController.remainingUsers"),remainingDiagramsBinding:Ember.Binding.oneWay("GliffyApp.accountManageController.remainingDiagrams"),remainingUsersMessage:Ember.computed(function(){return $.i18n._("online.account.management.add.users.notice",[this.get("remainingUsers")])}).property("remainingUsers"),remainingDiagramsMessage:Ember.computed(function(){return $.i18n._("online.account.management.account.summary.warning",[this.get("remainingDiagrams")])}).property("remainingDiagrams")});GliffyApp.AccountUserList=Ember.View.extend({tagName:"tr"});GliffyApp.AccountErrorList=Ember.View.extend({tagName:"li"});GliffyApp.AccountMenuView=Ember.View.extend({tagName:"a",isSelected:false,click:function(){GliffyApp.accountManageController.setTab(this.href);GliffyApp.accountManageController.hidePIAlerts();this.$().addClass("open-pill-account")}});GliffyApp.AccountManagerButtonView=Ember.View.extend({classNames:["account-manage-btn"],showAccountModal:function(c){c.preventDefault();GliffyApp.accountManageController.show()},switchAccounts:function(c){c.preventDefault();GliffyApp.accountSwitchController.show()}})}());(function(){GliffyApp.TempPasswordView=Ember.View.extend({didInsertElement:function(){var c=this;$(".gliffy-reset-password-primary-button").on("click",function(d){c.handleResetPasswordClick(d)})},getPassword1:function(){return $("#gliffy-password1").val()},getPassword2:function(){return $("#gliffy-password2").val()},validate:function(){var d=this.getPassword1(),c=this.getPassword2();if(d.length===0){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-temp-password-modal","You need to enter in a new password.");return false}if(c.length===0){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-temp-password-modal","You need to confirm your new password.");return false}if(d!==c){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-temp-password-modal","Your passwords do not match.");return false}return true},handleResetPasswordClick:function(c){c.preventDefault();if(this.validate()){window.GLIFFY.API.POST("user/changePassword",{password1:this.getPassword1(),password2:this.getPassword2()},{success:function(e,f,d){if(e.errors&&e.errors.length>0){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-temp-password-modal",e.errors)}else{GliffyApp.tempPasswordController.hide()}},error:function(f,d,e){console.error("error logging in",f,d,e)},context:this})}}})}());(function(){GliffyApp.SaveModalView=Ember.View.extend({didInsertElement:function(){GliffyApp.saveDialogController.getModal().find("form").submit(function(c){c.preventDefault();GliffyApp.saveDialogController.applySave()});GliffyApp.saveDialogController.getModal().find(".gliffy-account-folders-container").bind("folderClicked",function(d,c){GliffyApp.saveDialogController.handleFolderClick(c)});GliffyApp.saveDialogController.getModal().find(".close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-save-modal .gliffy-account-folders").scroll(function(c){GliffyApp.accountFoldersController.scroll(c,this)})}})}());(function(){GliffyApp.VerifyEmailView=Ember.View.extend({didInsertElement:function(c){$("#gliffy-verify-email-modal .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)}})}());(function(){GliffyApp.ManageUsersView=Ember.View.extend({listTitle:null,didInsertElement:function(c){this.set("listTitle",$.i18n._("online.account.current.users"));GliffyApp.accountManageController.addObserver("remainingUsers",function(){var d=(GliffyApp.accountManageController.get("remainingUsers")<=0);if(GliffyApp.accountManageController.theModal){GliffyApp.accountManageController.theModal.find(".gliffy-manage-users-add-textarea").attr("disabled",d);GliffyApp.accountManageController.theModal.find(".gliffy-manage-users-btns .gliffy-btn-primary").attr("disabled",d);if(d){GliffyApp.accountManageController.theModal.find(".gliffy-manage-users-btns .gliffy-btn-primary .gliffy-save-spinner").hide()}}})}})}());(function(){GliffyApp.AccountSwitchView=Ember.View.extend({})}());(function(){GliffyApp.FolderPermissionsModalView=Ember.View.extend({didInsertElement:function(){var c=this;$("#gliffy-folder-permissions-modal .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)}})}());(function(){GliffyApp.BannerView=Ember.View.extend({didInsertElement:function(d){var c=this;$(this.element).show();if(GLIFFY.editor){GLIFFY.editor.updateContainerSize();this.addObserver("majorStatusChange",function(){c.rerender();GLIFFY.editor.updateContainerSize()})}else{$("html").addClass("gliffy-banner");this.addObserver("majorStatusChange",function(){if(GliffyApp.authController.isEnterpriseAccount()||GliffyApp.authController.isPremiumAccount()||GliffyApp.authController.isAnonymousAccount()){$("html").removeClass("gliffy-banner")}else{$("html").addClass("gliffy-banner")}})}}})}());(function(){GliffyApp.ModalAlertView=Ember.View.extend({didInsertElement:function(c){this.$().find("a.close").on("click",function(d){$(d.currentTarget).parent().hide()})}})}());(function(){GliffyApp.AccountUpgradePurchaseView=Ember.View.extend({});GliffyApp.AccountUpgradePurchaseModalView=Ember.View.extend({})}());(function(){GliffyApp.FeedbackModalView=Ember.View.extend({didInsertElement:function(){}})}());(function(){GliffyApp.ExpirationNoticeView=Ember.View.extend({commentPlaceholderMessage:Ember.computed(function(){return $.i18n._("online.free.survey.comment.placeholder")}).property()})}());(function(){GliffyApp.ImageInfoView=Ember.View.extend({filenameBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.filename"),heightBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.height"),idBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.id"),imageBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.image"),sizeBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.size"),tagsBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.tags"),thumbnailBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.thumbnail"),tidBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.tid"),uidBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.uid"),urlBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.url"),useOriginalDimensionsBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.useOriginalDimensions"),widthBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.width")})}());(function(){GliffyApp.TrialTeamInviteModalView=Ember.View.extend({didInsertElement:function(c){GliffyApp.trialTeamInviteModalController.bindEvents()}})}());(function(){GliffyApp.TrialSignupInviteModalView=Ember.View.extend({didInsertElement:function(c){GliffyApp.trialSignupInviteModalController.bindEvents()}})}());(function(){GliffyApp.HelpMenuCustomerSupportView=Ember.View.extend({didInsertElement:function(){window.GLIFFY.ONLINE.INTEGRATION.editorUiObserver.insertAfterWhenEditorReady("#help-menu-customer-support",".gliffy-help-menu-link-eula")}});GliffyApp.helpMenuCustomerSupportView=GliffyApp.HelpMenuCustomerSupportView.create()}());(function(){GliffyApp.OpenFromView=Ember.View.extend({didInsertElement:function(){$(window).bind("gliffy.loginEvent",function(c){GliffyApp.authController.refreshAccountSettings(function(){window.GLIFFY.ONLINE.INTEGRATION.editorUiObserver.insertAfterWhenEditorReady("#filemenu-open-from",".gliffy-filemenu-open")})});if(!GliffyApp.authController.isAnonymousAccount()){window.GLIFFY.ONLINE.INTEGRATION.editorUiObserver.insertAfterWhenEditorReady("#filemenu-open-from",".gliffy-filemenu-open")}}});GliffyApp.openFromView=GliffyApp.OpenFromView.create()}());(function(){GliffyApp.SaveAsOverrideView=Ember.View.extend({didInsertElement:function(){$(window).bind("gliffy.loginEvent",function(c){GliffyApp.authController.refreshAccountSettings(function(){window.GLIFFY.ONLINE.INTEGRATION.editorUiObserver.insertAfterWhenEditorReady("#file-menu-saveAs-override",".gliffy-filemenu-menuSave")})});if(!GliffyApp.authController.isAnonymousAccount()){window.GLIFFY.ONLINE.INTEGRATION.editorUiObserver.insertAfterWhenEditorReady("#file-menu-saveAs-override",".gliffy-filemenu-menuSave")}}});GliffyApp.saveAsOverrideView=GliffyApp.SaveAsOverrideView.create()}());(function(){GliffyApp.HelpMenuSendFeedbackView=Ember.View.extend({});GliffyApp.helpMenuSendFeedbackView=GliffyApp.HelpMenuSendFeedbackView.create()}());(function(){GliffyApp.AuthorizeGDriveView=Ember.View.extend({});GliffyApp.authorizeGDriveView=GliffyApp.AuthorizeGDriveView.create()}());(function(){GliffyApp.SaveBeforeGoogleDriveOpenView=Ember.View.extend({})}());(function(){GliffyApp.ExplicitOnboardingStepsView=Ember.View.extend({didInsertElement:function(){if(GliffyApp.authController.account.isTrial){GliffyApp.explicitOnboardingStepsController.showOnboardingPopup();$("body").on("updateOnboardingSteps",function(){GliffyApp.explicitOnboardingStepsController.updateOnboardingSteps()})}}})}());(function(){GliffyApp.AccountUserAdditionalInfoView=Ember.View.extend({})}());(function(){GLIFFY.onlineUtils.postdecorate(GLIFFY.Renderer.ImageCanvas,"getUrl",function(d,c){var e=window.location.protocol+"//"+window.location.host;if(d&&d.indexOf(e)===0){return window.GLIFFY.API.getAuthUrl(d)}else{if(d==null){return window.GLIFFY.API.getAuthUrl("/go/assets/images/image_not_available.jpg")}else{return d}}})}());(function(){var c=0;function e(g){c=(new Date()).getTime();try{window.localStorage.setItem("clipboardtime",c);window.localStorage.setItem("clipboard",JSON.stringify({type:"local",data:g}))}catch(h){window.localStorage.removeItem("clipboard");$.ajax({url:GLIFFY.API.getAuthUrl("/go/clipboard/copy"),type:"POST",data:{data:JSON.stringify(g)},async:false,success:function(){window.localStorage.setItem("clipboardtime",c);window.localStorage.setItem("clipboard",JSON.stringify({type:"server",url:"/go/clipboard/copy"}))}})}}GLIFFY.onlineUtils.postdecorate(GLIFFY.CopyCommand,"execute",function(h,g){e(this.nodeObject)});GLIFFY.onlineUtils.postdecorate(GLIFFY.CutCommand,"execute",function(h,g){e(this.nodeObject)});GLIFFY.onlineUtils.override(GLIFFY.PasteCommand,"getNode",function(h,m){var j=new GLIFFY.Node(),l=h.commandHistory.getClipboard(),g=window.localStorage.getItem("clipboardtime"),k;if(g){g=parseInt(g)}else{g=0}if(g<=c&&l){j.fromObject(l.nodeObject);m(j)}else{k=JSON.parse(window.localStorage.getItem("clipboard"));if(k.type==="local"){j.fromObject(k.data);f(j,function(){m(j)})}else{if(k.type==="server"){$.ajax({url:GLIFFY.API.getAuthUrl(k.url),type:"GET",dataType:"json",async:false,success:function(n){c=(new Date()).getTime();j.fromObject(n);f(j,function(){m(j)})}})}}}});function f(k,j){var h=[],m=[],g,l;d([k],h,m);l=function(){j()};g=function(){GLIFFY.shapeLibrary.loadStencils(m).done(l)};j()}function d(g,l,n){var j,m,k,h;for(h=0;h<g.length;h++){k=g[h];if(k.isShape()){j=k.getUid();if($.inArray(j,l)===-1&&j){l.push(j)}if(k.getGraphic()){m=k.getGraphic().getTid();if($.inArray(m,n)===-1&&m){n.push(m)}}}if(k.children){d(k.children,l,n)}}}}());(function(){var d="/go/assets/images/loading.png",c=new Image();c.src=d;GLIFFY.UrlFileHandler=GLIFFY.DefaultFileHandler.extend({init:function(e){this.drawManager=e},handle:GLIFFY.onlineUtils.requireAccountPermission("storage",function(){return GliffyApp.authController.canAccountAddImage()},function(h,g){var f=this,j,e=GLIFFY.Mouse.getPosition(),k;if(g&&g>0){e.x+=g%5*OFFSET;e.y+=Math.floor(g/5)*OFFSET}j=new GLIFFY.Node();k={name:h.name,getImageUrl:function(l){GLIFFY.API.POST("upload_image_url.json",{url:h.url},{query:{accountId:GliffyApp.authController.getAccountId()},success:function(m){if(typeof(m)==="string"){m=JSON.parse(m)}l(GLIFFY.API.getAuthUrl(m.url));GliffyApp.imageBrowserController.loadImages("");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"imageBrowser",action:"uploadImage",label:h.name.substring(h.name.lastIndexOf(".")+1)})},error:function(){l(null)}})},uid:"com.gliffy.shape.basic.basic_v1.default.image",tid:"com.gliffy.stencil.image",useOriginalDimensions:true};GLIFFY.Utils.analyticsEvent("trackEvent",{category:"browserDragAndDrop",action:"image"});f.drawManager.setupShape(j,k,e)}),canHandleFile:function(e){return e.type==="url"&&e.url!==null}})}());(function(){GLIFFY.UploadImageFileHandler=GLIFFY.DefaultFileHandler.extend({MAX_FILE_SIZE_BYTES:512000,init:function(c){this.drawManager=c},handle:GLIFFY.onlineUtils.requireAccountPermission("storage",function(){return GliffyApp.authController.canAccountAddImage()},function(h,g){var d=new window.FileReader(),c=GLIFFY.Mouse.getPosition(),f=this,j=100;if(c.x<0){c.x=100}if(c.y<0){c.y=100}if(g&&g>0){c.x+=g%5*j;c.y+=Math.floor(g/5)*j}d.onload=function(k){if(h.size>f.MAX_FILE_SIZE_BYTES){f.__resizeImage(k.target.result).then(function(l){f.__addImage(h.name,l,c)})}else{f.__addImage(h.name,k.target.result,c)}};d.readAsDataURL(h);var e=new FormData();e.append("file-0",h);e.append("accountId",GliffyApp.authController.getAccountId());e.append("filename",h.name);$.ajax({url:window.GLIFFY.API.getActionUrl("upload_image.json",null),data:e,cache:false,contentType:false,processData:false,type:"POST",success:function(k){GliffyApp.imageBrowserController.render();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"imageBrowser",action:"uploadImageD&D",label:h.name})}})}),canHandleFile:function(c){return c.type==="image/jpeg"||c.type==="image/png"||c.type==="image/gif"},handleCustomLibraryUpload:function(g,f,e){var c=new window.FileReader(),d=this;c.onload=function(h){d.__generateThumbnail(h.target.result,50).then(function(j){if(g.size>d.MAX_FILE_SIZE_BYTES){d.__resizeImage(h.target.result).then(function(k){e.addFile({name:g.name,uid:"com.gliffy.shape.basic.basic_v1.default.image",data:k,thumbnail:j})})}else{e.addFile({name:g.name,uid:"com.gliffy.shape.basic.basic_v1.default.image",data:h.target.result,thumbnail:j})}},function(){e.addFile({name:g.name,uid:"com.gliffy.shape.basic.basic_v1.default.image",data:h.target.result,thumbnail:h.target.result});GLIFFY.Logger.warn("Failed to generate a thumbnail")})};c.readAsDataURL(g)},__generateThumbnail:function(c,h){var e=document.createElement("canvas"),l=e.getContext("2d"),f=new Image(),k=new $.Deferred(),d,g,j=this;f.onload=function(){g=j.__resize(f.width,f.height,h,h);e.width=h;e.height=h;l.drawImage(f,g.x,g.y,g.w,g.h);d=e.toDataURL("image/png");k.resolve(d)};f.onerror=function(){k.reject()};f.src=c;return k.promise()},__resize:function(o,e,c,f){var l=0,d=0,k=0,j=0,n=o/c,m=e/f,g=Math.max(n,m);if(g>1){l=o/g;d=e/g}else{l=o;d=e}k=(c-l)/2;j=(f-d)/2;return{w:l,h:d,x:k,y:j}},__addImage:function(d,g,c){var e,f;e=new GLIFFY.Node();f={name:d,thumbnail:g,doNotProxyImage:true,image:g,uid:"com.gliffy.shape.basic.basic_v1.default.image",tid:"com.gliffy.stencil.image",useOriginalDimensions:true};GLIFFY.Utils.analyticsEvent("trackEvent",{category:"fileDragAndDrop",action:"image"});this.drawManager.setupShape(e,f,c)},__resizeImage:function(k){var g=document.createElement("canvas"),c=g.getContext("2d"),f=new Image(),e=new $.Deferred(),j,h,d=this;f.onload=function(){var l=1;do{h=d.__resize(f.width,f.height,f.width/l,f.height/l);g.width=f.width/l;g.height=f.height/l;c.drawImage(f,h.x,h.y,h.w,h.h);j=g.toDataURL("image/png");l=l*2}while(j.length>d.MAX_FILE_SIZE_BYTES);e.resolve(j)};f.onerror=function(){e.reject()};f.src=k;return e.promise()}})}());(function(){GLIFFY.onlineUtils.override(GLIFFY.FileHandlerRegister,"register",function(c){this.add(new GLIFFY.UploadImageFileHandler(c));this.add(new GLIFFY.UrlFileHandler(c));this.add(this.SVG_FILE_HANDLER);this.add(this.DEFAULT_FILE_HANDLER)})}());(function(){GliffyApp.AccountUpgradeSimplifiedPricingPagesView=Ember.View.extend({didInsertElement:function(c){}})}());(function(){GliffyApp.AccountUpgradeBusinessTeamDealView=Ember.View.extend({didInsertElement:function(c){}})}());(function(){GliffyApp.ShareTheGliffyLoveView=Ember.View.extend({didInsertElement:function(c){if(Experiments&&Experiments.ShowRecommendGliffyMenu&&Experiments.ShowRecommendGliffyMenu.bindEvents){Experiments.ShowRecommendGliffyMenu.bindEvents()}}})}());(function(){GliffyApp.EnhancedModalView=Ember.View.extend({didInsertElement:function(c){}})}());(function(){GliffyApp.EnhancedLoginSignupModalView=Ember.View.extend({})}());(function(){GliffyApp.EnhancedTeamInviteModalView=Ember.View.extend({})}());(function(){GliffyApp.AccountEditorPurchasePageView=Ember.View.extend({didInsertElement:function(c){}})}());(function(){GliffyApp.AccountEditorStripePurchasePageView=Ember.View.extend({didInsertElement:function(c){}})}());(function(){GliffyApp.FinalView=Ember.View.extend({didInsertElement:function(c){$("body").trigger("templatesReady")}})}())}());